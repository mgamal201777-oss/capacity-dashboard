<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Partner Capacity Dashboard - Jan 2026 vs Feb 2026</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Custom Tooltip Styles */
        .kpi-tooltip-wrapper {
            position: relative;
            cursor: pointer;
        }
        .kpi-tooltip-wrapper .kpi-tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            min-width: 280px;
            max-width: 320px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #f8fafc;
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 12px;
            line-height: 1.6;
            text-align: left;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
            z-index: 1000;
            transition: all 0.25s ease;
        }
        .kpi-tooltip-wrapper .kpi-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-top-color: #334155;
        }
        .kpi-tooltip-wrapper:hover .kpi-tooltip {
            visibility: visible;
            opacity: 1;
            bottom: calc(100% + 8px);
        }
        .kpi-tooltip .tooltip-title {
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .kpi-tooltip .tooltip-calc {
            background: rgba(255,255,255,0.1);
            padding: 8px 10px;
            border-radius: 6px;
            margin: 8px 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
        }
        .kpi-tooltip .tooltip-highlight {
            color: #fbbf24;
            font-weight: 600;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: white;
            border-bottom: 2px solid #e5e7eb;
            padding: 20px 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            color: #1f4e78;
            margin-bottom: 5px;
        }

        .header-subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #2563eb;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            transition: border 0.2s;
        }

        .search-box:focus {
            border-color: #3b82f6;
        }

        .section-slicer-bar {
            display: none;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px 12px;
            margin-top: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        }

        .section-slicer-title {
            font-weight: 700;
            color: #1f2937;
            font-size: 13px;
            margin-right: 4px;
        }

        .section-slicer-btn {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: #f8fafc;
            color: #1f2937;
            font-weight: 700;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .section-slicer-btn:hover {
            border-color: #3b82f6;
            color: #1d4ed8;
            background: #eff6ff;
        }

        .blurred-row {
            filter: blur(2px);
            opacity: 0.45;
            transition: filter 0.2s ease, opacity 0.2s ease;
        }

        .tooltip-btn {
            position: relative;
        }

        .tooltip-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            bottom: calc(100% + 10px);
            transform: translateX(-50%);
            background: #0f172a;
            color: #f8fafc;
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.25);
            transition: opacity 0.2s ease, transform 0.2s ease;
            z-index: 50;
        }

        .tooltip-btn::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: calc(100% + 2px);
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #0f172a transparent transparent transparent;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 50;
        }

        .tooltip-btn:hover::after,
        .tooltip-btn:hover::before {
            opacity: 1;
        }

        /* Card tooltips - allow text wrapping */
        .tooltip-card {
            position: relative;
        }
        .tooltip-card::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            bottom: calc(100% + 8px);
            transform: translateX(-50%);
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.5;
            white-space: normal;
            width: max-content;
            max-width: 220px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 8px 20px rgba(124, 58, 237, 0.35);
            transition: opacity 0.15s ease, transform 0.15s ease;
            z-index: 100;
        }
        .tooltip-card::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: calc(100% + 0px);
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #7c3aed transparent transparent transparent;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
            z-index: 100;
        }
        .tooltip-card:hover::after,
        .tooltip-card:hover::before {
            opacity: 1;
        }

        /* Teal card tooltips for Riders Slab section */
        .tooltip-card-teal {
            position: relative;
        }
        .tooltip-card-teal::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            bottom: calc(100% + 8px);
            transform: translateX(-50%);
            background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.5;
            white-space: normal;
            width: max-content;
            max-width: 220px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 8px 20px rgba(15, 118, 110, 0.35);
            transition: opacity 0.15s ease, transform 0.15s ease;
            z-index: 100;
        }
        .tooltip-card-teal::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: calc(100% + 0px);
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #0f766e transparent transparent transparent;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
            z-index: 100;
        }
        .tooltip-card-teal:hover::after,
        .tooltip-card-teal:hover::before {
            opacity: 1;
        }

        /* Sky card tooltips for Top/Bottom Partners section */
        .tooltip-card-sky {
            position: relative;
        }
        .tooltip-card-sky::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            bottom: calc(100% + 8px);
            transform: translateX(-50%);
            background: linear-gradient(135deg, #0284c7 0%, #0ea5e9 100%);
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.5;
            white-space: normal;
            width: max-content;
            max-width: 220px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.35);
            transition: opacity 0.15s ease, transform 0.15s ease;
            z-index: 100;
        }
        .tooltip-card-sky::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: calc(100% + 0px);
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #0284c7 transparent transparent transparent;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
            z-index: 100;
        }
        .tooltip-card-sky:hover::after,
        .tooltip-card-sky:hover::before {
            opacity: 1;
        }

        .tooltip-btn-green::after {
            background: #065f46;
            box-shadow: 0 8px 18px rgba(6, 95, 70, 0.28);
        }

        .tooltip-btn-green::before {
            border-color: #065f46 transparent transparent transparent;
        }

        .tooltip-btn-blue::after {
            background: #1d4ed8;
            box-shadow: 0 8px 18px rgba(29, 78, 216, 0.28);
        }

        .tooltip-btn-blue::before {
            border-color: #1d4ed8 transparent transparent transparent;
        }

        .tooltip-btn-purple::after {
            background: #6d28d9;
            box-shadow: 0 8px 18px rgba(109, 40, 217, 0.28);
        }

        .tooltip-btn-purple::before {
            border-color: #6d28d9 transparent transparent transparent;
        }

        .tooltip-btn-teal::after {
            background: #0f766e;
            box-shadow: 0 8px 18px rgba(15, 118, 110, 0.28);
        }

        .tooltip-btn-teal::before {
            border-color: #0f766e transparent transparent transparent;
        }

        .tooltip-btn-sky::after {
            background: #0ea5e9;
            box-shadow: 0 8px 18px rgba(14, 165, 233, 0.28);
        }

        .tooltip-btn-sky::before {
            border-color: #0ea5e9 transparent transparent transparent;
        }

        .tabs {
            background: white;
            border-bottom: 2px solid #e5e7eb;
            padding: 0 30px;
            overflow-x: auto;
        }

        .tab-list {
            display: flex;
            gap: 20px;
            list-style: none;
            min-width: max-content;
        }

        .tab-item {
            padding: 16px 12px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab-item:hover {
            color: #3b82f6;
        }

        .tab-item.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .content {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        .share-slicer-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #6b7280;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 12px;
            transition: all 0.2s;
        }

        .share-slicer-btn.active {
            background: #7c3aed;
            color: white;
            border-color: #7c3aed;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.2);
        }

        .slab-slicer-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #6b7280;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 12px;
            transition: all 0.2s;
        }

        .slab-slicer-btn.active {
            background: #1e5a8e;
            color: white;
            border-color: #1e5a8e;
            box-shadow: 0 4px 10px rgba(30, 90, 142, 0.2);
        }

        /* Slicer panel animations */
        .slicer-panel {
            animation: slicerFadeIn 0.4s ease-out;
        }
        
        @keyframes slicerFadeIn {
            0% {
                opacity: 0;
                transform: translateY(15px) scale(0.98);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes slicerSlideIn {
            0% {
                opacity: 0;
                transform: translateX(-20px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Tier Tables Slicer Button Styles */
        .tier-table-slicer-btn:hover {
            background: #e0e7ff !important;
            border-color: #818cf8 !important;
            color: #3730a3 !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(79, 70, 229, 0.2);
        }
        .tier-table-slicer-btn.active {
            background: #1e3a8a !important;
            color: white !important;
            border-color: #1e3a8a !important;
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.35);
        }

        /* Advanced Donut Meter Styles */
        .donut-meter-container {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 16px 22px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 20px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.1), inset 0 2px 0 rgba(255,255,255,0.9);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease, filter 0.4s ease;
            opacity: 0;
            transform: translateY(30px) scale(0.9);
        }
        .donut-meter-container.animate-in {
            animation: donutFlyIn 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes donutFlyIn {
            0% { opacity: 0; transform: translateY(30px) scale(0.9); }
            60% { opacity: 1; transform: translateY(-8px) scale(1.03); }
            80% { transform: translateY(4px) scale(0.98); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .donut-meter-container:hover {
            transform: translateY(-4px) scale(1.02) !important;
            box-shadow: 0 12px 36px rgba(0,0,0,0.15), inset 0 2px 0 rgba(255,255,255,0.9);
            opacity: 1 !important;
            filter: none !important;
        }
        .donut-meter-container.fr-theme {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .donut-meter-container.dc-theme {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        /* KPI Card PPT-style fly-in animation */
        .kpi-card-animated {
            opacity: 0;
            transform: translateY(30px) scale(0.9);
            transition: all 0.3s ease;
        }
        .kpi-card-animated.fly-in {
            animation: kpiCardFlyIn 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes kpiCardFlyIn {
            0% { opacity: 0; transform: translateY(35px) scale(0.9); }
            60% { opacity: 1; transform: translateY(-10px) scale(1.04); }
            80% { transform: translateY(5px) scale(0.98); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .kpi-card-animated:hover {
            transform: translateY(-3px) scale(1.02) !important;
            box-shadow: 0 12px 28px rgba(0,0,0,0.12);
        }
        .donut-meter {
            position: relative;
            width: 100px;
            height: 100px;
            flex-shrink: 0;
        }
        .donut-meter svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        .donut-meter .donut-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 7;
        }
        .donut-meter .donut-progress {
            fill: none;
            stroke-width: 7;
            stroke-linecap: round;
            transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.3s ease;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.2));
            stroke-dashoffset: 87.96;
        }
        .donut-meter-container.animate-in .donut-progress {
            animation: donutProgress 1.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            animation-delay: 0.3s;
        }
        @keyframes donutProgress {
            from { stroke-dashoffset: 87.96; }
        }
        .donut-meter .donut-progress.fr-stroke {
            stroke: url(#frGradient);
        }
        .donut-meter .donut-progress.dc-stroke {
            stroke: url(#dcGradient);
        }
        .donut-meter .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .donut-meter .donut-value {
            font-size: 20px;
            font-weight: 800;
            color: #1f2937;
            line-height: 1;
        }
        .donut-meter .donut-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            margin-top: 3px;
        }
        .donut-meter-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .donut-meter-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.7px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .donut-meter-title .kpi-badge {
            font-size: 10px;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
        }
        .donut-meter-subtitle {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }
        .donut-dual-wrapper {
            display: flex;
            gap: 12px;
        }
        .donut-single {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .donut-single .donut-meter {
            width: 88px;
            height: 88px;
        }
        .donut-single .donut-sub-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
        }

        /* Partner Age Table Row Focus Effect */
        #partnerAgeTable tbody tr {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #partnerAgeTable tbody tr:hover {
            background: #f0f9ff !important;
        }
        #partnerAgeTable tbody tr:hover td:first-child {
            background: #f0f9ff !important;
        }
        #partnerAgeTable.has-focus tbody tr {
            opacity: 0.35;
            filter: blur(1px);
        }
        #partnerAgeTable.has-focus tbody tr.row-focused {
            opacity: 1;
            filter: none;
            background: #dbeafe !important;
            box-shadow: 0 0 0 2px #3b82f6;
            position: relative;
            z-index: 1;
        }
        #partnerAgeTable.has-focus tbody tr.row-focused td:first-child {
            background: #dbeafe !important;
        }
        #partnerAgeTable tbody tr.row-focused td:first-child::before {
            content: '👉';
            position: absolute;
            left: -24px;
            font-size: 14px;
        }
        #partnerAgeTable tbody tr td:first-child {
            position: sticky;
            left: 0;
            z-index: 2;
            background: inherit;
        }
        #partnerAgeTable thead th:first-child {
            position: sticky;
            left: 0;
            z-index: 12;
        }

        /* City-wise Table Row Focus Effect */
        #cityWiseTable tbody tr {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #cityWiseTable tbody tr:hover {
            background: #f0fdf4 !important;
        }
        #cityWiseTable.has-focus tbody tr {
            opacity: 0.35;
            filter: blur(1px);
        }
        #cityWiseTable.has-focus tbody tr.row-focused {
            opacity: 1;
            filter: none;
            background: #dcfce7 !important;
            box-shadow: 0 0 0 2px #22c55e;
            position: relative;
            z-index: 1;
        }
        #cityWiseTable tbody tr.row-focused td:first-child::before {
            content: '👉';
            position: absolute;
            left: -24px;
            font-size: 14px;
        }
        #cityWiseTable tbody tr td:first-child {
            position: relative;
        }

        .slab-table-increased span {
            background: transparent !important;
            color: #059669 !important;
            padding: 0 !important;
            border-radius: 0 !important;
            font-weight: 700 !important;
        }

        .slab-table-decreased span {
            background: transparent !important;
            color: #dc2626 !important;
            padding: 0 !important;
            border-radius: 0 !important;
            font-weight: 700 !important;
        }

        /* Ensure tab content stays centered */
        .tab-content {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Framework & Methodology - Advanced Layout */
        .framework-hero {
            background: linear-gradient(135deg, #1e3a8a 0%, #6d28d9 100%);
            border-radius: 16px;
            padding: 22px 24px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
            box-shadow: 0 10px 24px rgba(30, 58, 138, 0.25);
            margin-bottom: 16px;
        }
        .framework-hero-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 6px;
        }
        .framework-hero-subtitle {
            font-size: 12px;
            opacity: 0.9;
        }
        .framework-hero-pills {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .framework-pill {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.2px;
        }
        .framework-grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin: 14px 0 18px;
        }
        .framework-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 18px;
        }
        .framework-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 14px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .framework-card h4 {
            margin: 0 0 8px;
            font-size: 13px;
            color: #111827;
        }
        .framework-card p {
            margin: 0;
            font-size: 12px;
            color: #4b5563;
            line-height: 1.6;
        }
        .framework-card ul {
            margin: 0;
            padding-left: 18px;
            font-size: 12px;
            color: #4b5563;
            line-height: 1.7;
        }
        .framework-card.accent-blue {
            border-top: 3px solid #3b82f6;
            background: #eff6ff;
        }
        .framework-card.accent-teal {
            border-top: 3px solid #14b8a6;
            background: #ecfeff;
        }
        .framework-card.accent-amber {
            border-top: 3px solid #f59e0b;
            background: #fff7ed;
        }
        .framework-card.accent-emerald {
            border-top: 3px solid #10b981;
            background: #ecfdf5;
        }
        .framework-chip-row {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .framework-chip {
            background: #dcfce7;
            color: #166534;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 999px;
        }
        .framework-flow {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 18px;
        }
        .flow-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 12px;
        }
        .flow-title {
            font-size: 14px;
            font-weight: 800;
            color: #4c1d95;
        }
        .flow-subtitle {
            font-size: 11px;
            color: #6b7280;
        }
        .flow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
        }
        .flow-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }
        .flow-card.accent-purple {
            border-left: 4px solid #8b5cf6;
        }
        .flow-step {
            font-size: 11px;
            font-weight: 700;
            color: #6d28d9;
            margin-bottom: 6px;
        }
        .flow-text {
            font-size: 12px;
            color: #374151;
            line-height: 1.5;
        }
        /* Advanced Flow Chart Styles */
        .flow-timeline {
            display: flex;
            flex-wrap: wrap;
            gap: 0;
            margin: 20px 0;
            position: relative;
        }
        .flow-timeline-item {
            flex: 1;
            min-width: 160px;
            max-width: 220px;
            position: relative;
            padding: 0 8px;
        }
        .flow-timeline-item::after {
            content: '→';
            position: absolute;
            right: -8px;
            top: 28px;
            font-size: 20px;
            color: #a78bfa;
            font-weight: 700;
            z-index: 2;
        }
        .flow-timeline-item:last-child::after {
            display: none;
        }
        .flow-step-card {
            background: linear-gradient(135deg, #faf5ff 0%, #ede9fe 100%);
            border: 2px solid #c4b5fd;
            border-radius: 14px;
            padding: 16px;
            position: relative;
            transition: all 0.3s ease;
            height: 100%;
        }
        .flow-step-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.25);
            border-color: #8b5cf6;
        }
        .flow-step-num {
            position: absolute;
            top: -12px;
            left: 16px;
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 800;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.4);
        }
        .flow-step-title {
            font-size: 13px;
            font-weight: 700;
            color: #5b21b6;
            margin: 8px 0 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .flow-step-desc {
            font-size: 12px;
            color: #4c1d95;
            line-height: 1.6;
        }
        .flow-callouts-advanced {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .flow-callout-advanced {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 14px;
            padding: 18px 20px;
            display: flex;
            gap: 14px;
            align-items: flex-start;
            transition: all 0.3s ease;
        }
        .flow-callout-advanced:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.25);
        }
        .flow-callout-advanced.red {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
        }
        .flow-callout-advanced.red:hover {
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.25);
        }
        .flow-callout-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
        }
        .flow-callout-advanced .flow-callout-icon {
            background: rgba(245, 158, 11, 0.2);
        }
        .flow-callout-advanced.red .flow-callout-icon {
            background: rgba(239, 68, 68, 0.2);
        }
        .flow-callout-content h4 {
            font-size: 14px;
            font-weight: 700;
            color: #92400e;
            margin: 0 0 6px;
        }
        .flow-callout-advanced.red .flow-callout-content h4 {
            color: #991b1b;
        }
        .flow-callout-content p {
            font-size: 13px;
            color: #78350f;
            line-height: 1.6;
            margin: 0;
        }
        .flow-callout-advanced.red .flow-callout-content p {
            color: #7f1d1d;
        }
        .framework-footer-advanced {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        .framework-footer-card-advanced {
            background: white;
            border-radius: 16px;
            padding: 22px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .framework-footer-card-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }
        .framework-footer-card-advanced.blue::before {
            background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
        }
        .framework-footer-card-advanced.green::before {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
        }
        .framework-footer-card-advanced.purple::before {
            background: linear-gradient(90deg, #8b5cf6 0%, #a78bfa 100%);
        }
        .framework-footer-card-advanced:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.12);
        }
        .framework-footer-card-advanced .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 14px;
        }
        .framework-footer-card-advanced.blue .card-icon { background: #dbeafe; }
        .framework-footer-card-advanced.green .card-icon { background: #d1fae5; }
        .framework-footer-card-advanced.purple .card-icon { background: #ede9fe; }
        .framework-footer-card-advanced h4 {
            margin: 0 0 10px;
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
        }
        .framework-footer-card-advanced p {
            margin: 0 0 12px;
            font-size: 13px;
            color: #6b7280;
            line-height: 1.7;
        }
        .framework-footer-card-advanced .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .framework-footer-card-advanced .card-tag {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
        }
        .framework-footer-card-advanced.blue .card-tag { background: #dbeafe; color: #1e40af; }
        .framework-footer-card-advanced.green .card-tag { background: #d1fae5; color: #065f46; }
        .framework-footer-card-advanced.purple .card-tag { background: #ede9fe; color: #5b21b6; }

        /* Executive Summary - Advanced Layout */
        .exec-hero {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #312e81 100%);
            border-radius: 16px;
            padding: 24px 28px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
            box-shadow: 0 12px 28px rgba(15, 23, 42, 0.35);
            margin-bottom: 20px;
        }
        .exec-hero-left h1 {
            font-size: 24px;
            font-weight: 800;
            margin: 0 0 6px;
        }
        .exec-hero-left p {
            font-size: 13px;
            opacity: 0.85;
            margin: 0;
        }
        .exec-hero-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .exec-hero-stat {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 12px 18px;
            text-align: center;
            min-width: 100px;
        }
        .exec-hero-stat .value {
            font-size: 22px;
            font-weight: 800;
        }
        .exec-hero-stat .label {
            font-size: 10px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .exec-hero-stat.negative .value { color: #fca5a5; }
        .exec-hero-stat.positive .value { color: #86efac; }
        .exec-kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 20px;
        }
        .exec-kpi-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 4px solid #3b82f6;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .exec-kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        .exec-kpi-card.blue { border-left-color: #3b82f6; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); }
        .exec-kpi-card.green { border-left-color: #10b981; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); }
        .exec-kpi-card.red { border-left-color: #ef4444; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); }
        .exec-kpi-card.amber { border-left-color: #f59e0b; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); }
        .exec-kpi-card.purple { border-left-color: #8b5cf6; background: linear-gradient(135deg, #faf5ff 0%, #ede9fe 100%); }
        .exec-kpi-card.teal { border-left-color: #14b8a6; background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%); }
        .exec-kpi-card .icon { font-size: 20px; margin-bottom: 8px; }
        .exec-kpi-card .value { font-size: 26px; font-weight: 800; color: #1f2937; margin-bottom: 4px; }
        .exec-kpi-card .label { font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.3px; font-weight: 600; }
        .exec-kpi-card .change { font-size: 12px; margin-top: 6px; font-weight: 600; }
        .exec-kpi-card .change.up { color: #059669; }
        .exec-kpi-card .change.down { color: #dc2626; }
        .exec-section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .exec-card {
            background: white;
            border-radius: 14px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
        }
        .exec-card h3 {
            font-size: 15px;
            font-weight: 700;
            margin: 0 0 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .exec-card ul {
            margin: 0;
            padding-left: 18px;
            font-size: 13px;
            line-height: 1.9;
            color: #374151;
        }
        .exec-card ul li strong { color: #111827; }
        .exec-card.strategy { border-top: 4px solid #f59e0b; background: linear-gradient(180deg, #fffbeb 0%, white 30%); }
        .exec-card.strategy h3 { color: #92400e; }
        .exec-card.highlights { border-top: 4px solid #10b981; background: linear-gradient(180deg, #ecfdf5 0%, white 30%); }
        .exec-card.highlights h3 { color: #065f46; }
        .exec-card.concerns { border-top: 4px solid #ef4444; background: linear-gradient(180deg, #fef2f2 0%, white 30%); }
        .exec-card.concerns h3 { color: #991b1b; }
        .exec-card.targets { border-top: 4px solid #8b5cf6; background: linear-gradient(180deg, #faf5ff 0%, white 30%); }
        .exec-card.targets h3 { color: #5b21b6; }
        .exec-mini-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 12px;
        }
        .exec-mini-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        .exec-mini-card .num { font-size: 20px; font-weight: 800; color: #1e293b; }
        .exec-mini-card .txt { font-size: 10px; color: #64748b; margin-top: 4px; text-transform: uppercase; }
        .exec-footer-note {
            background: linear-gradient(135deg, #1e3a5f 0%, #312e81 100%);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-size: 13px;
            line-height: 1.7;
            margin-top: 20px;
        }
        .exec-footer-note strong { color: #fcd34d; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Success Metrics Toggle Animations */
        .success-metrics-toggle {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }
        .success-metrics-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.25);
        }
        .success-metrics-toggle.active {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.35);
        }

        @keyframes metricsSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes metricsFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .metrics-animate-in {
            animation: metricsSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .metrics-fade-in {
            animation: metricsFadeIn 0.4s ease-out forwards;
        }

        .summary-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .summary-header {
            background: #1e5a8e;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            text-align: center;
            font-size: 16px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            border-bottom: 2px solid #1e5a8e;
        }

        .summary-cell {
            padding: 20px;
            text-align: center;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
        }

        .summary-cell:last-child {
            border-right: none;
        }

        .summary-label {
            font-size: 13px;
            color: white;
            background: #1e5a8e;
            padding: 8px;
            font-weight: 600;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
        }

        .summary-value.negative {
            color: #dc2626;
        }

        .summary-value.positive {
            color: #059669;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 14px;
        }

        .kpi-card {
            background: white;
            border-radius: 10px;
            padding: 14px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #3b82f6;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .kpi-card.warning {
            border-left-color: #f59e0b;
        }

        .kpi-card.danger {
            border-left-color: #ef4444;
        }

        .kpi-card.success {
            border-left-color: #10b981;
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .kpi-title {
            color: #6b7280;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .kpi-icon {
            font-size: 24px;
            opacity: 0.3;
        }

        .kpi-value {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
        }

        .kpi-subtitle {
            color: #6b7280;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .kpi-subtitle.positive {
            color: #10b981;
        }

        .kpi-subtitle.negative {
            color: #ef4444;
        }

        .kpi-subtitle.neutral {
            color: #0ea5e9;
            font-weight: 700;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(420px, 1fr));
            grid-auto-flow: row;
            align-items: stretch;
            gap: 14px;
            margin-bottom: 16px;
        }

        @media (max-width: 1100px) {
            .chart-grid {   
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 20px;
        }

        .compliance-charts-frame {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
            padding: 0;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #1e7e34;
            color: white;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
        }

        tr:hover {
            background: #f9fafb;
        }

        .city-table-highlight td {
            color: #0f172a;
        }

        .city-table-highlight td:nth-child(6),
        .city-table-highlight td:nth-child(7) {
            font-weight: 700;
        }

        .city-table-highlight .total-row {
            background: #e0f2fe;
            font-weight: 700;
        }

        .city-table-highlight .total-row td {
            color: #0b3a63;
        }

        .pct-positive {
            color: #059669;
            font-weight: 700;
        }

        .pct-negative {
            color: #dc2626;
            font-weight: 700;
        }

        .positive {
            color: #10b981;
            font-weight: 600;
        }

        .negative {
            color: #ef4444;
            font-weight: 600;
        }

        .executive-section {
            background: white;
            border-radius: 12px;
            padding: 35px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .executive-section h2 {
            font-size: 26px;
            color: #1e7e34;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .exec-summary-hero {
            margin-bottom: 24px;
        }

        .exec-summary-title {
            font-size: 18px;
            font-weight: 800;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .exec-summary-subtitle {
            font-size: 12px;
            color: #64748b;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            margin-bottom: 14px;
        }

        .exec-section-title {
            font-size: 13px;
            color: #1f4e78;
            font-weight: 700;
            margin: 16px 0 10px;
        }

        .exec-donut-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 6px;
        }

        .exec-donut-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px 14px;
            text-align: center;
            min-width: 180px;
            flex: 1 1 180px;
        }

        .exec-donut {
            width: 86px;
            height: 86px;
            border-radius: 50%;
            background: conic-gradient(#22c55e calc(var(--p) * 1%), #e5e7eb 0);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            position: relative;
        }

        .exec-donut::after {
            content: '';
            width: 62px;
            height: 62px;
            background: #ffffff;
            border-radius: 50%;
            position: absolute;
        }

        .exec-donut-value {
            position: relative;
            z-index: 1;
            font-size: 14px;
            font-weight: 800;
            color: #0f172a;
        }

        .exec-donut-text {
            font-size: 11px;
            color: #475569;
            line-height: 1.35;
        }

        .info-box {
            border-left: 6px solid #10b981;
            background: #d1fae5;
            padding: 20px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #065f46;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .info-box ul {
            list-style: none;
            color: #047857;
        }

        .info-box li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .info-box li:before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .warning-box {
            border-left: 6px solid #f59e0b;
            background: #fef3c7;
            padding: 20px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .warning-box h3 {
            color: #92400e;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .warning-box ul {
            list-style: none;
            color: #78350f;
        }

        .warning-box li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .warning-box li:before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .action-box {
            border-left: 6px solid #3b82f6;
            background: #dbeafe;
            padding: 20px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .action-box h3 {
            color: #1e40af;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .action-box ol {
            list-style: none;
            counter-reset: item;
            color: #1e3a8a;
        }

        .action-box li {
            margin-bottom: 10px;
            padding-left: 30px;
            position: relative;
        }

        .action-box li:before {
            content: counter(item) ".";
            counter-increment: item;
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .highlight-box {
            border-left: 6px solid #10b981;
            background: #d1fae5;
            padding: 20px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .highlight-box h3 {
            color: #065f46;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .highlight-box ul {
            list-style: none;
            color: #047857;
        }

        .highlight-box li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .highlight-box li:before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .lowlight-box {
            border-left: 6px solid #dc2626;
            background: #fee2e2;
            padding: 20px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .lowlight-box h3 {
            color: #991b1b;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .lowlight-box ul {
            list-style: none;
            color: #7f1d1d;
        }

        .lowlight-box li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .lowlight-box li:before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            padding: 25px;
            color: #6b7280;
            font-size: 14px;
            border-top: 1px solid #e5e7eb;
            background: white;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }

        #leftChartCards, #rightChartCards {
            grid-template-columns: repeat(2, 1fr);
        }

        @media (max-width: 680px) {
            #leftChartCards, #rightChartCards {
                grid-template-columns: 1fr !important;
                gap: 6px !important;
            }
            #leftChartCards > div, #rightChartCards > div {
                padding: 6px 8px !important;
            }
            #leftChartCards > div > div:nth-child(2),
            #rightChartCards > div > div:nth-child(2) {
                font-size: 14px !important;
            }
        }
    

/* Compact tables for wide datasets */
.compact-table { table-layout: fixed; }
.compact-table th, .compact-table td { padding: 10px 12px; white-space: normal; word-break: break-word; }
/* For tables that require the Status column to stay on one line without clipping,
   wrap the table in a div.table-container.nowrap-table and add class nowrap-status
   to the table. This keeps other tables unchanged. */
.nowrap-table { overflow: auto; }
.nowrap-table table.nowrap-status { table-layout: auto; }
.nowrap-table table.nowrap-status th:last-child,
.nowrap-table table.nowrap-status td:last-child {
    white-space: nowrap;
    word-break: normal;
}

/* Terminated Partners Table - Professional Column Widths */
.terminated-table {
    table-layout: fixed;
    width: 100%;
}
.terminated-table th:nth-child(1),
.terminated-table td:nth-child(1) { width: 15%; }
.terminated-table th:nth-child(2),
.terminated-table td:nth-child(2) { width: 20%; }
.terminated-table th:nth-child(3),
.terminated-table td:nth-child(3) { width: 12%; }
.terminated-table th:nth-child(4),
.terminated-table td:nth-child(4) { width: 26%; }
.terminated-table th:nth-child(5),
.terminated-table td:nth-child(5) { width: 27%; }

        /* Monthly insights (new tab) */
        .month-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .month-select {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            outline: none;
        }
        .month-select:focus {
            border-color: #3b82f6;
        }

        .chart-info-panel {
            margin-top: 10px;
            padding: 10px 12px;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 12px;
            color: #1f2937;
        }
        .chart-info-title {
            font-weight: 700;
            margin-bottom: 6px;
            color: #1e40af;
        }
        .chart-info-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding: 3px 0;
        }
        .chart-info-left {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .chart-info-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            display: inline-block;
        }
        .chart-info-empty {
            color: #6b7280;
            font-style: italic;
        }
        .chart-toggle {
            display: flex;
            gap: 8px;
            margin: 8px 0 10px 0;
        }
        .chart-toggle-btn {
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            background: #ffffff;
            color: #374151;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        .chart-toggle-btn.active {
            background: #1e40af;
            border-color: #1e40af;
            color: #ffffff;
        }

                /* Subtle badge for Overall = 100% */
                .overall-badge {
                    display: inline-block;
                    margin-left: 6px;
                    padding: 2px 6px;
                    font-size: 12px;
                    line-height: 1;
                    border-radius: 9999px;
                    background: #f3f4f6; /* gray-100 */
                    color: #6b7280;      /* gray-500 */
                    border: 1px solid #e5e7eb; /* gray-200 */
                    font-weight: 600;
                }

</style>
</head>
<body>
    <script>
        (function () {
            const PASSCODE = "71290";
            document.documentElement.style.visibility = "hidden";
            const entered = prompt("Enter passcode:");
            if (entered !== PASSCODE) {
                document.documentElement.innerHTML = "<head><title>Access denied</title></head><body style='font-family: Arial, sans-serif; padding: 40px; background: #f9fafb; color: #1f2937;'><h2>Access denied</h2><p>Incorrect passcode.</p></body>";
                if (window.stop) window.stop();
                return;
            }
            document.documentElement.style.visibility = "visible";
        })();
    </script>
<div class="header">
<h1>Partner Capacity Dashboard</h1>
<div class="header-subtitle">January 2026 vs February 2026 Analysis</div>
<div class="header-buttons">
<button class="btn" onclick="window.print()">
<span>🖨️</span> Print
            </button>
<button class="btn" onclick="exportToCSV()">
<span>📥</span> Export CSV
            </button>
</div>
<div id="monthOverviewSlicer" class="section-slicer-bar">
    <span class="section-slicer-title">Jump to section:</span>
    <button class="section-slicer-btn" data-target="monthOverviewPerformanceBreakdown">📈 Performance Breakdown</button>
    <button class="section-slicer-btn" data-target="monthOverviewPerfScale">📌 Performance &amp; Scale Summary</button>
    <button class="section-slicer-btn" data-target="monthOverviewFrDc">📊 FR &amp; Driver Card Compliance</button>
    <button class="section-slicer-btn" data-target="monthOverviewCityTier">🏙️ City Tier Performance</button>
    <button class="section-slicer-btn" data-target="monthOverviewTargetMovement">🎯 Target Movement Analysis</button>
    <button class="section-slicer-btn" data-target="monthOverviewTopBottom">📌 Top &amp; Bottom Partners Overview</button>
    <button class="section-slicer-btn" data-target="monthOverviewSuccessMetrics">✅ February 2026 Success Metrics</button>
</div>
<div id="monthlyInsightsSlicer" class="section-slicer-bar">
    <span class="section-slicer-title">Jump to section:</span>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="monthlyOverviewSection">📊 Monthly Overview &amp; Trends</button>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="vehicleTypeMonthlySection">🚗🏍️ Vehicle Type Breakdown</button>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="partnerMovementSection">📊 Partner Movement Analysis</button>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="partnerAgeSection">👥 New vs Old Partners Analysis</button>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="cityWiseSection">🏙️ City-wise Target Distribution</button>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="tierCitySection">📊 Tier City Overview (T1 vs T2)</button>
    <button class="section-slicer-btn monthly-slicer-btn" data-target="monthlyWillingSection">📊 Partner Willing Analysis</button>
</div>
</div>
<div class="tabs">
<ul class="tab-list">
<li class="tab-item active" onclick="switchTab('executive', this)">📋 Executive Summary</li>
<li class="tab-item" onclick="switchTab('framework', this)">🔬 Framework &amp; Methodology</li>
<li class="tab-item" onclick="switchTab('overview', this)">📊 Month Overview</li>
<li class="tab-item" onclick="switchTab('monthly', this)">🗓️ Monthly Insights (6 Months Overview)</li>
<li class="tab-item" onclick="switchTab('adjustment', this)">🔧 Target Adjustment Analysis</li>
<li class="tab-item" onclick="switchTab('strategy', this)">🎯 Future Strategy &amp; Roadmap</li>
<li class="tab-item" onclick="switchTab('dailyView', this)">🧧 Hi Ray this is your dashboard Happy new chinese year</li>
</ul>
</div>
<div class="content">
<!-- FRAMEWORK & METHODOLOGY TAB -->
<div class="tab-content" id="framework">
<h2 style="margin-bottom: 25px; color: #1f4e78; font-size: 26px;">📋 Framework &amp; Methodology</h2>
<div class="framework-hero">
    <div>
        <div class="framework-hero-title">Framework &amp; Methodology</div>
        <div class="framework-hero-subtitle">How monthly capacity targets are built, protected, and aligned.</div>
    </div>
    <div class="framework-hero-pills">
        <span class="framework-pill">Model: Multi-layer rules</span>
        <span class="framework-pill">Cycle: Jan -> Feb</span>
        <span class="framework-pill">Signals: Perf + FR + Ops</span>
    </div>
</div>

<div class="framework-grid-3">
    <div class="framework-card accent-blue">
        <h4>Background</h4>
        <p>Targets are built monthly to match demand, protect quality, and keep partner capacity healthy using performance and compliance signals.</p>
    </div>
    <div class="framework-card accent-teal">
        <h4>Context (Feb 2026)</h4>
        <p>Stabilize good partners, reduce more from average/bad, protect new partners, and allow limited PMM exceptions.</p>
    </div>
    <div class="framework-card accent-amber">
        <h4>Challenges</h4>
        <p>Keep good partner capacity stable with a 13% overall cut; driver card constraints shift some share to average/bad.</p>
    </div>
</div>

<div class="framework-grid-2">
    <div class="framework-card accent-emerald">
        <h4>Strategic Goals</h4>
        <div class="framework-chip-row">
            <span class="framework-chip">Demand Coverage</span>
            <span class="framework-chip">Quality &amp; Compliance</span>
            <span class="framework-chip">Risk Mitigation</span>
            <span class="framework-chip">Budget Adherence</span>
        </div>
    </div>
    <div class="framework-card">
        <h4>Model Layers</h4>
        <p>Baseline (size, performance, FR) -> New Partner Protection -> Termination/Blocking -> Quality Brakes -> Manual Adjustment.</p>
    </div>
</div>

<div class="framework-flow">
    <div class="flow-header">
        <div class="flow-title">Calculation Flow (Feb) <span style="font-size: 0.65em; font-weight: 500; margin-left: 24px; color: #475569;">For more info about the rules check out this link</span> <a href="https://km.sankuai.com/collabpage/2747350482" target="_blank" style="font-size: 0.6em; font-weight: 700; color: #7c3aed; text-decoration: none; margin-left: 10px; padding: 8px 18px; background: linear-gradient(90deg, #f3e8ff 0%, #ede9fe 100%); border-radius: 8px; transition: all 0.2s; border: 1px solid #c4b5fd; display: inline-flex; align-items: center; gap: 6px;">Capacity target rules details <span style="font-size: 1.1em;">→</span></a></div>
        <div class="flow-subtitle">Short, auditable path from Jan baseline to Feb targets</div>
    </div>
    <!-- Advanced Flow Timeline -->
    <div class="flow-timeline">
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">1</div>
                <div class="flow-step-title">📍 Start Point</div>
                <div class="flow-step-desc">Jan final target per partner serves as the baseline for Feb calculations.</div>
            </div>
        </div>
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">2</div>
                <div class="flow-step-title">⚙️ Base Multipliers</div>
                <div class="flow-step-desc">Performance, FR%, and ops factors reduce low performers and protect high performers.</div>
            </div>
        </div>
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">3</div>
                <div class="flow-step-title">🛡️ Protected Partners</div>
                <div class="flow-step-desc">≤1 month: T1 min 20, T2 min 15 (18 partners). &lt;3 months: min by tier (150 partners). Zero after factors → restore safe minimum.</div>
            </div>
        </div>
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">4</div>
                <div class="flow-step-title">⚠️ Term & Warnings</div>
                <div class="flow-step-desc">Terminated = 0 (3 partners). Warning letters (34): Bad/Avg → 50% of Jan, Good → 90%.</div>
            </div>
        </div>
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">5</div>
                <div class="flow-step-title">📸 FR% Fine-Tune</div>
                <div class="flow-step-desc">Apply FR% slabs by performance tier to fine-tune output and reward compliance.</div>
            </div>
        </div>
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">6</div>
                <div class="flow-step-title">✏️ Manual Override</div>
                <div class="flow-step-desc">PMM/ops exceptions for contracts, launches, staffing, or data issues.</div>
            </div>
        </div>
        <div class="flow-timeline-item">
            <div class="flow-step-card">
                <div class="flow-step-num">7</div>
                <div class="flow-step-title">🎯 Align to Feb Plan</div>
                <div class="flow-step-desc">Scale to Feb national total, then apply city-level scaling factors.</div>
            </div>
        </div>
    </div>

    <!-- Advanced Callouts -->
    <div class="flow-callouts-advanced">
        <div class="flow-callout-advanced red">
            <div class="flow-callout-icon">🚫</div>
            <div class="flow-callout-content">
                <h4>Compliance Blocked Riders</h4>
                <p>Waiting for final list from compliance team. PMMs confirm recovery plans; actions follow on flagged risks. Critical for maintaining fleet quality standards.</p>
            </div>
        </div>
        <div class="flow-callout-advanced">
            <div class="flow-callout-icon">🪪</div>
            <div class="flow-callout-content">
                <h4>Driver Card Slab</h4>
                <p>Not a core factor (overall rate 40.5%). Used to keep targets stable with smaller cuts for good/average partners >80%. Ensures compliance-ready capacity.</p>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Footer Cards -->
<div class="framework-footer-advanced">
    <div class="framework-footer-card-advanced blue">
        <div class="card-icon">🏗️</div>
        <h4>Model Structure</h4>
        <p>Baseline + protection + controls + manual review produce explainable targets per partner and city. Transparent, auditable, and defensible.</p>
        <div class="card-tags">
            <span class="card-tag">Baseline</span>
            <span class="card-tag">Protection</span>
            <span class="card-tag">Controls</span>
        </div>
    </div>
    <div class="framework-footer-card-advanced green">
        <div class="card-icon">🔄</div>
        <h4>Flexibility</h4>
        <p>Monthly tuning of coefficients and thresholds keeps alignment with CPO, service, and partner mix goals. Adapts to market conditions.</p>
        <div class="card-tags">
            <span class="card-tag">Monthly Tuning</span>
            <span class="card-tag">CPO Alignment</span>
            <span class="card-tag">Adaptive</span>
        </div>
    </div>
    <div class="framework-footer-card-advanced purple">
        <div class="card-icon">🔐</div>
        <h4>Governance</h4>
        <p>Manual overrides are limited and audited to keep results consistent and defensible. SOP + maker/checker ensures accountability.</p>
        <div class="card-tags">
            <span class="card-tag">Audit Trail</span>
            <span class="card-tag">Maker/Checker</span>
            <span class="card-tag">SOP</span>
        </div>
    </div>
</div>
</div>
<!-- OVERVIEW TAB -->
<div class="tab-content" id="overview">
<h2 style="margin-bottom: 12px; color: #1f4e78; font-size: 20px;">Business Metrics Dashboard</h2>

<!-- Executive Briefing — Collapsed Side-by-Side Cards -->
<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
  <div style="display: flex; align-items: center; gap: 8px;">
    <span style="font-size: 15px;">📊</span>
    <span style="font-size: 13px; font-weight: 700; color: #475569;">Executive Briefing</span>
    <span id="briefingAutoLabel" style="font-size: 9px; font-weight: 600; color: #6366f1; background: #eef2ff; padding: 2px 8px; border-radius: 10px; animation: briefingPulse 2s ease-in-out infinite;">● AUTO</span>
  </div>
  <button id="briefingPinBtn" onclick="pinBriefingCards()" style="display: flex; align-items: center; gap: 6px; padding: 5px 14px; border: 1.5px solid #cbd5e1; border-radius: 8px; background: linear-gradient(135deg, #f8fafc, #f1f5f9); color: #475569; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; user-select: none;" onmouseover="this.style.borderColor='#94a3b8'; this.style.background='linear-gradient(135deg, #f1f5f9, #e2e8f0)'" onmouseout="if(!window._briefingPinned){this.style.borderColor='#cbd5e1'; this.style.background='linear-gradient(135deg, #f8fafc, #f1f5f9)'}">
    <span id="briefingPinIcon" style="font-size: 12px;">📌</span>
    <span id="briefingPinText">Keep Open</span>
  </button>
</div>
<style>
@keyframes briefingPulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
</style>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">

  <!-- Card 1: Highlights, Lowlights & Notes -->
  <div id="highlightsCard" style="border-radius: 14px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1.5px solid #e0e7ef; background: #fff;">
        <div id="highlightsHeader" onclick="toggleBriefingCards()" style="background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #1e40af 100%); padding: 14px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; user-select: none;">
      <span id="highlightsArrow" style="width: 28px; height: 28px; background: rgba(255,255,255,0.13); border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 13px; flex-shrink: 0; color: white; font-weight: 700; transition: transform 0.3s;">▶</span>
      <span style="color: white; font-size: 14px; font-weight: 700; flex: 1;">📋 Highlights, Lowlights & Notes</span>
      <span id="highlightsBadge" style="color: rgba(255,255,255,0.45); font-size: 10px; font-weight: 600; background: rgba(255,255,255,0.1); padding: 3px 10px; border-radius: 20px; transition: all 0.2s;">Expand ▾</span>
    </div>
    <div id="highlightsBody" style="max-height: 0; overflow: hidden;">
      <div style="padding: 18px 20px 20px; background: linear-gradient(180deg, #f8fafc, #ffffff);">

      <!-- Notes Section -->
      <div style="margin-bottom: 16px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <span style="width: 26px; height: 26px; background: linear-gradient(135deg, #6366f1, #818cf8); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px;">📌</span>
          <span style="font-size: 13px; font-weight: 700; color: #312e81;">Need to Know</span>
        </div>
        <div style="background: #eef2ff; border-left: 3px solid #6366f1; border-radius: 0 8px 8px 0; padding: 10px 14px; font-size: 11.5px; color: #3730a3; line-height: 1.65;">
          <div style="display: flex; align-items: flex-start; gap: 6px; margin-bottom: 5px;">
            <span style="color: #6366f1; font-weight: 700; flex-shrink: 0;">•</span>
            <span>Dashboard reflects <strong>first version</strong> of capacity target — mid-month adjustments may apply.</span>
          </div>
          <div style="display: flex; align-items: flex-start; gap: 6px; margin-bottom: 5px;">
            <span style="color: #6366f1; font-weight: 700; flex-shrink: 0;">•</span>
            <span>Partner data is based on <strong>last week of prior month</strong> (e.g., Feb target uses late-Jan active partner data).</span>
          </div>
          <div style="display: flex; align-items: flex-start; gap: 6px;">
            <span style="color: #6366f1; font-weight: 700; flex-shrink: 0;">•</span>
            <span>Performance MoM comparison is <strong>target vs. target</strong>, not actual performance — partner categories may shift between months.</span>
          </div>
        </div>
      </div>

      <!-- Highlights Section -->
      <div style="margin-bottom: 16px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <span style="width: 26px; height: 26px; background: linear-gradient(135deg, #059669, #34d399); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px;">✅</span>
          <span style="font-size: 13px; font-weight: 700; color: #065f46;">Highlights</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #166534; line-height: 1.5;">
            <span style="font-weight: 700;">🛡️ Good partners protected</span><br>Lowest target reduction at only <strong>6.6%</strong> — prioritized in allocation rules.
          </div>
          <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #166534; line-height: 1.5;">
            <span style="font-weight: 700;">📉 Bad partners minimized</span><br>Count dropped <strong>73 → 20</strong> MoM; target cut from <strong>808 → 370</strong>.
          </div>
          <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #166534; line-height: 1.5;">
            <span style="font-weight: 700;">⚖️ Average partners stable</span><br>Target maintained at same level MoM with <strong>+1.0%</strong> change.
          </div>
          <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #166534; line-height: 1.5;">
            <span style="font-weight: 700;">🤖 Manual adjustments halved</span><br>Reduced by <strong>50.4%</strong> — rules automation improving.
          </div>
          <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #166534; line-height: 1.5; grid-column: 1 / -1;">
            <span style="font-weight: 700;">🎯 FR achievement rate at 92.4%</span> — strong face recognition rate against target.
          </div>
        </div>
      </div>

      <!-- Lowlights Section -->
      <div>
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <span style="width: 26px; height: 26px; background: linear-gradient(135deg, #dc2626, #f87171); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px;">⚠️</span>
          <span style="font-size: 13px; font-weight: 700; color: #991b1b;">Lowlights</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #991b1b; line-height: 1.5;">
            <span style="font-weight: 700;">😞 Partner experience impact</span><br>Target declining for <strong>3rd consecutive month</strong> affects partner sentiment. Additionally, <strong>70 partners phased out</strong> adds to negative experience.
          </div>
          <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 9px 12px; font-size: 11px; color: #991b1b; line-height: 1.5;">
            <span style="font-weight: 700;">🪪 Low driver card rate</span><br>Driver card rate at <strong>40.5%</strong> — limiting full rule application and requiring exceptions.
          </div>
        </div>
      </div>

    </div>
    </div>
  </div>

  <!-- Card 2: Key Challenges & Outcomes -->
  <div id="challengesCard" style="border-radius: 14px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1.5px solid #e0e7ef; background: #fff;">
        <div id="challengesHeader" onclick="toggleBriefingCards()" style="background: linear-gradient(135deg, #4c1d95 0%, #6d28d9 50%, #7c3aed 100%); padding: 14px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; user-select: none;">
      <span id="challengesArrow" style="width: 28px; height: 28px; background: rgba(255,255,255,0.13); border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 13px; flex-shrink: 0; color: white; font-weight: 700; transition: transform 0.3s;">▶</span>
      <span style="color: white; font-size: 14px; font-weight: 700; flex: 1;">⚡ Key Challenges & Outcomes</span>
      <span id="challengesBadge" style="color: rgba(255,255,255,0.45); font-size: 10px; font-weight: 600; background: rgba(255,255,255,0.1); padding: 3px 10px; border-radius: 20px; transition: all 0.2s;">Expand ▾</span>
    </div>
    <div id="challengesBody" style="max-height: 0; overflow: hidden;">
      <div style="padding: 18px 20px 20px; background: linear-gradient(180deg, #f8fafc, #ffffff);">

      <!-- Challenge 1 -->
      <div style="background: #fff; border: 1.5px solid #e9d5ff; border-radius: 12px; padding: 16px; margin-bottom: 12px; position: relative;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <span style="width: 24px; height: 24px; background: linear-gradient(135deg, #7c3aed, #a78bfa); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; color: white; font-weight: 800;">1</span>
          <span style="font-size: 12.5px; font-weight: 700; color: #5b21b6;">Maintain avg scale with -13% target reduction</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
          <div style="background: #fef3c7; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #92400e; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Challenge</div>
            <div style="font-size: 11px; color: #78350f; line-height: 1.5;">Achieve scale target despite <strong>+13% overall reduction</strong> in capacity.</div>
          </div>
          <div style="background: #dbeafe; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #1e40af; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Solution</div>
            <div style="font-size: 11px; color: #1e3a8a; line-height: 1.5;">Identified & phased out <strong>low-compliance partners</strong> to protect avg scale.</div>
          </div>
          <div style="background: #d1fae5; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #065f46; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Outcome</div>
            <div style="font-size: 11px; color: #064e3b; line-height: 1.5;">Avg scale <strong>35.1 / 36 target</strong> — <span style="font-weight: 700; color: #059669;">98% achievement</span>.</div>
          </div>
        </div>
      </div>

      <!-- Challenge 2 -->
      <div style="background: #fff; border: 1.5px solid #e9d5ff; border-radius: 12px; padding: 16px; margin-bottom: 12px; position: relative;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <span style="width: 24px; height: 24px; background: linear-gradient(135deg, #7c3aed, #a78bfa); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; color: white; font-weight: 800;">2</span>
          <span style="font-size: 12.5px; font-weight: 700; color: #5b21b6;">Preserve good partners target under reduction pressure</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
          <div style="background: #fef3c7; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #92400e; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Challenge</div>
            <div style="font-size: 11px; color: #78350f; line-height: 1.5;">Keep high-quality partners at prior-month level despite overall <strong>target cuts</strong>.</div>
          </div>
          <div style="background: #dbeafe; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #1e40af; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Solution</div>
            <div style="font-size: 11px; color: #1e3a8a; line-height: 1.5;">Rules <strong>prioritize good partners first</strong> — absorb reduction from lower tiers.</div>
          </div>
          <div style="background: #d1fae5; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #065f46; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Outcome</div>
            <div style="font-size: 11px; color: #064e3b; line-height: 1.5;">Good partners target <strong>-6.6%</strong> (only from city-level constraints); <span style="font-weight: 700; color: #059669;">on track</span> — most reduction tied to DC issue.</div>
          </div>
        </div>
      </div>

      <!-- Challenge 3 -->
      <div style="background: #fff; border: 1.5px solid #e9d5ff; border-radius: 12px; padding: 16px; position: relative;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <span style="width: 24px; height: 24px; background: linear-gradient(135deg, #7c3aed, #a78bfa); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; color: white; font-weight: 800;">3</span>
          <span style="font-size: 12.5px; font-weight: 700; color: #5b21b6;">Driver card constraints limiting rule execution</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
          <div style="background: #fef3c7; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #92400e; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Challenge</div>
            <div style="font-size: 11px; color: #78350f; line-height: 1.5;">Low driver card rate (<strong>40.5%</strong>) prevents full rule application — forced <strong>manual exceptions</strong>.</div>
          </div>
          <div style="background: #dbeafe; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #1e40af; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Solution</div>
            <div style="font-size: 11px; color: #1e3a8a; line-height: 1.5;">Coordinating with <strong>CH/PMM</strong> to align partners on driver card issuance timeline.</div>
          </div>
          <div style="background: #d1fae5; border-radius: 8px; padding: 8px 10px;">
            <div style="font-size: 9px; color: #065f46; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">Outcome</div>
            <div style="font-size: 11px; color: #064e3b; line-height: 1.5;">Assigned <strong>conservative targets</strong> until commitment shown; <span style="font-weight: 700; color: #d97706;">reassessment next month</span>.</div>
          </div>
        </div>
      </div>

    </div>
    </div>
  </div>

</div>
<!-- End Executive Briefing -->

<script>
// Auto-cycling executive briefing cards with pin-to-keep-open
let briefingExpanded = false;
window._briefingPinned = false;
let briefingAutoTimer = null;
let briefingAutoHoverCount = 0;

function setBriefingState(expanded) {
    briefingExpanded = expanded;
    const hBody = document.getElementById('highlightsBody');
    const cBody = document.getElementById('challengesBody');
    const hArrow = document.getElementById('highlightsArrow');
    const cArrow = document.getElementById('challengesArrow');
    const hBadge = document.getElementById('highlightsBadge');
    const cBadge = document.getElementById('challengesBadge');

    if (expanded) {
        hBody.style.maxHeight = hBody.scrollHeight + 'px';
        cBody.style.maxHeight = cBody.scrollHeight + 'px';
        hArrow.textContent = '▼';
        cArrow.textContent = '▼';
        hBadge.textContent = 'Collapse ▴';
        cBadge.textContent = 'Collapse ▴';
    } else {
        hBody.style.maxHeight = '0';
        cBody.style.maxHeight = '0';
        hArrow.textContent = '▶';
        cArrow.textContent = '▶';
        hBadge.textContent = 'Expand ▾';
        cBadge.textContent = 'Expand ▾';
    }
}

function startBriefingAuto() {
    if (briefingAutoTimer) clearInterval(briefingAutoTimer);
    briefingAutoHoverCount = 0;

    // In AUTO mode: keep collapsed by default and only expand when hovering the header.
    if (!window._briefingPinned) setBriefingState(false);

    if (window._briefingAutoHoverBound) return;
    const hHeader = document.getElementById('highlightsHeader');
    const cHeader = document.getElementById('challengesHeader');
    if (!hHeader || !cHeader) return;

    const onEnter = () => {
        if (window._briefingPinned) return;
        briefingAutoHoverCount++;
        setBriefingState(true);
    };

    const onLeave = () => {
        if (window._briefingPinned) return;
        briefingAutoHoverCount = Math.max(0, briefingAutoHoverCount - 1);

        // Small delay prevents flicker when moving between headers.
        setTimeout(() => {
            if (window._briefingPinned) return;
            if (briefingAutoHoverCount === 0) setBriefingState(false);
        }, 40);
    };

    hHeader.addEventListener('mouseenter', onEnter);
    hHeader.addEventListener('mouseleave', onLeave);
    cHeader.addEventListener('mouseenter', onEnter);
    cHeader.addEventListener('mouseleave', onLeave);

    window._briefingAutoHoverBound = true;
}

function pinBriefingCards() {
    window._briefingPinned = !window._briefingPinned;
    const btn = document.getElementById('briefingPinBtn');
    const icon = document.getElementById('briefingPinIcon');
    const text = document.getElementById('briefingPinText');
    const autoLabel = document.getElementById('briefingAutoLabel');

    if (window._briefingPinned) {
        // Pin = keep expanded, stop auto
        setBriefingState(true);
        icon.textContent = '🔒';
        text.textContent = 'Pinned Open';
        btn.style.borderColor = '#6366f1';
        btn.style.background = 'linear-gradient(135deg, #eef2ff, #e0e7ff)';
        btn.style.color = '#4f46e5';
        autoLabel.textContent = '■ PINNED';
        autoLabel.style.color = '#059669';
        autoLabel.style.background = '#d1fae5';
        autoLabel.style.animation = 'none';
    } else {
        // Unpin = resume auto
        setBriefingState(false);
        icon.textContent = '📌';
        text.textContent = 'Keep Open';
        btn.style.borderColor = '#cbd5e1';
        btn.style.background = 'linear-gradient(135deg, #f8fafc, #f1f5f9)';
        btn.style.color = '#475569';
        autoLabel.textContent = '● AUTO';
        autoLabel.style.color = '#6366f1';
        autoLabel.style.background = '#eef2ff';
        autoLabel.style.animation = 'briefingPulse 2s ease-in-out infinite';
        startBriefingAuto();
    }
}

function toggleBriefingCards() {
    if (window._briefingPinned) {
        // If pinned, clicking header unpins and collapses
        window._briefingPinned = false;
        setBriefingState(false);
        const icon = document.getElementById('briefingPinIcon');
        const text = document.getElementById('briefingPinText');
        const btn = document.getElementById('briefingPinBtn');
        const autoLabel = document.getElementById('briefingAutoLabel');
        icon.textContent = '📌';
        text.textContent = 'Keep Open';
        btn.style.borderColor = '#cbd5e1';
        btn.style.background = 'linear-gradient(135deg, #f8fafc, #f1f5f9)';
        btn.style.color = '#475569';
        autoLabel.textContent = '● AUTO';
        autoLabel.style.color = '#6366f1';
        autoLabel.style.background = '#eef2ff';
        autoLabel.style.animation = 'briefingPulse 2s ease-in-out infinite';
        startBriefingAuto();
    } else {
        // If auto mode, clicking header pins open
        pinBriefingCards();
    }
}

// Start auto-cycling on load
startBriefingAuto();
</script>

<div class="kpi-grid">
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">Total Riders</span>
<span class="kpi-icon">👥</span>
</div>
<div class="kpi-value">19,365</div>
<div class="kpi-subtitle negative">↓ -3,088 (MoM -13.8%)</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Active Partners</span>
<span class="kpi-icon">🎯</span>
</div>
<div class="kpi-value">551</div>
<div class="kpi-subtitle">out of 643 partners</div>
</div>
<div class="kpi-card success">
<div class="kpi-header">
<span class="kpi-title">Good Partners</span>
<span class="kpi-icon">📈</span>
</div>
<div class="kpi-value">252</div>
<div class="kpi-subtitle negative">↓ -17 (MoM -6.3%)</div>
<div style="font-size: 11px; color: #6b7280; margin-top: 4px;">Jan: 269 → Feb: 252</div>
</div>
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">At-Risk Partners (bad partners)</span>
<span class="kpi-icon">⚠️</span>
</div>
<div class="kpi-value negative">20</div>
<div class="kpi-subtitle positive">↓ -53 (MoM -72.6%)</div>
<div style="font-size: 11px; color: #6b7280; margin-top: 4px;">Jan: 73 → Feb: 20</div>
</div>
</div>
<div class="kpi-grid">
<div class="kpi-card warning">
<div class="kpi-header">
<span class="kpi-title">Zero-Target Partners</span>
<span class="kpi-icon">⭕</span>
</div>
<div class="kpi-value">92</div>
<div class="kpi-subtitle"><span style="color: #dc2626; font-weight: 600;">3 Terminated</span>, <span style="color: #d97706; font-weight: 600;">70 Phased Out</span>, <span style="color: #6b7280; font-weight: 600;">19 No Jan Target</span></div>
<div style="font-size: 11px; color: #6b7280; margin-top: 4px;">Partners not given target in Feb</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Avg Scale per Partner</span>
<span class="kpi-icon">📊</span>
</div>
<div class="kpi-value">35.1</div>
<div class="kpi-subtitle negative">↓ -0.8 (MoM -2.2%)</div>
<div style="font-size: 11px; color: #6b7280; margin-top: 4px;">Jan: 35.9 → Feb: 35.1</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Highest Partner Total Capacity</span>
<span class="kpi-icon">🏆</span>
</div>
<div class="kpi-value">200</div>
<div class="kpi-subtitle">highest net target given to a partner (60 riders)</div>
</div>
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">Highest Partner with Capacity Reduction</span>
<span class="kpi-icon">📉</span>
</div>
<div class="kpi-value negative">-85</div>
<div class="kpi-subtitle">lowest total target given to a partner (10 riders)</div>
</div>
</div>
<h3 id="monthOverviewPerformanceBreakdown" style="margin: 14px 0 10px; color: #1f4e78; font-size: 17px;">Performance Breakdown</h3>
<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; padding: 7px 14px; background: linear-gradient(90deg, #eff6ff, #faf5ff); border-left: 3px solid #6366f1; border-radius: 0 6px 6px 0;">
<span style="font-size: 12px;">📌</span>
<p style="margin: 0; font-size: 11.5px; color: #4b5563; line-height: 1.4;"><span style="font-weight: 700; color: #4338ca;">Note:</span> The target change shown per category reflects the <span style="font-weight: 700; color: #1e40af;">overall capacity reduction</span>, not a per-performance-level adjustment. Partners may have a <span style="font-weight: 700; color: #b45309;">different assessment</span> month-over-month (e.g. shifted from Good to Average), so the numbers also reflect partner movement across categories.</p>
</div>
<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
<div style="background: white; border: 2px solid #10b981; border-radius: 10px; padding: 14px 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06);">
<h4 style="font-size: 16px; margin-bottom: 8px; color: #10b981;">Good Partners</h4>
<div style="color: #6b7280; line-height: 1.7;">
<p style="font-size: 13px; margin: 2px 0;"><strong>Partners:</strong> 252 (47.2%)</p>
<p style="font-size: 13px; margin: 2px 0; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;"><strong>Feb Target:</strong> 10,192 (53.7%)
<span style="font-size: 11px; font-weight: 700; color: #dc2626; background: #fee2e2; padding: 1px 6px; border-radius: 999px;">MoM -17.5%</span></p>
<p style="font-size: 13px; margin: 2px 0; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;">
<strong>Scale:</strong> 45.9 → 40.4
<span style="font-size: 11px; font-weight: 700; color: #dc2626; background: #fee2e2; padding: 1px 6px; border-radius: 999px;">-12.0%</span>
</p>
</div>
</div>
<div style="background: white; border: 2px solid #f59e0b; border-radius: 10px; padding: 14px 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06);">
<h4 style="font-size: 16px; margin-bottom: 8px; color: #f59e0b;">Average Partners</h4>
<div style="color: #6b7280; line-height: 1.7;">
<p style="font-size: 13px; margin: 2px 0;"><strong>Partners:</strong> 262 (49.1%)</p>
<p style="font-size: 13px; margin: 2px 0; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;"><strong>Feb Target:</strong> 8,414 (44.3%)
<span style="font-size: 11px; font-weight: 700; color: #16a34a; background: #dcfce7; padding: 1px 6px; border-radius: 999px;">MoM +1.0%</span></p>
<p style="font-size: 13px; margin: 2px 0; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;">
<strong>Scale:</strong> 30.4 → 32.1
<span style="font-size: 11px; font-weight: 700; color: #16a34a; background: #dcfce7; padding: 1px 6px; border-radius: 999px;">+5.6%</span>
</p>
</div>
</div>
<div style="background: white; border: 2px solid #dc2626; border-radius: 10px; padding: 14px 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06);">
<h4 style="font-size: 16px; margin-bottom: 8px; color: #dc2626;">Bad Partners</h4>
<div style="color: #6b7280; line-height: 1.7;">
<p style="font-size: 13px; margin: 2px 0;"><strong>Partners:</strong> 20 (3.7%)</p>
<p style="font-size: 13px; margin: 2px 0; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;"><strong>Feb Target:</strong> 370 (1.9%)
<span style="font-size: 11px; font-weight: 700; color: #dc2626; background: #fee2e2; padding: 1px 6px; border-radius: 999px;">MoM -75.9%</span></p>
<p style="font-size: 13px; margin: 2px 0; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;">
<strong>Scale:</strong> 21.0 → 18.5
<span style="font-size: 11px; font-weight: 700; color: #dc2626; background: #fee2e2; padding: 1px 6px; border-radius: 999px;">-11.9%</span>
</p>
</div>
</div>
</div>

<!-- Final Capacity Target Section -->
<div style="background: white; border-radius: 12px; padding: 0; margin-bottom: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 16px rgba(0,0,0,0.06); overflow: hidden;">
    <!-- Header Bar -->
    <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 50%, #7c3aed 100%); padding: 14px 24px; display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">📋</div>
            <div>
                <span style="color: white; font-size: 16px; font-weight: 700; letter-spacing: 0.3px;">Final Capacity Target — Our Rules vs Last Month Achievement (Performance breakdown)</span>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.12); border-radius: 20px; padding: 5px 14px;">
            <span style="font-size: 11px; color: rgba(255,255,255,0.7);">Total Delta</span>
            <span style="font-size: 14px; font-weight: 800; color: #fbbf24;">-3,366</span>
        </div>
    </div>

    <!-- Highlight Note -->
    <div style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 24px; background: linear-gradient(90deg, #eff6ff, #faf5ff); border-bottom: 1px solid #e5e7eb;">
        <span style="font-size: 14px; margin-top: 1px;">💡</span>
        <p style="margin: 0; font-size: 12px; line-height: 1.8;">
            <span style="font-weight: 700; color: #1e40af;">Note:</span>
            <span style="color: #4b5563;"> Target is assigned only to</span>
            <span style="font-weight: 700; color: #7c3aed; background: #f3e8ff; padding: 1px 8px; border-radius: 4px; margin: 0 2px;">last week active partners</span>
            <span style="color: #4b5563;">of the month — inactive partners are excluded.</span>
            <span style="color: #94a3b8; margin: 0 4px;">|</span>
            <span style="color: #4b5563;">This table shows the</span>
            <span style="font-weight: 700; color: #0369a1; background: #e0f2fe; padding: 1px 8px; border-radius: 4px; margin: 0 2px;">capacity rules impact</span>
            <span style="color: #4b5563;">on target assignment per performance level (Good, Average, Bad).</span>
            <span style="color: #94a3b8; margin: 0 4px;">|</span>
            <span style="color: #4b5563;">Targets are based on each partner's</span>
            <span style="font-weight: 700; color: #b45309; background: #fef3c7; padding: 1px 8px; border-radius: 4px; margin: 0 2px;">latest assessment</span>
            <span style="color: #4b5563;">— some partners may have shifted category since last month.</span>
        </p>
    </div>

    <!-- Summary KPI Strip -->
    <div style="display: flex; justify-content: center; gap: 16px; padding: 14px 24px; background: #f8fafc; border-bottom: 1px solid #f1f5f9;">
        <div style="display: flex; align-items: center; gap: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 20px; padding: 6px 16px;">
            <span style="width: 8px; height: 8px; border-radius: 50%; background: #6366f1;"></span>
            <span style="font-size: 11px; color: #6b7280;">Last Month Total</span>
            <span style="font-size: 13px; font-weight: 800; color: #1e293b;">22,342</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 20px; padding: 6px 16px;">
            <span style="width: 8px; height: 8px; border-radius: 50%; background: #2563eb;"></span>
            <span style="font-size: 11px; color: #6b7280;">New Month Total</span>
            <span style="font-size: 13px; font-weight: 800; color: #1e293b;">18,976</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 20px; padding: 6px 16px;">
            <span style="width: 8px; height: 8px; border-radius: 50%; background: #dc2626;"></span>
            <span style="font-size: 11px; color: #6b7280;">Net Delta</span>
            <span style="font-size: 13px; font-weight: 800; color: #dc2626;">-3,366</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 20px; padding: 6px 16px;">
            <span style="width: 8px; height: 8px; border-radius: 50%; background: #0ea5e9;"></span>
            <span style="font-size: 11px; color: #6b7280;">Partners with Target</span>
            <span style="font-size: 13px; font-weight: 800; color: #1e293b;">534</span>
        </div>
    </div>

    <!-- Data Table -->
    <div style="padding: 16px 24px 20px;">
        <table style="width: 100%; border-collapse: separate; border-spacing: 0; font-size: 13px; border-radius: 10px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
            <thead>
                <tr>
                    <th style="padding: 12px 16px; background: linear-gradient(135deg, #1e293b, #334155); color: white; text-align: left; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #475569;">Category</th>
                    <th style="padding: 12px 16px; background: linear-gradient(135deg, #1e293b, #334155); color: white; text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #475569;"># of Partners<br>with Target</th>
                    <th style="padding: 12px 16px; background: linear-gradient(135deg, #1e293b, #334155); color: white; text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #475569;">Last Month Final Target</th>
                    <th style="padding: 12px 16px; background: linear-gradient(135deg, #1e293b, #334155); color: white; text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #475569;">New Month Final Target</th>
                    <th style="padding: 12px 16px; background: linear-gradient(135deg, #1e293b, #334155); color: white; text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #475569;">Delta</th>
                    <th style="padding: 12px 16px; background: linear-gradient(135deg, #1e293b, #334155); color: white; text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #475569;">MoM %</th>
                </tr>
            </thead>
            <tbody>
                <!-- Good Row -->
                <tr style="background: #f0fdf4; transition: background 0.2s;" onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
                    <td style="padding: 14px 16px; border-bottom: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="width: 10px; height: 10px; border-radius: 50%; background: #10b981; box-shadow: 0 0 6px rgba(16,185,129,0.4);"></span>
                            <span style="font-weight: 700; color: #065f46; font-size: 13px;">Good</span>
                        </div>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #1e293b; background: #e0f2fe; padding: 3px 12px; border-radius: 6px; font-size: 13px;">252</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">10,914</td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 700; color: #1e293b; border-bottom: 1px solid #e5e7eb;">10,192</td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #dc2626; background: #fee2e2; padding: 3px 10px; border-radius: 6px; font-size: 12px;">-722</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #dc2626; font-size: 12px;">-6.6%</span>
                    </td>
                </tr>
                <!-- Average Row -->
                <tr style="background: #fffbeb; transition: background 0.2s;" onmouseover="this.style.background='#fef3c7'" onmouseout="this.style.background='#fffbeb'">
                    <td style="padding: 14px 16px; border-bottom: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="width: 10px; height: 10px; border-radius: 50%; background: #f59e0b; box-shadow: 0 0 6px rgba(245,158,11,0.4);"></span>
                            <span style="font-weight: 700; color: #92400e; font-size: 13px;">Average</span>
                        </div>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #1e293b; background: #e0f2fe; padding: 3px 12px; border-radius: 6px; font-size: 13px;">262</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">10,620</td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 700; color: #1e293b; border-bottom: 1px solid #e5e7eb;">8,414</td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #dc2626; background: #fee2e2; padding: 3px 10px; border-radius: 6px; font-size: 12px;">-2,206</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #dc2626; font-size: 12px;">-20.8%</span>
                    </td>
                </tr>
                <!-- Bad Row -->
                <tr style="background: #fef2f2; transition: background 0.2s;" onmouseover="this.style.background='#fee2e2'" onmouseout="this.style.background='#fef2f2'">
                    <td style="padding: 14px 16px; border-bottom: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="width: 10px; height: 10px; border-radius: 50%; background: #dc2626; box-shadow: 0 0 6px rgba(220,38,38,0.4);"></span>
                            <span style="font-weight: 700; color: #991b1b; font-size: 13px;">Bad</span>
                        </div>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #1e293b; background: #e0f2fe; padding: 3px 12px; border-radius: 6px; font-size: 13px;">20</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">808</td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 700; color: #1e293b; border-bottom: 1px solid #e5e7eb;">370</td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #dc2626; background: #fee2e2; padding: 3px 10px; border-radius: 6px; font-size: 12px;">-438</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-weight: 700; color: #dc2626; font-size: 12px;">-54.2%</span>
                    </td>
                </tr>
                <!-- Total Row -->
                <tr style="background: linear-gradient(90deg, #f1f5f9, #eef2ff); transition: background 0.2s;">
                    <td style="padding: 14px 16px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="width: 10px; height: 10px; border-radius: 50%; background: linear-gradient(135deg, #2563eb, #7c3aed); box-shadow: 0 0 6px rgba(99,102,241,0.4);"></span>
                            <span style="font-weight: 800; color: #1e293b; font-size: 14px;">Total</span>
                        </div>
                    </td>
                    <td style="padding: 14px 16px; text-align: center;">
                        <span style="font-weight: 800; color: white; background: linear-gradient(135deg, #2563eb, #7c3aed); padding: 4px 14px; border-radius: 6px; font-size: 14px; box-shadow: 0 2px 6px rgba(99,102,241,0.3);">534</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 800; color: #1e293b; font-size: 14px;">22,342</td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: 800; color: #1e293b; font-size: 14px;">18,976</td>
                    <td style="padding: 14px 16px; text-align: center;">
                        <span style="font-weight: 800; color: white; background: linear-gradient(135deg, #dc2626, #b91c1c); padding: 4px 14px; border-radius: 6px; font-size: 13px; box-shadow: 0 2px 6px rgba(220,38,38,0.3);">-3,366</span>
                    </td>
                    <td style="padding: 14px 16px; text-align: center;">
                        <span style="font-weight: 800; color: #dc2626; font-size: 13px;">-15.1%</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Manual Adjustment Summary Panel - NPS Style -->
<div style="background: white; border-radius: 0; padding: 0; margin-bottom: 16px; border: 1px solid #e5e7eb;">
    <!-- Header -->
    <div style="background: linear-gradient(90deg, #0d9488 0%, #14b8a6 100%); padding: 10px 20px; display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 6px; height: 28px; background: white; border-radius: 4px;"></div>
            <span style="color: white; font-size: 18px; font-weight: 700; letter-spacing: 0.5px;">Manual Adjustment Summary - Feb 2026</span>
        </div>
        <div style="display: flex; gap: 20px; align-items: center;">
            <div style="display: flex; align-items: center; gap: 6px;"><span style="width: 14px; height: 14px; background: #10b981; border-radius: 3px;"></span><span style="color: white; font-size: 11px;">Capacity Added</span></div>
            <div style="display: flex; align-items: center; gap: 6px;"><span style="width: 14px; height: 14px; background: #fbbf24; border-radius: 3px;"></span><span style="color: white; font-size: 11px;">Unchanged</span></div>
            <div style="display: flex; align-items: center; gap: 6px;"><span style="width: 14px; height: 14px; background: #f87171; border-radius: 3px;"></span><span style="color: white; font-size: 11px;">Capacity Reduced</span></div>
        </div>
    </div>
    
    <!-- KPI Badges Strip -->
    <div style="display: flex; justify-content: center; gap: 10px; padding: 10px 20px; background: #f8fafc; border-bottom: 1px solid #e5e7eb; flex-wrap: wrap;">
        <div class="tooltip-card" data-tooltip="MoM change in adjusted partners. Jan: 123 → Feb: 61 → (61−123)/123 = −50.4%" style="display: flex; align-items: center; gap: 12px; background: white; border: 2px solid #e5e7eb; border-radius: 25px; padding: 8px 20px; cursor: pointer;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">MoM Partners</span>
            <span style="color: #dc2626; font-weight: 700; font-size: 14px;">-50.4%</span>
            <span style="color: #dc2626; font-size: 12px;">▼</span>
        </div>
        <div class="tooltip-card" data-tooltip="Net capacity change as % of total target assigned to adjusted partners. Net change (423−596) = −173 ÷ Total given target (2,012) = −8.6%" style="display: flex; align-items: center; gap: 12px; background: white; border: 2px solid #e5e7eb; border-radius: 25px; padding: 8px 20px; cursor: pointer;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">Net Impact</span>
            <span style="color: #dc2626; font-weight: 700; font-size: 14px;">-8.6%</span>
            <span style="color: #dc2626; font-size: 12px;">▼</span>
        </div>
        <div class="tooltip-card" data-tooltip="Total unique partners with manual capacity adjustments applied in Feb 2026. Down from 123 in Jan (−62 partners)." style="display: flex; align-items: center; gap: 12px; background: white; border: 2px solid #e5e7eb; border-radius: 25px; padding: 8px 20px; cursor: pointer;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">Partners Adjusted</span>
            <span style="color: #0d9488; font-weight: 700; font-size: 14px;">61</span>
            <span style="color: #0d9488; font-size: 12px;">▲</span>
        </div>
        <div class="tooltip-card" data-tooltip="Total absolute capacity units moved. 423 added + 596 reduced = 1,019 total capacity movements." style="display: flex; align-items: center; gap: 12px; background: white; border: 2px solid #e5e7eb; border-radius: 25px; padding: 8px 20px; cursor: pointer;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">Total Moved</span>
            <span style="color: #0d9488; font-weight: 700; font-size: 14px;">1,019</span>
            <span style="color: #0d9488; font-size: 12px;">▲</span>
        </div>
        <div class="tooltip-card" data-tooltip="Most common reason for manual adjustments: Driver Card issues — 23 partners (37.7% of all adjustments)." style="display: flex; align-items: center; gap: 12px; background: white; border: 2px solid #e5e7eb; border-radius: 25px; padding: 8px 20px; cursor: pointer;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">Top Issue</span>
            <span style="color: #dc2626; font-weight: 700; font-size: 14px;">Driver Card</span>
            <span style="color: #dc2626; font-size: 12px;">⚠</span>
        </div>
    </div>
    
    <!-- Main Metrics Section -->
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0; padding: 16px 24px; background: white;">
        <!-- Adjusted Partners Score -->
        <div style="text-align: center; border-right: 1px solid #e5e7eb; padding-right: 30px;">
            <div style="display: flex; align-items: center; gap: 8px; justify-content: center; margin-bottom: 8px;">
                <div style="width: 5px; height: 20px; background: #0d9488; border-radius: 3px;"></div>
                <span style="font-size: 15px; font-weight: 600; color: #374151; font-style: italic;">Adjusted Partners</span>
            </div>
            <div style="display: flex; align-items: flex-start; justify-content: center; gap: 6px;">
                <span style="font-size: 48px; font-weight: 300; color: #0d9488; line-height: 1;">61</span>
                <span style="color: #dc2626; font-size: 14px; margin-top: 8px;">▼</span>
            </div>
            <div style="margin-top: 16px; padding: 12px; background: #f1f5f9; border-radius: 8px;">
                <div style="font-size: 11px; color: #64748b; margin-bottom: 6px;">Jan: 123 → Feb: 61</div>
                <div style="font-size: 12px; color: #475569;"><strong>-62 partners</strong> month-over-month</div>
            </div>
        </div>
        
        <!-- Net Capacity Change Score -->
        <div style="text-align: center; border-right: 1px solid #e5e7eb; padding: 0 30px;">
            <div style="display: flex; align-items: center; gap: 8px; justify-content: center; margin-bottom: 8px;">
                <div style="width: 5px; height: 20px; background: #6366f1; border-radius: 3px;"></div>
                <span style="font-size: 15px; font-weight: 600; color: #374151; font-style: italic;">Net Capacity Change</span>
            </div>
            <div style="display: flex; align-items: flex-start; justify-content: center; gap: 6px;">
                <span style="font-size: 48px; font-weight: 300; color: #dc2626; line-height: 1;">-173</span>
                <span style="color: #dc2626; font-size: 14px; margin-top: 8px;">▼</span>
            </div>
            <div style="margin-top: 16px; padding: 12px; background: #f1f5f9; border-radius: 8px;">
                <div style="font-size: 11px; color: #64748b; margin-bottom: 6px;">Calculation = Added - Reduced</div>
                <div style="font-size: 12px; color: #475569;"><strong>+423</strong> added - <strong>596</strong> reduced</div>
            </div>
        </div>
        
        <!-- Category Breakdown -->
        <div style="padding-left: 30px;">
            <div style="text-align: center; margin-bottom: 10px;">
                <span style="font-size: 15px; font-weight: 600; color: #374151; font-style: italic;">Capacity Movement Breakdown</span>
            </div>
            <!-- Stacked Bar -->
            <div style="display: flex; height: 40px; border-radius: 6px; overflow: hidden; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="width: 41.5%; background: linear-gradient(180deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center;">
                    <span style="color: white; font-weight: 700; font-size: 14px;">423</span>
                </div>
                <div style="width: 58.5%; background: linear-gradient(180deg, #f87171 0%, #dc2626 100%); display: flex; align-items: center; justify-content: center;">
                    <span style="color: white; font-weight: 700; font-size: 14px;">596</span>
                </div>
            </div>
            <div style="display: flex; justify-content: center; gap: 24px; margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 6px;"><span style="width: 12px; height: 12px; background: #10b981; border-radius: 2px;"></span><span style="font-size: 12px; color: #64748b;">Added (41.5%)</span></div>
                <div style="display: flex; align-items: center; gap: 6px;"><span style="width: 12px; height: 12px; background: #f87171; border-radius: 2px;"></span><span style="font-size: 12px; color: #64748b;">Reduced (58.5%)</span></div>
            </div>
            <!-- Top Driver Alert -->
            <div style="background: #fef2f2; border: 2px dashed #fca5a5; border-radius: 8px; padding: 12px; text-align: center;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 6px;">
                    <span style="font-size: 16px;">⚠️</span>
                    <span style="font-size: 13px; font-weight: 700; color: #dc2626;">TOP DRIVER</span>
                </div>
                <div style="font-size: 16px; font-weight: 700; color: #991b1b;">Driver Card Issues</div>
                <div style="font-size: 13px; color: #b91c1c; margin-top: 4px;"><strong>23</strong> partners (37.7%)</div>
            </div>
        </div>
    </div>
</div>

<!-- How We Reduced Manual Adjustment — Collapsed Section -->
<details style="margin-bottom: 16px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.06); border: 1px solid #e2e8f0;">
    <summary style="background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 40%, #4338ca 100%); padding: 14px 24px; cursor: pointer; display: flex; align-items: center; gap: 14px; list-style: none; user-select: none;">
        <span style="width: 32px; height: 32px; background: rgba(255,255,255,0.12); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; color: white; font-weight: 700;">▶</span>
        <span style="color: white; font-size: 15px; font-weight: 700; flex: 1;">How We Reduced Manual Adjustments — Feb Approach</span>
        <span style="color: rgba(255,255,255,0.5); font-size: 11px; font-weight: 600; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 20px;">Click to expand ▾</span>
    </summary>
    <div style="background: linear-gradient(180deg, #f8fafc, #ffffff); padding: 20px 24px 24px;">
        <!-- Intro -->
        <p style="font-size: 13px; color: #475569; margin: 0 0 18px; line-height: 1.5; padding: 10px 16px; background: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 0 8px 8px 0;">
            We reduced manual edits by <strong style="color: #1e40af;">tightening rules</strong>, <strong style="color: #7c3aed;">requiring evidence</strong>, and <strong style="color: #0d9488;">aligning stakeholders early</strong> — so targets follow one consistent logic.
        </p>

        <!-- 3 Rule Cards in Flow -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; position: relative;">

            <!-- Flow Connector Arrows -->
            <div style="position: absolute; top: 50%; left: 33.33%; transform: translate(-50%, -50%); z-index: 2; width: 28px; height: 28px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(99,102,241,0.4);">
                <span style="color: white; font-size: 14px; font-weight: 800;">→</span>
            </div>
            <div style="position: absolute; top: 50%; left: 66.66%; transform: translate(-50%, -50%); z-index: 2; width: 28px; height: 28px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(99,102,241,0.4);">
                <span style="color: white; font-size: 14px; font-weight: 800;">→</span>
            </div>

            <!-- Rule 1 -->
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 12px 0 0 12px; padding: 18px; border-right: 1px dashed #d1d5db; position: relative;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #0ea5e9, #38bdf8); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 800; color: white; flex-shrink: 0;">1</div>
                    <span style="font-size: 13px; font-weight: 700; color: #0c4a6e;">Same-Level Shift Rules</span>
                </div>
                <!-- Shift Diagram -->
                <div style="background: #f0f9ff; border-radius: 8px; padding: 10px 12px; margin-bottom: 10px;">
                    <div style="display: flex; flex-direction: column; gap: 5px; font-size: 11px;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 10px;">Good</span>
                            <span style="color: #94a3b8;">→</span>
                            <span style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 4px; font-weight: 600; font-size: 10px;">Good only</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 10px;">Average</span>
                            <span style="color: #94a3b8;">→</span>
                            <span style="background: #fef3c7; color: #92400e; padding: 2px 8px; border-radius: 4px; font-weight: 600; font-size: 10px;">Average or Good</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <span style="background: #ef4444; color: white; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 10px;">Bad</span>
                            <span style="color: #94a3b8;">→</span>
                            <span style="background: #fee2e2; color: #991b1b; padding: 2px 8px; border-radius: 4px; font-weight: 600; font-size: 10px;">Bad or higher</span>
                        </div>
                    </div>
                </div>
                <div style="font-size: 11px; color: #475569; line-height: 1.5;">
                    <div style="margin-bottom: 4px;"><span style="font-weight: 700; color: #0369a1;">Purpose:</span> Keep growth on strong partners & protect avg scale.</div>
                    <div><span style="font-weight: 700; color: #16a34a;">Result:</span> Fewer random reductions; PMMs push delivery or reassign within tier.</div>
                </div>
            </div>

            <!-- Rule 2 -->
            <div style="background: white; border: 1px solid #e5e7eb; padding: 18px; border-right: 1px dashed #d1d5db; position: relative;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #7c3aed, #a78bfa); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 800; color: white; flex-shrink: 0;">2</div>
                    <span style="font-size: 13px; font-weight: 700; color: #4c1d95;">No Removal Without Proof</span>
                </div>
                <!-- Evidence Required Visual -->
                <div style="background: #faf5ff; border-radius: 8px; padding: 10px 12px; margin-bottom: 10px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 6px;">
                        <span style="font-size: 20px;">🚫</span>
                        <span style="color: #6b7280; font-size: 18px;">→</span>
                        <span style="font-size: 20px;">📄</span>
                        <span style="color: #6b7280; font-size: 18px;">→</span>
                        <span style="font-size: 20px;">✅</span>
                    </div>
                    <div style="font-size: 10px; color: #7c3aed; font-weight: 600;">No ad-hoc removal → Provide evidence → Approved</div>
                </div>
                <div style="font-size: 11px; color: #475569; line-height: 1.5;">
                    <div style="margin-bottom: 4px;"><span style="font-weight: 700; color: #7c3aed;">Rule:</span> PMMs need valid proof (screenshot/record) to remove any target.</div>
                    <div style="margin-bottom: 4px;"><span style="font-weight: 700; color: #0369a1;">Purpose:</span> Eliminate decisions not backed by data.</div>
                    <div><span style="font-weight: 700; color: #16a34a;">Result:</span> Adjustments drop — all exceptions are controlled & traceable.</div>
                </div>
            </div>

            <!-- Rule 3 -->
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 12px 12px 0; padding: 18px; position: relative;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #0d9488, #2dd4bf); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 800; color: white; flex-shrink: 0;">3</div>
                    <span style="font-size: 13px; font-weight: 700; color: #134e4a;">Upfront Alignment & PMM Ownership</span>
                </div>
                <!-- Wiki Checklist Visual -->
                <div style="background: #f0fdfa; border-radius: 8px; padding: 10px 12px; margin-bottom: 10px;">
                    <div style="font-size: 10px; font-weight: 700; color: #0d9488; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Pre-cycle session → Share wiki:</div>
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 11px; color: #334155;">
                            <span style="color: #10b981;">✓</span> Target rules & logic
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 11px; color: #334155;">
                            <span style="color: #10b981;">✓</span> Stratification metrics & criteria
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 11px; color: #334155;">
                            <span style="color: #10b981;">✓</span> Examples & common cases
                        </div>
                    </div>
                </div>
                <!-- PMM Ownership -->
                <div style="background: #eff6ff; border-radius: 8px; padding: 10px 12px; margin-bottom: 10px; border-left: 3px solid #3b82f6;">
                    <div style="font-size: 10px; font-weight: 700; color: #1d4ed8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">After alignment → PMM authority:</div>
                    <div style="font-size: 11px; color: #334155; line-height: 1.5;">
                        PMMs can request adjustments <strong>without pre-approval</strong> — as long as they follow the shared rules and support Keeta's monthly target. Frontline teams are closest to reality and partners.
                    </div>
                </div>
                <div style="font-size: 11px; color: #475569; line-height: 1.5;">
                    <div style="margin-bottom: 4px;"><span style="font-weight: 700; color: #0369a1;">Purpose:</span> Align first, then empower — fewer blockers, faster decisions.</div>
                    <div><span style="font-weight: 700; color: #16a34a;">Result:</span> PMMs act confidently within clear rules — less back-and-forth, more ownership.</div>
                </div>
            </div>
        </div>

        <!-- Real Example: Push-back on Zero Target Request -->
        <div style="margin-top: 20px; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #dc2626, #f59e0b); padding: 10px 20px; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 16px;">⚠️</span>
                <span style="color: white; font-size: 13px; font-weight: 700;">Real Example — Push-back on removing a good partner's target</span>
            </div>
            <div style="padding: 10px 20px 6px; background: #fefce8; border-bottom: 1px solid #fde68a;">
                <p style="margin: 0; font-size: 12px; color: #92400e; line-height: 1.5;">
                    <span style="font-weight: 700; color: #b91c1c;">Context:</span> A PMM requested to set a <strong>good-performing partner's target to zero</strong> based on city-level cancellation rate. We refused — the partner had <strong>100% FR, 100 Driver Card</strong> and was rated <strong>Good</strong> across all 8 metrics over 3 months. Removing their target would violate our data-driven rules. The case was escalated and resolved through a meeting.
                </p>
            </div>
            <!-- Chat Thread -->
            <div style="background: #f8fafc; padding: 16px 20px; display: flex; flex-direction: column; gap: 12px; max-height: 480px; overflow-y: auto;">

                <!-- Ruaa 09:09 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">R</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Ruaa Alabdulrahman</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 09:09 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            performance all month is below city average <span style="color: #2563eb; font-weight: 600;">@Adeel Ahmed</span> <span style="background: #dbeafe; color: #1e40af; padding: 1px 6px; border-radius: 4px; font-weight: 600;">@Mohamed Gamal</span>
                        </div>
                    </div>
                </div>

                <!-- Mohamed 10:02 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0ea5e9, #38bdf8); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">M</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Mohamed Gamal</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 10:02 AM</span>
                        </div>
                        <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #1e3a5f; line-height: 1.6; max-width: 85%;">
                            <span style="color: #2563eb; font-weight: 600;">@Ruaa Alabdulrahman</span><br>
                            Performance used for three month and they are good performance with 100% FR, 100 Driver card, what's the logic to give them zero target?<br><br>
                            <span style="color: #2563eb; font-weight: 600;">@Adeel Ahmed</span> ^
                        </div>
                    </div>
                </div>

                <!-- Ruaa 10:13 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">R</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Ruaa Alabdulrahman</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 10:13 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            <span style="background: #dbeafe; color: #1e40af; padding: 1px 6px; border-radius: 4px; font-weight: 600;">@Mohamed Gamal</span> shared above their Jan overall performance ^
                        </div>
                    </div>
                </div>

                <!-- Mohamed 10:30 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0ea5e9, #38bdf8); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">M</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Mohamed Gamal</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 10:30 AM</span>
                        </div>
                        <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #1e3a5f; line-height: 1.6; max-width: 85%;">
                            Yes, as mentioned above, we are considering 3 months performance assessment not MTD, we explained this
                        </div>
                    </div>
                </div>

                <!-- Mohamed 10:32 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0ea5e9, #38bdf8); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">M</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Mohamed Gamal</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 10:32 AM</span>
                        </div>
                        <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #1e3a5f; line-height: 1.6; max-width: 85%;">
                            The option we can do is to reduce their target a bit and give the reduction target to same level partners (good one)
                        </div>
                    </div>
                </div>

                <!-- Ruaa 10:56 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">R</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Ruaa Alabdulrahman</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 10:56 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            in 3 months they been average with a constants high cancelation and Al Ahsa overall cancelation is very high so we need to reduce those who contribute the majority of the city cancelation thu have low capacity
                        </div>
                    </div>
                </div>

                <!-- Mohamed 10:58 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0ea5e9, #38bdf8); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">M</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Mohamed Gamal</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 10:58 AM</span>
                        </div>
                        <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #1e3a5f; line-height: 1.6; max-width: 85%;">
                            Kindly note that the performance level has a score with 8 metrics not only cancellation rate, if you a confusion on that level, pls arrange for a meeting to discuss further, for now let's pls work on the data we added<br><br>
                            thank you
                        </div>
                    </div>
                </div>

                <!-- Ruaa 11:02 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">R</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Ruaa Alabdulrahman</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 11:02 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            <span style="background: #dbeafe; color: #1e40af; padding: 1px 6px; border-radius: 4px; font-weight: 600;">@Mohamed Gamal</span> you asked for justification im justifying my actions if i need to raise a request ill. Im well aware of the 8 matrics as ill follow up on daily.
                        </div>
                    </div>
                </div>

                <!-- Mohamed 11:05 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0ea5e9, #38bdf8); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">M</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Mohamed Gamal</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-27 11:05 AM</span>
                        </div>
                        <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #1e3a5f; line-height: 1.6; max-width: 85%;">
                            The justification is against our data statement, we can't terminate good partners without valid reason<br><br>
                            <span style="color: #2563eb; font-weight: 600;">@Adeel Ahmed</span> If you have time, let's discuss this today me, you, and Ruaa
                        </div>
                    </div>
                </div>

                <!-- Ruaa 01-28 09:17 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">R</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">Ruaa Alabdulrahman</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-28 09:17 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            CC: <span style="color: #2563eb; font-weight: 600;">@王奉策(Chandler Wa...</span>
                        </div>
                    </div>
                </div>

                <!-- Chandler 01-28 09:38 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0d9488, #2dd4bf); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">C</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">王奉策 (Chandler)</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-28 09:38 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            <span style="color: #2563eb; font-weight: 600;">@Adeel Ahmed</span> check this, driver card is priority
                        </div>
                    </div>
                </div>

                <!-- Chandler 01-28 09:39 -->
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #0d9488, #2dd4bf); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 700; flex-shrink: 0;">C</div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 3px;">
                            <span style="font-size: 12px; font-weight: 700; color: #1e293b;">王奉策 (Chandler)</span>
                            <span style="font-size: 10px; color: #94a3b8;">01-28 09:39 AM</span>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0 10px 10px 10px; padding: 10px 14px; font-size: 12px; color: #334155; line-height: 1.6; max-width: 85%;">
                            <span style="background: #dbeafe; color: #1e40af; padding: 1px 6px; border-radius: 4px; font-weight: 600;">@Mohamed Gamal</span> fyi, in KAS, cost is first, compliance is second, customer experience is third, all others are rest
                        </div>
                    </div>
                </div>

                <!-- Reactions -->
                <div style="display: flex; align-items: center; gap: 6px; padding-left: 42px;">
                    <span style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 12px; padding: 2px 10px; font-size: 11px; color: #2563eb; font-weight: 600;">👍 Mohamed Gamal, Adeel Ahmed</span>
                </div>
            </div>

            <!-- Outcome Footer -->
            <div style="background: linear-gradient(90deg, #f0fdf4, #ecfdf5); padding: 10px 20px; border-top: 1px solid #bbf7d0; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 14px;">✅</span>
                <p style="margin: 0; font-size: 12px; color: #166534; line-height: 1.4;">
                    <span style="font-weight: 700;">Outcome:</span> Request to zero the target was <strong>rejected</strong>. The partner kept their target with a minor reduction, redistributed to same-tier (Good) partners — fully aligned with our rules.
                    <a href="https://km.sankuai.com/collabpage/2744845954" target="_blank" style="margin-left: 8px; font-size: 11px; font-weight: 700; color: #2563eb; background: #eff6ff; padding: 2px 10px; border-radius: 12px; border: 1px solid #bfdbfe; text-decoration: none;">📄 View full case details →</a>
                </p>
            </div>
        </div>

    </div>
</details>

 <div class="chart-grid">
 <div class="chart-container">
 <div id="leftChartCards" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:10px;">
    <div class="tooltip-card" data-tooltip="Net impact after manual adjustment across all segments. Computed as After Manual Total minus Rule Total (18,976 − 19,242 = −266 riders)." style="background:linear-gradient(135deg,#eff6ff 0%,#dbeafe 100%);border:1px solid #bfdbfe;border-radius:8px;padding:8px 10px;cursor:pointer;">
     <div style="font-size:9px;color:#1e3a8a;font-weight:700;text-transform:uppercase;letter-spacing:.3px;">Net Manual Impact</div>
     <div id="overviewInsightNet" style="font-size:16px;font-weight:800;color:#1e40af;line-height:1.2;margin-top:2px;">—</div>
     <div id="overviewInsightNetSub" style="font-size:10px;color:#475569;margin-top:1px;">—</div>
   </div>
    <div class="tooltip-card" data-tooltip="Segment with the largest shift after manual adjustment. Bad segment increased by +226 riders (+157%), while Good segment decreased." style="background:linear-gradient(135deg,#fffbeb 0%,#fef3c7 100%);border:1px solid #fde68a;border-radius:8px;padding:8px 10px;cursor:pointer;">
     <div style="font-size:9px;color:#92400e;font-weight:700;text-transform:uppercase;letter-spacing:.3px;">Largest Segment Shift</div>
     <div id="overviewInsightShift" style="font-size:16px;font-weight:800;color:#b45309;line-height:1.2;margin-top:2px;">—</div>
     <div id="overviewInsightShiftSub" style="font-size:10px;color:#475569;margin-top:1px;">—</div>
   </div>
 </div>
 <h3 class="chart-title">Feb Target vs After Manual Adjustment (Good / Average / Bad Partners)</h3>
 <p style="color: #6b7280; font-size: 12px; margin: 0 0 8px 0; font-style: italic;">Capacity targets for partners by performance segment (Good / Average / Bad) before and after PMM manual adjustments; shows how manual overrides impacted our rule-based targets.</p>
 <canvas id="manualAdjustChart"></canvas>
 </div>
 <div class="chart-container">
 <div id="rightChartCards" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:10px;">
    <div class="tooltip-card" data-tooltip="Partners whose target increased vs previous month. Share is calculated out of 551 partners with target in Feb." style="background:linear-gradient(135deg,#ecfdf5 0%,#d1fae5 100%);border:1px solid #a7f3d0;border-radius:8px;padding:8px 10px;cursor:pointer;">
     <div style="font-size:9px;color:#065f46;font-weight:700;text-transform:uppercase;letter-spacing:.3px;">Increase Partners</div>
     <div id="overviewInsightInc" style="font-size:16px;font-weight:800;color:#047857;line-height:1.2;margin-top:2px;">—</div>
     <div id="overviewInsightIncSub" style="font-size:10px;color:#475569;margin-top:1px;">—</div>
   </div>
    <div class="tooltip-card" data-tooltip="Partners whose target decreased vs previous month. Share is calculated out of 551 partners with target in Feb." style="background:linear-gradient(135deg,#fef2f2 0%,#fee2e2 100%);border:1px solid #fecaca;border-radius:8px;padding:8px 10px;cursor:pointer;">
     <div style="font-size:9px;color:#991b1b;font-weight:700;text-transform:uppercase;letter-spacing:.3px;">Decrease Partners</div>
     <div id="overviewInsightDec" style="font-size:16px;font-weight:800;color:#dc2626;line-height:1.2;margin-top:2px;">—</div>
     <div id="overviewInsightDecSub" style="font-size:10px;color:#475569;margin-top:1px;">—</div>
   </div>
 </div>
 <h3 class="chart-title">Partner Capacity Changes</h3>
 <p style="color: #6b7280; font-size: 12px; margin: 0 0 8px 0; font-style: italic;">Distribution of 551 partners with active targets showing capacity direction: increases, unchanged, or decreases vs previous month.</p>
 <canvas id="changesChart"></canvas>
 </div>
 </div>
<!-- PERFORMANCE & SCALE SUMMARY SECTION -->
<div id="monthOverviewPerfScale" style="margin-top: 20px; margin-bottom: 20px;">
<h3 style="color: #1f4e78; margin-bottom: 12px; font-size: 18px; border-bottom: 2px solid #0ea5e9; padding-bottom: 8px;">
    📌 Performance & Scale Summary (Jan vs Feb)
</h3>
<!-- PS Summary Cards -->
<div id="psSummaryCardsContainer" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px;">
    <div id="psSummaryCard1" class="ps-summary-card tooltip-card" data-tooltip="Total partners with active capacity target in Feb. Tracks overall partner base." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; animation: psCardSlideIn 0.5s ease forwards;">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #0ea5e9, #06b6d4); border-radius: 12px 12px 0 0;"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0;">👥</div>
            <div style="min-width: 0;">
                <div id="psCard1Label" style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Partners with Target</div>
                <div style="display: flex; align-items: baseline; gap: 4px; flex-wrap: wrap;">
                    <span id="psCard1Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">551</span>
                    <span id="psCard1MoM" style="font-size: 11px; font-weight: 700; color: #dc2626;">-11.8%</span>
                </div>
                <div id="psCard1Sub" style="font-size: 11px; color: #6b7280;">Jan 625 → Feb 551</div>
            </div>
        </div>
    </div>
    <div id="psSummaryCard2" class="ps-summary-card tooltip-card" data-tooltip="Total capacity target value in Feb. Shows overall target volume." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; animation: psCardSlideIn 0.5s ease 0.1s forwards;">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #f59e0b, #fbbf24); border-radius: 12px 12px 0 0;"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0;">🎯</div>
            <div style="min-width: 0;">
                <div id="psCard2Label" style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Target</div>
                <div style="display: flex; align-items: baseline; gap: 4px; flex-wrap: wrap;">
                    <span id="psCard2Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">19,365</span>
                    <span id="psCard2MoM" style="font-size: 11px; font-weight: 700; color: #dc2626;">-13.7%</span>
                </div>
                <div id="psCard2Sub" style="font-size: 11px; color: #6b7280;">Jan 22,453 → Feb 19,365</div>
            </div>
        </div>
    </div>
    <div id="psSummaryCard3" class="ps-summary-card tooltip-card" data-tooltip="Average scale per partner in Feb. Measures capacity density." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; animation: psCardSlideIn 0.5s ease 0.2s forwards;">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #10b981, #34d399); border-radius: 12px 12px 0 0;"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0;">📊</div>
            <div style="min-width: 0;">
                <div id="psCard3Label" style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Avg Scale</div>
                <div style="display: flex; align-items: baseline; gap: 4px; flex-wrap: wrap;">
                    <span id="psCard3Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">35.1</span>
                    <span id="psCard3MoM" style="font-size: 11px; font-weight: 700; color: #dc2626;">-2.2%</span>
                </div>
                <div id="psCard3Sub" style="font-size: 11px; color: #6b7280;">Jan 35.9 → Feb 35.1</div>
            </div>
        </div>
    </div>
    <div id="psSummaryCard4" class="ps-summary-card tooltip-card" data-tooltip="Delivery riders across all partners in Feb. Tracks rider availability." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; animation: psCardSlideIn 0.5s ease 0.3s forwards;">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #8b5cf6, #a78bfa); border-radius: 12px 12px 0 0;"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0;">🚴</div>
            <div style="min-width: 0;">
                <div id="psCard4Label" style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Delivery Riders</div>
                <div style="display: flex; align-items: baseline; gap: 4px; flex-wrap: wrap;">
                    <span id="psCard4Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">20,489</span>
                    <span id="psCard4MoM" style="font-size: 11px; font-weight: 700; color: #dc2626;">-12.8%</span>
                </div>
                <div id="psCard4Sub" style="font-size: 11px; color: #6b7280;">Jan 23,511 → Feb 20,489</div>
            </div>
        </div>
    </div>
</div>
<!-- Dynamic context note -->
<div id="psContextNote" style="text-align: center; padding: 6px 14px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; margin-bottom: 8px; font-size: 12px; color: #0369a1; font-weight: 500; border: 1px solid #bae6fd; transition: all 0.3s ease;">
    🧭 Filter by period, performance, or scale to view avg scale & capacity breakdown. Overall avg scale is always included.
</div>

<!-- Section View Toggles -->
<div style="display: flex; justify-content: center; gap: 16px; margin: 18px 0 14px 0; flex-wrap: wrap;">
    <button class="ps-view-toggle tooltip-btn tooltip-btn-sky active" data-view="summary" data-tooltip="Executive summary of avg scale & capacity changes between Jan and Feb; filter by period, performance, and scale." style="padding: 12px 26px; border: 3px solid #0ea5e9; border-radius: 12px; background: #0ea5e9; color: white; font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 4px 10px rgba(14,165,233,0.25);">
        Avg Scale & Capacity Summary
    </button>
    <button class="ps-view-toggle tooltip-btn tooltip-btn-sky" data-view="breakdown" data-tooltip="Detailed breakdown of performance & scale segments (Jan vs Feb) to compare mix shifts." style="padding: 12px 26px; border: 3px solid #e5e7eb; border-radius: 12px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        Performance & Scale Breakdown
    </button>
    <button class="ps-view-toggle tooltip-btn tooltip-btn-sky" data-view="target-breakdown" data-tooltip="Capacity target breakdown by performance level (Good/Average/Bad) with New vs Old partner split comparison." style="padding: 12px 26px; border: 3px solid #e5e7eb; border-radius: 12px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        Performance Target Breakdown
    </button>
    <button class="ps-view-toggle tooltip-btn tooltip-btn-sky" data-view="vehicle-type" data-tooltip="Target breakdown by vehicle type (Cars vs Bikes) with city-level comparison across Jan and Feb." style="padding: 12px 26px; border: 3px solid #e5e7eb; border-radius: 12px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        🚗 Vehicle Type Breakdown
    </button>
</div>

<!-- Summary View -->
<div id="psSummaryView" style="display: block;">

    <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 14px;">
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Period:</span>
            <button class="ps-summary-period-btn active" data-period="total" style="padding: 6px 12px; border: 2px solid #0ea5e9; border-radius: 8px; background: #0ea5e9; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Total</button>
            <button class="ps-summary-period-btn" data-period="new1" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">New &lt;1M</button>
            <button class="ps-summary-period-btn" data-period="new3" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">New &lt;3M</button>
            <button class="ps-summary-period-btn" data-period="old3" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Old &gt;3M</button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Performance:</span>
            <button class="ps-summary-perf-btn" data-perf="all" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">All</button>
            <button class="ps-summary-perf-btn" data-perf="good" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Good</button>
            <button class="ps-summary-perf-btn" data-perf="average" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Average</button>
            <button class="ps-summary-perf-btn" data-perf="bad" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Bad</button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Scale:</span>
            <button class="ps-summary-scale-btn" data-scale="all" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">All</button>
            <button class="ps-summary-scale-btn" data-scale="big" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Big</button>
            <button class="ps-summary-scale-btn" data-scale="mid" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Mid</button>
            <button class="ps-summary-scale-btn" data-scale="small" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Small</button>
        </div>
    </div>

    <div class="chart-container" style="margin-bottom: 18px; height: 320px;">
        <h4 id="psAvgScaleTitle" style="text-align: center; color: #1f4e78; font-size: 16px; margin: 0 0 10px 0;">Avg Scale Overview (Total Partners)</h4>
        <canvas id="psAvgScaleChart"></canvas>
    </div>

    <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 10px 0 12px 0;">
        <button class="ps-summary-view-btn tooltip-btn tooltip-btn-sky active" data-view="both" data-tooltip="Shows both riders breakdown and avg scale together for a full comparison (Jan vs Feb)." style="padding: 6px 14px; border: 2px solid #0ea5e9; border-radius: 8px; background: #0ea5e9; color: white; font-weight: 700; cursor: pointer; font-size: 12px;">Riders breakdown & Avg Scale</button>
        <button class="ps-summary-view-btn tooltip-btn tooltip-btn-sky" data-view="riders" data-tooltip="Focuses only on riders breakdown by category for Jan vs Feb." style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px;">Riders breakdown</button>
        <button class="ps-summary-view-btn tooltip-btn tooltip-btn-sky" data-view="avgscale" data-tooltip="Focuses only on avg scale (partners with target) for Jan vs Feb." style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px;">Avg Scale</button>
    </div>

    <div id="psRidersView" class="chart-container" style="margin-bottom: 18px; display: none; height: 320px;">
        <h4 id="psRidersBreakdownTitle" style="text-align: center; color: #1f4e78; font-size: 16px; margin: 0 0 10px 0;">Riders Breakdown Overview (Total Partners)</h4>
        <canvas id="psRidersBreakdownChart"></canvas>
    </div>

    <div id="psAvgScaleView" class="chart-container" style="margin-bottom: 18px; display: none; height: 320px;">
        <h4 id="psAvgScaleOverallTitle" style="text-align: center; color: #1f4e78; font-size: 16px; margin: 0 0 10px 0;">Avg Scale Overview (Partners with Target)</h4>
        <canvas id="psAvgScaleOverallChart"></canvas>
    </div>

    <div id="psBothView" style="display: block; margin-bottom: 18px;">
        <div style="display: flex; flex-wrap: wrap; gap: 18px; justify-content: center;">
            <div class="chart-container" style="flex: 1; min-width: 320px; height: 280px;">
                <h4 style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 10px 0;">Riders breakdown (Jan vs Feb)</h4>
                <canvas id="psCombinedRidersChart"></canvas>
            </div>
            <div class="chart-container" style="flex: 1; min-width: 320px; height: 280px;">
                <h4 style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 10px 0;">Avg Scale (Partners with Target)</h4>
                <canvas id="psCombinedAvgScaleChart"></canvas>
            </div>
        </div>
    </div>

    <button onclick="toggleTable(this, 'psSummaryTable')" style="width: 100%; padding: 10px 16px; background: #0ea5e9; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view detailed data ▼</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="psSummaryTable" style="display: none; margin-top: 12px;">
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #0ea5e9; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Metric</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                    </tr>
                </thead>
                <tbody id="psSummaryTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Breakdown View -->
<div id="psBreakdownView" style="display: none;">
    
    <h4 id="psBreakdownTitle" style="text-align: center; color: #1f4e78; font-size: 16px; margin: 0 0 15px 0;">📊 Breakdown Overview (Total Partners)</h4>
    
    <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 16px;">
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Period:</span>
            <button class="ps-period-btn active" data-period="total" style="padding: 6px 12px; border: 2px solid #3b82f6; border-radius: 8px; background: #3b82f6; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Total</button>
            <button class="ps-period-btn" data-period="new1" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">New &lt;1M</button>
            <button class="ps-period-btn" data-period="new3" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">New &lt;3M</button>
            <button class="ps-period-btn" data-period="old3" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Old &gt;3M</button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Performance:</span>
            <button class="ps-perf-btn" data-perf="all" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">All</button>
            <button class="ps-perf-btn" data-perf="good" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Good</button>
            <button class="ps-perf-btn" data-perf="average" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Average</button>
            <button class="ps-perf-btn" data-perf="bad" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Bad</button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Scale:</span>
            <button class="ps-scale-btn" data-scale="all" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">All</button>
            <button class="ps-scale-btn" data-scale="big" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Big</button>
            <button class="ps-scale-btn" data-scale="mid" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Mid</button>
            <button class="ps-scale-btn" data-scale="small" style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Small</button>
        </div>
    </div>

    <!-- KPI Cards with Mini Charts Grid -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 18px;">
        <!-- Total Partners Card -->
        <div class="chart-container" style="padding: 15px; border-radius: 12px; border-left: 4px solid #3b82f6;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                <div>
                    <div id="psKpiTotalPartnersLabel" style="font-size: 12px; color: #64748b; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <span>👥 Total Active Partners</span>
                        <span class="kpi-tooltip-wrapper" style="display: inline-flex; align-items: center;">
                            <span style="width: 18px; height: 18px; border-radius: 6px; background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; line-height: 1;">i</span>
                            <div class="kpi-tooltip">
                                <div class="tooltip-title">👥 Total Active Partners</div>
                                <div>Partners with delivery riders active in the <span class="tooltip-highlight">last 7 days</span> of the month.</div>
                            </div>
                        </span>
                    </div>
                    <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 4px;">
                        <span id="psKpiTotalPartnersDec" style="font-size: 20px; font-weight: 700; color: #3b82f6;">851</span>
                        <span style="font-size: 11px; color: #94a3b8;">Jan</span>
                        <span style="font-size: 16px; color: #64748b;">→</span>
                        <span id="psKpiTotalPartnersJan" style="font-size: 20px; font-weight: 700; color: #10b981;">687</span>
                        <span style="font-size: 11px; color: #94a3b8;">Feb</span>
                    </div>
                    <div id="psKpiTotalPartnersMom" style="font-size: 12px; font-weight: 700; color: #dc2626; margin-top: 2px;">-19.3% MoM</div>
                </div>
            </div>
            <div style="height: 100px;">
                <canvas id="psBreakdownChart1"></canvas>
            </div>
        </div>

        <!-- Partners with Target Card -->
        <div class="chart-container" style="padding: 15px; border-radius: 12px; border-left: 4px solid #8b5cf6;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                <div>
                    <div id="psKpiActivePartnersLabel" style="font-size: 12px; color: #64748b; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <span>🎯 Total Partners With Target</span>
                        <span class="kpi-tooltip-wrapper" style="display: inline-flex; align-items: center;">
                            <span style="width: 18px; height: 18px; border-radius: 6px; background: #f5f3ff; border: 1px solid #ddd6fe; color: #5b21b6; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; line-height: 1;">i</span>
                            <div class="kpi-tooltip">
                                <div class="tooltip-title">🎯 Total Partners With Target</div>
                                <div>Partners that were <span class="tooltip-highlight">assigned a capacity target</span> for the month.</div>
                            </div>
                        </span>
                    </div>
                    <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 4px;">
                        <span id="psKpiActivePartnersDec" style="font-size: 20px; font-weight: 700; color: #8b5cf6;">674</span>
                        <span style="font-size: 11px; color: #94a3b8;">Jan</span>
                        <span style="font-size: 16px; color: #64748b;">→</span>
                        <span id="psKpiActivePartnersJan" style="font-size: 20px; font-weight: 700; color: #10b981;">625</span>
                        <span style="font-size: 11px; color: #94a3b8;">Feb</span>
                    </div>
                    <div id="psKpiActivePartnersMom" style="font-size: 12px; font-weight: 700; color: #dc2626; margin-top: 2px;">-7.3% MoM</div>
                </div>
            </div>
            <div style="height: 100px;">
                <canvas id="psBreakdownChart2"></canvas>
            </div>
        </div>

        <!-- Target Total Card -->
        <div class="chart-container" style="padding: 15px; border-radius: 12px; border-left: 4px solid #f59e0b;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                <div>
                    <div style="font-size: 12px; color: #64748b; font-weight: 600;">🎯 Capacity Target Total</div>
                    <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 4px;">
                        <span id="psKpiTargetDec" style="font-size: 20px; font-weight: 700; color: #f59e0b;">24,182</span>
                        <span style="font-size: 11px; color: #94a3b8;">Jan</span>
                        <span style="font-size: 16px; color: #64748b;">→</span>
                        <span id="psKpiTargetJan" style="font-size: 20px; font-weight: 700; color: #10b981;">22,453</span>
                        <span style="font-size: 11px; color: #94a3b8;">Feb</span>
                    </div>
                    <div id="psKpiTargetMom" style="font-size: 12px; font-weight: 700; color: #dc2626; margin-top: 2px;">-7.1% MoM</div>
                </div>
            </div>
            <div style="height: 100px;">
                <canvas id="psBreakdownChart3"></canvas>
            </div>
        </div>

        <!-- Avg Scale Card -->
        <div class="chart-container" style="padding: 15px; border-radius: 12px; border-left: 4px solid #10b981;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                <div>
                    <div style="font-size: 12px; color: #64748b; font-weight: 600;">📈 Average Scale</div>
                    <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 4px;">
                        <span id="psKpiAvgScaleDec" style="font-size: 20px; font-weight: 700; color: #10b981;">35.9</span>
                        <span style="font-size: 11px; color: #94a3b8;">Jan</span>
                        <span style="font-size: 16px; color: #64748b;">→</span>
                        <span id="psKpiAvgScaleJan" style="font-size: 20px; font-weight: 700; color: #10b981;">35.9</span>
                        <span style="font-size: 11px; color: #94a3b8;">Feb</span>
                    </div>
                    <div id="psKpiAvgScaleMom" style="font-size: 12px; font-weight: 700; color: #f59e0b; margin-top: 2px;">0.0% MoM</div>
                </div>
            </div>
            <div style="height: 100px;">
                <canvas id="psBreakdownChart4"></canvas>
            </div>
        </div>
    </div>

    <button onclick="toggleTable(this, 'psBreakdownTable')" style="width: 100%; padding: 10px 16px; background: #64748b; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view detailed data ▼</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="psBreakdownTable" style="display: none; margin-top: 12px;">
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #64748b; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Metric</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                    </tr>
                </thead>
                <tbody id="psBreakdownTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Performance Target Breakdown View -->
<div id="psTargetBreakdownView" style="display: none;">
    
    <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 16px;">
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">View:</span>
            <button class="ps-target-view-btn active" data-view="partners" style="padding: 6px 14px; border: 2px solid #f59e0b; border-radius: 8px; background: #f59e0b; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Partner Count</button>
            <button class="ps-target-view-btn" data-view="target" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Target Value</button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">Partner Type:</span>
            <button class="ps-target-type-btn active" data-type="all" style="padding: 6px 14px; border: 2px solid #f59e0b; border-radius: 8px; background: #f59e0b; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">All Partners</button>
            <button class="ps-target-type-btn" data-type="new" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">New (<3M)</button>
            <button class="ps-target-type-btn" data-type="old" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Old (≥3M)</button>
            <button class="ps-target-type-btn" data-type="compare" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">New vs Old</button>
        </div>
    </div>

    <div class="chart-container" style="margin-bottom: 18px; height: 320px;">
        <h4 id="psTargetBreakdownTitle" style="text-align: center; color: #1f4e78; font-size: 16px; margin: 0 0 10px 0;">Performance Target Breakdown - Partner Count (All Partners)</h4>
        <canvas id="psTargetBreakdownChart"></canvas>
    </div>

    <button onclick="toggleTable(this, 'psTargetBreakdownTable')" style="width: 100%; padding: 10px 16px; background: #f59e0b; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view detailed data ▼</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="psTargetBreakdownTable" style="display: none; margin-top: 12px;">
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f59e0b; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Performance Level</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">New Partners</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Old Partners</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 10px; border: 1px solid #d1d5db; font-weight: 600; color: #10b981;">Good Partners</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">41</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">211</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">252</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #d1d5db; font-weight: 600; color: #f59e0b;">Average Partners</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">57</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">205</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">262</td>
                    </tr>
                    <tr style="background: #fef2f2;">
                        <td style="padding: 10px; border: 1px solid #d1d5db; font-weight: 600; color: #ef4444;">Bad Partners</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">12</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">8</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">20</td>
                    </tr>
                    <tr style="background: #e0f2fe; font-weight: bold;">
                        <td style="padding: 10px; border: 1px solid #d1d5db;">Total</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">110</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">424</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">534</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 10px; border: 1px solid #d1d5db; font-weight: 600; color: #10b981;">Good Partners Target</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">1,100</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">9,092</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">10,192</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #d1d5db; font-weight: 600; color: #f59e0b;">Average Partners Target</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">1,260</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">7,154</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">8,414</td>
                    </tr>
                    <tr style="background: #fef2f2;">
                        <td style="padding: 10px; border: 1px solid #d1d5db; font-weight: 600; color: #ef4444;">Bad Partners Target</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">213</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">157</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">370</td>
                    </tr>
                    <tr style="background: #e0f2fe; font-weight: bold;">
                        <td style="padding: 10px; border: 1px solid #d1d5db;">Total Target</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">2,573</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">16,403</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db; font-weight: 600;">18,976</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vehicle Type Breakdown View -->
<div id="psVehicleTypeView" style="display: none;">
    
    <!-- Donut Meters Section -->
    <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 24px;">
        <!-- Dec Donut -->
        <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 16px; padding: 20px 30px; min-width: 280px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <h4 style="margin: 0 0 12px 0; color: #0c4a6e; font-size: 15px;">📅 January 2026</h4>
            <div style="position: relative; width: 160px; height: 160px; margin: 0 auto;">
                <canvas id="vehicleDonutDec"></canvas>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                    <div style="font-size: 22px; font-weight: 700; color: #1e40af;" id="vehicleDonutDecTotal">22,453</div>
                    <div style="font-size: 11px; color: #64748b;">Total Target</div>
                </div>
            </div>
            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 12px;">
                <div style="text-align: center;">
                    <div style="font-size: 18px; font-weight: 700; color: #3b82f6;" id="vehicleDecCars">17,446</div>
                    <div style="font-size: 11px; color: #6b7280;">🚗 Cars (<span id="vehicleDecCarsPct">77.7%</span>)</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 18px; font-weight: 700; color: #10b981;" id="vehicleDecBikes">5,007</div>
                    <div style="font-size: 11px; color: #6b7280;">🏍️ Bikes (<span id="vehicleDecBikesPct">22.3%</span>)</div>
                </div>
            </div>
        </div>
        
        <!-- Jan Donut -->
        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 16px; padding: 20px 30px; min-width: 280px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <h4 style="margin: 0 0 12px 0; color: #166534; font-size: 15px;">📅 February 2026</h4>
            <div style="position: relative; width: 160px; height: 160px; margin: 0 auto;">
                <canvas id="vehicleDonutJan"></canvas>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                    <div style="font-size: 22px; font-weight: 700; color: #166534;" id="vehicleDonutJanTotal">19,365</div>
                    <div style="font-size: 11px; color: #64748b;">Total Target</div>
                </div>
            </div>
            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 12px;">
                <div style="text-align: center;">
                    <div style="font-size: 18px; font-weight: 700; color: #3b82f6;" id="vehicleJanCars">14,443</div>
                    <div style="font-size: 11px; color: #6b7280;">🚗 Cars (<span id="vehicleJanCarsPct">74.6%</span>)</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 18px; font-weight: 700; color: #10b981;" id="vehicleJanBikes">4,922</div>
                    <div style="font-size: 11px; color: #6b7280;">🏍️ Bikes (<span id="vehicleJanBikesPct">25.4%</span>)</div>
                </div>
            </div>
        </div>
        
        <!-- Change Summary Card -->
        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 16px; padding: 20px 30px; min-width: 220px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <h4 style="margin: 0 0 16px 0; color: #92400e; font-size: 15px;">📊 MoM Change</h4>
            <div style="margin-bottom: 16px;">
                <div style="font-size: 24px; font-weight: 700; color: #dc2626;" id="vehicleTotalChange">-3,088</div>
                <div style="font-size: 12px; color: #78350f;">Total Target (<span id="vehicleTotalChangePct">-13.8%</span>)</div>
            </div>
            <div style="display: flex; justify-content: center; gap: 16px;">
                <div style="text-align: center;">
                    <div style="font-size: 16px; font-weight: 700; color: #dc2626;" id="vehicleCarsChange">-3,003</div>
                    <div style="font-size: 10px; color: #78350f;">🚗 Cars (<span id="vehicleCarsChangePct">-17.2%</span>)</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 16px; font-weight: 700; color: #dc2626;" id="vehicleBikesChange">-85</div>
                    <div style="font-size: 10px; color: #78350f;">🏍️ Bikes (<span id="vehicleBikesChangePct">-1.7%</span>)</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- City Filter Slicers -->
    <div style="margin-bottom: 16px;">
        <!-- City Level Filter -->
        <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center; margin-bottom: 12px;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">🏙️ City Level:</span>
            <button class="vehicle-city-level-btn active" data-level="all" style="padding: 6px 14px; border: 2px solid #10b981; border-radius: 8px; background: #10b981; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">All Cities</button>
            <button class="vehicle-city-level-btn" data-level="t1" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">T1 Cities</button>
            <button class="vehicle-city-level-btn" data-level="t2" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">T2 Cities</button>
            <button class="vehicle-city-level-btn" data-level="t1vst2" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">T1 vs T2</button>
        </div>
        <!-- Individual City Filter -->
        <div style="display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; align-items: center; margin-bottom: 12px;">
            <span style="font-weight: 600; color: #374151; font-size: 12px;">📍 City:</span>
            <button class="vehicle-city-btn" data-city="Riyadh" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Riyadh</button>
            <button class="vehicle-city-btn" data-city="Jeddah" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Jeddah</button>
            <button class="vehicle-city-btn" data-city="Dammam" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Dammam</button>
            <button class="vehicle-city-btn" data-city="Madinah" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Madinah</button>
            <button class="vehicle-city-btn" data-city="Makkah" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Makkah</button>
            <button class="vehicle-city-btn" data-city="Al Ahsa" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Al Ahsa</button>
            <button class="vehicle-city-btn" data-city="Al Kharj" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Al Kharj</button>
            <button class="vehicle-city-btn" data-city="Abha" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Abha</button>
            <button class="vehicle-city-btn" data-city="Taif" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Taif</button>
            <button class="vehicle-city-btn" data-city="Buraydah" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Buraydah</button>
            <button class="vehicle-city-btn" data-city="Jubail" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Jubail</button>
            <button class="vehicle-city-btn" data-city="Tabuk" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Tabuk</button>
            <button class="vehicle-city-btn" data-city="Hail" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Hail</button>
            <button class="vehicle-city-btn" data-city="Yanbu" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Yanbu</button>
            <button class="vehicle-city-btn" data-city="Hafar Al Batin" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Hafar Al Batin</button>
            <button class="vehicle-city-btn" data-city="Jazan" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Jazan</button>
            <button class="vehicle-city-btn" data-city="Najran" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Najran</button>
        </div>
        <!-- View Toggle -->
        <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center;">
            <span style="font-weight: 600; color: #374151; font-size: 13px;">📊 View:</span>
            <button class="vehicle-view-btn active" data-view="comparison" style="padding: 6px 14px; border: 2px solid #10b981; border-radius: 8px; background: #10b981; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Jan vs Feb</button>
            <button class="vehicle-view-btn" data-view="trend" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Trend Line</button>
        </div>
    </div>

    <!-- Chart Container -->
    <div class="chart-container" style="margin-bottom: 18px; height: 340px;">
        <h4 id="vehicleChartTitle" style="text-align: center; color: #1f4e78; font-size: 16px; margin: 0 0 10px 0;">Vehicle Type Target Comparison - All Cities</h4>
        <canvas id="vehicleTypeChart"></canvas>
    </div>
    
    <!-- T1 vs T2 Dual Chart Container (hidden by default) -->
    <div id="vehicleT1vsT2Container" style="display: none; gap: 20px; margin-bottom: 18px;">
        <div class="chart-container" style="flex: 1; min-width: 300px; height: 300px;">
            <h4 style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 10px 0;">🏙️ T1 Cities (Major)</h4>
            <canvas id="vehicleT1Chart"></canvas>
        </div>
        <div class="chart-container" style="flex: 1; min-width: 300px; height: 300px;">
            <h4 style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 10px 0;">🌆 T2 Cities (Emerging)</h4>
            <canvas id="vehicleT2Chart"></canvas>
        </div>
    </div>

    <!-- City Level Table -->
    <button onclick="toggleTable(this, 'vehicleCityTable')" style="width: 100%; padding: 10px 16px; background: #10b981; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view city-level detailed data ▼</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="vehicleCityTable" style="display: none; margin-top: 12px;">
        <div class="table-container" style="max-height: 400px; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="position: sticky; top: 0;">
                    <tr style="background: #10b981; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;" rowspan="2">City</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;" colspan="2">January 2026</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;" colspan="2">February 2026</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;" colspan="2">Change</th>
                    </tr>
                    <tr style="background: #059669; color: white;">
                        <th style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">🚗 Cars</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">🏍️ Bikes</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">🚗 Cars</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">🏍️ Bikes</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">🚗 Cars</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">🏍️ Bikes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Riyadh</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">8,103</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">1,925</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">6,704</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">1,957</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-1,399</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #10b981;">+32</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Jeddah</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">2,469</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">1,625</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">1,900</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">1,554</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-569</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-71</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Dammam</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">2,205</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">436</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">1,770</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">357</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-435</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-79</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Madinah</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">929</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">266</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">841</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">290</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-88</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #10b981;">+24</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Makkah</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">738</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">336</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">540</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">395</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-198</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #10b981;">+59</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Al Ahsa</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">712</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">146</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">695</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">123</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-17</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-23</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Al Kharj</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">380</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">347</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-33</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Abha</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">316</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">23</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">279</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">18</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-37</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-5</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Taif</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">277</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">68</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">205</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">87</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-72</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #10b981;">+19</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Buraydah</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">232</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">64</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">218</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">35</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-14</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-29</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Jubail</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">224</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">20</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">210</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">20</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-14</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #6b7280;">0</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Tabuk</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">242</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">10</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">186</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">16</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-56</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #10b981;">+6</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Hail</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">199</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">186</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-13</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Yanbu</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">154</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">55</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">128</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">43</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-26</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-12</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Hafar Al Batin</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">103</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">25</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">97</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">12</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-6</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-13</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Jazan</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">85</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">10</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">64</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">10</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #dc2626;">-21</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #6b7280;">0</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td style="padding: 8px; border: 1px solid #d1d5db; font-weight: 600;">Najran</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">76</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">78</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db; color: #10b981;">+2</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">-</td>
                    </tr>
                    <tr style="background: #10b981; color: white; font-weight: bold;">
                        <td style="padding: 10px; border: 1px solid #d1d5db;">Grand Total</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">17,446</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">5,007</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">14,446</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">4,919</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">-3,000</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">-88</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>

<!-- FR & DRIVER CARD COMBINED ANALYSIS SECTION -->
<div style="margin-top: 20px; margin-bottom: 20px;">
<h3 id="monthOverviewFrDc" style="color: #1f4e78; margin-bottom: 10px; font-size: 18px; border-bottom: 2px solid #3b82f6; padding-bottom: 8px;">
    📊 FR & Driver Card Compliance Analysis
</h3>

<!-- Overview Info Box -->
<div class="info-box" style="background: #f0fdf4; border-left: 4px solid #059669; margin-bottom: 12px; padding: 8px 12px;">
    <p style="margin: 0; font-size: 12px; color: #065f46;">
        <strong>📋 Overview:</strong> Analyze partner distribution by Face Recognition (FR) and Driver Card compliance rates across all segments. <span style="color: #6b7280; font-style: italic;">(Data updated till 25th Feb 2026)</span>
    </p>
</div>

<!-- Analysis Type Toggle Buttons (Compliance vs Target Range) -->
<div style="display: flex; justify-content: center; gap: 12px; margin: 12px 0; padding: 0;">
    <button class="analysis-type-toggle tooltip-btn tooltip-btn-green active" data-type="compliance" data-tooltip="Partner counts by compliance range for FR/Driver Card." style="padding: 8px 24px; border: 2px solid #059669; border-radius: 10px; background: #059669; color: white; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 3px 8px rgba(5, 150, 105, 0.3);">
        <span style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 15px;">📈</span>
            <span>Compliance Distribution</span>
        </span>
    </button>
    <button class="analysis-type-toggle tooltip-btn tooltip-btn-green" data-type="target-range" data-tooltip="Target changes across compliance ranges (Jan → Feb) for FR/Driver Card." style="padding: 8px 24px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <span style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 15px;">📊</span>
            <span>Target Range Impact</span>
        </span>
    </button>
    <button class="analysis-type-toggle tooltip-btn tooltip-btn-green" data-type="city-wise" data-tooltip="City averages and range distributions with risk highlights." style="padding: 8px 24px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <span style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 15px;">🏙️</span>
            <span>City-wise Analysis</span>
        </span>
    </button>
</div>

<!-- COMPLIANCE ANALYSIS VIEW (Pie Charts) -->
<div id="complianceAnalysisView" style="display: block;">

<!-- Compliance Metric Toggle Buttons with Donut Meters -->
<div style="display: flex; justify-content: center; align-items: center; gap: 14px; margin: 12px 0; padding: 0; flex-wrap: wrap;">
    <!-- FR Donut Meter -->
    <div id="frAvgCard" class="donut-meter-container fr-theme">
        <div class="donut-meter-info">
            <div class="donut-meter-title">
                <span>📸 AVG FR RATE</span>
                <span class="kpi-badge">KPI</span>
            </div>
            <div id="frAvgSubtitle" class="donut-meter-subtitle">All / With Target</div>
        </div>
        <div class="donut-dual-wrapper">
            <div class="donut-single">
                <div class="donut-meter" id="frDonutAll">
                    <svg viewBox="0 0 36 36">
                        <defs>
                            <linearGradient id="frGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6"/>
                                <stop offset="100%" style="stop-color:#1d4ed8"/>
                            </linearGradient>
                        </defs>
                        <circle class="donut-bg" cx="18" cy="18" r="14"/>
                        <circle class="donut-progress fr-stroke" cx="18" cy="18" r="14" stroke-dasharray="87.96" stroke-dashoffset="24.7"/>
                    </svg>
                    <div class="donut-center">
                        <div class="donut-value" id="frDonutAllValue">71.9%</div>
                        <div class="donut-label">All</div>
                    </div>
                </div>
            </div>
            <div class="donut-single">
                <div class="donut-meter" id="frDonutTarget">
                    <svg viewBox="0 0 36 36">
                        <circle class="donut-bg" cx="18" cy="18" r="14"/>
                        <circle class="donut-progress fr-stroke" cx="18" cy="18" r="14" stroke-dasharray="87.96" stroke-dashoffset="23.0"/>
                    </svg>
                    <div class="donut-center">
                        <div class="donut-value" id="frDonutTargetValue">73.8%</div>
                        <div class="donut-label">Target</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <button class="metric-toggle-btn active" data-metric="fr" style="padding: 8px 24px; border: 2px solid #3b82f6; border-radius: 10px; background: #3b82f6; color: white; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 3px 8px rgba(59, 130, 246, 0.3); position: relative; overflow: hidden;">
        <span style="position: relative; z-index: 1; display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 15px;">📸</span>
            <span>FR Rate Distribution</span>
        </span>
    </button>
    <button class="metric-toggle-btn" data-metric="dc" style="padding: 8px 24px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; overflow: hidden;">
        <span style="position: relative; z-index: 1; display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 15px;">🪪</span>
            <span>Driver Card Rate Distribution</span>
        </span>
    </button>
    
    <!-- DC Donut Meter -->
    <div id="dcAvgCard" class="donut-meter-container dc-theme" style="opacity: 0.6;">
        <div class="donut-dual-wrapper">
            <div class="donut-single">
                <div class="donut-meter" id="dcDonutAll">
                    <svg viewBox="0 0 36 36">
                        <defs>
                            <linearGradient id="dcGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981"/>
                                <stop offset="100%" style="stop-color:#059669"/>
                            </linearGradient>
                        </defs>
                        <circle class="donut-bg" cx="18" cy="18" r="14"/>
                        <circle class="donut-progress dc-stroke" cx="18" cy="18" r="14" stroke-dasharray="87.96" stroke-dashoffset="64.3"/>
                    </svg>
                    <div class="donut-center">
                        <div class="donut-value" id="dcDonutAllValue">26.9%</div>
                        <div class="donut-label">All</div>
                    </div>
                </div>
            </div>
            <div class="donut-single">
                <div class="donut-meter" id="dcDonutTarget">
                    <svg viewBox="0 0 36 36">
                        <circle class="donut-bg" cx="18" cy="18" r="14"/>
                        <circle class="donut-progress dc-stroke" cx="18" cy="18" r="14" stroke-dasharray="87.96" stroke-dashoffset="62.7"/>
                    </svg>
                    <div class="donut-center">
                        <div class="donut-value" id="dcDonutTargetValue">28.7%</div>
                        <div class="donut-label">Target</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="donut-meter-info">
            <div class="donut-meter-title">
                <span>🪪 AVG DC RATE</span>
                <span class="kpi-badge">KPI</span>
            </div>
            <div id="dcAvgSubtitle" class="donut-meter-subtitle">All / With Target</div>
        </div>
    </div>
</div>

<!-- Compliance Dynamic Title -->
<h4 id="metricTitle" style="text-align: center; color: #1f4e78; font-size: 15px; margin: 10px 0 8px 0; font-weight: 600;">Face Recognition (FR) Rate - All Partners vs Partners with Target</h4>

<!-- Compliance Filters - Side by Side -->
<div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; align-items: flex-start; margin: 8px 0 10px 0;">
    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap;">
        <span style="font-weight: 600; color: #374151; min-width: 90px;">Comparison:</span>
        <button class="fr-filter-btn active" data-filter="comparison" style="padding: 5px 10px; border: 2px solid #3b82f6; border-radius: 6px; background: #3b82f6; color: white; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">All vs With Target</button>
    </div>
    <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap;">
        <span style="font-weight: 600; color: #374151; min-width: 90px;">All Partners:</span>
        <button class="fr-filter-btn" data-filter="all" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">All (643)</button>
        <button class="fr-filter-btn" data-filter="new" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">New (158)</button>
        <button class="fr-filter-btn" data-filter="old" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Old (485)</button>
        <button class="fr-filter-btn" data-filter="both" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">New vs Old</button>
    </div>
    <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap;">
        <span style="font-weight: 600; color: #374151; min-width: 90px;">With Target:</span>
        <button class="fr-filter-btn" data-filter="all-target" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">All (551)</button>
        <button class="fr-filter-btn" data-filter="new-target" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">New (127)</button>
        <button class="fr-filter-btn" data-filter="old-target" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Old (424)</button>
        <button class="fr-filter-btn" data-filter="both-target" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">New vs Old</button>
    </div>
    <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap;">
        <span style="font-weight: 600; color: #374151; min-width: 90px;">Performance:</span>
        <button class="fr-perf-filter-btn" data-perf="all" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">All (534)</button>
        <button class="fr-perf-filter-btn" data-perf="good" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Good (252)</button>
        <button class="fr-perf-filter-btn" data-perf="average" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Average (262)</button>
        <button class="fr-perf-filter-btn" data-perf="bad" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Bad (20)</button>
    </div>
</div>

<!-- Compliance Charts Wrapper -->
<div id="complianceChartsWrapper" class="compliance-charts-frame" style="max-width: 1200px; margin: 0 auto;">
<!-- Single Chart View (All, New, Old, All Target, New Target, Old Target) -->
<div id="frChartSingle" style="display: block; margin: 0 auto; max-width: 900px;">
    <canvas id="frChart" style="max-height: 520px;"></canvas>
</div>
<!-- Dual Chart View (New vs Old) -->
<div id="frChartDual" style="display: none; gap: 12px; margin-top: 8px; max-width: 1200px; margin-left: auto; margin-right: auto;">
    <div style="flex: 1; background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px;">
        <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #111827; text-align: center;">New Partners (158)</h4>
        <canvas id="frChartNew"></canvas>
    </div>
    <div style="flex: 1; background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px;">
        <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #111827; text-align: center;">Old Partners (485)</h4>
        <canvas id="frChartOld"></canvas>
    </div>
</div>
<!-- Dual Chart View (New vs Old - With Target) -->
<div id="frChartDualTarget" style="display: none; gap: 12px; margin-top: 8px; max-width: 1200px; margin-left: auto; margin-right: auto;">
    <div style="flex: 1; background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px;">
        <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #111827; text-align: center;">New Partners with Target (127)</h4>
        <canvas id="frChartNewTarget"></canvas>
    </div>
    <div style="flex: 1; background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px;">
        <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #111827; text-align: center;">Old Partners with Target (424)</h4>
        <canvas id="frChartOldTarget"></canvas>
    </div>
</div>
<!-- Dual Chart View (All vs With Target) -->
<div id="frChartComparison" style="display: none; gap: 12px; margin-top: 8px; max-width: 1200px; margin-left: auto; margin-right: auto;">
    <div style="flex: 1; background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px;">
        <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #111827; text-align: center;">All Partners (643)</h4>
        <canvas id="frChartTotal"></canvas>
    </div>
    <div style="flex: 1; background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px;">
        <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #111827; text-align: center;">Partners with Target (551)</h4>
        <canvas id="frChartTargetActive"></canvas>
    </div>
</div>
<!-- End Compliance Charts Wrapper -->
</div>
</div>

<!-- TARGET RANGE IMPACT VIEW (Bar/Trend Charts) -->
<div id="targetRangeView" style="display: none;">
<div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; margin-bottom: 12px; padding: 8px 12px;">
    <p style="margin: 0; font-size: 12px; color: #1e40af;">
        <strong>Overview:</strong> Shows how FR/Driver Card compliance ranges shift partner targets from Jan 2026 to Feb 2026, split by new (&lt;3 months) and old (≥3 months) partners.
    </p>
</div>

<!-- Target Range Metric Toggle Buttons + KPI Cards -->
<div style="display: flex; align-items: stretch; justify-content: space-between; gap: 12px; margin: 12px 0; padding: 0; flex-wrap: wrap;">
    <div id="impactPartnersCard" class="kpi-card-animated" style="flex: 1; min-width: 230px; background: linear-gradient(135deg, #eef2ff 0%, #f8fafc 100%); border: 1px solid #e5e7eb; border-radius: 14px; padding: 14px 16px; box-shadow: 0 8px 18px rgba(59, 130, 246, 0.12);">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 8px;">
            <div style="font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; color: #6366f1;">Partners Overview</div>
            <div style="font-size: 10px; font-weight: 700; color: #1f2937; background: rgba(99,102,241,0.12); padding: 3px 8px; border-radius: 999px;">KPI</div>
        </div>
        <div id="impactPartnersValue" style="margin-top: 6px; font-size: 20px; font-weight: 800; color: #1f2937;">--</div>
        <div id="impactPartnersSub" style="margin-top: 4px; font-size: 12px; color: #6b7280;">--</div>
        <div id="impactPartnersSplit" style="margin-top: 6px; font-size: 11px; color: #374151; font-weight: 600;">--</div>
    </div>
    <div style="display: flex; justify-content: center; gap: 14px; flex: 2; min-width: 360px; align-items: center;">
        <button class="impact-metric-toggle active" data-metric="fr" style="padding: 8px 24px; border: 2px solid #3b82f6; border-radius: 10px; background: #3b82f6; color: white; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 3px 8px rgba(59, 130, 246, 0.3);">
            <span style="display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 15px;">📸</span>
                <span>FR Range Impact</span>
            </span>
        </button>
        <button class="impact-metric-toggle" data-metric="dc" style="padding: 8px 24px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 13px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <span style="display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 15px;">🪪</span>
                <span>Driver Card Range Impact</span>
            </span>
        </button>
    </div>
    <div id="impactTargetsCard" class="kpi-card-animated" style="flex: 1; min-width: 230px; background: linear-gradient(135deg, #ecfeff 0%, #f8fafc 100%); border: 1px solid #e5e7eb; border-radius: 14px; padding: 14px 16px; box-shadow: 0 8px 18px rgba(14, 165, 233, 0.12);">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 8px;">
            <div style="font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; color: #0ea5e9;">Target Movement</div>
            <div style="font-size: 10px; font-weight: 700; color: #1f2937; background: rgba(14,165,233,0.12); padding: 3px 8px; border-radius: 999px;">KPI</div>
        </div>
        <div id="impactTargetsValue" style="margin-top: 6px; font-size: 18px; font-weight: 800; color: #1f2937;">--</div>
        <div id="impactTargetsSub" style="margin-top: 4px; font-size: 12px; color: #6b7280;">--</div>
        <div id="impactTargetsChange" style="margin-top: 6px; font-size: 11px; color: #374151; font-weight: 600;">--</div>
    </div>
</div>

<!-- Target Range Dynamic Title -->
<h4 id="impactTitle" style="text-align: center; color: #1f4e78; font-size: 15px; margin: 10px 0 8px 0; font-weight: 600;">Face Recognition (FR) All Partners Summary - Target Changes Across Ranges</h4>

<!-- Target Range Filter Buttons -->
<div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: flex-start; margin: 8px 0 10px 0;">
    <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap;">
        <span style="font-weight: 600; color: #374151; min-width: 50px;">View:</span>
        <button class="impact-filter-btn active" data-filter="all" style="padding: 5px 10px; border: 2px solid #3b82f6; border-radius: 6px; background: #3b82f6; color: white; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);">📊 All Partners (643)</button>
        <button class="impact-filter-btn" data-filter="withtarget" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">✅ With Target (551)</button>
        <button class="impact-filter-btn" data-filter="new" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">🆕 New Partners (158)</button>
        <button class="impact-filter-btn" data-filter="old" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">👥 Old Partners (485)</button>
        <button class="impact-filter-btn" data-filter="both" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">⚖️ New vs Old</button>
    </div>
    <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap;">
        <span style="font-weight: 600; color: #374151; min-width: 90px;">Performance:</span>
        <button class="impact-perf-filter-btn" data-perf="all" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">All (551)</button>
        <button class="impact-perf-filter-btn" data-perf="good" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Good (252)</button>
        <button class="impact-perf-filter-btn" data-perf="average" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Average (262)</button>
        <button class="impact-perf-filter-btn" data-perf="bad" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px; transition: all 0.2s;">Bad (20)</button>
    </div>
</div>

<!-- Single Chart View -->
<div id="impactChartSingle" style="display: block; margin-bottom: 12px;">
    <canvas id="impactChartSingleCanvas"></canvas>
</div>

<!-- Overall Chart View -->
<div id="impactChartOverall" style="display: none; margin-bottom: 12px;">
    <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
        <h4 style="color: #1f4e78; margin: 0 0 8px 0; font-size: 14px;">📈 All Partners Summary - Partners Count by Range</h4>
        <canvas id="impactChartOverallCanvas"></canvas>
    </div>
</div>

<!-- Partners with Target Chart View -->
<div id="impactChartWithTarget" style="display: none; margin-bottom: 12px;">
    <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
        <h4 style="color: #1f4e78; margin: 0 0 8px 0; font-size: 14px;">✓ Partners with Target Summary - Active Partners Count by Range</h4>
        <canvas id="impactChartWithTargetCanvas"></canvas>
    </div>
</div>

<!-- Dual Chart View (New vs Old) -->
<div id="impactChartDual" style="display: none; gap: 14px; margin-bottom: 12px; width: 100%; box-sizing: border-box; flex-direction: row; align-items: stretch;">
    <div style="flex: 1; min-width: 0;">
        <div class="chart-container" style="overflow: hidden; height: 100%;">
            <h4 style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 15px 0;">New Partners (<3 months)</h4>
            <canvas id="impactChartNewBar" style="display: block;"></canvas>
        </div>
    </div>
    <div style="flex: 1; min-width: 0;">
        <div class="chart-container" style="overflow: hidden; height: 100%;">
            <h4 style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 15px 0;">Old Partners (≥3 months)</h4>
            <canvas id="impactChartOldBar" style="display: block;"></canvas>
        </div>
    </div>
</div>

<!-- Detailed Tables (moved here) -->
<div id="impactDetailedTablesMount"></div>
</div>

<!-- CITY-WISE ANALYSIS VIEW -->
<div id="cityWiseView" style="display: none;">
    <div class="info-box" style="background: #f8fafc; border-left: 4px solid #8b5cf6; margin-bottom: 10px; padding: 8px 12px;">
        <p style="margin: 0; font-size: 12px; color: #4c1d95;">
            <strong>Overview:</strong> City-level FR/Driver Card performance with risk highlights. Bar colors reflect risk: <strong>High</strong> (red), <strong>Moderate</strong> (amber), <strong>Low</strong> (green). Rule: <strong>FR &lt; 85%</strong> = High risk, <strong>DC &lt; 30%</strong> = High risk; Moderate/Low are above these thresholds.
        </p>
    </div>

    <div style="display: flex; align-items: stretch; justify-content: space-between; gap: 10px; margin: 8px 0 10px 0; flex-wrap: wrap;">
        <div id="cityWiseAvgCard" class="kpi-card-animated" style="flex: 1; min-width: 180px; background: linear-gradient(135deg, #eef2ff, #f8fafc); border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);">
            <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; color: #6366f1;">Overall Average</div>
            <div id="cityWiseAvgCardValue" style="margin-top: 4px; font-size: 18px; font-weight: 800; color: #1f2937;">--</div>
            <div id="cityWiseAvgCardSub" style="margin-top: 2px; font-size: 11px; color: #6b7280;">Avg rate based on filter</div>
        </div>
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 6px; flex: 2; min-width: 360px;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-weight: 700; color: #374151; font-size: 12px;">Metric:</span>
                <button class="citywise-metric-btn active" data-metric="fr" style="padding: 6px 14px; min-width: 140px; border: 2px solid #3b82f6; border-radius: 8px; background: #3b82f6; color: white; font-weight: 700; cursor: pointer; font-size: 11px;">FR Rate & Target</button>
                <button class="citywise-metric-btn" data-metric="dc" style="padding: 6px 14px; min-width: 140px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 11px;">Driver Card Rate & Target</button>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; justify-content: center;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="font-weight: 600; color: #374151; font-size: 11px;">View:</span>
                    <button class="citywise-view-btn active" data-view="overview" style="padding: 5px 10px; border: 2px solid #8b5cf6; border-radius: 6px; background: #8b5cf6; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">Overall</button>
                    <button class="citywise-view-btn" data-view="range" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Range + Target</button>
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="font-weight: 600; color: #374151; font-size: 11px;">Tier:</span>
                    <button class="citywise-tier-btn active" data-tier="all" style="padding: 5px 10px; border: 2px solid #0ea5e9; border-radius: 6px; background: #0ea5e9; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">All</button>
                    <button class="citywise-tier-btn" data-tier="t1" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1 Cities</button>
                    <button class="citywise-tier-btn" data-tier="t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T2 Cities</button>
                    <button class="citywise-view-btn" data-view="t1t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1 vs T2</button>
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="font-weight: 600; color: #374151; font-size: 11px;">City:</span>
                    <select id="cityWiseCitySelect" style="padding: 4px 8px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #374151; font-weight: 600; font-size: 11px;"></select>
                </div>
            </div>
        </div>
        <div id="cityWiseRiskCard" class="kpi-card-animated" style="flex: 1; min-width: 180px; background: linear-gradient(135deg, #ecfeff, #f8fafc); border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);">
            <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; color: #0ea5e9;">Risk Count (Cities)</div>
            <div id="cityWiseRiskCardValue" style="margin-top: 4px; font-size: 16px; font-weight: 800; color: #1f2937;">High: -- | Low: --</div>
            <div id="cityWiseRiskCardSub" style="margin-top: 2px; font-size: 11px; color: #6b7280;">Based on current filter</div>
        </div>
    </div>

    <h4 id="cityWiseTitle" style="text-align: center; color: #1f4e78; font-size: 15px; margin: 10px 0 8px 0; font-weight: 600;">City-wise Compliance Overview (FR)</h4>

    <div id="cityWiseOverviewSection" class="chart-container" style="margin-bottom: 12px;">
        <canvas id="cityWiseOverviewChart"></canvas>
    </div>

    <div id="cityWiseTierOverviewSection" style="display: none; margin-bottom: 12px;">
        <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 id="cityWiseT1Title" style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T1 Cities</h4>
                <canvas id="cityWiseT1OverviewChart"></canvas>
            </div>
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 id="cityWiseT2Title" style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T2 Cities</h4>
                <canvas id="cityWiseT2OverviewChart"></canvas>
            </div>
        </div>
    </div>

    <div id="cityWiseRangeSection" style="display: none; margin-bottom: 12px;">
        <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 id="cityWiseRangeTitle" style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">Partners with Target by Range</h4>
                <canvas id="cityWiseRangeChart"></canvas>
            </div>
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 id="cityWiseTargetRangeTitle" style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">Target Range by City</h4>
                <canvas id="cityWiseTargetRangeChart"></canvas>
            </div>
        </div>
    </div>

    <button onclick="toggleTable(this, 'cityWiseDetailsTable')" style="width: 100%; padding: 10px 16px; background: #f97316; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view city details ▼</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="cityWiseDetailsTable" style="display: none; margin-top: 12px;">
        <div id="cityWiseOverallTable" class="table-container" style="margin-bottom: 16px;">
            <h4 id="cityWiseOverallTableTitle" style="margin: 0 0 8px 0; color: #1f4e78; font-size: 14px;">City Overall Compliance (All Cities)</h4>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f97316; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">City</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;"># of partners with target</th>
                        <th id="cityWiseOverallMetricHeader" style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Avg FR Rate %</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Risk</th>
                    </tr>
                </thead>
                <tbody id="cityWiseOverallTableBody"></tbody>
            </table>
        </div>
        <div id="cityWiseRangeTables" style="display: none;">
            <div class="table-container" style="margin-bottom: 16px;">
                <h4 id="cityWiseRangeTableTitle" style="margin: 0 0 8px 0; color: #1f4e78; font-size: 14px;">Partners with Target by Range (All Cities)</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f97316; color: white;">
                            <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">City</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">0-20%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">20-30%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">30-40%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">40-50%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">50-60%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">60-80%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">>80%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Total</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Risk</th>
                        </tr>
                    </thead>
                    <tbody id="cityWiseRangeTableBody"></tbody>
                </table>
            </div>
            <div class="table-container">
                <h4 id="cityWiseTargetRangeTableTitle" style="margin: 0 0 8px 0; color: #1f4e78; font-size: 14px;">Target Range by City (All Cities)</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f97316; color: white;">
                            <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">City</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">0-20%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">20-30%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">30-40%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">40-50%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">50-60%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">60-80%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">>80%</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Total</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Risk</th>
                        </tr>
                    </thead>
                    <tbody id="cityWiseTargetRangeTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- CITY TIER ANALYSIS SECTION -->
<div id="monthOverviewCityTier" style="margin-top: 20px; margin-bottom: 20px;">
<h3 style="color: #1f4e78; margin-bottom: 10px; font-size: 18px; border-bottom: 2px solid #0ea5e9; padding-bottom: 8px;">
    🏙️ City Tier Performance Analysis (Jan vs Feb)
</h3>

<!-- Summary Cards Section -->
<div id="cityTierSummaryCardsContainer" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px;">
    <div id="cityTierSummaryCard1" class="city-tier-summary-card tooltip-card" data-tooltip="City with the most partners with target in Feb. Tracks which city leads in partner capacity." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #0ea5e9, #06b6d4);"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); display: flex; align-items: center; justify-content: center; font-size: 16px;">🏆</div>
            <div>
                <div style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Highest City</div>
                <div id="summaryCard1Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">Riyadh</div>
                <div id="summaryCard1Sub" style="font-size: 11px; color: #6b7280;">200 partners (Feb)</div>
            </div>
        </div>
    </div>
    <div id="cityTierSummaryCard2" class="city-tier-summary-card tooltip-card" data-tooltip="City with the fewest partners with target in Feb. Highlights underrepresented areas." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); display: flex; align-items: center; justify-content: center; font-size: 16px;">📉</div>
            <div>
                <div style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Lowest City</div>
                <div id="summaryCard2Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">Jazan</div>
                <div id="summaryCard2Sub" style="font-size: 11px; color: #6b7280;">3 partners (Feb)</div>
            </div>
        </div>
    </div>
    <div id="cityTierSummaryCard3" class="city-tier-summary-card tooltip-card" data-tooltip="Total partners with an active target in Feb across all cities. MoM% shows month-over-month change." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #10b981, #34d399);"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); display: flex; align-items: center; justify-content: center; font-size: 16px;">📊</div>
            <div>
                <div style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total (Feb)</div>
                <div id="summaryCard3Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">551</div>
                <div id="summaryCard3Sub" style="font-size: 11px; color: #6b7280;">partners with target</div>
            </div>
        </div>
    </div>
    <div id="cityTierSummaryCard4" class="city-tier-summary-card tooltip-card" data-tooltip="City with the largest MoM% swing in partner count. Flags rapid growth or decline areas." style="background: white; border-radius: 12px; padding: 12px 14px; border: 1px solid #e5e7eb; box-shadow: 0 3px 12px rgba(0,0,0,0.06); position: relative; overflow: visible; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #8b5cf6, #a78bfa);"></div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); display: flex; align-items: center; justify-content: center; font-size: 16px;">📈</div>
            <div>
                <div style="font-size: 10px; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Biggest MoM Change</div>
                <div id="summaryCard4Value" style="font-size: 18px; font-weight: 800; color: #1f4e78;">Jazan</div>
                <div id="summaryCard4Sub" style="font-size: 11px; color: #6b7280;">-40.0% MoM</div>
            </div>
        </div>
    </div>
</div>

<style>
.city-tier-summary-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.12);
}
.city-tier-summary-card.preparing {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
}
@keyframes cardFlyIn {
    0% { opacity: 0; transform: translateY(30px) scale(0.9); }
    60% { opacity: 1; transform: translateY(-5px) scale(1.02); }
    80% { transform: translateY(3px) scale(0.99); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}
.city-tier-summary-card.fly-in {
    animation: cardFlyIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
/* PS Summary Cards */
@keyframes psCardSlideIn {
    0% { opacity: 0; transform: translateY(24px) scale(0.92); }
    50% { opacity: 0.8; transform: translateY(-4px) scale(1.02); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}
.ps-summary-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.12);
}
.ps-summary-card.ps-card-updating {
    opacity: 0;
    transform: translateY(16px) scale(0.94);
}
@keyframes psCardFlyIn {
    0% { opacity: 0; transform: translateY(24px) scale(0.9); }
    55% { opacity: 1; transform: translateY(-4px) scale(1.02); }
    80% { transform: translateY(2px) scale(0.99); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}
.ps-summary-card.ps-card-fly-in {
    animation: psCardFlyIn 0.45s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
.city-tier-summary-card .card-value-transition {
    transition: all 0.3s ease;
}
</style>

<div style="display: flex; justify-content: center; gap: 10px; margin: 8px 0 12px 0; flex-wrap: wrap;">
    <button class="city-tier-view-toggle tooltip-btn tooltip-btn-blue active" data-view="city" data-tooltip="City-level comparison of Jan vs Feb by selected metric." style="padding: 7px 14px; border: 2px solid #0ea5e9; border-radius: 8px; background: #0ea5e9; color: white; font-weight: 700; cursor: pointer; font-size: 12px;">City Level Summary</button>
    <button class="city-tier-view-toggle tooltip-btn tooltip-btn-blue" data-view="tier" data-tooltip="Tier breakdown showing Jan vs Feb by city tier." style="padding: 7px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px;">City Tier Breakdown</button>
    <button class="city-tier-view-toggle tooltip-btn tooltip-btn-blue" data-view="performance" data-tooltip="Distribution of partner performance across cities." style="padding: 7px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px;">Performance Distribution</button>
    <button class="city-tier-view-toggle tooltip-btn tooltip-btn-blue" data-view="scale" data-tooltip="Distribution of partner scale across cities." style="padding: 7px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px;">Scale Distribution</button>
</div>

<!-- City Level Summary View -->
<div id="cityTierCityView" style="display: block;">
    <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 10px;">
        <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151; font-size: 12px;">Metric:</span>
            <button class="city-tier-metric-btn active" data-metric="partners" style="padding: 5px 10px; border: 2px solid #0ea5e9; border-radius: 6px; background: #0ea5e9; color: white; font-weight: 600; cursor: pointer; font-size: 11px;"># of partners with target</button>
            <button class="city-tier-metric-btn" data-metric="target" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Total target</button>
            <button class="city-tier-metric-btn" data-metric="avg" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Avg scale</button>
        </div>
    </div>

    <div class="chart-container" style="margin-bottom: 12px;">
        <h4 id="cityTierCityTitle" style="text-align: center; color: #1f4e78; font-size: 14px; margin: 0 0 8px 0;">City Comparison (Jan vs Feb)</h4>
        <canvas id="cityTierCityChart"></canvas>
    </div>

    <div id="cityTierCityNote" class="info-box" style="background: #f0f9ff; border-left: 4px solid #0ea5e9; margin-bottom: 10px; padding: 8px 12px;">
        <p style="margin: 0; font-size: 12px; color: #0f4a6e;">
            <strong>Note:</strong> Use slicers to compare Jan vs Feb by city and tier, with MoM% changes highlighted.
        </p>
    </div>

    <button onclick="toggleTable(this, 'cityTierCityTable')" style="width: 100%; padding: 8px 12px; background: #0ea5e9; border: none; color: white; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 12px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view detailed data ▼</span>
        <span style="font-size: 11px; background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="cityTierCityTable" style="display: none; margin-top: 8px;">
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #0ea5e9; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">City</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                    </tr>
                </thead>
                <tbody id="cityTierCityTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- City Tier Breakdown View -->
<div id="cityTierBreakdownView" style="display: none;">
    <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 10px;">
        <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151; font-size: 11px;">Tier:</span>
            <button class="city-tier-tier-btn active" data-tier="t1" style="padding: 5px 10px; border: 2px solid #0ea5e9; border-radius: 6px; background: #0ea5e9; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">T1</button>
            <button class="city-tier-tier-btn" data-tier="t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T2</button>
            <button class="city-tier-tier-btn" data-tier="both" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1 vs T2</button>
        </div>
        <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151; font-size: 11px;">City:</span>
            <select id="cityTierCitySelectSingle" style="padding: 4px 8px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #374151; font-weight: 600; font-size: 11px;">
                <option value="all">All (Tier summary)</option>
            </select>
            <select id="cityTierCitySelectT1" style="display: none; padding: 4px 8px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #374151; font-weight: 600; font-size: 11px;">
                <option value="all">T1 (Tier summary)</option>
            </select>
            <select id="cityTierCitySelectT2" style="display: none; padding: 4px 8px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #374151; font-weight: 600; font-size: 11px;">
                <option value="all">T2 (Tier summary)</option>
            </select>
            <button id="cityTierClearCityFilter" style="padding: 5px 8px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 11px;">Clear</button>
        </div>
        <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151; font-size: 11px;">Breakdown:</span>
            <button class="city-tier-breakdown-btn active" data-breakdown="overview" style="padding: 5px 10px; border: 2px solid #0ea5e9; border-radius: 6px; background: #0ea5e9; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">Overview</button>
            <button class="city-tier-breakdown-btn" data-breakdown="city" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">City Level</button>
            <button class="city-tier-breakdown-btn" data-breakdown="performance" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Performance</button>
            <button class="city-tier-breakdown-btn" data-breakdown="scale" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Scale</button>
        </div>
        <div style="display: flex; align-items: center; gap: 6px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151; font-size: 11px;">Metric:</span>
            <button class="city-tier-breakdown-metric-btn active" data-metric="partners" style="padding: 5px 10px; border: 2px solid #0ea5e9; border-radius: 6px; background: #0ea5e9; color: white; font-weight: 600; cursor: pointer; font-size: 11px;"># of partners with target</button>
            <button class="city-tier-breakdown-metric-btn" data-metric="target" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Total target</button>
            <button class="city-tier-breakdown-metric-btn" data-metric="avg" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Avg scale</button>
        </div>
    </div>

    <div id="cityTierBreakdownSingle" class="chart-container" style="margin-bottom: 12px;">
        <h4 id="cityTierBreakdownTitle" style="text-align: center; color: #1f4e78; font-size: 14px; margin: 0 0 8px 0;">Tier Breakdown (Jan vs Feb)</h4>
        <canvas id="cityTierBreakdownChart"></canvas>
    </div>

    <div id="cityTierBreakdownDual" style="display: none; margin-bottom: 12px;">
        <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 id="cityTierBreakdownTitleT1" style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T1 Breakdown (Jan vs Feb)</h4>
                <canvas id="cityTierBreakdownChartT1"></canvas>
            </div>
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 id="cityTierBreakdownTitleT2" style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T2 Breakdown (Jan vs Feb)</h4>
                <canvas id="cityTierBreakdownChartT2"></canvas>
            </div>
        </div>
    </div>

    <div id="cityTierBreakdownNote" class="info-box" style="background: #f8fafc; border-left: 4px solid #64748b; margin-bottom: 10px; padding: 8px 12px;">
        <p style="margin: 0; font-size: 12px; color: #475569;">
            <strong>Tip:</strong> Choose a tier and breakdown type. MoM% is shown on Feb values only.
        </p>
    </div>

    <button onclick="toggleTable(this, 'cityTierBreakdownTable')" style="width: 100%; padding: 8px 12px; background: #64748b; border: none; color: white; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 12px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view detailed data ▼</span>
        <span style="font-size: 11px; background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="cityTierBreakdownTable" style="display: none; margin-top: 8px;">
        <div id="cityTierBreakdownSingleTable" class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #64748b; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Category</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                    </tr>
                </thead>
                <tbody id="cityTierBreakdownTableBody"></tbody>
            </table>
        </div>
        <div id="cityTierBreakdownDualTable" style="display: none;">
            <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                <div class="table-container" style="flex: 1; min-width: 320px;">
                    <h5 style="margin: 0 0 8px 0; color: #1f4e78;">T1 Details</h5>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #64748b; color: white;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Category</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                            </tr>
                        </thead>
                        <tbody id="cityTierBreakdownTableBodyT1"></tbody>
                    </table>
                </div>
                <div class="table-container" style="flex: 1; min-width: 320px;">
                    <h5 style="margin: 0 0 8px 0; color: #1f4e78;">T2 Details</h5>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #64748b; color: white;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Category</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                            </tr>
                        </thead>
                        <tbody id="cityTierBreakdownTableBodyT2"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- City Performance Distribution View -->
<div id="cityTierPerformanceView" style="display: none;">
    <div style="display: flex; justify-content: center; gap: 8px; margin: 4px 0 10px 0; flex-wrap: wrap;">
        <span style="font-weight: 600; color: #374151; font-size: 11px;">Breakdown:</span>
        <button class="city-tier-performance-filter active" data-filter="total" style="padding: 5px 10px; border: 2px solid #22c55e; border-radius: 6px; background: #22c55e; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">Total</button>
        <button class="city-tier-performance-filter" data-filter="t1" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1</button>
        <button class="city-tier-performance-filter" data-filter="t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T2</button>
        <button class="city-tier-performance-filter" data-filter="t1t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1 vs T2</button>
    </div>

    <div id="cityTierPerformanceSingle" class="chart-container" style="margin-bottom: 12px;">
        <h4 style="text-align: center; color: #1f4e78; font-size: 14px; margin: 0 0 8px 0;">City Performance Distribution (Partners with Target)</h4>
        <canvas id="cityTierPerformanceChart"></canvas>
    </div>
    <div id="cityTierPerformanceSplit" style="display: none; margin-bottom: 12px;">
        <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T1 Cities</h4>
                <canvas id="cityTierPerformanceChartT1"></canvas>
            </div>
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T2 Cities</h4>
                <canvas id="cityTierPerformanceChartT2"></canvas>
            </div>
        </div>
    </div>

    <div id="cityTierPerformanceNote" class="info-box" style="background: #f0fdf4; border-left: 4px solid #22c55e; margin-bottom: 10px; padding: 8px 12px;">
        <p style="margin: 0; font-size: 12px; color: #166534;">
            <strong>Insight:</strong> Distribution of Good / Average / Bad partners by city with % share. Use this to spot risk-heavy cities quickly.
        </p>
    </div>

    <button onclick="toggleTable(this, 'cityTierPerformanceTable')" style="width: 100%; padding: 8px 12px; background: #22c55e; border: none; color: white; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 12px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view performance details ▼</span>
        <span style="font-size: 11px; background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="cityTierPerformanceTable" style="display: none; margin-top: 8px;">
        <!-- Legend/Note Section -->
        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px 14px; margin-bottom: 10px;">
            <div style="font-weight: 700; color: #1f4e78; margin-bottom: 6px; font-size: 12px;">📊 Highlight Legend & Risk Explanation</div>
            <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 12px;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #dcfce7; border: 2px solid #16a34a; border-radius: 3px;"></span>
                    <span style="font-size: 12px; color: #374151;">Top 3 Good Performance (Best cities with highest % of Good partners)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #fee2e2; border: 2px solid #dc2626; border-radius: 3px;"></span>
                    <span style="font-size: 12px; color: #374151;">Top 3 Bad Performance (Cities with highest % of Bad partners - needs attention)</span>
                </div>
            </div>
            <div style="font-weight: 600; color: #475569; font-size: 12px; margin-bottom: 6px;">Risk Level Definitions:</div>
            <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 11px;">
                <div><span style="color: #16a34a; font-weight: 700;">● Low Risk:</span> Good % ≥ 50% (Healthy performance distribution)</div>
                <div><span style="color: #f59e0b; font-weight: 700;">● Moderate Risk:</span> Good % 30-49% (Needs monitoring)</div>
                <div><span style="color: #dc2626; font-weight: 700;">● High Risk:</span> Good % < 30% OR Bad % ≥ 20% (Requires immediate action)</div>
            </div>
        </div>
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #22c55e; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">City</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Performance</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Partners with Target</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan target total</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb target total</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Change #</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Change %</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">City Share %</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Risk</th>
                    </tr>
                </thead>
                <tbody id="cityTierPerformanceTableBody"></tbody>
            </table>
        </div>
    </div>
</div>
</div>

<!-- City Scale Distribution View -->
<div id="cityTierScaleView" style="display: none;">
    <div style="display: flex; justify-content: center; gap: 8px; margin: 4px 0 10px 0; flex-wrap: wrap;">
        <span style="font-weight: 600; color: #374151; font-size: 11px;">Breakdown:</span>
        <button class="city-tier-scale-filter active" data-filter="total" style="padding: 5px 10px; border: 2px solid #8b5cf6; border-radius: 6px; background: #8b5cf6; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">Total</button>
        <button class="city-tier-scale-filter" data-filter="t1" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1</button>
        <button class="city-tier-scale-filter" data-filter="t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T2</button>
        <button class="city-tier-scale-filter" data-filter="t1t2" style="padding: 5px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">T1 vs T2</button>
    </div>

    <div id="cityTierScaleSingle" class="chart-container" style="margin-bottom: 12px;">
        <h4 style="text-align: center; color: #1f4e78; font-size: 14px; margin: 0 0 8px 0;">City Scale Distribution (Partners with Target)</h4>
        <canvas id="cityTierScaleChart"></canvas>
    </div>
    <div id="cityTierScaleSplit" style="display: none; margin-bottom: 12px;">
        <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T1 Cities</h4>
                <canvas id="cityTierScaleChartT1"></canvas>
            </div>
            <div class="chart-container" style="flex: 1; min-width: 300px;">
                <h4 style="text-align: center; color: #1f4e78; font-size: 13px; margin: 0 0 8px 0;">T2 Cities</h4>
                <canvas id="cityTierScaleChartT2"></canvas>
            </div>
        </div>
    </div>

    <div id="cityTierScaleNote" class="info-box" style="background: #f5f3ff; border-left: 4px solid #8b5cf6; margin-bottom: 10px; padding: 8px 12px;">
        <p style="margin: 0; font-size: 12px; color: #5b21b6;">
            <strong>Insight:</strong> Distribution of Big / Mid / Small scale partners by city with % share. Understand partner scale mix across cities.
        </p>
    </div>

    <button onclick="toggleTable(this, 'cityTierScaleTable')" style="width: 100%; padding: 8px 12px; background: #8b5cf6; border: none; color: white; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 12px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view scale details ▼</span>
        <span style="font-size: 11px; background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="cityTierScaleTable" style="display: none; margin-top: 8px;">
        <!-- Legend/Note Section -->
        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px 14px; margin-bottom: 10px;">
            <div style="font-weight: 700; color: #1f4e78; margin-bottom: 6px; font-size: 12px;">📊 Highlight Legend & Scale Explanation</div>
            <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 12px;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #ede9fe; border: 2px solid #8b5cf6; border-radius: 3px;"></span>
                    <span style="font-size: 12px; color: #374151;">Top 3 Big Partners (Cities with highest % of Big scale partners)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #fef3c7; border: 2px solid #f59e0b; border-radius: 3px;"></span>
                    <span style="font-size: 12px; color: #374151;">Top 3 Small Partners (Cities with highest % of Small scale partners)</span>
                </div>
            </div>
            <div style="font-weight: 600; color: #475569; font-size: 12px; margin-bottom: 6px;">Scale Definitions:</div>
            <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 11px;">
                <div><span style="color: #7c3aed; font-weight: 700;">● Big:</span> High capacity partners (Top tier)</div>
                <div><span style="color: #0ea5e9; font-weight: 700;">● Mid:</span> Medium capacity partners</div>
                <div><span style="color: #f59e0b; font-weight: 700;">● Small:</span> Lower capacity partners</div>
            </div>
        </div>
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #8b5cf6; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">City</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Scale</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Partners with Target</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan target total</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb target total</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Change #</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Change %</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">City Share %</th>
                    </tr>
                </thead>
                <tbody id="cityTierScaleTableBody"></tbody>
            </table>
        </div>
    </div>
</div>
</div>

<!-- TARGET MOVEMENT ANALYSIS SECTION -->
<div id="monthOverviewTargetMovement" style="margin-top: 50px; margin-bottom: 50px;">
<h3 style="color: #1f4e78; margin-bottom: 20px; font-size: 22px; border-bottom: 3px solid #7c3aed; padding-bottom: 10px;">
    🎯 Target Movement Analysis (Jan vs Feb)
</h3>

<!-- Summary Cards Row -->
<div id="targetMovementSummaryCards" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px;">
    <div class="tooltip-card" data-tooltip="MoM change in total partners with target (Jan: 625 → Feb: 551)" style="flex: 1; min-width: 130px; max-width: 165px; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.1); border: 1px solid #ddd6fe; border-top: 3px solid #7c3aed; position: relative;">
        <div style="font-size: 11px; color: #7c3aed; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; margin-bottom: 4px;">MoM Partners</div>
        <div style="display: flex; align-items: baseline; gap: 6px;">
            <span id="tmCardMoMPartners" style="font-size: 20px; font-weight: 800; color: #7c3aed;">-11.8%</span>
            <span id="tmCardMoMPartnersArrow" style="font-size: 12px; color: #dc2626;">▼</span>
        </div>
    </div>
    <div class="tooltip-card" data-tooltip="Increased − Decreased: 153 − 284 = -131 (more decreases than increases)" style="flex: 1; min-width: 130px; max-width: 165px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #3b82f6; position: relative;">
        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Net Movement</div>
        <div style="display: flex; align-items: baseline; gap: 6px;">
            <span id="tmCardNetImpact" style="font-size: 18px; font-weight: 700; color: #1f2937;">-131</span>
            <span id="tmCardNetImpactArrow" style="font-size: 12px; color: #dc2626;">▼</span>
        </div>
    </div>
    <div class="tooltip-card" data-tooltip="Partners with increased target: Jan 212 → Feb 153 | Change: -59 (-27.8%)" style="flex: 1; min-width: 130px; max-width: 165px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #16a34a; position: relative;">
        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Increased</div>
        <div style="display: flex; align-items: baseline; gap: 6px;">
            <span id="tmCardIncreased" style="font-size: 18px; font-weight: 700; color: #1f2937;">153</span>
            <span id="tmCardIncreasedMoM" style="font-size: 11px; font-weight: 600; color: #dc2626;">MoM -27.8%</span>
        </div>
    </div>
    <div class="tooltip-card" data-tooltip="Partners with decreased target: Jan 240 → Feb 284 | Change: +44 (+18.3%)" style="flex: 1; min-width: 130px; max-width: 165px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #dc2626; position: relative;">
        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Decreased</div>
        <div style="display: flex; align-items: baseline; gap: 6px;">
            <span id="tmCardDecreased" style="font-size: 18px; font-weight: 700; color: #1f2937;">284</span>
            <span id="tmCardDecreasedMoM" style="font-size: 11px; font-weight: 600; color: #16a34a;">MoM +18.3%</span>
        </div>
    </div>
    <div class="tooltip-card" data-tooltip="Partners with no change: Jan 173 → Feb 114 | Change: -59 (-34.1%)" style="flex: 1; min-width: 130px; max-width: 165px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #f59e0b; position: relative;">
        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">No Change</div>
        <div style="display: flex; align-items: baseline; gap: 6px;">
            <span id="tmCardNoChange" style="font-size: 18px; font-weight: 700; color: #1f2937;">114</span>
            <span id="tmCardNoChangeMoM" style="font-size: 11px; font-weight: 600; color: #dc2626;">MoM -34.1%</span>
        </div>
    </div>
</div>

<!-- Target Increase/Decrease Overview -->
<div style="margin-bottom: 24px;">
    <div style="display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 14px;">
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 700; color: #374151;">View:</span>
            <button class="target-move-view-btn tooltip-btn tooltip-btn-purple active" data-view="overall" data-tooltip="Overall view compares Jan vs Feb totals for partners with target, and splits movement into Increase, Decrease, and No Change so you can see net direction at a glance." style="padding: 6px 12px; border: 2px solid #7c3aed; border-radius: 8px; background: #7c3aed; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Overall</button>
            <button id="breakdownViewBtn" class="target-move-view-btn tooltip-btn tooltip-btn-purple" data-view="breakdown" data-tooltip="Breakdown view drills into the movement type and shows how Good/Average/Bad segments shifted from Jan to Feb, with MoM labels on Feb values for quick read." style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;"><span id="breakdownArrow" style="margin-right: 4px; transition: transform 0.2s;">◀</span>Breakdown</button>
        </div>
        <div id="breakdownFilterContainer" style="display: none; align-items: center; gap: 8px; flex-wrap: nowrap; border-left: 2px solid #e5e7eb; padding-left: 12px;">
            <span style="font-weight: 600; color: #374151;">Breakdown:</span>
            <button class="target-move-breakdown-btn tooltip-btn tooltip-btn-purple active" data-breakdown="increased" data-tooltip="Partners whose targets increased. Use this to see which performance segments drove growth from Jan to Feb." style="padding: 6px 12px; border: 2px solid #7c3aed; border-radius: 8px; background: #7c3aed; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Total Increased</button>
            <button class="target-move-breakdown-btn tooltip-btn tooltip-btn-purple" data-breakdown="decreased" data-tooltip="Partners whose targets decreased. Highlights segments contributing to the drop and where reductions are concentrated." style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Total Decreased</button>
            <button class="target-move-breakdown-btn tooltip-btn tooltip-btn-purple" data-breakdown="nochange" data-tooltip="Partners with no target change. Useful for stability analysis and identifying segments with steady targets." style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">No Change</button>
        </div>
    </div>

    <!-- Side by Side Container -->
    <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;">
        <!-- Overall Section -->
        <div id="targetMovementOverallSection" style="flex: 1; min-width: 400px;">
            <h4 style="color: #1f4e78; margin: 0 0 12px 0; font-size: 16px;">📈 Overall</h4>

            <div style="background: #ede9fe; border-left: 4px solid #7c3aed; border-radius: 8px; padding: 10px 12px; margin-bottom: 12px; min-height: 36px; display: flex; align-items: center;">
                <p style="color: #4c1d95; margin: 0; font-size: 12px;"><strong>Note:</strong> MoM% shown on Feb values. Bars: Jan vs Feb comparison.</p>
            </div>

            <div class="chart-container" style="margin-bottom: 16px; height: 340px;">
                <canvas id="targetMovementSummaryChart"></canvas>
            </div>
        </div>

        <!-- Breakdown Section -->
        <div id="targetMovementBreakdownSection" style="flex: 1; min-width: 400px;">
            <h4 style="color: #1f4e78; margin: 0 0 12px 0; font-size: 16px;">🧩 Breakdown</h4>

            <div id="targetMovementInsight" style="background: #ede9fe; border-left: 4px solid #7c3aed; border-radius: 8px; padding: 10px 12px; margin-bottom: 12px; min-height: 36px; display: flex; align-items: center;">
                <p style="color: #4c1d95; margin: 0; font-size: 12px;"></p>
            </div>

            <div class="chart-container" style="margin-bottom: 16px; height: 340px;">
                <h4 id="targetMovementBreakdownTitle" style="text-align: center; color: #1f4e78; font-size: 14px; margin: 0 0 8px 0;">Breakdown (Jan vs Feb)</h4>
                <canvas id="targetMovementBreakdownChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Riders Slab Distribution -->
<div>
    <h4 style="color: #1f4e78; margin: 0 0 16px 0; font-size: 16px;">📊 Riders Slab Distribution (Jan vs Feb)</h4>
    
    <!-- Summary Cards Row -->
    <div id="ridersSlabSummaryCards" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 18px;">
        <div class="tooltip-card-teal" data-tooltip="Total partners: Jan 625 → Feb 551 | Change: -74 (-11.8%)" style="flex: 1; min-width: 155px; max-width: 180px; background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%); border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(15, 118, 110, 0.1); border: 1px solid #99f6e4; border-top: 3px solid #0f766e; position: relative;">
            <div style="font-size: 11px; color: #0f766e; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; margin-bottom: 4px;">Total Partners</div>
            <div style="display: flex; align-items: baseline; gap: 6px; white-space: nowrap;">
                <span style="font-size: 20px; font-weight: 800; color: #0f766e;">551</span>
                <span style="font-size: 11px; font-weight: 600; color: #dc2626;">MoM -11.8% ▼</span>
            </div>
        </div>
        <div class="tooltip-card-teal" data-tooltip="Small scale (1-19 riders): Jan 181 → Feb 141 | Change: -40 (-22.1%)" style="flex: 1; min-width: 155px; max-width: 180px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #3b82f6; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Small Scale</div>
            <div style="display: flex; align-items: baseline; gap: 6px; white-space: nowrap;">
                <span style="font-size: 18px; font-weight: 700; color: #1f2937;">141</span>
                <span style="font-size: 10px; color: #6b7280;">partners</span>
                <span style="font-size: 11px; font-weight: 600; color: #dc2626;">MoM -22.1%</span>
            </div>
        </div>
        <div class="tooltip-card-teal" data-tooltip="Mid scale (20-49 riders): Jan 328 → Feb 316 | Change: -12 (-3.7%)" style="flex: 1; min-width: 155px; max-width: 180px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #f59e0b; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Mid Scale</div>
            <div style="display: flex; align-items: baseline; gap: 6px; white-space: nowrap;">
                <span style="font-size: 18px; font-weight: 700; color: #1f2937;">316</span>
                <span style="font-size: 10px; color: #6b7280;">partners</span>
                <span style="font-size: 11px; font-weight: 600; color: #dc2626;">MoM -3.7%</span>
            </div>
        </div>
        <div class="tooltip-card-teal" data-tooltip="Large scale (50+ riders): Jan 116 → Feb 94 | Change: -22 (-19.0%)" style="flex: 1; min-width: 155px; max-width: 180px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #10b981; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Large Scale</div>
            <div style="display: flex; align-items: baseline; gap: 6px; white-space: nowrap;">
                <span style="font-size: 18px; font-weight: 700; color: #1f2937;">94</span>
                <span style="font-size: 10px; color: #6b7280;">partners</span>
                <span style="font-size: 11px; font-weight: 600; color: #dc2626;">MoM -19.0%</span>
            </div>
        </div>
        <div class="tooltip-card-teal" data-tooltip="Most common target range in Feb: 20-30 riders with 160 partners" style="flex: 1; min-width: 155px; max-width: 180px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #8b5cf6; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Peak Slab</div>
            <div style="display: flex; align-items: baseline; gap: 6px; white-space: nowrap;">
                <span style="font-size: 14px; font-weight: 700; color: #1f2937;">20-30</span>
                <span style="font-size: 10px; color: #6b7280;">160 partners</span>
            </div>
        </div>
    </div>
    
    <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 14px;">
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;">
            <span style="font-weight: 600; color: #374151;">View:</span>
            <button class="riders-slab-view-btn tooltip-btn tooltip-btn-teal active" data-view="total" data-tooltip="All partners with a target, shown by riders slab to compare Jan vs Feb distribution." style="padding: 6px 12px; border: 2px solid #0f766e; border-radius: 8px; background: #0f766e; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">Total with Target</button>
            <button class="riders-slab-view-btn tooltip-btn tooltip-btn-teal" data-view="increased" data-tooltip="Only partners whose targets increased; shows which rider slabs gained the most." style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Increased Target</button>
            <button class="riders-slab-view-btn tooltip-btn tooltip-btn-teal" data-view="decreased" data-tooltip="Only partners whose targets decreased; highlights slabs with the biggest declines." style="padding: 6px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">Decreased Target</button>
        </div>
    </div>

    <div class="chart-container" style="margin-bottom: 16px; height: 320px;">
        <h4 id="ridersSlabTitle" style="text-align: center; color: #1f4e78; font-size: 15px; margin: 0 0 10px 0;">Riders Slab Distribution (Jan vs Feb)</h4>
        <canvas id="ridersSlabChart"></canvas>
    </div>

    <button onclick="toggleTable(this, 'ridersSlabTable')" style="width: 100%; padding: 10px 16px; background: #0f766e; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Click to view detailed data ▼</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 4px;">Collapsed</span>
    </button>
    <div id="ridersSlabTable" style="display: none; margin-top: 12px;">
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #0f766e; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db;">Slab</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Jan</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Feb</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">MoM %</th>
                    </tr>
                </thead>
                <tbody id="ridersSlabTableBody"></tbody>
            </table>
        </div>
    </div>
</div>
</div>

    <!-- TOP/BOTTOM PARTNERS OVERVIEW SECTION -->
    <div id="monthOverviewTopBottom" style="margin-top: 50px; margin-bottom: 50px;">
    <h3 style="color: #1f4e78; margin-bottom: 20px; font-size: 22px; border-bottom: 3px solid #0ea5e9; padding-bottom: 10px;">
        📌 Top & Bottom Partners Overview (Jan vs Feb)
    </h3>

    <!-- Summary Cards Row -->
    <div id="partnersOverviewSummaryCards" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 18px;">
        <div class="tooltip-card-sky" data-tooltip="Number of partners shown in selected view" style="flex: 1; min-width: 120px; max-width: 150px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(14, 165, 233, 0.1); border: 1px solid #bae6fd; border-top: 3px solid #0ea5e9; position: relative;">
            <div style="font-size: 11px; color: #0ea5e9; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; margin-bottom: 4px;">Partners</div>
            <div style="display: flex; align-items: baseline; gap: 6px;">
                <span id="poCardPartners" style="font-size: 20px; font-weight: 800; color: #0284c7;">20</span>
            </div>
        </div>
        <div id="poCardTotalTargetContainer" class="tooltip-card-sky" data-tooltip="Total target riders across all partners in Feb" style="flex: 1; min-width: 120px; max-width: 150px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #3b82f6; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Total Target</div>
            <div style="display: flex; align-items: baseline; gap: 6px;">
                <span id="poCardTotalTarget" style="font-size: 18px; font-weight: 700; color: #1f2937;">3,833</span>
                <span id="poCardTargetPct" style="font-size: 11px; font-weight: 600; color: #0284c7;">19.8%</span>
            </div>
        </div>
        <div class="tooltip-card-sky" data-tooltip="Partners with Good performance rating in Feb" style="flex: 1; min-width: 120px; max-width: 150px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #16a34a; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Good Perf.</div>
            <div style="display: flex; align-items: baseline; gap: 6px;">
                <span id="poCardGood" style="font-size: 18px; font-weight: 700; color: #16a34a;">14</span>
                <span style="font-size: 10px; color: #6b7280;">partners</span>
            </div>
        </div>
        <div class="tooltip-card-sky" data-tooltip="Partners with Average performance rating in Feb" style="flex: 1; min-width: 120px; max-width: 150px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #f59e0b; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Avg Perf.</div>
            <div style="display: flex; align-items: baseline; gap: 6px;">
                <span id="poCardAvg" style="font-size: 18px; font-weight: 700; color: #f59e0b;">6</span>
                <span style="font-size: 10px; color: #6b7280;">partners</span>
            </div>
        </div>
        <div class="tooltip-card-sky" data-tooltip="Average Face Recognition Rate / Driver Card % across partners in Feb" style="flex: 1; min-width: 140px; max-width: 170px; background: white; border-radius: 10px; padding: 12px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; border-top: 3px solid #8b5cf6; position: relative;">
            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">Avg FR / DC %</div>
            <div style="display: flex; align-items: baseline; gap: 4px;">
                <span id="poCardAvgFR" style="font-size: 16px; font-weight: 700; color: #1f2937;">96.1%</span>
                <span style="font-size: 12px; color: #6b7280;">/</span>
                <span id="poCardAvgDC" style="font-size: 16px; font-weight: 700; color: #1f2937;">40.0%</span>
            </div>
        </div>
    </div>

    <div style="display: flex; justify-content: center; gap: 12px; margin: 10px 0 18px 0; flex-wrap: wrap;">
        <button class="partners-overview-btn tooltip-btn tooltip-btn-sky active" data-view="top" data-tooltip="Top 20 partners by rider count, showing Jan vs Feb targets, riders, performance, and compliance." style="padding: 10px 18px; border: 2px solid #0ea5e9; border-radius: 10px; background: #0ea5e9; color: white; font-weight: 700; cursor: pointer; font-size: 13px;">Top 20 Biggest Partners</button>
        <button class="partners-overview-btn tooltip-btn tooltip-btn-sky" data-view="bottom" data-tooltip="Bottom 20 partners by rider count, highlighting low-scale partners and their Jan vs Feb target movement." style="padding: 10px 18px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 13px;">Bottom 20 Smallest Partners</button>
        <button class="partners-overview-btn tooltip-btn tooltip-btn-sky" data-view="ranked" data-tooltip="Top 20 partners ranked by the highest number of covered cities across the Kingdom, reflecting the widest geographic reach." style="padding: 10px 18px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 13px;">Top 20 Ranked Partners</button>
    </div>

    <div class="table-container" style="margin-bottom: 14px; overflow-x: auto;">
        <table id="partnersOverviewTable" style="width: 100%; border-collapse: collapse; min-width: 1200px;">
            <thead id="partnersOverviewTableHead">
                <tr style="background: #0ea5e9; color: white;">
                    <th rowspan="2" style="padding: 10px; text-align: center; border: 1px solid #d1d5db; min-width: 40px; vertical-align: middle;">#</th>
                    <th rowspan="2" style="padding: 10px; text-align: left; border: 1px solid #d1d5db; min-width: 200px; vertical-align: middle;">Partner</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;"># of cities</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">New/Old</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Delivery riders</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Total target</th>
                    <th rowspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db; vertical-align: middle;">MoM %<br>(Target)</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Performance</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Avg FR %</th>
                    <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Avg Driver Card %</th>
                </tr>
                <tr style="background: #0284c7; color: white;">
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                    <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                </tr>
            </thead>
            <tbody id="partnersOverviewTableBody"></tbody>
        </table>
    </div>

    <div id="partnersOverviewNote" style="background: #e0f2fe; border-left: 4px solid #0284c7; border-radius: 8px; padding: 12px;">
        <p style="color: #0c4a6e; margin: 0; font-size: 13px;">
            <strong>📋 Note:</strong> Table compares Jan vs Feb per partner. MoM% shown for Total Target only. Total target reflects riders across all covered cities. Performance is based on highest-target city. FR & Driver Card rates are averaged across cities.
        </p>
    </div>
    </div>

<div style="margin-top: 40px;">
<h3 id="monthOverviewSuccessMetrics" style="color: #1f4e78; margin-bottom: 20px; font-size: 22px; border-bottom: 3px solid #059669; padding-bottom: 10px;">
                    ✅ February 2026 Success Metrics
                </h3>
<div class="info-box" style="background: #f0fdf4; border-left: 4px solid #059669; margin-bottom: 18px;">
<p style="margin: 0; font-size: 14px; color: #065f46;">
<strong>Performance Breakdown:</strong> Toggle between Capacity Target & Avg Scale, and Next Month Target to review achievement, gaps, % by segment, and strategic planning.
                    </p>
</div>

<div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap;">
    <button class="success-metrics-toggle active" data-metric="capacity" style="padding: 8px 16px; border: 2px solid #059669; border-radius: 10px; background: #059669; color: white; font-weight: 700; cursor: pointer; font-size: 12px; transition: all 0.4s ease;">Capacity Target & Avg Scale</button>
    <button class="success-metrics-toggle" data-metric="nextmonth" style="padding: 8px 16px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px; transition: all 0.4s ease;">🎯 Next Month Target</button>
    <button class="success-metrics-toggle" data-metric="okrs" style="padding: 8px 16px; border: 2px solid #e5e7eb; border-radius: 10px; background: white; color: #6b7280; font-weight: 700; cursor: pointer; font-size: 12px; transition: all 0.4s ease;">📋 2026 OKRs Summary (Not yet ready)</button>
</div>

<!-- OKRs Summary Section -->
<div id="okrsSummarySection" style="display: none;">
    <!-- Executive Summary -->
    <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); border-radius: 12px; padding: 20px; margin-bottom: 20px; color: white;">
        <h4 style="margin: 0 0 12px 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
            <span>🎯</span> Q1 2026 Strategic Mandate
        </h4>
        <p style="margin: 0; font-size: 13px; line-height: 1.6; opacity: 0.95;">
            Cut cost per order while growing dependable supply. Gate capacity by compliance first, shift targets toward high-performers, run 3-month bands for stability, and execute 30/60/90 turnarounds for weak partners. Consolidate scale to lift average riders per partner, cap single-partner exposure per city, and use long-term assessment + incentives to raise willingness where it matters.
        </p>
    </div>

    <!-- Team Objectives Grid -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100%, 1fr)); gap: 16px;">

        <!-- O1: Cost Reduction via Scale Growth -->
        <div class="okr-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleOkrCard(this)" style="width: 100%; padding: 14px 18px; background: linear-gradient(90deg, #5a7c91 0%, #7494a8 100%); border: none; color: white; font-weight: 700; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                <span><span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; margin-right: 10px;">O1</span> Reduce CPO via Scale Growth (Q1) — Target: 0.39 SAR/order</span>
                <span style="font-size: 18px; transition: transform 0.3s;">▼</span>
            </button>
            <div class="okr-card-content" style="padding: 16px; display: none;">
                <div style="background: #f0f4f7; border-left: 4px solid #5a7c91; padding: 12px; border-radius: 0 8px 8px 0; margin-bottom: 16px;">
                    <p style="margin: 0; font-size: 12px; color: #3d5a6f;"><strong>Team Objective:</strong> Reduce 0.444 SAR per order in Q1</p>
                </div>

                <!-- KR1 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR1: Raise avg riders/partner from ~33 → ≥45</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Reallocate from small/weak partners (<20 riders) to reliable partners. Lock 3-month bands; retain ≥70% of peak gains. Protect priority cities.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">35.9 avg scale target</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;"><strong>35.9</strong> (79.8% to target)</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR2 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR2: Deliver ≥0.39 SAR/order CPO reduction from scale</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Concentrate capacity on Good & compliant partners. Enforce SOP + maker/checker to cut overrides (willingness & special cases with proof process).</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;"><strong>Good:</strong> 55.2% share | <strong>Avg:</strong> 37.7% | <strong>Bad:</strong> 7.1%</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR3 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR3: Frontline engagement (PMM/CH)</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Assign avg scale/partner target to PMM by performance level. Push alignment with partners to prepare riders accordingly.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Monthly (until Mar 31)</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">Target assigned per city to share with CH</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">Partners count shared with PMM/CH to reach avg scale target</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- O2: Compliance & Experience -->
        <div class="okr-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleOkrCard(this)" style="width: 100%; padding: 14px 18px; background: linear-gradient(90deg, #8b7eb8 0%, #a89dc7 100%); border: none; color: white; font-weight: 700; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                <span><span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; margin-right: 10px;">O2</span> Improve Compliance & Experience (Q1) — Target: 25% → 80%</span>
                <span style="font-size: 18px; transition: transform 0.3s;">▼</span>
            </button>
            <div class="okr-card-content" style="padding: 16px; display: none;">
                <div style="background: #f6f4fa; border-left: 4px solid #8b7eb8; padding: 12px; border-radius: 0 8px 8px 0; margin-bottom: 16px;">
                    <p style="margin: 0; font-size: 12px; color: #5c4f82;"><strong>Team Objective:</strong> Raise compliance rate from 25% to 80% in Q1</p>
                </div>

                <!-- KR -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR: Good/strong partners carry ≥58-60% of capacity target; Bad partners ≤5%</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Use weighted operational metrics. Add driver card to performance assessment. Assign highest capacity to highest compliant partners (FR, driver card, etc.).</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">28.7% driver card rate</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">Driver card in ops metrics from Jan 19. Will use in March target. <strong>Good: 55%</strong> (from 55% target) | <strong>Bad: 7%</strong> (vs 5% target)</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- O3: Long-term Assessment & Willingness -->
        <div class="okr-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleOkrCard(this)" style="width: 100%; padding: 14px 18px; background: linear-gradient(90deg, #5c9ca8 0%, #7ab5c0 100%); border: none; color: white; font-weight: 700; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                <span><span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; margin-right: 10px;">O3</span> Long-term Assessment & Willingness (Q1)</span>
                <span style="font-size: 18px; transition: transform 0.3s;">▼</span>
            </button>
            <div class="okr-card-content" style="padding: 16px; display: none;">
                <div style="background: #f0f7f9; border-left: 4px solid #5c9ca8; padding: 12px; border-radius: 0 8px 8px 0; margin-bottom: 16px;">
                    <p style="margin: 0; font-size: 12px; color: #3e6d78;"><strong>Team Objective:</strong> Ensure capacity fulfillment via long-term partner assessment</p>
                </div>

                <!-- KR1 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR1: Build V1 new partners assessment model</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Benchmark competitors, design new assessment, align with Keeta CPO target, finalize criteria/rewards structure.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Plan: Feb 28; Pilot: Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;">Pending — Start after March capacity target (2nd week Feb)</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR2 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR2: Publish assessment plan; pilot T2 cities</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Determine T2 cities for pilot phase of new assessment.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Plan: Feb 28; Pilot: Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;">Pending — Start after March capacity target (2nd week Feb)</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR3 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR3: Partner willingness +≥8-10pp vs Jan in pilots</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Establish incentives for partners with highest growth potential based on total riders including other platforms.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">Willingness data from Monthly Insights (Jan)</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR4 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR4: Deliver evaluation & product alignment</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Evaluate partners stratification, align on execution process.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 15</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- O4: Allocation Accuracy & Fulfillment -->
        <div class="okr-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleOkrCard(this)" style="width: 100%; padding: 14px 18px; background: linear-gradient(90deg, #4d9a7e 0%, #6bb59a 100%); border: none; color: white; font-weight: 700; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                <span><span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; margin-right: 10px;">O4</span> Allocation Accuracy & Fulfillment (Q1) — Target: ≥100% FR</span>
                <span style="font-size: 18px; transition: transform 0.3s;">▼</span>
            </button>
            <div class="okr-card-content" style="padding: 16px; display: none;">
                <div style="background: #f0f7f4; border-left: 4px solid #4d9a7e; padding: 12px; border-radius: 0 8px 8px 0; margin-bottom: 16px;">
                    <p style="margin: 0; font-size: 12px; color: #366b56;"><strong>Team Objective:</strong> Iterate target allocation mechanism; reduce PMM adjustment to 10%; achieve ≥100% monthly capacity FR</p>
                </div>

                <!-- KR1 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR1: Reduce manual adjustment by 10%</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Pre-planning alignment; parameterized gates; data-driven insights. Quick audits and consistent review. SOP + willingness tracker for special cases.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;">In progress — Collecting data</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR2 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR2: March capacity FR 98-100%</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Apply capacity target rules for high FR%. Focus on high FR partners and reward with capacity target.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb; background: #dcfce7;"><strong>96%</strong> FR (based on Jan 1 data: 73.8%). Push for 100%</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- KR3 -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR3: Promote ≥20 partners to ≥150 riders</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Scale top performers; mid → big path for compliant partners using monthly compliance targets + high quality metrics.</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;">7.1% target reduction in Jan — Will prioritize in Feb</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- O5: Concentration Risk -->
        <div class="okr-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleOkrCard(this)" style="width: 100%; padding: 14px 18px; background: linear-gradient(90deg, #d4a154 0%, #e4bb7a 100%); border: none; color: white; font-weight: 700; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                <span><span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; margin-right: 10px;">O5</span> Manage Concentration Risk (Q1)</span>
                <span style="font-size: 18px; transition: transform 0.3s;">▼</span>
            </button>
            <div class="okr-card-content" style="padding: 16px; display: none;">
                <div style="background: #faf6ed; border-left: 4px solid #d4a154; padding: 12px; border-radius: 0 8px 8px 0; margin-bottom: 16px;">
                    <p style="margin: 0; font-size: 12px; color: #7a5c2e;"><strong>Team Objective:</strong> Reduce group-wide risks & ensure fulfillment stability</p>
                </div>

                <!-- KR -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px; border-bottom: 1px solid #e5e7eb;">
                        <h5 style="margin: 0; font-size: 13px; color: #1f2937;">KR: Single-partner share ≤X% per city; remediate any breach within cycle</h5>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0 0 10px 0; font-size: 12px; color: #4b5563;"><strong>How:</strong> Map current city data and set metrics. Set city caps in model with alert + reallocation rules. Review capacity growth factor for enhancement.</p>
                        <p style="margin: 0 0 10px 0; font-size: 11px; color: #b45309; background: #fef3c7; padding: 8px; border-radius: 4px;"><strong>⚠️ Potential conflict:</strong> Balance between concentration risk goal and avg scale increase goal</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #e5e7eb;">Deadline</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Jan)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">O Progress (Feb)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #e5e7eb;">Mar 31</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #e5e7eb;">—</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="successMetricsCards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 18px; margin-bottom: 18px;"></div>

<div class="highlight-box" id="successMetricsInsights">
    <h4 style="color: #065f46; margin-bottom: 12px;">💡 Key Observations</h4>
    <ul style="margin: 0; padding-left: 20px;">
        <li style="margin-bottom: 8px;">Loading insights...</li>
    </ul>
</div>
</div>

</div>

<!-- DETAILED TABLES SECTION (Target Range Only) -->
<div id="detailedTablesSection" style="display: none;">

<!-- FR DETAILED TABLES -->
<div id="frDetailedTablesWrapper" style="margin-bottom: 20px;">
    <button onclick="toggleTable(this, 'frDetailedTables')" style="width: 100%; padding: 12px 20px; background: #3b82f6; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ FR Range Impact - Detailed Data (New / Old / Consolidated)</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 4px;">Click to expand</span>
    </button>
    <div id="frDetailedTables" style="display: none; margin-top: 15px;">
        
        <!-- New Partners FR Table -->
        <div style="margin-bottom: 25px;">
            <h5 style="color: #1f4e78; margin-bottom: 10px; font-size: 16px;">📋 New Partners (&lt;3 months) - FR Range Impact</h5>
            <div style="overflow-x: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead style="background: #1e5a8e; color: white;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">FR% Range</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Partners Count</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Active Partners</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Jan Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Feb Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change #</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change %</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg FR % (All)</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg FR % (Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">0-20%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">16</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">16</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">305</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">359</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+54</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+17.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1.0%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1.0%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">20-30%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">91</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-91</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">30-40%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">195</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">19</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-176</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-90.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36.7%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">40-50%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">227</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-227</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">50-60%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">2</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">642</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-642</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">56.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">60-80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">14</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">7</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,596</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">115</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-1,481</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-92.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">71.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">71.8%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">&gt;80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">125</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">103</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,898</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">2,469</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+571</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+30.1%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">95.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">96.0%</td>
                        </tr>
                        <tr style="background: #e0f2fe; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">Total/Avg</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">158</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">127</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">4,954</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">2,962</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #fee2e2; color: #991b1b;">-1,992</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #fee2e2; color: #991b1b;">-40.2%</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">83.2%</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">82.2%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Old Partners FR Table -->
        <div style="margin-bottom: 25px;">
            <h5 style="color: #1f4e78; margin-bottom: 10px; font-size: 16px;">📋 Old Partners (≥3 months) - FR Range Impact</h5>
            <div style="overflow-x: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead style="background: #1e5a8e; color: white;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">FR% Range</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Partners Count</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Active Partners</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Jan Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Feb Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change #</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change %</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg FR % (All)</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg FR % (Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">0-20%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">113</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">10</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-103</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-91.2%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0.0%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0.0%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">20-30%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">90</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-90</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">26.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">30-40%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">239</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-239</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">40-50%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,004</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-1,004</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">50-60%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">990</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">11</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-979</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-98.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">52.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">52.9%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">60-80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">22</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">16</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">6,870</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">513</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-6,357</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-92.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">73.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">74.2%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">&gt;80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">460</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">406</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">8,193</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">15,869</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+7,676</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+93.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">96.6%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">96.6%</td>
                        </tr>
                        <tr style="background: #e0f2fe; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">Total/Avg</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">485</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">424</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">17,499</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">16,403</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #fee2e2; color: #991b1b;">-1,096</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #fee2e2; color: #991b1b;">-6.3%</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">95.1%</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">95.4%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Consolidated FR Table -->
        <div style="margin-bottom: 25px;">
            <h5 style="color: #1f4e78; margin-bottom: 10px; font-size: 16px;">📋 All Partners - FR Range Impact (Consolidated)</h5>
            <div style="overflow-x: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead style="background: #1e5a8e; color: white;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">FR% Range</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Partners Count</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Active Partners</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Jan Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Feb Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change #</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change %</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg FR % (All)</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg FR % (Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">0-20%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">17</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">17</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">418</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">369</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-49</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-11.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1.0%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1.0%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">20-30%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">181</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-181</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">26.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">30-40%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">434</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">19</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-415</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-95.6%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36.7%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">40-50%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,231</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">0</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-1,231</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-100%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">—</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">50-60%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">3</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,632</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">11</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-1,621</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-99.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">55.2%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">52.9%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">60-80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">23</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">8,466</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">628</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-7,838</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-92.6%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">72.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">73.5%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">&gt;80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">585</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">509</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">10,091</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">18,338</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+8,247</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+81.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">96.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">96.5%</td>
                        </tr>
                        <tr style="background: #e0f2fe; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">Total/Avg</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">643</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">551</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">22,453</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">19,365</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #fee2e2; color: #991b1b;">-3,088</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #fee2e2; color: #991b1b;">-13.8%</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">92.2%</td>
                            <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center;">92.4%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- EXPANDABLE DETAILED TABLES FOR FR & DRIVER CARD -->
<h4 style="color: #1f4e78; margin: 40px 0 15px 0; font-size: 18px;">📋 Detailed Data Tables</h4>

<!-- DRIVER CARD DETAILED TABLES -->
<div id="dcDetailedTablesWrapper" style="margin-bottom: 30px; display: none;">
    <button onclick="toggleTable(this, 'dcDetailedTables')" style="width: 100%; padding: 12px 20px; background: #f97316; border: none; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; font-size: 14px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
        <span>▼ Driver Card Range Impact - Detailed Data (New / Old / Consolidated)</span>
        <span style="font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 4px;">Click to expand</span>
    </button>
    <div id="dcDetailedTables" style="display: none; margin-top: 15px;">
        
        <!-- New Partners Driver Card Table -->
        <div style="margin-bottom: 25px;">
            <h5 style="color: #1f4e78; margin-bottom: 10px; font-size: 16px;">📋 New Partners (&lt;3 months) - Driver Card Range Impact</h5>
            <div style="overflow-x: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead style="background: #ea580c; color: white;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Driver Card % Range</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Partners Count</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Active Partners</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Jan Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Feb Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change #</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change %</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg DC % (All)</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg DC % (Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">0-20%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">88</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">60</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">3,073</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,360</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-1,713</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-55.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">3.1%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">3.5%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">20-30%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">9</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">8</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">475</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">249</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-226</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-47.6%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">24.0%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">24.3%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">30-40%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">2</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">2</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">207</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">70</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-137</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-66.2%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">38.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">38.8%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">40-50%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">5</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">5</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">136</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">78</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-58</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-42.6%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">43.2%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">43.2%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">50-60%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">7</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">7</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">43</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">129</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+86</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+200%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">53.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">53.7%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">60-80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">9</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">9</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">238</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">201</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-37</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-15.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">71.0%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">71.0%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">&gt;80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">38</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">782</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">875</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+93</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+11.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">94.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">95.6%</td>
                        </tr>
                        <tr style="background: #fef3c7; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">Total/Avg</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">158</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">127</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">4,954</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">2,962</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center; background: #fee2e2; color: #991b1b;">-1,992</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center; background: #fee2e2; color: #991b1b;">-40.2%</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">34.2%</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">40.6%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Old Partners Driver Card Table -->
        <div style="margin-bottom: 25px;">
            <h5 style="color: #1f4e78; margin-bottom: 10px; font-size: 16px;">📋 Old Partners (≥3 months) - Driver Card Range Impact</h5>
            <div style="overflow-x: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead style="background: #ea580c; color: white;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Driver Card % Range</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Partners Count</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Active Partners</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Jan Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Feb Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change #</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change %</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg DC % (All)</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg DC % (Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">0-20%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">229</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">177</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">10,053</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">6,987</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-3,066</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-30.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">5.2%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">6.0%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">20-30%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">36</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">35</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,325</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,318</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-7</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-0.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">24.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">24.4%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">30-40%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">35</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">32</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">781</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,248</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+467</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+59.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">34.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">34.8%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">40-50%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">21</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">20</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">623</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">722</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+99</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+15.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">44.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">45.0%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">50-60%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">25</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">23</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">795</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">849</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+54</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+6.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">53.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">53.7%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">60-80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">34</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">34</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">889</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,201</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+312</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+35.1%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">68.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">68.8%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">&gt;80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">105</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">103</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">3,033</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">4,078</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+1,045</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+34.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">93.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">93.8%</td>
                        </tr>
                        <tr style="background: #fef3c7; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">Total/Avg</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">485</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">424</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">17,499</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">16,403</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center; background: #fee2e2; color: #991b1b;">-1,096</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center; background: #fee2e2; color: #991b1b;">-6.3%</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">36.6%</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">40.5%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Consolidated Driver Card Table -->
        <div style="margin-bottom: 25px;">
            <h5 style="color: #1f4e78; margin-bottom: 10px; font-size: 16px;">📋 All Partners - Driver Card Range Impact (Consolidated)</h5>
            <div style="overflow-x: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead style="background: #ea580c; color: white;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Driver Card % Range</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Partners Count</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Active Partners</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Jan Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Feb Target</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change #</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Change %</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg DC % (All)</th>
                            <th style="padding: 10px; border: 1px solid #d1d5db; text-align: center;">Avg DC % (Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">0-20%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">317</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">237</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">13,126</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">8,347</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-4,779</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-36.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">4.6%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">5.4%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">20-30%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">45</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">43</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,800</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,567</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-233</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 700;">-12.9%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">24.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">24.4%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">30-40%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">37</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">34</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">988</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,318</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+330</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+33.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">35.0%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">35.1%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">40-50%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">26</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">25</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">759</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">800</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+41</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+5.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">44.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">44.7%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">50-60%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">32</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">30</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">838</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">978</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+140</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+16.7%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">53.5%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">53.7%</td>
                        </tr>
                        <tr style="background: #ffffff;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">60-80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">43</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">43</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,127</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">1,402</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+275</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+24.4%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">69.3%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">69.3%</td>
                        </tr>
                        <tr style="background: #f9fafb;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">&gt;80%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">143</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">139</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">3,815</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">4,953</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+1,138</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 700;">+29.8%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">94.2%</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">94.3%</td>
                        </tr>
                        <tr style="background: #fef3c7; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">Total/Avg</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">643</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">551</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">22,453</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">19,365</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center; background: #fee2e2; color: #991b1b;">-3,088</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center; background: #fee2e2; color: #991b1b;">-13.8%</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">36.0%</td>
                            <td style="padding: 10px; border: 1px solid #f97316; text-align: center;">40.5%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

 </div>

</div>
<!-- END OVERVIEW TAB -->
</div>
<div class="tab-content active" id="executive">
<!-- Executive Summary - Advanced Management View -->
<div class="exec-hero">
    <div class="exec-hero-left">
        <h1>📋 Executive Summary</h1>
        <p>February 2026 Partner Capacity Analysis — High-Level Management View</p>
    </div>
    <div class="exec-hero-right">
        <div class="exec-hero-stat negative">
            <div class="value">-13.8%</div>
            <div class="label">MoM Change</div>
        </div>
        <div class="exec-hero-stat">
            <div class="value">19,365</div>
            <div class="label">Total Riders</div>
        </div>
        <div class="exec-hero-stat">
            <div class="value">551</div>
            <div class="label">Active Partners</div>
        </div>
    </div>
</div>

<!-- KPI Cards Grid -->
<div class="exec-kpi-grid">
    <div class="exec-kpi-card blue">
        <div class="icon">🚴</div>
        <div class="value">19,365</div>
        <div class="label">Total Riders (Feb)</div>
        <div class="change down">↓ 3,088 from Jan (22,453)</div>
    </div>
    <div class="exec-kpi-card green">
        <div class="icon">👥</div>
        <div class="value">551</div>
        <div class="label">Partners with Target</div>
        <div class="change">of 643 total partners</div>
    </div>
    <div class="exec-kpi-card amber">
        <div class="icon">📊</div>
        <div class="value">35.1</div>
        <div class="label">Avg Target/Partner</div>
        <div class="change">Stable vs January</div>
    </div>
    <div class="exec-kpi-card purple">
        <div class="icon">🆕</div>
        <div class="value">23</div>
        <div class="label">New Partners</div>
        <div class="change">17 out of assessment</div>
    </div>
    <div class="exec-kpi-card red">
        <div class="icon">⚠️</div>
        <div class="value">92</div>
        <div class="label">Zero-Target Partners</div>
        <div class="change down">3 Term, 70 Phased, 19 No Jan</div>
    </div>
    <div class="exec-kpi-card teal">
        <div class="icon">✅</div>
        <div class="value">252</div>
        <div class="label">Good Partners</div>
        <div class="change down">↓ 17.5% capacity vs Jan</div>
    </div>
</div>

<!-- Section Grid: Strategy + Highlights + Concerns -->
<div class="exec-section-grid">
    <div class="exec-card strategy">
        <h3>📈 February 2026 Capacity Strategy</h3>
        <ul>
            <li><strong>Re-balancing:</strong> Strategic redistribution, not uniform cuts</li>
            <li><strong>Overall Reduction:</strong> 13.8% below Jan (-3,088 riders)</li>
            <li><strong>Headcount Alignment:</strong> Restructure base for high avg scale</li>
            <li><strong>FR% Primary Gate:</strong> Low FR = no growth; severe = zero target</li>
            <li><strong>Performance-Based:</strong> Quality + scale → allocation</li>
            <li><strong>New Partner Protection:</strong> Shield new partners from sharp cuts</li>
        </ul>
        <div class="exec-mini-grid">
            <div class="exec-mini-card"><div class="num">-13.8%</div><div class="txt">Overall</div></div>
            <div class="exec-mini-card"><div class="num">92</div><div class="txt">Zero Target</div></div>
            <div class="exec-mini-card"><div class="num">FR%</div><div class="txt">Primary Gate</div></div>
        </div>
    </div>
    <div class="exec-card highlights">
        <h3>✅ Positive Highlights</h3>
        <ul>
            <li><strong>Bad Partners ↓72.6%:</strong> Dropped from 73 → 20 partners</li>
            <li><strong>Average Partners Stable:</strong> 262 partners at 8,414 riders (+1.0%)</li>
            <li><strong>Avg Target Held:</strong> 35.1 riders/partner despite reduction</li>
            <li><strong>Quality Improvement:</strong> Portfolio mix shifting toward compliance</li>
        </ul>
        <div class="exec-mini-grid">
            <div class="exec-mini-card" style="background: #d1fae5;"><div class="num" style="color: #059669;">-53</div><div class="txt">Bad Partners</div></div>
            <div class="exec-mini-card" style="background: #d1fae5;"><div class="num" style="color: #059669;">+1.0%</div><div class="txt">Avg Partners</div></div>
            <div class="exec-mini-card" style="background: #d1fae5;"><div class="num" style="color: #059669;">35.1</div><div class="txt">Avg Target</div></div>
        </div>
    </div>
    <div class="exec-card concerns">
        <h3>⚠️ Concerns &amp; Risks</h3>
        <ul>
            <li><strong>Overall Decline:</strong> Total capacity down 13.8% (-3,088)</li>
            <li><strong>Good Partners Down:</strong> target reduction by 6.6%</li>
            <li><strong>Zero-Target Impact:</strong> 70 partners phased partners with no allocation (Impact on partner experience)</li>
            <li><strong>Capacity Contraction:</strong> Fleet size reduction pressure</li>
        </ul>
        <div class="exec-mini-grid">
            <div class="exec-mini-card" style="background: #fee2e2;"><div class="num" style="color: #dc2626;">-3,088</div><div class="txt">Riders</div></div>
            <div class="exec-mini-card" style="background: #fee2e2;"><div class="num" style="color: #dc2626;">-17.5%</div><div class="txt">Good Cap.</div></div>
            <div class="exec-mini-card" style="background: #fee2e2;"><div class="num" style="color: #dc2626;">92</div><div class="txt">Zero Target</div></div>
        </div>
    </div>
    <div class="exec-card targets">
        <h3>🎯 Q1 2026 Success Targets</h3>
        <ul>
            <li><strong>Avg riders/partner:</strong> Raise from ~33 to ≥45</li>
            <li><strong>Stability:</strong> Lock 3-month bands; ≥70% peak retention</li>
            <li><strong>CPO impact:</strong> ≥0.39 SAR/order reduction</li>
            <li><strong>Controls:</strong> SOP + maker/checker; -10% manual adj.</li>
            <li><strong>Mix shift:</strong> Good 58-60%; Bad 5%; add driver card</li>
            <li><strong>Compliance:</strong> FR 98-100% by March</li>
            <li><strong>Scale top:</strong> ≥20 partners to ≥150 riders</li>
        </ul>
        <div class="exec-mini-grid">
            <div class="exec-mini-card" style="background: #ede9fe;"><div class="num" style="color: #7c3aed;">≥45</div><div class="txt">Avg Target</div></div>
            <div class="exec-mini-card" style="background: #ede9fe;"><div class="num" style="color: #7c3aed;">58-60%</div><div class="txt">Good Share</div></div>
            <div class="exec-mini-card" style="background: #ede9fe;"><div class="num" style="color: #7c3aed;">98%+</div><div class="txt">FR Target</div></div>
        </div>
    </div>
</div>

<!-- Footer Note -->
<div class="exec-footer-note">
    <strong>💡 Strategy Logic:</strong> Scale reliable partners, tighten controls, and shift mix toward compliant segments to raise output and reduce CPO. Focus on headcount alignment to maintain high average scale for partner profitability while protecting priority cities and high-quality performers.
</div>
</div><div class="tab-content" id="strategy">
<h2 style="margin-bottom: 25px; color: #1f4e78; font-size: 26px;">🎯 Future Strategy &amp; Roadmap</h2>
<div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 30px; margin-bottom: 30px; color: white; text-align: center;">
<h3 style="color: white; font-size: 24px; margin-bottom: 10px;">📅 Planning Horizon</h3>
<p style="font-size: 16px; margin: 0;">
<strong>Next Implementation Phase:</strong> February 2026 or Post-Ramadan (depending on timing)
                </p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
<div style="background: #dbeafe; border-left: 6px solid #3b82f6; border-radius: 12px; padding: 25px;">
<div style="display: flex; align-items: center; margin-bottom: 15px;">
<span style="font-size: 32px; margin-right: 15px;">🔧</span>
<h3 style="color: #1e40af; font-size: 18px; margin: 0;">1. Refine Logic &amp; Factors</h3>
</div>
<ul style="color: #1e3a8a; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li>Adjust performance and FR thresholds based on January results</li>
<li>Fine-tune coefficients using real performance data</li>
<li>Optimize balance between quality gates and growth targets</li>
</ul>
</div>
<div style="background: #d1fae5; border-left: 6px solid #10b981; border-radius: 12px; padding: 25px;">
<div style="display: flex; align-items: center; margin-bottom: 15px;">
<span style="font-size: 32px; margin-right: 15px;">🏙️</span>
<h3 style="color: #065f46; font-size: 18px; margin: 0;">2. City-Tier Minimums &amp; Order Targets</h3>
</div>
<ul style="color: #047857; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li>Set differentiated minimum targets per city tier (T1 vs T2)</li>
<li>Ensure city-level capacity aligns with demand</li>
<li>Balance service level requirements with budget constraints</li>
</ul>
</div>
<div style="background: #fef3c7; border-left: 6px solid #f59e0b; border-radius: 12px; padding: 25px;">
<div style="display: flex; align-items: center; margin-bottom: 15px;">
<span style="font-size: 32px; margin-right: 15px;">📋</span>
<h3 style="color: #92400e; font-size: 18px; margin: 0;">3. Partner Willingness &amp; Commitment</h3>
</div>
<ul style="color: #78350f; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li>Introduce PMM-recorded partner willingness sheet</li>
<li>Track recruitment plans and fleet investment commitments</li>
<li>Integrate as model signal post-Ramadan (when demand stabilizes)</li>
</ul>
</div>
<div style="background: #ede9fe; border-left: 6px solid #8b5cf6; border-radius: 12px; padding: 25px;">
<div style="display: flex; align-items: center; margin-bottom: 15px;">
<span style="font-size: 32px; margin-right: 15px;">🤝</span>
<h3 style="color: #5b21b6; font-size: 18px; margin: 0;">4. Long-Term Strategic Partnerships</h3>
</div>
<ul style="color: #6b21a8; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li>Share capacity targets 2–3 months in advance for key partners</li>
<li>Enable early hiring and operational planning</li>
<li>Build longer-term, win-win partnership relationships</li>
</ul>
</div>
</div>
<div style="background: white; border: 3px solid #ef4444; border-radius: 12px; padding: 30px; margin-bottom: 30px;">
<div style="display: flex; align-items: center; margin-bottom: 20px;">
<span style="font-size: 40px; margin-right: 15px;">🛡️</span>
<h3 style="color: #dc2626; font-size: 22px; margin: 0;">5. Partner Retention Focus (Critical Priority)</h3>
</div>
<div style="background: #fee2e2; border-left: 4px solid #dc2626; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
<p style="color: #991b1b; font-size: 15px; margin: 0; line-height: 1.8;">
<strong>⚠️ Priority Goal:</strong> Prevent loss of good, compliant partners due to unrealistic capacity reductions
                    </p>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
<div>
<h4 style="color: #1f4e78; margin-bottom: 10px;">✅ Protection Strategies</h4>
<ul style="color: #374151; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li>Provide reasonable, profitable targets for quality partners</li>
<li>Ensure targets support sustainable partner economics</li>
<li>Regular follow-up on partner concerns and feedback</li>
<li>Quick resolution of operational blockers</li>
</ul>
</div>
<div>
<h4 style="color: #1f4e78; margin-bottom: 10px;">🎯 Success Metrics</h4>
<ul style="color: #374151; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li>Partner satisfaction and engagement levels</li>
<li>Retention rate of "Good" performing partners</li>
<li>Partner profitability and earning potential</li>
<li>Long-term partnership commitment indicators</li>
</ul>
</div>
</div>
</div>
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 30px; color: white;">
<h3 style="color: white; font-size: 22px; margin-bottom: 20px; text-align: center;">📊 Implementation Timeline</h3>
<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
<div style="background: rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; text-align: center;">
<div style="font-size: 36px; margin-bottom: 10px;">📅</div>
<h4 style="color: white; font-size: 16px; margin-bottom: 10px;">Phase 1: Immediate</h4>
<p style="font-size: 13px; margin: 0;">
                            Logic refinement<br/>Partner retention focus
                        </p>
</div>
<div style="background: rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; text-align: center;">
<div style="font-size: 36px; margin-bottom: 10px;">🗓️</div>
<h4 style="color: white; font-size: 16px; margin-bottom: 10px;">Phase 2: Post-Ramadan</h4>
<p style="font-size: 13px; margin: 0;">
                            City-tier targets<br/>Willingness tracking
                        </p>
</div>
<div style="background: rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; text-align: center;">
<div style="font-size: 36px; margin-bottom: 10px;">📆</div>
<h4 style="color: white; font-size: 16px; margin-bottom: 10px;">Phase 3: Long-term</h4>
<p style="font-size: 13px; margin: 0;">
                            Strategic partnerships<br/>Advance planning (2-3 months)
                        </p>
</div>
</div>
</div>
<div style="background: #f0f9ff; border: 2px solid #3b82f6; border-radius: 12px; padding: 25px; margin-top: 30px;">
<h4 style="color: #1e40af; font-size: 18px; margin-bottom: 15px;">🎯 Strategic Outcomes</h4>
<div style="color: #1e3a8a; font-size: 14px; line-height: 2.0;">
<p style="margin-bottom: 10px;">By implementing these initiatives, we aim to achieve:</p>
<ul style="margin: 0; padding-left: 20px;">
<li><strong>Enhanced Predictability:</strong> Partners can plan ahead with confidence</li>
<li><strong>Improved Retention:</strong> Keep quality partners engaged and profitable</li>
<li><strong>Better Alignment:</strong> Partner capacity matches actual demand and capability</li>
<li><strong>Stronger Partnerships:</strong> Move from transactional to strategic relationships</li>
<li><strong>Operational Excellence:</strong> Right capacity, right place, right time</li>
</ul>
</div>
</div>
</div>
<!-- MONTHLY INSIGHTS TAB -->
<div class="tab-content" id="monthly">
<h2 style="margin-bottom: 15px; color: #1f4e78; font-size: 24px;">🗓️ Monthly insights (6 months comparison)</h2>
<div class="header-subtitle" style="margin-bottom: 15px;">Sep 2025 – Feb 2026 Structure (capacity target monthly overview)</div>
<div class="month-controls">
<button class="btn" onclick="changeMonth(-1)"><span>⬅️</span> Prev</button>
<select class="month-select" id="monthSelect" onchange="updateMonthlyView(this.value)">
<option value="All">🗓️ All months</option>
<option value="Aug-25">Aug-25</option>
<option value="Sep-25">Sep-25</option>
<option value="Oct-25">Oct-25</option>
<option value="Nov-25">Nov-25</option>
<option value="Dec-25">Dec-25</option>
<option value="Jan-26">Jan-26</option>
<option value="Feb-26">Feb-26</option>
</select>
<button class="btn" onclick="changeMonth(1)">Next <span>➡️</span></button>
</div>
<div style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: stretch;">
<span style="font-weight: 700; color: #1f4e78; font-size: 14px; margin-right: 4px; align-self: center;">What's inside:</span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">📊 Overview & Trends</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">KPIs, targets, scale & MoM</span></span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">🚗🏍️ Vehicle Type</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">Target split by vehicle</span></span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">📊 Partner Movement</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">Joiners, leavers & net flow</span></span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">👥 New vs Old</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">Tenure-based contribution</span></span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">🏙️ City Distribution</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">Allocation across cities</span></span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">🏢 Tier City (T1 vs T2)</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">Tier performance compare</span></span>
<span style="display: inline-flex; flex-direction: column; padding: 8px 14px; border: 1.5px solid #e5e7eb; border-radius: 12px; background: #f8fafc; min-width: 140px;"><span style="font-size: 12.5px; font-weight: 700; color: #1f2937;">🤝 Partner Willingness</span><span style="font-size: 10.5px; color: #6b7280; margin-top: 2px;">Sentiment & growth intent</span></span>
</div>
<h3 id="monthlyOverviewSection" style="margin: 10px 0 14px; color: #1f4e78; font-size: 18px;">📊 Monthly Overview &amp; Trends</h3>
<div id="monthlySectionKpis" class="kpi-grid" style="margin-bottom: 10px;">
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Active Partners (with target)</span>
<span class="kpi-icon">✅</span>
</div>
<div class="kpi-value" id="m_activePartners">—</div>
<div class="kpi-subtitle" id="m_activePartners_sub">—</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Total Partners</span>
<span class="kpi-icon">🏢</span>
</div>
<div class="kpi-value" id="m_totalPartners">—</div>
<div class="kpi-subtitle" id="m_totalPartners_sub">—</div>
</div>
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">Total Target</span>
<span class="kpi-icon">🎯</span>
</div>
<div class="kpi-value" id="m_totalTarget">—</div>
<div class="kpi-subtitle" id="m_totalTarget_sub">—</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Average Scale (riders / active partner)</span>
<span class="kpi-icon">📏</span>
</div>
<div class="kpi-value" id="m_avgScale">—</div>
<div class="kpi-subtitle" id="m_avgScale_sub">—</div>
</div>
</div>
<div class="kpi-grid">
<div class="kpi-card success">
<div class="kpi-header">
<span class="kpi-title"># Of Partners with target increase in a month (all)</span>
<span class="kpi-icon">📈</span>
</div>
<div class="kpi-value" id="m_incAny">—</div>
<div class="kpi-subtitle" id="m_incAny_sub">—</div>
</div>
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">MoM change (Increase all)</span>
<span class="kpi-icon">🔁</span>
</div>
<div class="kpi-value" id="m_inc40">—</div>
<div class="kpi-subtitle" id="m_inc40_sub">—</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Increase &gt; 20%</span>
<span class="kpi-icon">🔥</span>
</div>
<div class="kpi-value" id="m_inc20">—</div>
<div class="kpi-subtitle" id="m_inc20_sub">—</div>
</div>
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Increase &gt; 30%</span>
<span class="kpi-icon">🚀</span>
</div>
<div class="kpi-value" id="m_inc30">—</div>
<div class="kpi-subtitle" id="m_inc30_sub">—</div>
</div>
</div>
<div class="chart-grid" style="margin-top: 25px;">
<div id="monthlySectionTargetTrend" class="chart-container">
<div style="margin-bottom: 15px;">
<h3 class="chart-title">Monthly trend: Total Target &amp; Total Partners</h3>
<p style="color: #6b7280; font-size: 13px; margin: 5px 0 10px 0; font-style: italic;">Tracks total capacity targets and number of total partners month-over-month. Shows overall market size and partner base growth trends. Dual-axis visualization with combined insight indicator.</p>
</div>
<canvas id="monthlyTargetTrendChart"></canvas>
<div class="chart-info-panel" id="targetTrendInfo">Hover a month to see details.</div>
</div>
<div id="monthlySectionMoMChange" class="chart-container">
<div style="margin-bottom: 15px;">
<h3 class="chart-title">MoM Change in Total Target (%)</h3>
<p style="color: #6b7280; font-size: 13px; margin: 5px 0 0 0; font-style: italic;">Shows month‑over‑month % change in Total Target based on the Monthly Insights totals. Green = increase vs previous month, Red = decrease. First month is the baseline (no MoM).</p>
</div>
<canvas id="monthlyMoMChangeChartNew"></canvas>
</div>
</div>

<!-- VEHICLE TYPE BREAKDOWN SECTION -->
<div id="vehicleTypeMonthlySection" class="chart-container" style="margin-top: 25px;">
<h3 style="margin: 0 0 15px 0; color: #1f4e78; font-size: 18px;">🚗🏍️ Monthly Target by Vehicle Type (Cars vs Bikes)</h3>
<p style="color: #6b7280; font-size: 13px; margin: 0 0 15px 0; font-style: italic;">Shows capacity target breakdown by vehicle type across months. Cars dominate but Bikes share is growing (15.8% → 25.4%). Toggle between Monthly overview and City-level breakdown.</p>

<!-- View Toggle -->
<div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;">
    <button class="vehicle-monthly-view-btn active" data-view="monthly" onclick="switchVehicleMonthlyView('monthly')" style="padding: 8px 16px; border: 2px solid #3b82f6; border-radius: 8px; background: #3b82f6; color: white; font-weight: 600; cursor: pointer; font-size: 13px;">📅 Monthly View</button>
    <button class="vehicle-monthly-view-btn" data-view="city" onclick="switchVehicleMonthlyView('city')" style="padding: 8px 16px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 13px;">🏙️ City View</button>
</div>

<!-- Monthly View Panel -->
<div id="vehicleMonthlyViewPanel" style="display: block;">
    <!-- Vehicle Monthly View Slicers -->
    <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
        <button class="vehicle-monthly-trend-btn active" data-trend="combined" onclick="switchVehicleMonthlyTrend('combined')" style="padding: 6px 14px; border: 2px solid #8b5cf6; border-radius: 8px; background: #8b5cf6; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">📊 Cars vs Bikes Evolution</button>
        <button class="vehicle-monthly-trend-btn" data-trend="cars" onclick="switchVehicleMonthlyTrend('cars')" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">🚗 Cars Monthly Trend</button>
        <button class="vehicle-monthly-trend-btn" data-trend="bikes" onclick="switchVehicleMonthlyTrend('bikes')" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">🏍️ Bikes Monthly Trend</button>
    </div>
    
    <!-- KPI Summary Cards -->
    <div id="vehicleMonthlyKpiCards" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #3b82f6;">
            <div class="kpi-tooltip">
                <div class="tooltip-title">🚗 Avg Cars Explained</div>
                <div>Average monthly <span class="tooltip-highlight">car-based capacity targets</span> across all cities from September 2025 to February 2026.</div>
                <div class="tooltip-calc">22,493 = 134,957 total ÷ 6 months<br>(27,599 + 28,372 + 28,257 + 18,845 + 17,441 + 14,443) ÷ 6</div>
                <div>Represents <span class="tooltip-highlight">80.5%</span> of total vehicle capacity. Cars remain the dominant vehicle type.</div>
            </div>
            <div style="font-size: 11px; color: #1e40af; font-weight: 600;">🚗 Avg Cars (per month)</div>
            <div style="font-size: 22px; font-weight: 700; color: #1e40af;">22,493</div>
            <div style="font-size: 11px; color: #3b82f6;">80.5% of total</div>
            <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: 134,957</div>
        </div>
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #10b981;">
            <div class="kpi-tooltip">
                <div class="tooltip-title">🏍️ Avg Bikes Explained</div>
                <div>Average monthly <span class="tooltip-highlight">bike-based capacity targets</span> across all cities from September 2025 to February 2026.</div>
                <div class="tooltip-calc">5,447 = 32,679 total ÷ 6 months<br>(5,194 + 5,634 + 6,580 + 5,337 + 5,012 + 4,922) ÷ 6</div>
                <div>Represents <span class="tooltip-highlight">19.5%</span> of total vehicle capacity. Bikes share is growing steadily.</div>
            </div>
            <div style="font-size: 11px; color: #065f46; font-weight: 600;">🏍️ Avg Bikes (per month)</div>
            <div style="font-size: 22px; font-weight: 700; color: #065f46;">5,447</div>
            <div style="font-size: 11px; color: #10b981;">19.5% of total</div>
            <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: 32,679</div>
        </div>
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #f59e0b;">
            <div class="kpi-tooltip">
                <div class="tooltip-title">📈 Bikes Share Growth Explained</div>
                <div><span class="tooltip-highlight">+9.6pp Share Increase:</span> Bikes' share of total capacity grew from 15.8% (Sep) to 25.4% (Feb).</div>
                <div class="tooltip-calc">Share: 25.4% - 15.8% = +9.6 percentage points</div>
                <div><span class="tooltip-highlight">-5.2% Volume Change:</span> Bike count went from 5,194 (Sep) to 4,922 (Feb).</div>
                <div class="tooltip-calc">Volume: (4,922 - 5,194) / 5,194 × 100 = -5.2%</div>
                <div style="margin-top: 6px; font-size: 11px; opacity: 0.85;">Note: Share increased mainly due to cars declining faster (-47.7%) than bikes (-5.2%).</div>
            </div>
            <div style="font-size: 11px; color: #92400e; font-weight: 600;">📈 Bikes Share Growth (Sep→Feb)</div>
            <div style="font-size: 20px; font-weight: 700; color: #b45309;">+9.6pp <span style="font-size: 12px; font-weight: 600;">share increase</span></div>
            <div style="font-size: 13px; color: #d97706; font-weight: 600;">15.8% → 25.4% <span style="font-size: 10px; font-weight: 500;">bikes share</span></div>
            <div style="font-size: 9px; color: #64748b; margin-top: 2px;">Cars declined -47.7% vs Bikes -5.2%</div>
        </div>
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #8b5cf6;">
            <div class="kpi-tooltip">
                <div class="tooltip-title">📊 Avg Total Explained</div>
                <div>Average monthly <span class="tooltip-highlight">capacity targets for both Cars and Bikes</span> across all 17 cities.</div>
                <div class="tooltip-calc">27,939 = 167,636 total ÷ 6 months</div>
                <div>Period: <span class="tooltip-highlight">September 2025 → February 2026</span></div>
                <div style="margin-top: 6px; font-size: 11px; opacity: 0.85;">Monthly trend: Peaked at 34,837 (Nov) → dropped to 19,365 (Feb) due to seasonal adjustments.</div>
            </div>
            <div style="font-size: 11px; color: #5b21b6; font-weight: 600;">📊 Avg Total (per month)</div>
            <div style="font-size: 22px; font-weight: 700; color: #6d28d9;">27,939</div>
            <div style="font-size: 11px; color: #8b5cf6;">Sep - Feb 2026</div>
            <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: 167,636</div>
        </div>
    </div>
    <div style="height: 280px;">
        <canvas id="vehicleMonthlyChart"></canvas>
    </div>
</div>

<!-- City View Panel -->
<div id="vehicleCityViewPanel" style="display: none;">
    <!-- City Level Filter -->
    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
        <span style="font-weight: 600; color: #374151; font-size: 13px;">🏙️ City Level:</span>
        <button class="vehicle-city-level-monthly-btn active" data-level="all" onclick="filterVehicleCityLevel('all')" style="padding: 6px 14px; border: 2px solid #10b981; border-radius: 8px; background: #10b981; color: white; font-weight: 600; cursor: pointer; font-size: 12px;">All Cities</button>
        <button class="vehicle-city-level-monthly-btn" data-level="t1" onclick="filterVehicleCityLevel('t1')" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">T1 Cities</button>
        <button class="vehicle-city-level-monthly-btn" data-level="t2" onclick="filterVehicleCityLevel('t2')" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">T2 Cities</button>
        <button class="vehicle-city-level-monthly-btn" data-level="t1vst2" onclick="filterVehicleCityLevel('t1vst2')" style="padding: 6px 14px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 12px;">T1 vs T2</button>
    </div>
    
    <!-- Individual City Filter (shown when All Cities selected) -->
    <div id="vehicleCityIndividualFilter" style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 15px; flex-wrap: wrap;">
        <span style="font-weight: 600; color: #6b7280; font-size: 12px;">📍 City:</span>
        <button class="vehicle-city-monthly-btn active" data-city="all" onclick="filterVehicleCity('all')" style="padding: 4px 10px; border: 2px solid #8b5cf6; border-radius: 6px; background: #8b5cf6; color: white; font-weight: 600; cursor: pointer; font-size: 11px;">All</button>
        <button class="vehicle-city-monthly-btn" data-city="Riyadh" onclick="filterVehicleCity('Riyadh')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Riyadh</button>
        <button class="vehicle-city-monthly-btn" data-city="Jeddah" onclick="filterVehicleCity('Jeddah')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Jeddah</button>
        <button class="vehicle-city-monthly-btn" data-city="Dammam" onclick="filterVehicleCity('Dammam')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Dammam</button>
        <button class="vehicle-city-monthly-btn" data-city="Madinah" onclick="filterVehicleCity('Madinah')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Madinah</button>
        <button class="vehicle-city-monthly-btn" data-city="Makkah" onclick="filterVehicleCity('Makkah')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Makkah</button>
        <button class="vehicle-city-monthly-btn" data-city="Al Ahsa" onclick="filterVehicleCity('Al Ahsa')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Al Ahsa</button>
        <button class="vehicle-city-monthly-btn" data-city="Al Kharj" onclick="filterVehicleCity('Al Kharj')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Al Kharj</button>
        <button class="vehicle-city-monthly-btn" data-city="Abha" onclick="filterVehicleCity('Abha')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Abha</button>
        <button class="vehicle-city-monthly-btn" data-city="Taif" onclick="filterVehicleCity('Taif')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Taif</button>
        <button class="vehicle-city-monthly-btn" data-city="Buraydah" onclick="filterVehicleCity('Buraydah')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Buraydah</button>
        <button class="vehicle-city-monthly-btn" data-city="Jubail" onclick="filterVehicleCity('Jubail')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Jubail</button>
        <button class="vehicle-city-monthly-btn" data-city="Tabuk" onclick="filterVehicleCity('Tabuk')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Tabuk</button>
        <button class="vehicle-city-monthly-btn" data-city="Hail" onclick="filterVehicleCity('Hail')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Hail</button>
        <button class="vehicle-city-monthly-btn" data-city="Yanbu" onclick="filterVehicleCity('Yanbu')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Yanbu</button>
        <button class="vehicle-city-monthly-btn" data-city="Hafar Al Batin" onclick="filterVehicleCity('Hafar Al Batin')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Hafar Al Batin</button>
        <button class="vehicle-city-monthly-btn" data-city="Jazan" onclick="filterVehicleCity('Jazan')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Jazan</button>
        <button class="vehicle-city-monthly-btn" data-city="Najran" onclick="filterVehicleCity('Najran')" style="padding: 4px 10px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; font-weight: 600; cursor: pointer; font-size: 11px;">Najran</button>
    </div>
    
    <!-- Dynamic KPI Cards for City View -->
    <div id="vehicleCityKpiCards" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
        <!-- Will be populated dynamically -->
    </div>
    
    <!-- Vehicle Share Insights Panel (Donut Meters) - Only for All Cities, T1, T2 views -->
    <div id="vehicleShareInsightsPanel" style="display: none; margin-bottom: 20px;">
        <!-- Will be populated dynamically with donut meters -->
    </div>
    
    <!-- Single chart container -->
    <div id="vehicleSingleChartContainer" style="height: 280px;">
        <canvas id="vehicleCityChart"></canvas>
    </div>
    
    <!-- T1 vs T2 Side by Side container -->
    <div id="vehicleT1T2Container" style="display: none; gap: 15px;">
        <div style="flex: 1; background: #f8fafc; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0;">
            <h4 style="margin: 0 0 8px 0; color: #1e40af; font-size: 13px; text-align: center;">🏙️ T1 Cities (7 cities)</h4>
            <div style="height: 220px;"><canvas id="vehicleMonthlyT1Chart"></canvas></div>
        </div>
        <div style="flex: 1; background: #f0fdf4; padding: 12px; border-radius: 10px; border: 1px solid #d1fae5;">
            <h4 style="margin: 0 0 8px 0; color: #047857; font-size: 13px; text-align: center;">🌆 T2 Cities (10 cities)</h4>
            <div style="height: 220px;"><canvas id="vehicleMonthlyT2Chart"></canvas></div>
        </div>
    </div>
</div>

<!-- Expandable Data Table -->
<div style="margin-top: 20px;">
    <button onclick="toggleTable(this, 'vehicleMonthlyDataTable')" style="width: 100%; padding: 10px 15px; background: #f0f9ff; border: 2px solid #3b82f6; color: #1e40af; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 13px; text-align: left;">▼ Click to view detailed data table ▼</button>
    <div id="vehicleMonthlyDataTable" style="display: none; margin-top: 10px; max-height: 500px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
        <div id="vehicleTableContainer"></div>
    </div>
</div>
</div>
<!-- END VEHICLE TYPE BREAKDOWN SECTION -->

<div class="chart-grid">
<div id="monthlySectionAvgScale" class="chart-container">
<div style="text-align: center; margin-bottom: 12px;">
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 6px; flex-wrap: wrap;">
        <button class="slab-slicer-btn active" data-target="avgScale" data-view="perf">Performance</button>
        <button class="slab-slicer-btn" data-target="avgScale" data-view="size">Size</button>
    </div>
</div>
<div data-panel="avgScale" data-view="perf">
    <h3 class="chart-title">Average Scale by Performance Level</h3>
    <p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Average riders per partner by performance level (Good/Average/Bad) across months.</p>
    <div class="chart-toggle" id="avgScalePerfToggle">
        <button class="chart-toggle-btn active" data-view="trend">Trend</button>
        <button class="chart-toggle-btn" data-view="comparison">Comparison</button>
    </div>
    <canvas id="avgScalePerfChart"></canvas>
    <div class="chart-info-panel" id="avgScalePerfInfo">Hover a month to see details.</div>
</div>
<div data-panel="avgScale" data-view="size" style="display: none;">
    <h3 class="chart-title">Average Scale by Size Level</h3>
    <p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Average riders per partner by size level (Big/Mid/Small) across months.</p>
    <div class="chart-toggle" id="avgScaleSizeToggle">
        <button class="chart-toggle-btn active" data-view="trend">Trend</button>
        <button class="chart-toggle-btn" data-view="comparison">Comparison</button>
    </div>
    <canvas id="avgScaleSizeChart"></canvas>
    <div class="chart-info-panel" id="avgScaleSizeInfo">Hover a month to see details.</div>
    <!-- Expandable Table for Size Level -->
    <div style="margin-top: 15px;">
    <button onclick="toggleTable(this, 'avgScaleSizeTable')" style="width: 100%; padding: 10px 15px; background: #f0f9ff; border: 2px solid #3b82f6; color: #1e40af; font-weight: 600; border-radius: 6px; cursor: pointer; font-size: 13px; text-align: left;">▼ Click to view detailed data ▼</button>
    <div id="avgScaleSizeTable" style="display: none; margin-top: 10px; max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
    <thead style="position: sticky; top: 0; background: #3b82f6; color: white;">
    <tr>
    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Month</th>
    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Big</th>
    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Mid</th>
    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Small</th>
    </tr>
    </thead>
    <tbody>
    <tr style="background: #f9fafb;">
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Aug-25</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #f3f4f6;">101.6</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #f3f4f6;">56.7</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #f3f4f6;">34.5</td>
    </tr>
    <tr style="background: #ffffff;">
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Sep-25</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 600;">↑ 122.0</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 600;">↑ 61.0</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 600;">↑ 35.3</td>
    </tr>
    <tr style="background: #f9fafb;">
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Oct-25</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 106.8</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 55.0</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 29.9</td>
    </tr>
    <tr style="background: #ffffff;">
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Nov-25</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 105.4</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 50.9</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 28.0</td>
    </tr>
    <tr style="background: #f9fafb;">
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Dec-25</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 77.5</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 36.9</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 19.5</td>
    </tr>
    <tr style="background: #ffffff;">
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">Jan-26</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #fee2e2; color: #991b1b; font-weight: 600;">↓ 62.1</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 600;">↑ 38.8</td>
    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dcfce7; color: #166534; font-weight: 600;">↑ 26.0</td>
    </tr>
    </tbody>
    </table>
    </div>
    </div>
</div>
</div>
<div class="chart-container">
<div style="text-align: center; margin-bottom: 12px;">
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 6px; flex-wrap: wrap;">
        <button class="slab-slicer-btn active" data-target="monthlyExtras" data-view="mom">Avr scale overview</button>
        <button class="slab-slicer-btn" data-target="monthlyExtras" data-view="top">Top & Bottom partners with target</button>
    </div>
</div>
<div id="monthlySectionAvgScaleTrend" data-panel="monthlyExtras" data-view="mom">
    <h3 class="chart-title">Monthly trend: Average Scale</h3>
    <p style="color: #6b7280; font-size: 13px; margin: 5px 0 10px 0; font-style: italic;">Average riders per active partner each month. Indicates typical partner capacity and operational efficiency trends. Declining trend shows efficiency optimization efforts.</p>
    <canvas id="monthlyAvgScaleChart" style="margin-top: 10px;"></canvas>
    <div class="chart-info-panel" id="avgScaleOverviewInfo">Hover a month to see details.</div>
</div>
<div id="monthlySectionTopBottom" data-panel="monthlyExtras" data-view="top" style="display: none;">
    <h3 class="chart-title">📊 Top Movers - Biggest &amp; Smallest Partners by Riders</h3>
    <p style="color: #6b7280; font-size: 13px; margin: 5px 0 15px 0; font-style: italic;">
                            Shows Top 20 partners with highest rider count and Bottom 20 with lowest rider count. 
                            Includes actual riders and total target.
                        </p>
    <div style="margin-bottom: 15px;">
    <label for="topMoversMonthSelect" style="font-weight: 600; margin-right: 10px;">Select Month:</label>
    <select id="topMoversMonthSelect" onchange="updateTopMoversTable(this.value)" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
    <option value="Sep">Sep-25</option>
    <option value="Oct">Oct-25</option>
    <option value="Nov">Nov-25</option>
    <option value="Dec">Dec-25</option>
    <option value="Jan">Jan-26</option>
    <option selected="" value="Feb">Feb-26</option>
    </select>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <div>
    <h4 style="color: #059669; margin-bottom: 10px; font-size: 15px;">🏆 Top 20 Biggest Partners (by Riders)</h4>
    <div class="table-container" style="margin: 0; max-height: 400px; overflow-y: auto;">
    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
    <thead style="position: sticky; top: 0; background: #059669; z-index: 10;">
    <tr style="color: white;">
    <th style="padding: 6px; border: 1px solid #ddd;">#</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Partner</th>
    <th style="padding: 6px; border: 1px solid #ddd;">New/Old</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Actual Riders</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Target</th>
    </tr>
    </thead>
    <tbody id="topIncreasesTableBody"></tbody>
    </table>
    </div>
    </div>
    <div>
    <h4 style="color: #dc2626; margin-bottom: 10px; font-size: 15px;">📉 Bottom 20 Smallest Partners (by Riders)</h4>
    <div class="table-container" style="margin: 0; max-height: 400px; overflow-y: auto;">
    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
    <thead style="position: sticky; top: 0; background: #dc2626; z-index: 10;">
    <tr style="color: white;">
    <th style="padding: 6px; border: 1px solid #ddd;">#</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Partner</th>
    <th style="padding: 6px; border: 1px solid #ddd;">New/Old</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Actual Riders</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Target</th>
    </tr>
    </thead>
    <tbody id="topDecreasesTableBody"></tbody>
    </table>
    </div>
    </div>
    </div>
    <div style="margin-top: 12px; padding: 10px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
    <p style="margin: 0; font-size: 12px; color: #78350f;">
    <strong>💡 Note:</strong> Biggest partners = highest actual rider count. Smallest partners = lowest rider count. <strong>New partners</strong> = less than 3 months since their first delivery date with Keeta.
                            </p>
    </div>
    <div style="margin-top: 15px;">
    <h4 style="color: #0284c7; margin-bottom: 10px; font-size: 15px;">🏅 Top 20 Ranked Partners (by City Coverage)</h4>
    <div class="table-container" style="margin: 0; max-height: 400px; overflow-y: auto;">
    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
    <thead style="position: sticky; top: 0; background: #0284c7; z-index: 10;">
    <tr style="color: white;">
    <th style="padding: 6px; border: 1px solid #ddd;">#</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Partner</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Cities</th>
    <th style="padding: 6px; border: 1px solid #ddd;">New/Old</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Actual Riders</th>
    <th style="padding: 6px; border: 1px solid #ddd;">Target</th>
    </tr>
    </thead>
    <tbody id="topRankedTableBody"></tbody>
    </table>
    </div>
    <div style="margin-top: 8px; padding: 8px; background: #e0f2fe; border-left: 4px solid #0284c7; border-radius: 4px;">
    <p style="margin: 0; font-size: 11px; color: #0c4a6e;">
    <strong>📊</strong> Ranked by highest number of covered cities across the Kingdom (Feb only).
    </p>
    </div>
    </div>
</div>
</div>
</div>
<div class="chart-grid">
<div class="chart-container">
<div style="text-align: center; margin-bottom: 12px;">
    <div style="font-size: 16px; font-weight: 600; color: #111827;">Partners Share (Performance &amp; Size)</div>
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
        <button class="share-slicer-btn active" data-target="partnersShare" data-view="performance">Performance</button>
        <button class="share-slicer-btn" data-target="partnersShare" data-view="size">Size</button>
    </div>
</div>
<div id="partnersSharePerformance">
    <div style="margin-bottom: 15px;">
        <h3 class="chart-title">Partners performance mix (Good / Average / Bad)</h3>
        <p style="color: #6b7280; font-size: 13px; margin: 5px 0 10px 0; font-style: italic;">Distribution of partners by achievement level. Good (≥80% FR), Average (50-80% FR), Bad (&lt;50% FR). Shows quality composition evolution.</p>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; align-items: center;">
            <span style="font-size: 12px; font-weight: 600; color: #374151;">Quick Metrics:</span>
            <span style="background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">✓ Good Quality Trending</span>
            <span style="background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">⚠ Watch Average Decline</span>
        </div>
    </div>
    <canvas id="monthlyPerformanceMixChart"></canvas>
</div>
<div id="partnersShareSize" style="display: none;">
    <div style="margin-bottom: 15px;">
        <h3 class="chart-title">Partners size mix (Big / Mid / Small)</h3>
        <p style="color: #6b7280; font-size: 13px; margin: 5px 0 10px 0; font-style: italic;">Partner distribution by target size. Big partners show strong growth, Mid stable, Small declining. Strategic diversification needed.</p>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; align-items: center;">
            <span style="font-size: 12px; font-weight: 600; color: #374151;">Distribution Trend:</span>
            <span style="background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">📦 Big: Growing Base</span>
            <span style="background: #fecaca; color: #991b1b; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">📍 Small: Monitor</span>
        </div>
    </div>
    <canvas id="monthlySizeMixChart"></canvas>
</div>
</div>
<div class="chart-container">
<div style="text-align: center; margin-bottom: 12px;">
    <div style="font-size: 16px; font-weight: 600; color: #111827;">Total Target Share (Performance &amp; Size)</div>
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
        <button class="share-slicer-btn active" data-target="totalTargetShare" data-view="performance">Performance</button>
        <button class="share-slicer-btn" data-target="totalTargetShare" data-view="size">Size</button>
    </div>
</div>
<div id="totalTargetSharePerformance">
    <div style="margin-bottom: 15px;">
        <h3 class="chart-title">Total Riders Share by Performance Level (Good / Average / Bad)</h3>
        <p style="color: #6b7280; font-size: 13px; margin: 5px 0 10px 0; font-style: italic;">Distribution of total target riders share with % across performance levels. Shows capacity concentration by quality tier.</p>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; align-items: center;">
            <span style="font-size: 12px; font-weight: 600; color: #374151;">Capacity Allocation:</span>
            <span style="background: #e0f2fe; color: #1e40af; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">⭐ Share by Quality</span>
        </div>
    </div>
    <canvas id="monthlyRidersPerformanceMixChart"></canvas>
</div>
<div id="totalTargetShareSize" style="display: none;">
    <div style="margin-bottom: 15px;">
        <h3 class="chart-title">Total Riders Share by Size Level (Big / Mid / Small)</h3>
        <p style="color: #6b7280; font-size: 13px; margin: 5px 0 10px 0; font-style: italic;">Distribution of total target riders share with % across partner size levels. Shows concentration risk and diversification.</p>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; align-items: center;">
            <span style="font-size: 12px; font-weight: 600; color: #374151;">Concentration Risk:</span>
            <span style="background: #f3e8ff; color: #6b21a8; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">📊 Share by Size</span>
        </div>
    </div>
    <canvas id="monthlyRidersSizeMixChart"></canvas>
</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function setupButtonSlicer(targetKey, perfId, sizeId) {
        const buttons = Array.from(document.querySelectorAll(`.share-slicer-btn[data-target="${targetKey}"]`));
        const perf = document.getElementById(perfId);
        const size = document.getElementById(sizeId);
        if (!buttons.length || !perf || !size) return;

        function apply(view, animate) {
            // Hide both first
            perf.style.display = 'none';
            size.style.display = 'none';
            
            // Remove animation class
            perf.classList.remove('slicer-panel');
            size.classList.remove('slicer-panel');
            
            // Show the selected one with animation
            const target = (view === 'performance') ? perf : size;
            target.style.display = 'block';
            
            // Trigger animation if not initial load
            if (animate) {
                // Force reflow to restart animation
                void target.offsetWidth;
                target.classList.add('slicer-panel');
            }
            
            buttons.forEach(b => b.classList.toggle('active', b.dataset.view === view));
            if (window.monthlyCharts && Array.isArray(window.monthlyCharts)) {
                window.monthlyCharts.forEach(c => { try { c.resize(); } catch(e) {} });
            }
            // Resize Total Target Share charts
            if (targetKey === 'totalTargetShare') {
                setTimeout(function() {
                    if (view === 'performance' && window.m_ridersPerfMix) {
                        try { window.m_ridersPerfMix.resize(); } catch(e) {}
                    }
                    if (view === 'size' && window.m_ridersSizeMix) {
                        try { window.m_ridersSizeMix.resize(); } catch(e) {}
                    }
                }, 50);
            }
            // Resize Partners Share charts
            if (targetKey === 'partnersShare') {
                setTimeout(function() {
                    if (view === 'performance' && window.m_perfMix) {
                        try { window.m_perfMix.resize(); } catch(e) {}
                    }
                    if (view === 'size' && window.m_sizeMix) {
                        try { window.m_sizeMix.resize(); } catch(e) {}
                    }
                }, 50);
            }
        }

        buttons.forEach(b => {
            b.addEventListener('click', function() {
                apply(this.dataset.view, true);
            });
        });

        const defaultBtn = buttons.find(b => b.classList.contains('active')) || buttons[0];
        apply(defaultBtn.dataset.view || 'performance', false);
    }

    setupButtonSlicer('partnersShare', 'partnersSharePerformance', 'partnersShareSize');
    setupButtonSlicer('totalTargetShare', 'totalTargetSharePerformance', 'totalTargetShareSize');

    function setupPanelSlicer(targetKey, defaultView) {
        const buttons = Array.from(document.querySelectorAll(`.slab-slicer-btn[data-target="${targetKey}"]`));
        const panels = Array.from(document.querySelectorAll(`[data-panel="${targetKey}"]`));
        if (!buttons.length || !panels.length) return;

        function apply(view, animate) {
            buttons.forEach(b => b.classList.toggle('active', b.dataset.view === view));
            
            // Hide all panels first and remove animation class
            panels.forEach(p => {
                p.style.display = 'none';
                p.classList.remove('slicer-panel');
            });
            
            // Show the selected panel with animation
            panels.forEach(p => {
                if (p.dataset.view === view) {
                    p.style.display = 'block';
                    if (animate) {
                        // Force reflow to restart animation
                        void p.offsetWidth;
                        p.classList.add('slicer-panel');
                    }
                }
            });
            
            if (targetKey === 'willingness') {
                if (view === 'bars' && window.m_willingVsNotWilling) window.m_willingVsNotWilling.resize();
                if (view === 'trend' && window.m_willingnessTrend) window.m_willingnessTrend.resize();
            }
            if (targetKey === 'growth') {
                if (view === 'increase' && window.m_growthCategory) window.m_growthCategory.resize();
                if (view === 'decrease' && window.m_decreaseCategory) window.m_decreaseCategory.resize();
            }
            if (targetKey === 'avgScale') {
                if (view === 'perf' && window.m_avgScalePerf) window.m_avgScalePerf.resize();
                if (view === 'size' && window.m_avgScaleSize) window.m_avgScaleSize.resize();
            }
            if (targetKey === 'monthlyExtras') {
                if (view === 'mom' && window.m_mom) window.m_mom.resize();
            }
        }

        buttons.forEach(b => b.addEventListener('click', () => apply(b.dataset.view, true)));
        const activeBtn = buttons.find(b => b.classList.contains('active'));
        apply(activeBtn ? activeBtn.dataset.view : defaultView, false);
    }

    setupPanelSlicer('willingness', 'trend');
    setupPanelSlicer('growth', 'increase');
    setupPanelSlicer('avgScale', 'perf');
    setupPanelSlicer('monthlyExtras', 'mom');

    // Tier Tables Slicer Setup
    (function() {
        const buttons = document.querySelectorAll('.tier-table-slicer-btn');
        const panels = document.querySelectorAll('.tier-table-panel');
        
        function applyTierTableView(view, animate) {
            // Update button styles
            buttons.forEach(btn => {
                const isActive = btn.dataset.view === view;
                btn.classList.toggle('active', isActive);
                btn.style.background = isActive ? '#1e3a8a' : 'white';
                btn.style.color = isActive ? 'white' : '#374151';
                btn.style.borderColor = isActive ? '#1e3a8a' : '#d1d5db';
            });
            
            // Show/hide panels with animation
            panels.forEach(panel => {
                const isActive = panel.dataset.panel === view;
                panel.style.display = isActive ? 'block' : 'none';
                
                if (isActive && animate) {
                    panel.classList.remove('slicer-panel');
                    void panel.offsetWidth; // trigger reflow
                    panel.classList.add('slicer-panel');
                }
            });
        }
        
        buttons.forEach(btn => btn.addEventListener('click', () => applyTierTableView(btn.dataset.view, true)));
        applyTierTableView('tierOverview', false); // default view
    })();
});
</script>
<div id="monthlyHighlightsSection" class="highlight-box">
<h3>Highlights &amp; takeaways (selected month)</h3>
<ul id="monthlyHighlights">
<li>—</li>
</ul>
</div>

<!-- PARTNER MOVEMENT ANALYSIS SECTION -->
<div id="partnerMovementSection" style="margin-top: 35px;">
<details id="partnerMovementDetails" open style="background: #f8fafc; border: 2px solid #0891b2; border-radius: 10px; padding: 14px;">
    <summary style="cursor: pointer; font-size: 18px; font-weight: 700; color: #0891b2; display: flex; align-items: center; gap: 10px; list-style: none;">
        <span id="partnerMovementArrow" style="font-size: 18px; color: #0891b2;">▶</span>
        <span>📊 Partner Movement Analysis (Increase / Decrease / No Change) — click to expand/collapse</span>
    </summary>
<div style="margin-top: 14px;">
<p style="color: #6b7280; font-size: 13px; margin: 0 0 15px 0; font-style: italic;">Track partner target capacity movements: partners who increased, decreased, or maintained their targets across 6 months. Segmented by quality performance (Good ≥80% FR, Average 50-80% FR, Bad &lt;50% FR).</p>

<div id="partnerMovementTakeaway" style="margin-bottom: 20px; padding: 12px; background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%); border-left: 4px solid #06b6d4; border-radius: 6px;">
    <p style="margin: 0; font-size: 13px; color: #0e7490; font-weight: 600;">📊 Key Insight: <span id="partnerMovementInsight">Average of 195 partners increased targets monthly, while 243 decreased. December saw the sharpest decline (79 increases vs 457 decreases). February closed with 136 increases vs 284 decreases.</span></p>
</div>

<div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
    <label style="font-weight: 600; color: #1f2937;">Filter by:</label>
    <div id="movementQualityFilter" style="display: flex; gap: 8px;">
        <button class="movement-quality-chip active" data-quality="allPartners" style="padding: 8px 16px; border: 2px solid #06b6d4; background: #06b6d4; color: white; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">All Partners</button>
        <button class="movement-quality-chip" data-quality="all" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">All Partners with Performance</button>
        <button class="movement-quality-chip" data-quality="good" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Good Partners</button>
        <button class="movement-quality-chip" data-quality="average" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Average Partners</button>
        <button class="movement-quality-chip" data-quality="bad" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Bad Partners</button>
    </div>
</div>

<div class="chart-grid" style="margin-bottom: 20px;">
    <div class="chart-container">
        <h3 class="chart-title">Partner Movement by Type (Trend)</h3>
        <canvas id="partnerMovementTrendChart"></canvas>
    </div>
    <div class="chart-container">
        <h3 class="chart-title">Quality Distribution by Movement Type</h3>
        <canvas id="partnerMovementQualityChart"></canvas>
    </div>
</div>

<div style="margin-bottom: 15px; padding: 12px; background: #f0fdf4; border-left: 4px solid #10b981; border-radius: 6px;">
    <p style="margin: 0; font-size: 13px; color: #15803d; font-weight: 500;">ℹ️ <strong>Note:</strong> Table shows partners who completed assessment during each month. Partners without assessment data (new sign-ups, incomplete metrics) are excluded from these numbers.</p>
</div>

<details style="margin-bottom: 20px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px;">
    <summary style="cursor: pointer; font-size: 14px; font-weight: 600; color: #0891b2; display: flex; align-items: center; gap: 8px; list-style: none;">
        <span style="font-size: 14px;">▶</span>
        <span>📋 View Detailed Movement Table — click to expand</span>
    </summary>
    <div style="overflow-x: auto; margin-top: 12px;">
        <table id="partnerMovementTable" style="width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;font-size:12px;">
            <thead style="background: #0891b2; color: white;">
                <tr>
                    <th rowspan="2" style="padding: 10px; border: 1px solid #e5e7eb; text-align: left;">Month</th>
                    <th colspan="3" style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #10b981;">Total Increase</th>
                    <th colspan="3" style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #ef4444;">Total Decrease</th>
                    <th colspan="3" style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: #6b7280;">No change</th>
                    <th rowspan="2" style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">Subtotal</th>
                </tr>
                <tr>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #059669;">Good</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #059669;">Average</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #059669;">Bad</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dc2626;">Good</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dc2626;">Average</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #dc2626;">Bad</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #9ca3af;">Good</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #9ca3af;">Average</th>
                    <th style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; background: #9ca3af;">Bad</th>
                </tr>
            </thead>
            <tbody id="partnerMovementTableBody">
            </tbody>
        </table>
    </div>
</details>
</div>
</details>
</div>

<!-- NEW VS OLD PARTNERS ANALYSIS SECTION -->
<div id="partnerAgeSection" style="margin-top: 35px;">
<details id="partnerAgeDetails" open style="background: #f8fafc; border: 2px solid #1e3a8a; border-radius: 10px; padding: 14px;">
    <summary style="cursor: pointer; font-size: 18px; font-weight: 700; color: #1e3a8a; display: flex; align-items: center; gap: 10px; list-style: none;">
        <span id="partnerAgeArrow" style="font-size: 18px; color: #1e3a8a;">▶</span>
        <span>👥 New vs Old Partners Analysis (by Partner Age) — click to expand/collapse</span>
    </summary>
<div style="margin-top: 14px;">
<p style="color: #6b7280; font-size: 13px; margin: 0 0 15px 0; font-style: italic;">Analyze partner composition by tenure: newly onboarded (&lt;1 month), recently added (&lt;3 months), and established (&gt;3 months). Compare capacity (Target), engagement (Active Count), scale efficiency (Avg Scale), and quality breakdown across all 6 months. Green/Red arrows show month-over-month trends.</p>

<div id="partnerAgeTakeaway" style="margin-bottom: 20px; padding: 12px; background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%); border-left: 4px solid #2563eb; border-radius: 6px;">
    <p style="margin: 0; font-size: 13px; color: #1e40af; font-weight: 600;">📊 Key Insight: <span id="partnerAgeInsight">Loading...</span></p>
</div>

<div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
<label style="font-weight: 600; color: #1f2937;">Compare Months:</label>
<select id="partnerAgeMonthFilter1" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
<option value="">-- Month 1 --</option>
<option value="0">Sep-25</option>
<option value="1">Oct-25</option>
<option value="2">Nov-25</option>
<option value="3">Dec-25</option>
<option value="4">Jan-26</option>
<option value="5">Feb-26</option>
</select>
<select id="partnerAgeMonthFilter2" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
<option value="">-- Month 2 --</option>
<option value="0">Sep-25</option>
<option value="1">Oct-25</option>
<option value="2">Nov-25</option>
<option value="3">Dec-25</option>
<option value="4">Jan-26</option>
<option value="5" selected>Feb-26</option>
</select>
<button id="partnerAgeCompareBtn" style="padding: 8px 20px; background: #059669; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Compare</button>
<button id="partnerAgeResetBtn" style="padding: 8px 20px; background: #6b7280; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Reset to All Months</button>
</div>

<div style="margin-bottom: 20px;">
<label style="font-weight: 600; color: #1f2937; display: block; margin-bottom: 10px;">Filter by Partner Age:</label>
<div style="display: flex; gap: 10px; flex-wrap: wrap;">
    <button class="age-category-chip active" data-category="all" style="padding: 8px 16px; border: 2px solid #1e3a8a; background: #1e3a8a; color: white; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">All Categories</button>
    <button class="age-category-chip" data-category="New <1 month" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">New &lt;1 month</button>
    <button class="age-category-chip" data-category="New <3 months" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">New &lt;3 months</button>
    <button class="age-category-chip" data-category="Old >3 months" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Old &gt;3 months</button>
</div>
</div>

<div class="chart-grid" style="margin-bottom: 20px;">
<div class="chart-container">
<h3 class="chart-title">Total Partners by Age (Trend)</h3>
<canvas id="partnerAgeTrendChart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">Avg Scale by Partner Age (Trend)</h3>
<canvas id="partnerAgeScaleChart"></canvas>
</div>
</div>

<div style="overflow-x: auto; margin-bottom: 20px;">
<table id="partnerAgeTable" style="width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;">
<tbody></tbody>
</table>
</div>
</div>
</details>
</div>
<script>
// Arrow toggles for Monthly Insights expandable sections
(function() {
    const sections = [
        { detailsId: 'partnerMovementDetails', arrowId: 'partnerMovementArrow' },
        { detailsId: 'partnerAgeDetails', arrowId: 'partnerAgeArrow' },
        { detailsId: 'cityWiseDetails', arrowId: 'cityWiseArrow' },
        { detailsId: 'tierCityDetails', arrowId: 'tierCityArrow' },
    ];
    sections.forEach(({ detailsId, arrowId }) => {
        const detailsEl = document.getElementById(detailsId);
        const arrowEl = document.getElementById(arrowId);
        if (detailsEl && arrowEl) {
            const setArrow = () => { arrowEl.textContent = detailsEl.open ? '▼' : '▶'; };
            detailsEl.addEventListener('toggle', setArrow);
            setArrow();
        }
    });
})();
</script>

<!-- CITY-WISE PERFORMANCE SECTION -->
<div id="cityWiseSection" style="margin-top: 35px;">
<details id="cityWiseDetails" open style="background: #f8fafc; border: 2px solid #059669; border-radius: 10px; padding: 14px;">
    <summary style="cursor: pointer; font-size: 18px; font-weight: 700; color: #059669; display: flex; align-items: center; gap: 10px; list-style: none;">
        <span id="cityWiseArrow" style="font-size: 18px; color: #059669;">▶</span>
        <span>🏙️ City-wise Target Distribution (with MoM trends) — click to expand/collapse</span>
    </summary>
<div style="margin-top: 14px;">
<p style="color: #6b7280; font-size: 13px; margin: 0 0 15px 0; font-style: italic;">City-level analysis showing total target riders and active partners (with targets) across all 6 months (Sep–Feb). Green/Red arrows indicate month-over-month percentage changes. Filter by two months to compare city performance trends.</p>

<div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
<label style="font-weight: 600; color: #1f2937;">Compare Months:</label>
<select id="cityMonthFilter1" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
<option value="">-- Month 1 --</option>
<option value="0">Sep-25</option>
<option value="1">Oct-25</option>
<option value="2">Nov-25</option>
<option value="3">Dec-25</option>
<option value="4">Jan-26</option>
<option value="5">Feb-26</option>
</select>
<select id="cityMonthFilter2" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
<option value="">-- Month 2 --</option>
<option value="0">Sep-25</option>
<option value="1">Oct-25</option>
<option value="2">Nov-25</option>
<option value="3">Dec-25</option>
<option value="4">Jan-26</option>
<option value="5" selected>Feb-26</option>
</select>
<button id="cityCompareBtn" style="padding: 8px 20px; background: #059669; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Compare</button>
</div>

<div style="margin-bottom: 20px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
<label style="font-weight: 600; color: #1f2937; display: block; margin-bottom: 12px;">Filter by City (Slicer):</label>

<div style="margin-bottom: 15px;">
<div style="font-weight: 600; font-size: 13px; color: #374151; margin-bottom: 8px;">🔵 T1 Cities (Major Markets)</div>
<div id="t1CityChips" style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px;">
<button class="city-chip" data-city="Riyadh" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Riyadh</button>
<button class="city-chip" data-city="Jeddah" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Jeddah</button>
<button class="city-chip" data-city="Dammam" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Dammam</button>
<button class="city-chip" data-city="Medina" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Medina</button>
<button class="city-chip" data-city="Makkah" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Makkah</button>
<button class="city-chip" data-city="Al Kharj" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Al Kharj</button>
<button class="city-chip" data-city="Al Ahsa" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Al Ahsa</button>
</div>
</div>

<div>
<div style="font-weight: 600; font-size: 13px; color: #374151; margin-bottom: 8px;">🟢 T2 Cities (Secondary Markets)</div>
<div id="t2CityChips" style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px;">
<button class="city-chip" data-city="Abha" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Abha</button>
<button class="city-chip" data-city="Buraydah" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Buraydah</button>
<button class="city-chip" data-city="Hafar Al Batin" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Hafar Al Batin</button>
<button class="city-chip" data-city="Hail" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Hail</button>
<button class="city-chip" data-city="Jazan" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Jazan</button>
<button class="city-chip" data-city="Jubail" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Jubail</button>
<button class="city-chip" data-city="Najran" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Najran</button>
<button class="city-chip" data-city="Tabuk" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Tabuk</button>
<button class="city-chip" data-city="Taif" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Taif</button>
<button class="city-chip" data-city="Yanbu" style="padding: 6px 12px; background: #e5e7eb; color: #1f2937; border: 2px solid #d1d5db; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.2s;">Yanbu</button>
</div>
</div>

<div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
<button id="cityFilterBtn" style="padding: 8px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s;">Apply Filter</button>
<button id="cityFilterResetBtn" style="padding: 8px 20px; background: #9ca3af; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s;">Clear All</button>
</div>
</div>

<div class="chart-grid" style="margin-bottom: 20px;">
<div class="chart-container">
<h3 class="chart-title">Total Target by City (Trend)</h3>
<canvas id="cityTargetTrendChart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">Active Partners by City (Trend)</h3>
<canvas id="cityPartnersChart"></canvas>
</div>
</div>

<div id="avgScaleCardsRow" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:10px;">
  <div id="cardHighestScale" style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:10px 12px;">
    <div style="font-size:10px;color:#6b7280;font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Highest Avg Scale</div>
    <div style="font-size:18px;font-weight:700;color:#065f46;margin:2px 0;" id="cardHighVal">—</div>
    <div style="font-size:11px;color:#374151;" id="cardHighCity">—</div>
    <div style="font-size:11px;font-weight:600;margin-top:2px;" id="cardHighMom">—</div>
  </div>
  <div id="cardLowestScale" style="background:#fef2f2;border:1px solid #fecaca;border-radius:8px;padding:10px 12px;">
    <div style="font-size:10px;color:#6b7280;font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Lowest Avg Scale</div>
    <div style="font-size:18px;font-weight:700;color:#991b1b;margin:2px 0;" id="cardLowVal">—</div>
    <div style="font-size:11px;color:#374151;" id="cardLowCity">—</div>
    <div style="font-size:11px;font-weight:600;margin-top:2px;" id="cardLowMom">—</div>
  </div>
  <div id="cardBestMom" style="background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;padding:10px 12px;">
    <div style="font-size:10px;color:#6b7280;font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Best MoM Improver</div>
    <div style="font-size:18px;font-weight:700;color:#1e40af;margin:2px 0;" id="cardBestMomVal">—</div>
    <div style="font-size:11px;color:#374151;" id="cardBestMomCity">—</div>
    <div style="font-size:11px;color:#6b7280;" id="cardBestMomScale">—</div>
  </div>
  <div id="cardWorstMom" style="background:#fefce8;border:1px solid #fde68a;border-radius:8px;padding:10px 12px;">
    <div style="font-size:10px;color:#6b7280;font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Steepest MoM Decline</div>
    <div style="font-size:18px;font-weight:700;color:#92400e;margin:2px 0;" id="cardWorstMomVal">—</div>
    <div style="font-size:11px;color:#374151;" id="cardWorstMomCity">—</div>
    <div style="font-size:11px;color:#6b7280;" id="cardWorstMomScale">—</div>
  </div>
</div>
<div class="chart-container" style="margin-bottom: 16px;">
<h3 class="chart-title">City-wise Avg Scale Trend (Target ÷ Partners)</h3>
<canvas id="cityCombinedTrendChart" style="max-height: 320px;"></canvas>
</div>

<div class="table-container" style="margin-bottom: 20px;">
<h4 style="color: #1f2937; margin: 0 0 10px 0;">City-wise Monthly Target & Partners Overview</h4>
<p style="color: #6b7280; font-size: 12px; margin: 0 0 10px 0; font-style: italic;">Complete view of all cities across 6 months showing partner counts and total target capacity. MoM % change calculated from previous month.</p>
<table id="cityWiseTable" style="width: 100%; border-collapse: collapse; font-size: 12px;"></table>
</div>
</div>
</details>
</div>

<!-- TIER CITY (T1 vs T2) EXPANDABLE SECTION -->
<div id="tierCitySection" style="margin-top: 35px;">
<details id="tierCityDetails" open style="background: #f8fafc; border: 2px solid #1e3a8a; border-radius: 10px; padding: 14px;">
    <summary style="cursor: pointer; font-size: 18px; font-weight: 700; color: #1e3a8a; display: flex; align-items: center; gap: 10px; list-style: none;">
        <span id="tierCityArrow" style="font-size: 18px; color: #1e3a8a;">▶</span>
        <span>📊 Tier City Overview (T1 vs T2) — click to expand/collapse</span>
    </summary>
<div style="margin-top: 14px;">
<div class="info-box" style="background: #e0f2fe; border-left: 4px solid #2563eb; margin-bottom: 12px;">
                    <p style="margin: 0; font-size: 14px; color: #1d4ed8;">
                        <strong>Takeaway:</strong> T1 drives ~90.2% of targets while T2 holds ~9.8% in Feb. T1 shows a sharper pullback in Feb while T2 stays relatively flat; maintain T2 density (avg scale ~21.0) and prioritize T1 recovery.
                    </p>
                </div>
                <div class="info-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; margin-bottom: 18px;">
                    <p style="margin: 0; font-size: 13px; color: #92400e;">
                        <strong>📌 Highlighted Arrows:</strong> Green ↑ or Red ↓ with percentage show <strong>month-over-month change</strong> for each metric within the same tier (T1 compared to previous T1, T2 to previous T2). This helps identify growth or decline trends for each tier independently.
</p>
</div>

<!-- Tier Filter Slicer -->
<div style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <label style="font-weight: 600; color: #1f2937;">Filter by Tier:</label>
                    <div id="tierFilterContainer" style="display: flex; gap: 8px;">
                        <button class="tier-filter-chip" data-tier="both" style="padding: 8px 16px; border: 2px solid #3b82f6; background: #3b82f6; color: white; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Both (T1 & T2)</button>
                        <button class="tier-filter-chip" data-tier="t1" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">T1 Only</button>
                        <button class="tier-filter-chip" data-tier="t2" style="padding: 8px 16px; border: 2px solid #d1d5db; background: white; color: #374151; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">T2 Only</button>
                    </div>
                </div>

<div class="chart-grid" style="margin-bottom: 16px;">
<div class="chart-container">
<h3 class="chart-title">T1 vs T2 Total Target (with combined trend)</h3>
<canvas id="tierTargetChart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">Partners with Target (T1/T2) + Total Trend</h3>
<canvas id="tierPartnersChart"></canvas>
</div>
</div>

<!-- Tier Tables Slicer Navigation -->
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 14px;">
                        <button class="tier-table-slicer-btn" data-view="tierOverview" style="padding: 10px 18px; background: #1e3a8a; color: white; border: 2px solid #1e3a8a; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s ease;">📋 Tier Overview</button>
                        <button class="tier-table-slicer-btn" data-view="partnerPerf" style="padding: 10px 18px; background: white; color: #374151; border: 2px solid #d1d5db; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s ease;">👥 Partners — Performance</button>
                        <button class="tier-table-slicer-btn" data-view="partnerScale" style="padding: 10px 18px; background: white; color: #374151; border: 2px solid #d1d5db; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s ease;">📊 Partners — Scale</button>
                        <button class="tier-table-slicer-btn" data-view="targetPerf" style="padding: 10px 18px; background: white; color: #374151; border: 2px solid #d1d5db; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s ease;">🎯 Target — Performance</button>
                        <button class="tier-table-slicer-btn" data-view="targetScale" style="padding: 10px 18px; background: white; color: #374151; border: 2px solid #d1d5db; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s ease;">📈 Target — Scale</button>
                    </div>
                </div>

                <!-- Panel 1: Tier Overview by Month -->
                <div class="tier-table-panel slicer-panel" data-panel="tierOverview" style="display: block;">
                    <div class="table-container" style="margin-bottom: 16px;">
                        <h4 style="color: #1f2937; margin: 0 0 5px 0;">Tier Overview by Month (counts shown with share%)</h4>
                        <p style="color: #6b7280; font-size: 12px; margin: 0 0 10px 0; font-style: italic;">Comprehensive view of T1 vs T2 cities showing monthly targets, active partners, partners with targets, and average scale. Weighted Avg Scale represents overall market capacity efficiency. Last row shows 6-month averages.</p>
                        <table id="tierOverviewTable" style="width: 100%; border-collapse: collapse; font-size: 12px;"></table>
                    </div>
                </div>

                <!-- Panel 2: Partners with Target — Performance Split -->
                <div class="tier-table-panel" data-panel="partnerPerf" style="display: none;">
                    <div class="table-container" style="margin-bottom: 16px;">
                        <h4 style="color: #1f2937; margin: 0 0 5px 0;">Partners with Target — Performance Split (good / average / bad)</h4>
                        <p style="color: #6b7280; font-size: 12px; margin: 0 0 10px 0; font-style: italic;">Distribution of partners with targets by performance level across T1 and T2 cities. Good (≥80% FR), Average (50-80% FR), Bad (&lt;50% FR). Shows quality mix differences between tier cities.</p>
                        <table id="tierPerfTable" style="width: 100%; border-collapse: collapse; font-size: 12px;"></table>
                    </div>
                </div>

                <!-- Panel 3: Partners with Target — Scale Split -->
                <div class="tier-table-panel" data-panel="partnerScale" style="display: none;">
                    <div class="table-container" style="margin-bottom: 16px;">
                        <h4 style="color: #1f2937; margin: 0 0 5px 0;">Partners with Target — Scale Split (big / mid / small)</h4>
                        <p style="color: #6b7280; font-size: 12px; margin: 0 0 10px 0; font-style: italic;">Partner count distribution by size level (Big/Mid/Small) for T1 vs T2 cities. Big partners have high order proportion (&gt;0.7) and scale; Small have low proportion (&lt;0.1) or riders; Mid are in between. Reveals partner base structure differences.</p>
                        <table id="tierScaleTable" style="width: 100%; border-collapse: collapse; font-size: 12px;"></table>
                    </div>
                </div>

                <!-- Panel 4: Total Target — Performance Split -->
                <div class="tier-table-panel" data-panel="targetPerf" style="display: none;">
                    <div class="table-container" style="margin-bottom: 12px;">
                        <h4 style="color: #1f2937; margin: 0 0 5px 0;">Total Target — Performance Split (with share%)</h4>
                        <p style="color: #6b7280; font-size: 12px; margin: 0 0 10px 0; font-style: italic;">Distribution of total target riders by performance level (Good/Average/Bad) across T1 and T2 cities. Shows how capacity volume is distributed across quality tiers and city types.</p>
                        <table id="tierTargetPerfTable" style="width: 100%; border-collapse: collapse; font-size: 12px;"></table>
                    </div>
                </div>

                <!-- Panel 5: Total Target — Scale Split -->
                <div class="tier-table-panel" data-panel="targetScale" style="display: none;">
                    <div class="table-container" style="margin-bottom: 8px;">
                        <h4 style="color: #1f2937; margin: 0 0 5px 0;">Total Target — Scale Split (with share%)</h4>
                        <p style="color: #6b7280; font-size: 12px; margin: 0 0 10px 0; font-style: italic;">Distribution of total target riders by partner size level (Big/Mid/Small) for T1 vs T2 cities. Reveals how capacity volume concentrates across different partner scales and tier types.</p>
                        <table id="tierTargetScaleTable" style="width: 100%; border-collapse: collapse; font-size: 12px;"></table>
                    </div>
                </div>
</div>
</details>
</div>
<!-- PARTNER WILLING ANALYSIS SECTION -->
<div style="margin-top: 20px;">
<h3 id="monthlyWillingSection" style="color: #1f4e78; margin-bottom: 10px; font-size: 18px; border-bottom: 3px solid #3b82f6; padding-bottom: 6px;">
                    📊 Partner Willing Analysis (Monthly Comparison)
                </h3>
<div class="info-box" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 4px solid #3b82f6; margin-bottom: 12px; border-radius: 0 8px 8px 0; padding: 8px 14px;">
<p style="margin: 0; font-size: 14px; color: #1e40af; line-height: 1.6;">
<strong style="color: #1e3a5f;">📋 Definition:</strong> "Willing Partners" are those who <span style="background: #d1fae5; color: #065f46; padding: 2px 8px; border-radius: 4px; font-weight: 600;">increased their capacity target</span> compared to the previous month. 
                        "Not-Willing Partners" have <span style="background: #fee2e2; color: #b91c1c; padding: 2px 8px; border-radius: 4px; font-weight: 600;">decreased or maintained</span> the same target (Target Increase ≤ 0).
                    </p>
</div>

<!-- Summary KPI Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 10px; margin-bottom: 14px;">
    <!-- Latest Month Willing % -->
    <div style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-radius: 10px; padding: 12px 14px; border: 1px solid #a7f3d0; box-shadow: 0 2px 6px rgba(16, 185, 129, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div style="font-size: 10px; color: #059669; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Feb-26 Willing %</div>
                <div style="font-size: 22px; font-weight: 800; color: #065f46; margin: 3px 0;">24.6%</div>
            </div>
            <div style="background: #fee2e2; color: #dc2626; padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: 700;">↓ -8.1pp</div>
        </div>
        <div style="margin-top: 4px; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 10px; color: #6b7280;">vs Jan-26:</span>
            <span style="font-size: 11px; font-weight: 600; color: #374151;">32.7%</span>
            <svg width="40" height="16" style="margin-left: auto;">
                <polyline points="0,8 8,6 16,12 24,4 32,10 40,14" fill="none" stroke="#059669" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </div>
    </div>
    
    <!-- Latest Month Willing Count -->
    <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 10px; padding: 12px 14px; border: 1px solid #bbf7d0; box-shadow: 0 2px 6px rgba(34, 197, 94, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div style="font-size: 10px; color: #16a34a; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Feb-26 Willing</div>
                <div style="font-size: 22px; font-weight: 800; color: #15803d; margin: 3px 0;">130</div>
            </div>
            <div style="background: #fee2e2; color: #dc2626; padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: 700;">↓ -35.3%</div>
        </div>
        <div style="margin-top: 4px; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 10px; color: #6b7280;">vs Jan-26:</span>
            <span style="font-size: 11px; font-weight: 600; color: #374151;">201</span>
            <svg width="40" height="16" style="margin-left: auto;">
                <polyline points="0,4 8,2 16,1 24,12 32,6 40,10" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </div>
    </div>
    
    <!-- Latest Month Not-Willing Count -->
    <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-radius: 10px; padding: 12px 14px; border: 1px solid #fecaca; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div style="font-size: 10px; color: #dc2626; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Feb-26 Not-Willing</div>
                <div style="font-size: 22px; font-weight: 800; color: #b91c1c; margin: 3px 0;">398</div>
            </div>
            <div style="background: #dcfce7; color: #16a34a; padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: 700;">↓ -3.6%</div>
        </div>
        <div style="margin-top: 4px; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 10px; color: #6b7280;">vs Jan-26:</span>
            <span style="font-size: 11px; font-weight: 600; color: #374151;">413</span>
            <svg width="40" height="16" style="margin-left: auto;">
                <polyline points="0,6 8,5 16,4 24,2 32,5 40,6" fill="none" stroke="#dc2626" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </div>
    </div>
    
    <!-- New Partners -->
    <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 10px; padding: 12px 14px; border: 1px solid #bfdbfe; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div style="font-size: 10px; color: #2563eb; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Feb-26 New Partners</div>
                <div style="font-size: 22px; font-weight: 800; color: #1e40af; margin: 3px 0;">23</div>
            </div>
            <div style="background: #dcfce7; color: #16a34a; padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: 700;">↑ +109.1%</div>
        </div>
        <div style="margin-top: 4px; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 10px; color: #6b7280;">vs Jan-26:</span>
            <span style="font-size: 11px; font-weight: 600; color: #374151;">11</span>
            <svg width="40" height="16" style="margin-left: auto;">
                <polyline points="0,4 8,2 16,1 24,12 32,14 40,8" fill="none" stroke="#2563eb" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </div>
    </div>
    
    <!-- 5-Month Average -->
    <div style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border-radius: 10px; padding: 12px 14px; border: 1px solid #e9d5ff; box-shadow: 0 2px 6px rgba(139, 92, 246, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div style="font-size: 10px; color: #7c3aed; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">5-Mo Avg Willing %</div>
                <div style="font-size: 22px; font-weight: 800; color: #6d28d9; margin: 3px 0;">30.0%</div>
            </div>
            <div style="background: #f3e8ff; color: #7c3aed; padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: 700;">AVG</div>
        </div>
        <div style="margin-top: 4px; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 10px; color: #6b7280;">Range:</span>
            <span style="font-size: 11px; font-weight: 600; color: #374151;">12.8% - 40.5%</span>
        </div>
    </div>
</div>

<!-- Enhanced Summary Table -->
<div class="table-container" style="margin-bottom: 20px; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 12px rgba(0,0,0,0.08);">
<table style="width: 100%; border-collapse: collapse;">
<thead>
<tr style="background: linear-gradient(135deg, #1e5a8e 0%, #1e3a5f 100%);">
<th style="padding: 9px 12px; text-align: left; border: none; color: white; font-size: 12px; font-weight: 700;">Month</th>
<th style="padding: 9px 12px; text-align: center; border: none; color: white; font-size: 12px; font-weight: 700;">Total Partners</th>
<th style="padding: 9px 12px; text-align: center; border: none; color: white; font-size: 12px; font-weight: 700;">✓ Willing (>0)</th>
<th style="padding: 9px 12px; text-align: center; border: none; color: white; font-size: 12px; font-weight: 700;">✗ Not-Willing (≤0)</th>
<th style="padding: 9px 12px; text-align: center; border: none; color: white; font-size: 12px; font-weight: 700;">🆕 New Partners</th>
<th style="padding: 9px 12px; text-align: center; border: none; color: white; font-size: 12px; font-weight: 700;">Willing %</th>
<th style="padding: 9px 12px; text-align: center; border: none; color: white; font-size: 12px; font-weight: 700;">Not-Willing %</th>
</tr>
</thead>
<tbody>
<tr style="background: #f8fafc; transition: all 0.2s;" onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='#f8fafc'">
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a5f; font-size: 12px;">
    <span style="display: inline-flex; align-items: center; gap: 6px;">
        <span style="background: #e0e7ff; color: #4338ca; padding: 1px 6px; border-radius: 4px; font-size: 10px;">BASE</span>
        Sep-25
    </span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 600; font-size: 13px;">615</td>
<td colspan="5" style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center; color: #64748b; font-style: italic; background: #f8fafc; font-size: 12px;">
    <span style="display: inline-flex; align-items: center; gap: 5px;">
        <svg width="14" height="14" fill="none" stroke="#94a3b8" stroke-width="2"><circle cx="7" cy="7" r="5"/><line x1="7" y1="4" x2="7" y2="7"/><line x1="7" y1="7" x2="9" y2="9"/></svg>
        Baseline month (no comparison data)
    </span>
</td>
</tr>

<!-- Oct-25 Row -->
<tr style="background: #ffffff; transition: all 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='#ffffff'">
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a5f; font-size: 12px;">Oct-25</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="font-weight: 700; font-size: 13px;">697</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600;">↑ +13.3%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #065f46; display: inline-block; min-width: 40px; font-size: 12px;">213</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #b91c1c; display: inline-block; min-width: 40px; font-size: 12px;">356</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #1e40af; display: inline-block; min-width: 40px; font-size: 12px;">128</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <span style="font-weight: 700; color: #059669; font-size: 13px;">37.4%</span>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 37.4%; height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <span style="font-weight: 700; color: #dc2626; font-size: 13px;">62.6%</span>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 62.6%; height: 100%; background: linear-gradient(90deg, #f87171 0%, #dc2626 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
</tr>

<!-- Nov-25 Row -->
<tr style="background: #f8fafc; transition: all 0.2s;" onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='#f8fafc'">
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a5f; font-size: 12px;">Nov-25</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="font-weight: 700; font-size: 13px;">767</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600;">↑ +10.0%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #065f46; display: inline-block; min-width: 40px; font-size: 12px;">259</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600; margin-top: 2px;">↑ +21.6%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #b91c1c; display: inline-block; min-width: 40px; font-size: 12px;">381</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↑ +7.0%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #1e40af; display: inline-block; min-width: 40px; font-size: 12px;">127</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↓ -0.8%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #059669; font-size: 13px;">40.5%</span>
            <span style="background: #dcfce7; color: #16a34a; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↑ +3.1pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 40.5%; height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #dc2626; font-size: 13px;">59.5%</span>
            <span style="background: #dcfce7; color: #16a34a; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↓ -3.1pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 59.5%; height: 100%; background: linear-gradient(90deg, #f87171 0%, #dc2626 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
</tr>

<!-- Dec-25 Row -->
<tr style="background: #ffffff; transition: all 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='#ffffff'">
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a5f; font-size: 12px;">Dec-25</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="font-weight: 700; font-size: 13px;">674</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600;">↓ -12.1%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #065f46; display: inline-block; min-width: 40px; font-size: 12px;">81</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↓ -68.7%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #b91c1c; display: inline-block; min-width: 40px; font-size: 12px;">554</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↑ +45.4%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #1e40af; display: inline-block; min-width: 40px; font-size: 12px;">39</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↓ -69.3%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #059669; font-size: 13px;">12.8%</span>
            <span style="background: #fee2e2; color: #dc2626; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↓ -27.7pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 12.8%; height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #dc2626; font-size: 13px;">87.2%</span>
            <span style="background: #fee2e2; color: #dc2626; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↑ +27.7pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 87.2%; height: 100%; background: linear-gradient(90deg, #f87171 0%, #dc2626 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
</tr>

<!-- Jan-26 Row -->
<tr style="background: #f8fafc; transition: all 0.2s;" onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='#f8fafc'">
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a5f; font-size: 12px;">Jan-26</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="font-weight: 700; font-size: 13px;">625</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600;">↓ -7.3%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #065f46; display: inline-block; min-width: 40px; font-size: 12px;">201</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600; margin-top: 2px;">↑ +148.1%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #b91c1c; display: inline-block; min-width: 40px; font-size: 12px;">413</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600; margin-top: 2px;">↓ -25.5%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #1e40af; display: inline-block; min-width: 40px; font-size: 12px;">11</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↓ -71.8%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #059669; font-size: 13px;">32.7%</span>
            <span style="background: #dcfce7; color: #16a34a; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↑ +19.9pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 32.7%; height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #dc2626; font-size: 13px;">67.3%</span>
            <span style="background: #dcfce7; color: #16a34a; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↓ -19.9pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 67.3%; height: 100%; background: linear-gradient(90deg, #f87171 0%, #dc2626 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
</tr>

<!-- Feb-26 Row (Latest) -->
<tr style="background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); transition: all 0.2s; border-left: 4px solid #eab308;" onmouseover="this.style.boxShadow='inset 0 0 0 2px #fbbf24'" onmouseout="this.style.boxShadow='none'">
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a5f; font-size: 12px;">
    <span style="display: inline-flex; align-items: center; gap: 6px;">
        <span style="background: #fbbf24; color: #78350f; padding: 1px 6px; border-radius: 4px; font-size: 9px; font-weight: 700;">LATEST</span>
        Feb-26
    </span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="font-weight: 700; font-size: 13px;">551</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600;">↓ -11.8%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #065f46; display: inline-block; min-width: 40px; font-size: 12px;">130</span>
    <span style="display: block; font-size: 9px; color: #dc2626; font-weight: 600; margin-top: 2px;">↓ -35.3%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #b91c1c; display: inline-block; min-width: 40px; font-size: 12px;">398</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600; margin-top: 2px;">↓ -3.6%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <span style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 4px 10px; border-radius: 6px; font-weight: 700; color: #1e40af; display: inline-block; min-width: 40px; font-size: 12px;">23</span>
    <span style="display: block; font-size: 9px; color: #16a34a; font-weight: 600; margin-top: 2px;">↑ +109.1%</span>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #059669; font-size: 13px;">24.6%</span>
            <span style="background: #fee2e2; color: #dc2626; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↓ -8.1pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 24.6%; height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
<td style="padding: 7px 12px; border-bottom: 1px solid #e2e8f0; text-align: center;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <span style="font-weight: 700; color: #dc2626; font-size: 13px;">75.4%</span>
            <span style="background: #fee2e2; color: #dc2626; padding: 1px 5px; border-radius: 8px; font-size: 8px; font-weight: 700;">↑ +8.1pp</span>
        </div>
        <div style="width: 60px; height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
            <div style="width: 75.4%; height: 100%; background: linear-gradient(90deg, #f87171 0%, #dc2626 100%); border-radius: 2px;"></div>
        </div>
    </div>
</td>
</tr>

<!-- Average Row -->
<tr style="background: linear-gradient(135deg, #1e5a8e 0%, #1e3a5f 100%); color: white;">
<td style="padding: 9px 12px; border: none; font-weight: 700; border-radius: 0 0 0 10px; font-size: 12px;">
    <span style="display: inline-flex; align-items: center; gap: 6px;">
        <svg width="14" height="14" fill="white"><rect x="2" y="5" width="10" height="3" rx="1"/><rect x="5" y="2" width="4" height="10" rx="1"/></svg>
        Average (Oct-25 - Feb-26)
    </span>
</td>
<td style="padding: 9px 12px; border: none; text-align: center; font-weight: 700; font-size: 14px;">663</td>
<td style="padding: 9px 12px; border: none; text-align: center; font-weight: 700; font-size: 14px;">177</td>
<td style="padding: 9px 12px; border: none; text-align: center; font-weight: 700; font-size: 14px;">420</td>
<td style="padding: 9px 12px; border: none; text-align: center; font-weight: 700; font-size: 14px;">66</td>
<td style="padding: 9px 12px; border: none; text-align: center;">
    <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 5px; font-weight: 700; font-size: 13px;">30.0%</span>
</td>
<td style="padding: 9px 12px; border: none; text-align: center; border-radius: 0 0 10px 0;">
    <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 5px; font-weight: 700; font-size: 13px;">70.0%</span>
</td>
</tr>
</tbody>
</table>
</div>
<!-- Charts Grid -->
<div class="chart-grid">
<div class="chart-container">
<div style="text-align: center; margin-bottom: 12px;">
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 6px; flex-wrap: wrap;">
        <button class="slab-slicer-btn active" data-target="willingness" data-view="trend">Trend %</button>
        <button class="slab-slicer-btn" data-target="willingness" data-view="bars">Willing vs Not</button>
    </div>
</div>
<div data-panel="willingness" data-view="bars">
    <h3 class="chart-title">Monthly Willing vs Not-Willing Partners</h3>
    <p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Stacked bars show monthly willing vs not‑willing partners (counts). Use the filter to switch to % trend.</p>
    <canvas id="willingVsNotWillingChart"></canvas>
</div>
<div data-panel="willingness" data-view="trend" style="display: none;">
    <h3 class="chart-title">Partner Willingness Trend (%)</h3>
    <p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Line trend shows willingness share over time (percent). Use the filter to switch to counts.</p>
    <canvas id="willingnessTrendChart"></canvas>
</div>
</div>
<div class="chart-container">
<div style="text-align: center; margin-bottom: 12px;">
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 6px; flex-wrap: wrap;">
        <button class="slab-slicer-btn active" data-target="growth" data-view="increase">Increase</button>
        <button class="slab-slicer-btn" data-target="growth" data-view="decrease">Decrease</button>
    </div>
</div>
<div data-panel="growth" data-view="increase">
    <h3 class="chart-title">Growth Category Breakdown (Increase Slabs)</h3>
    <p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Partners by % target increase (0%, 1-10%, 11-20%, 21-30%, &gt;30%). Line shows total partners with any increase.</p>
    <canvas id="growthCategoryChart"></canvas>
</div>
<div data-panel="growth" data-view="decrease" style="display: none;">
    <h3 class="chart-title">Growth Category Breakdown (Decrease Slabs)</h3>
    <p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Partners by % target decrease (0%, -1 to -10%, -11 to -20%, -21 to -30%, &lt;-30%). Line shows total partners with any decrease.</p>
    <canvas id="decreaseCategoryChart"></canvas>
</div>
</div>
</div>
<!-- MoM Chart with proper percentages -->
<div class="chart-grid">
<div class="chart-container">
<h3 class="chart-title">Partner Size Breakdown - Willingness by Target Size</h3>
<div class="table-container compact-table nowrap-table" style="margin: 0; max-height: 500px; overflow: auto;">
<table style="width: 100%; border-collapse: collapse; font-size: 13px; min-width: 1800px;">
<thead style="position: sticky; top: 0; background: #1e5a8e; z-index: 10;">
<tr style="color: white;">
<th style="padding: 12px 16px; border: 1px solid #ddd; text-align: left; width: 160px; background: #1e5a8e; white-space: nowrap;">Size</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #e3f2fd; color: #1e5a8e; font-weight: 700;">Oct-25</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #f1f8e9; color: #1e5a8e; font-weight: 700;">Nov-25</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #e3f2fd; color: #1e5a8e; font-weight: 700;">Dec-25</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #f1f8e9; color: #1e5a8e; font-weight: 700;">Jan-26</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #e3f2fd; color: #1e5a8e; font-weight: 700;">Feb-26</th>
</tr>
<tr style="color: white; background: #1e5a8e;">
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: left;"></th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Big</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Mid</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Small</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Big</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Mid</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Small</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Big</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Mid</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Small</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Big</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Mid</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Small</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Big</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Mid</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Small</th>
</tr>
</thead>
<tbody>
<tr style="background: #ffffff;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">Total</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">213 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">28 <span style="color: #dc2626; font-weight: 600;">↓ (13.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">116 <span style="color: #059669; font-weight: 600;">↑ (54.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">69 <span style="color: #059669; font-weight: 600;">↑ (32.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">258 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">24 <span style="color: #dc2626; font-weight: 600;">↓ (9.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">129 <span style="color: #059669; font-weight: 600;">↑ (50.0%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">105 <span style="color: #059669; font-weight: 600;">↑ (40.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">79 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">7 <span style="color: #dc2626; font-weight: 600;">↓ (8.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">32 <span style="color: #059669; font-weight: 600;">↑ (40.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">40 <span style="color: #059669; font-weight: 600;">↑ (50.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">201 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">22 <span style="color: #dc2626; font-weight: 600;">↓ (10.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">96 <span style="color: #059669; font-weight: 600;">↑ (47.8%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">83 <span style="color: #059669; font-weight: 600;">↑ (41.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">129 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">13 <span style="color: #dc2626; font-weight: 600;">↓ (10.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">62 <span style="color: #059669; font-weight: 600;">↑ (48.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">54 <span style="color: #059669; font-weight: 600;">↑ (41.9%)</span></td>
</tr>
<tr style="background: #f9fafb;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">≥1%-≤10%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">60 (28.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">11 <span style="color: #059669; font-weight: 600;">↑ (39.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">37 <span style="color: #059669; font-weight: 600;">↑ (31.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 (17.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">73 (28.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">16 <span style="color: #059669; font-weight: 600;">↑ (66.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">47 <span style="color: #059669; font-weight: 600;">↑ (36.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">10 <span style="color: #dc2626; font-weight: 600;">↓ (9.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">22 (27.8%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">4 <span style="color: #059669; font-weight: 600;">↑ (57.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 <span style="color: #059669; font-weight: 600;">↑ (37.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">6 (15.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">79 (39.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">16 (72.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">40 (41.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">23 (27.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">46 (35.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">8 <span style="color: #059669; font-weight: 600;">↑ (61.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">27 <span style="color: #059669; font-weight: 600;">↑ (43.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">11 <span style="color: #dc2626; font-weight: 600;">↓ (20.4%)</span></td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">>10%-<20%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">86 <span style="color: #059669; font-weight: 600;">↑ (40.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 <span style="color: #059669; font-weight: 600;">↑ (42.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">47 <span style="color: #059669; font-weight: 600;">↑ (40.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">27 <span style="color: #059669; font-weight: 600;">↑ (39.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">112 <span style="color: #059669; font-weight: 600;">↑ (43.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">4 (16.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">59 <span style="color: #059669; font-weight: 600;">↑ (45.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">49 <span style="color: #059669; font-weight: 600;">↑ (46.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">31 <span style="color: #059669; font-weight: 600;">↑ (39.2%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 <span style="color: #059669; font-weight: 600;">↑ (42.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">13 <span style="color: #059669; font-weight: 600;">↑ (40.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">15 <span style="color: #059669; font-weight: 600;">↑ (37.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">58 (28.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">5 (22.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">30 (31.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">23 (27.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">51 <span style="color: #059669; font-weight: 600;">↑ (39.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">4 <span style="color: #059669; font-weight: 600;">↑ (30.8%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">22 <span style="color: #059669; font-weight: 600;">↑ (35.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">25 <span style="color: #059669; font-weight: 600;">↑ (46.3%)</span></td>
</tr>
<tr style="background: #f9fafb;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">≥20%-≤30%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">30 <span style="color: #dc2626; font-weight: 600;">↓ (14.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 <span style="color: #dc2626; font-weight: 600;">↓ (10.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">15 <span style="color: #dc2626; font-weight: 600;">↓ (12.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 (17.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">35 <span style="color: #dc2626; font-weight: 600;">↓ (13.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">4 (16.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 <span style="color: #dc2626; font-weight: 600;">↓ (9.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">19 (18.1%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">14 (17.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">5 (15.6%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">9 <span style="color: #dc2626;">(22.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">28 (13.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">1 (4.5%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">14 (14.6%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">13 (15.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">16 (12.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">1 <span style="color: #dc2626; font-weight: 600;">↓ (7.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">5 <span style="color: #dc2626; font-weight: 600;">↓ (8.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">10 (18.5%)</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">>30%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">37 (17.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 <span style="color: #dc2626; font-weight: 600;">↓ (7.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">17 <span style="color: #dc2626; font-weight: 600;">↓ (14.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">18 (26.1%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">38 <span style="color: #dc2626; font-weight: 600;">↓ (14.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">11 <span style="color: #dc2626; font-weight: 600;">↓ (8.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">27 (25.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">12 (15.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 <span style="color: #dc2626; font-weight: 600;">↓ (6.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">10 (25.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">36 (17.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 (12.5%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">24 (28.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">16 (12.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">8 <span style="color: #dc2626; font-weight: 600;">↓ (12.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">8 (14.8%)</td>
</tr>
</tbody>
</table>
</div>
<div class="header-subtitle" style="margin-top: 10px;">
Shows willingness to increase targets by partner size reveals which size segments drive growth across all months.
</div>
</div>
<div class="chart-container">
<h3 class="chart-title">Partner Performance Breakdown - Willingness by Target Size</h3>
<div class="table-container compact-table nowrap-table" style="margin: 0; max-height: 500px; overflow: auto;">
<table style="width: 100%; border-collapse: collapse; font-size: 13px; min-width: 1800px;">
<thead style="position: sticky; top: 0; background: #1e5a8e; z-index: 10;">
<tr style="color: white;">
<th style="padding: 12px 16px; border: 1px solid #ddd; text-align: left; width: 160px; background: #1e5a8e; white-space: nowrap;">Performance</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #e3f2fd; color: #1e5a8e; font-weight: 700;">Oct-25</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #f1f8e9; color: #1e5a8e; font-weight: 700;">Nov-25</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #e3f2fd; color: #1e5a8e; font-weight: 700;">Dec-25</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #f1f8e9; color: #1e5a8e; font-weight: 700;">Jan-26</th>
<th colspan="4" style="padding: 12px 16px; border: 1px solid #ddd; text-align: center; background: #e3f2fd; color: #1e5a8e; font-weight: 700;">Feb-26</th>
</tr>
<tr style="color: white; background: #1e5a8e;">
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: left;"></th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Good</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Average</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Bad</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Good</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Average</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Bad</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Good</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Average</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Bad</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Good</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Average</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Bad</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Overall</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Good</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Average</th>
<th style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; width: 110px;">Bad</th>
</tr>
</thead>
<tbody>
<tr style="background: #ffffff;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">Total</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">213 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">28 <span style="color: #dc2626; font-weight: 600;">↓ (13.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">116 <span style="color: #059669; font-weight: 600;">↑ (54.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">69 <span style="color: #059669; font-weight: 600;">↑ (32.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">258 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">24 <span style="color: #dc2626; font-weight: 600;">↓ (9.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">129 <span style="color: #059669; font-weight: 600;">↑ (50.0%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">105 <span style="color: #059669; font-weight: 600;">↑ (40.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">79 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">7 <span style="color: #dc2626; font-weight: 600;">↓ (8.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">32 <span style="color: #059669; font-weight: 600;">↑ (40.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">40 <span style="color: #059669; font-weight: 600;">↑ (50.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">201 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">109 (54.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">77 (38.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">15 (7.5%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; font-weight: 700; background: #e3f2fd;">129 <span class="overall-badge">(100%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">82 <span style="color: #059669; font-weight: 600;">↑ (63.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">46 <span style="color: #059669; font-weight: 600;">↑ (35.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #ecfdf5;">1 <span style="color: #dc2626; font-weight: 600;">↓ (0.8%)</span></td>
</tr>
<tr style="background: #f9fafb;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">≥1%-≤10%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">60 (28.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">10 <span style="color: #059669; font-weight: 600;">↑ (35.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">35 <span style="color: #059669; font-weight: 600;">↑ (30.2%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">15 <span style="color: #dc2626;">(21.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">73 (28.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">7 (29.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">41 <span style="color: #059669; font-weight: 600;">↑ (31.8%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">25 (23.8%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">22 (27.8%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 <span style="color: #059669; font-weight: 600;">↑ (42.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">13 <span style="color: #059669; font-weight: 600;">↑ (40.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">6 (15.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">79 (39.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">46 (42.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">29 (37.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">4 (26.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">46 (35.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">32 <span style="color: #059669; font-weight: 600;">↑ (39.0%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">14 <span style="color: #059669; font-weight: 600;">↑ (30.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">>10%-<20%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">86 <span style="color: #059669; font-weight: 600;">↑ (40.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">13 <span style="color: #059669; font-weight: 600;">↑ (46.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">45 <span style="color: #059669; font-weight: 600;">↑ (38.8%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">28 <span style="color: #059669; font-weight: 600;">↑ (40.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">112 <span style="color: #059669; font-weight: 600;">↑ (43.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 <span style="color: #059669; font-weight: 600;">↑ (50.0%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">60 <span style="color: #059669; font-weight: 600;">↑ (46.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">40 <span style="color: #059669; font-weight: 600;">↑ (38.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">31 <span style="color: #059669; font-weight: 600;">↑ (39.2%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 (28.6%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">14 <span style="color: #059669; font-weight: 600;">↑ (43.8%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">15 <span style="color: #059669; font-weight: 600;">↑ (37.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">58 (28.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">32 (29.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">20 (26.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">6 (40.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">51 <span style="color: #059669; font-weight: 600;">↑ (39.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">33 <span style="color: #059669; font-weight: 600;">↑ (40.2%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">18 <span style="color: #059669; font-weight: 600;">↑ (39.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
</tr>
<tr style="background: #f9fafb;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">≥20%-≤30%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">30 <span style="color: #dc2626; font-weight: 600;">↓ (14.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 (10.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">19 (16.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">8 <span style="color: #dc2626; font-weight: 600;">↓ (11.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">35 <span style="color: #dc2626; font-weight: 600;">↓ (13.6%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 <span style="color: #dc2626; font-weight: 600;">↓ (12.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">16 <span style="color: #dc2626; font-weight: 600;">↓ (12.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">16 (15.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">14 (17.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 (28.6%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 <span style="color: #dc2626; font-weight: 600;">↓ (9.4%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">9 <span style="color: #dc2626;">(22.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">28 (13.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">15 (13.8%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">11 (14.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 (13.3%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">16 (12.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">10 <span style="color: #dc2626; font-weight: 600;">↓ (12.2%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">6 <span style="color: #dc2626; font-weight: 600;">↓ (13.0%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 10px 12px; border: 1px solid #ddd; font-weight: 700; white-space: nowrap;">>30%</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">37 (17.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 <span style="color: #dc2626; font-weight: 600;">↓ (7.1%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">17 <span style="color: #dc2626; font-weight: 600;">↓ (14.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">18 (26.1%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">38 <span style="color: #dc2626; font-weight: 600;">↓ (14.7%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 <span style="color: #dc2626; font-weight: 600;">↓ (8.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">12 <span style="color: #dc2626; font-weight: 600;">↓ (9.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">24 <span style="color: #dc2626;">(22.9%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">12 (15.2%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">0 (0.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">2 <span style="color: #dc2626; font-weight: 600;">↓ (6.3%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">10 (25.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">36 (17.9%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">16 (14.7%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">17 (22.1%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">3 (20.0%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap; background: #e3f2fd;">16 (12.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">7 <span style="color: #dc2626; font-weight: 600;">↓ (8.5%)</span></td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">8 (17.4%)</td>
<td style="padding: 10px 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">1 <span style="color: #059669; font-weight: 600;">↑ (100.0%)</span></td>
</tr>
</tbody>
</table>
</div>
<div class="header-subtitle" style="margin-top: 10px;">
Shows willingness to increase targets by partner performance reveals which level segments drive growth across all months.
</div>
</div></div>
</div>
<!-- RIDERS SLAB DISTRIBUTION CHART & TABLE -->
<div style="margin-top: 30px;">
<div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
    <button class="slab-slicer-btn active" data-target="ridersSlab" data-view="total">Total</button>
    <button class="slab-slicer-btn" data-target="ridersSlab" data-view="increased">Increased</button>
    <button class="slab-slicer-btn" data-target="ridersSlab" data-view="decreased">Decreased</button>
</div>
<div class="chart-container" id="ridersSlabPanelTotal" style="margin-top: 20px;">
<h3 class="chart-title">Partners by Riders Slab Distribution</h3>
<p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Number of partners in each rider count range across all months. Helps identify capacity distribution patterns.</p>

<!-- Interactive Bar Chart -->
<div style="position: relative; width: 100%; height: 350px; margin-bottom: 20px;">
<canvas id="ridersSlabTrendChart"></canvas>
</div>

<!-- Expandable Table -->
<div style="margin-top: 15px;">
<button id="toggleRidersTable" style="padding: 8px 16px; background: #1e5a8e; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">▶ Show Table Details</button>
</div>
<div id="ridersTableContainer" class="table-container compact-table nowrap-table" style="margin: 10px 0 0 0; max-height: 350px; overflow-y: auto; display: none;">
<table style="width: 100%; border-collapse: collapse; font-size: 12px;">
<thead style="position: sticky; top: 0; background: #1e5a8e; z-index: 10;">
<tr style="color: white;">
<th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Month</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥1-&lt;20</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥20-&lt;30</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥30-&lt;50</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥50-&lt;80</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥80-&lt;100</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥100-&lt;150</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥150-&lt;200</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥200-&lt;300</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">≥300</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">Total</th>
</tr>
</thead>
<tbody>
<tr style="background: #f0f9ff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Sep-25</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">58 <span style="color: #dc2626; font-weight: 600;">↓ (9.4%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">145 <span style="color: #059669; font-weight: 600;">↑ (23.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">176 <span style="color: #059669; font-weight: 600;">↑ (28.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">136 <span style="color: #059669; font-weight: 600;">↑ (22.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">36 (5.9%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">34 (5.5%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">14 <span style="color: #dc2626; font-weight: 600;">↓ (2.3%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">11 <span style="color: #dc2626; font-weight: 600;">↓ (1.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">5 <span style="color: #dc2626; font-weight: 600;">↓ (0.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">615</td>
</tr>
<tr style="background: #f0f9ff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Oct-25</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">95 <span style="color: #dc2626; font-weight: 600;">↓ (13.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">158 <span style="color: #059669; font-weight: 600;">↑ (22.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">201 <span style="color: #059669; font-weight: 600;">↑ (28.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">138 <span style="color: #059669; font-weight: 600;">↑ (19.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">38 (5.5%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">40 (5.7%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">13 <span style="color: #dc2626; font-weight: 600;">↓ (1.9%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">9 <span style="color: #dc2626; font-weight: 600;">↓ (1.3%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">5 <span style="color: #dc2626; font-weight: 600;">↓ (0.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">697</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Nov-25</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">119 <span style="color: #dc2626; font-weight: 600;">↓ (15.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">193 <span style="color: #059669; font-weight: 600;">↑ (25.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">221 <span style="color: #059669; font-weight: 600;">↑ (28.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">136 <span style="color: #059669; font-weight: 600;">↑ (17.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">37 (4.8%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">35 (4.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">14 <span style="color: #dc2626; font-weight: 600;">↓ (1.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">7 <span style="color: #dc2626; font-weight: 600;">↓ (0.9%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">5 <span style="color: #dc2626; font-weight: 600;">↓ (0.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">767</td>
</tr>
<tr style="background: #f0f9ff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Dec-25</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">183 <span style="color: #059669; font-weight: 600;">↑ (27.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">182 <span style="color: #059669; font-weight: 600;">↑ (27.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">181 <span style="color: #059669; font-weight: 600;">↑ (26.9%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">75 (11.1%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">20 <span style="color: #dc2626; font-weight: 600;">↓ (3.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">21 <span style="color: #dc2626; font-weight: 600;">↓ (3.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">8 <span style="color: #dc2626; font-weight: 600;">↓ (1.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">4 <span style="color: #dc2626; font-weight: 600;">↓ (0.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 <span style="color: #dc2626; font-weight: 600;">↓ (0.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">674</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Jan-26</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">181 <span style="color: #dc2626; font-weight: 600;">↓ (29.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">156 <span style="color: #dc2626; font-weight: 600;">↓ (25.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">172 <span style="color: #dc2626; font-weight: 600;">↓ (27.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">63 <span style="color: #dc2626; font-weight: 600;">↓ (10.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">23 <span style="color: #059669; font-weight: 600;">↑ (3.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">19 <span style="color: #dc2626; font-weight: 600;">↓ (3.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">7 <span style="color: #dc2626; font-weight: 600;">↓ (1.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">4 (0.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">625</td>
</tr>
<tr style="background: #f0f9ff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Feb-26</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">141 <span style="color: #dc2626; font-weight: 600;">↓ (25.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">160 <span style="color: #059669; font-weight: 600;">↑ (29.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">156 <span style="color: #dc2626; font-weight: 600;">↓ (28.3%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">49 <span style="color: #dc2626; font-weight: 600;">↓ (8.9%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">25 <span style="color: #059669; font-weight: 600;">↑ (4.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">13 <span style="color: #dc2626; font-weight: 600;">↓ (2.4%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">6 <span style="color: #dc2626; font-weight: 600;">↓ (1.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 <span style="color: #dc2626; font-weight: 600;">↓ (0.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700;">551</td>
</tr>
</tbody>
</table>
</div>
</div>

<script>
// Toggle Riders Table
document.getElementById('toggleRidersTable').addEventListener('click', function() {
    const container = document.getElementById('ridersTableContainer');
    const btn = this;
    if (container.style.display === 'none') {
        container.style.display = 'block';
        btn.textContent = '▼ Hide Table Details';
    } else {
        container.style.display = 'none';
        btn.textContent = '▶ Show Table Details';
    }
});

// Riders Slab Distribution Chart - Initialize after DOM is ready
setTimeout(function() {
    const ridersCanvas = document.getElementById('ridersSlabTrendChart');
    if (ridersCanvas && typeof Chart !== 'undefined') {
        const ridersCtx = ridersCanvas.getContext('2d');
        const totalChart = new Chart(ridersCtx, {
            type: 'line',
            data: {
                labels: ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'],
                datasets: [
                    {
                        label: '≥1-<20',
                        data: [58, 95, 119, 183, 181, 141],
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#dc2626',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥20-<30',
                        data: [145, 158, 193, 182, 156, 160],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#f59e0b',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥30-<50',
                        data: [176, 201, 221, 181, 172, 156],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥50-<80',
                        data: [136, 138, 136, 75, 63, 49],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥80-<100',
                        data: [36, 38, 37, 20, 23, 25],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥100-<150',
                        data: [34, 40, 35, 21, 19, 13],
                        borderColor: '#ec4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#ec4899',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥150-<200',
                        data: [14, 13, 14, 8, 7, 6],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#f97316',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥200-<300',
                        data: [11, 9, 7, 4, 4, 1],
                        borderColor: '#06b6d4',
                        backgroundColor: 'rgba(6, 182, 212, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#06b6d4',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '≥300',
                        data: [5, 5, 5, 0, 0, 0],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.05)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#6366f1',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            font: { size: 11 },
                            padding: 10,
                            boxWidth: 12,
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1f2937',
                        titleFont: { size: 13, weight: 'bold' },
                        bodyFont: { size: 12 },
                        padding: 10,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                const monthIndex = context.dataIndex;
                                const totals = [615, 697, 767, 674, 625, 551];
                                const value = context.parsed.y || 0;
                                const pct = totals[monthIndex] ? ((value / totals[monthIndex]) * 100).toFixed(1) : '0.0';
                                return `${context.dataset.label}: ${value} (${pct}%)`;
                            }
                        }
                    },
                    datalabels: {
                        display: true,
                        color: function(context) {
                            return context.dataset.borderColor;
                        },
                        font: { size: 9, weight: 'bold' },
                        anchor: 'end',
                        align: 'top',
                        offset: 2,
                        clamp: true,
                        clip: false,
                        formatter: function(value, context) {
                            const monthIndex = context.dataIndex;
                            const totals = [615, 697, 767, 674, 625, 551];
                            const pct = ((value / totals[monthIndex]) * 100).toFixed(1);
                            return value + '\n(' + pct + '%)';
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { font: { size: 11 } },
                        title: {
                            display: true,
                            text: 'Number of Partners',
                            font: { size: 12, weight: 'bold' }
                        }
                    },
                    x: {
                        ticks: { font: { size: 11 } },
                        title: {
                            display: true,
                            text: 'Month',
                            font: { size: 12, weight: 'bold' }
                        }
                    }
                }
            }
        });
        window.ridersSlabCharts = window.ridersSlabCharts || {};
        window.ridersSlabCharts.total = totalChart;
    }
}, 100);

// Riders Slab Increased/Decreased Charts + Slicer
setTimeout(function() {
    if (typeof Chart === 'undefined') return;

    function parseSlabTable(tableEl) {
        if (!tableEl) return null;
        const headerCells = Array.from(tableEl.querySelectorAll('thead th'));
        const datasetLabels = headerCells.slice(1, -1).map(th => th.textContent.trim());
        const rows = Array.from(tableEl.querySelectorAll('tbody tr'));
        const labels = [];
        const totals = [];
        const series = datasetLabels.map(() => []);

        function firstInt(text) {
            const m = String(text || '').match(/-?\d+/);
            return m ? parseInt(m[0], 10) : 0;
        }

        rows.forEach(row => {
            const cells = Array.from(row.querySelectorAll('td'));
            if (!cells.length) return;
            labels.push(cells[0].textContent.trim());
            const totalCell = cells[cells.length - 1];
            const totalVal = firstInt(totalCell.textContent);
            totals.push(totalVal);
            datasetLabels.forEach((_, i) => {
                const cell = cells[i + 1];
                const val = firstInt(cell ? cell.textContent : '');
                series[i].push(val);
            });
        });

        return { labels, datasetLabels, series, totals };
    }

    function buildSlabChart(canvasId, parsed, colors) {
        const canvas = document.getElementById(canvasId);
        if (!canvas || !parsed) return null;

        const datasets = parsed.datasetLabels.map((label, i) => ({
            label,
            data: parsed.series[i],
            borderColor: colors[i % colors.length],
            backgroundColor: 'rgba(0,0,0,0)',
            borderWidth: 2,
            fill: false,
            tension: 0.4,
            pointRadius: 4,
            pointBackgroundColor: colors[i % colors.length],
            pointBorderColor: '#fff',
            pointBorderWidth: 2
        }));

        return new Chart(canvas.getContext('2d'), {
            type: 'line',
            data: { labels: parsed.labels, datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: { font: { size: 11 }, padding: 10, boxWidth: 12, usePointStyle: true }
                    },
                    tooltip: {
                        backgroundColor: '#1f2937',
                        titleFont: { size: 13, weight: 'bold' },
                        bodyFont: { size: 12 },
                        padding: 10,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                const idx = context.dataIndex;
                                const total = parsed.totals[idx] || 0;
                                const value = context.parsed.y || 0;
                                const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                return `${context.dataset.label}: ${value} (${pct}%)`;
                            }
                        }
                    },
                    datalabels: {
                        display: true,
                        color: function(context) {
                            return context.dataset.borderColor;
                        },
                        font: { size: 9, weight: 'bold' },
                        anchor: 'end',
                        align: 'top',
                        offset: 2,
                        clamp: true,
                        clip: false,
                        formatter: function(value, context) {
                            const idx = context.dataIndex;
                            const total = parsed.totals[idx] || 0;
                            const raw = (context.parsed && context.parsed.y !== undefined) ? context.parsed.y : value;
                            const val = Number.isFinite(Number(raw)) ? Number(raw) : 0;
                            const pct = total ? ((val / total) * 100).toFixed(1) : '0.0';
                            return val + '\n(' + pct + '%)';
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { font: { size: 11 } },
                        title: { display: true, text: 'Number of Partners', font: { size: 12, weight: 'bold' } }
                    },
                    x: {
                        ticks: { font: { size: 11 } },
                        title: { display: true, text: 'Month', font: { size: 12, weight: 'bold' } }
                    }
                }
            },
            plugins: [ChartDataLabels]
        });
    }

    const colors = ['#dc2626', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#f97316', '#06b6d4', '#6366f1'];
    const incTable = document.querySelector('#increasedTableContainer table');
    const decTable = document.querySelector('#decreasedTableContainer table');
    const incParsed = parseSlabTable(incTable);
    const decParsed = parseSlabTable(decTable);

    window.ridersSlabCharts = window.ridersSlabCharts || {};
    window.ridersSlabCharts.increased = buildSlabChart('ridersSlabIncreasedChart', incParsed, colors);
    window.ridersSlabCharts.decreased = buildSlabChart('ridersSlabDecreasedChart', decParsed, colors);

    const buttons = Array.from(document.querySelectorAll('.slab-slicer-btn[data-target="ridersSlab"]'));
    function apply(view) {
        const total = document.getElementById('ridersSlabPanelTotal');
        const inc = document.getElementById('ridersSlabPanelIncreased');
        const dec = document.getElementById('ridersSlabPanelDecreased');
        if (total) total.style.display = (view === 'total') ? 'block' : 'none';
        if (inc) inc.style.display = (view === 'increased') ? 'block' : 'none';
        if (dec) dec.style.display = (view === 'decreased') ? 'block' : 'none';
        buttons.forEach(b => b.classList.toggle('active', b.dataset.view === view));
        if (window.ridersSlabCharts) {
            Object.values(window.ridersSlabCharts).forEach(c => { try { c && c.resize(); } catch(e) {} });
        }
    }

    buttons.forEach(b => b.addEventListener('click', function() { apply(this.dataset.view); }));
    const defaultBtn = buttons.find(b => b.classList.contains('active')) || buttons[0];
    if (defaultBtn) apply(defaultBtn.dataset.view || 'total');
}, 140);
</script>

<!-- INCREASED TARGET BY RIDERS SLAB -->
<div class="chart-container" id="ridersSlabPanelIncreased" style="margin-top: 30px; display: none;">
<h3 class="chart-title">Partners with Increased Target by Riders Slab Distribution</h3>
<p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Number of partners who increased their targets, categorized by rider count range. Shows growth momentum across different partner sizes.</p>

<div style="position: relative; width: 100%; height: 350px; margin: 5px 0 20px 0;">
<canvas id="ridersSlabIncreasedChart"></canvas>
</div>

<div style="margin-top: 15px;">
<button id="toggleIncreasedTable" style="padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">▶ Show Table Details</button>
</div>
<div id="increasedTableContainer" class="table-container compact-table nowrap-table" style="margin: 10px 0 0 0; max-height: 350px; overflow-y: auto; display: none;">
<table class="slab-table-increased" style="width: 100%; border-collapse: collapse; font-size: 12px;">
<thead style="position: sticky; top: 0; background: #059669; z-index: 10;">
<tr style="color: white;">
<th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Month</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=1 - &lt;20</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=20 - &lt;30</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=30 - &lt;50</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=50 - &lt;80</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=80 - &lt;100</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=100 - &lt;150</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=150 - &lt;200</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=200 - &lt;300</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">>=300</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #047857;">Total</th>
</tr>
</thead>
<tbody>
<tr style="background: #f0fdf4;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Sep</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">171 (44.9%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">99 (26.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">77 (20.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #0284c7; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">26 (6.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">4 (1.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">3 (0.8%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.3%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #d1fae5;">381</td>
</tr>
<tr style="background: #f0fdf4;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Oct</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">238 (69.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">47 (13.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">43 (12.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #0284c7; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">11 (3.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">2 (0.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #d1fae5;">341</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Nov</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">282 (73.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">64 (16.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">31 (8.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #0284c7; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">8 (2.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.3%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #d1fae5;">386</td>
</tr>
<tr style="background: #f0fdf4;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Dec</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">85 (70.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">21 (17.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">12 (10.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #0284c7; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">2 (1.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #d1fae5;">120</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Jan</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">200 (94.3%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">8 (3.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">3 (1.4%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #0284c7; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">1 (0.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #d1fae5;">212</td></td>
</tr>
<tr style="background: #f0fdf4;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Feb</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">139 (90.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">12 (7.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">1 (0.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #0284c7; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">1 (0.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #d1fae5;">153</td>
</tr>
</tbody>
</table>
</div>
</div>

<script>
document.getElementById('toggleIncreasedTable').addEventListener('click', function() {
    const container = document.getElementById('increasedTableContainer');
    const btn = this;
    if (container.style.display === 'none') {
        container.style.display = 'block';
        btn.textContent = '▼ Hide Table Details';
    } else {
        container.style.display = 'none';
        btn.textContent = '▶ Show Table Details';
    }
});
</script>

<!-- DECREASED TARGET BY RIDERS SLAB -->
<div class="chart-container" id="ridersSlabPanelDecreased" style="margin-top: 30px; display: none;">
<h3 class="chart-title">Partners with Decreased Target by Riders Slab Distribution</h3>
<p style="color: #6b7280; font-size: 12px; margin: 5px 0 10px 0; font-style: italic;">Number of partners who decreased their targets, categorized by rider count range. Identifies areas requiring attention and support.</p>

<div style="position: relative; width: 100%; height: 350px; margin: 5px 0 20px 0;">
<canvas id="ridersSlabDecreasedChart"></canvas>
</div>

<div style="margin-top: 15px;">
<button id="toggleDecreasedTable" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">▶ Show Table Details</button>
</div>
<div id="decreasedTableContainer" class="table-container compact-table nowrap-table" style="margin: 10px 0 0 0; max-height: 350px; overflow-y: auto; display: none;">
<table class="slab-table-decreased" style="width: 100%; border-collapse: collapse; font-size: 12px;">
<thead style="position: sticky; top: 0; background: #dc2626; z-index: 10;">
<tr style="color: white;">
<th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Month</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;0 &amp; &gt;-20</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-20 &amp; &gt;-30</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-30 &amp; &gt;-50</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=50 &amp; &gt;-80</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-80 &amp; &gt;-100</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-100 &amp; &gt;-150</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-150 &amp; &gt;-200</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-200 &amp; &gt;-300</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center;">&lt;=-300</th>
<th style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #b91c1c;">Total</th>
</tr>
</thead>
<tbody>
<tr style="background: #fef2f2;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Sep</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">88 (71.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">17 (13.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #f97316; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">12 (9.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">2 (1.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">2 (1.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">2 (1.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.8%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #fecaca;">124</td>
</tr>
<tr style="background: #fef2f2;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Oct</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">127 (78.4%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">17 (10.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #f97316; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">10 (6.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">4 (2.5%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.6%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">2 (1.2%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #fecaca;">162</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Nov</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">145 (77.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">22 (11.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #f97316; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">9 (4.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">9 (4.8%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.5%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.5%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.5%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #fecaca;">188</td>
</tr>
<tr style="background: #fef2f2;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Dec</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">317 (69.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">65 (14.2%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #f97316; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">41 (9.0%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #fb923c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">21 (4.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">6 (1.3%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">4 (0.9%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">2 (0.4%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.2%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.2%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #fecaca;">458</td>
</tr>
<tr style="background: #ffffff;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Jan</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">221 (92.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">11 (4.6%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #f97316; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">6 (2.5%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.4%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.4%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #fecaca;">240</td>
</tr>
<tr style="background: #fef2f2;">
<td style="padding: 8px; border: 1px solid #ddd; font-weight: 700;">Feb</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">255 (89.8%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #ea580c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">19 (6.7%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;"><span style="background: #f97316; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600;">6 (2.1%)</span></td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">3 (1.1%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">1 (0.4%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center;">0 (0.0%)</td>
<td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #fecaca;">284</td>
</tr>
</tbody>
</table>
</div>
</div>

<script>
document.getElementById('toggleDecreasedTable').addEventListener('click', function() {
    const container = document.getElementById('decreasedTableContainer');
    const btn = this;
    if (container.style.display === 'none') {
        container.style.display = 'block';
        btn.textContent = '▼ Hide Table Details';
    } else {
        container.style.display = 'none';
        btn.textContent = '▶ Show Table Details';
    }
});
</script>

</div>

<!-- Key Insights -->
<div class="highlight-box" style="margin-top: 30px;">
<h3 style="color: #1f4e78; margin-bottom: 15px;">💡 Key Insights &amp; Takeaways</h3>
<div>
<p style="margin-bottom: 12px; line-height: 1.6;">
<strong>📈 Overall Trend:</strong> Partner willingness started at 37.4% in October (213 willing partners), 
                            improved in November (40.5%, 259 partners), but plummeted in December to the lowest point at 12.8% (81 willing partners). 
                            January showed strong recovery to 32.7% (201 partners), but February declined again to 24.6% (130 partners), indicating fluctuating engagement patterns.
                        </p>
<p style="margin-bottom: 12px; line-height: 1.6;">
<strong>🎯 Best Performance:</strong> November demonstrated the highest willingness rate at 40.5%, with 259 out of 640 
                            sub-total partners willing to increase targets. October followed with 37.4% willingness (213 partners).
                        </p>
<p style="margin-bottom: 12px; line-height: 1.6;">
<strong>⚠️ December Challenge:</strong> December saw the most dramatic drop with only 12.8% willingness (81 partners), 
                            and 554 partners (87.2%) not willing to increase targets. This represents the most significant resistance to growth 
                            observed across all months.
                        </p>
<p style="margin-bottom: 12px; line-height: 1.6;">
<strong>🔥 January Recovery &amp; February Decline:</strong> January demonstrated a remarkable 20% recovery jump to 32.7% willingness (201 partners), rising from December's 12.8% low. 
                            However, February declined to 24.6% (130 partners willing out of 528 sub-total), showing continued volatility in partner engagement.
                        </p>
<p style="margin-bottom: 12px; line-height: 1.6;">
<strong>📊 Partner Base Dynamics:</strong> Total partners contracted from peak of 767 (November) to 551 (February), representing significant portfolio consolidation. 
                            Average willingness across Oct-Feb was 30.0% for willing partners vs 70.0% not-willing, showing persistent engagement challenges.
                        </p>
<p style="margin-bottom: 0; line-height: 1.6;">
<strong>💼 Strategic Recommendation:</strong> Address the February decline by implementing targeted retention and growth incentives. The fluctuation between January's recovery and February's drop suggests 
                            partners respond inconsistently to interventions. Focus on sustaining engagement momentum while addressing root causes of the repeated declines.
                        </p>
</div>
</div>
<!-- JANUARY SUCCESS METRICS TABLE -->
</div>
<!-- TARGET ADJUSTMENT ANALYSIS TAB -->
<!-- EXECUTIVE SUMMARY TAB -->

<!-- FUTURE STRATEGY & ROADMAP TAB -->

</div>
<!-- TARGET ADJUSTMENT ANALYSIS TAB - COMPLETELY REBUILT -->
<div class="tab-content" id="adjustment">
<h2 style="margin-bottom: 25px; color: #1f4e78; font-size: 26px;">🔧 Target Adjustment Analysis - February 2026</h2>
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 30px; margin-bottom: 30px; color: white;">
<h3 style="color: white; font-size: 22px; margin-bottom: 15px;">📊 Strategic Capacity Reduction via Manual Adjustments</h3>
<p style="font-size: 15px; line-height: 1.8; margin: 0;">
This analysis examines manual target adjustments for February 2026. <strong>61 partners received manual adjustments</strong>, resulting in strategic capacity reduction: net <span style="color: #fca5a5;">-173 riders (-8.6%)</span> through +423 additions and -596 reductions. Primary drivers: driver card compliance issues and capacity rebalancing. <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px;">MoM: Partners <span style="color: #fca5a5;">↓50.4%</span> (123→61)</span>
</p>
</div>
<!-- KPI Cards -->
<div class="kpi-grid">
<div class="kpi-card">
<div class="kpi-header">
<span class="kpi-title">Total Partners</span>
<span class="kpi-icon">👥</span>
</div>
<div class="kpi-value">61</div>
<div class="kpi-subtitle">MoM: <span style="color: #dc2626;">↓50.4%</span> (was 123)</div>
</div>
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">Given Target</span>
<span class="kpi-icon">📋</span>
</div>
<div class="kpi-value">2,012</div>
<div class="kpi-subtitle">MoM: <span style="color: #dc2626;">↓52.3%</span> (was 4,221)</div>
</div>
<div class="kpi-card danger">
<div class="kpi-header">
<span class="kpi-title">Adjusted Target</span>
<span class="kpi-icon">📉</span>
</div>
<div class="kpi-value">1,839</div>
<div class="kpi-subtitle negative">-173 (-8.6%)</div>
</div>
<div class="kpi-card warning">
<div class="kpi-header">
<span class="kpi-title">Adjustments (Total capacity moved)</span>
<span class="kpi-icon">🔄</span>
</div>
<div class="kpi-value">1,019</div>
<div class="kpi-subtitle">MoM: <span style="color: #dc2626;">↓47.7%</span> (was ±1,949)</div>
</div>
</div>
<!-- TOTAL CAPACITY MOVED EXPLANATION -->
<div style="background: #fee2e2; border-left: 3px solid #dc2626; border-radius: 6px; padding: 10px 15px; margin-bottom: 20px; font-size: 12px;">
<p style="margin: 0; color: #991b1b; line-height: 1.5;">
<strong style="font-size: 12px;">💡 Total Capacity Moved (1,019):</strong> 
<span style="color: #16a34a;">Total Additions: 423</span> • <span style="color: #dc2626;">Total Reductions: 596</span> • Total: 423 + 596 = 1,019 • Net: <strong>-173 riders</strong>. 
<em>This represents strategic capacity reduction with focus on driver card compliance.</em> <span style="background: rgba(220,38,38,0.1); padding: 2px 6px; border-radius: 4px;">MoM: ↓49.8% capacity movement</span>
</p>
</div>
<!-- GIVEN VS ADJUSTED DEEP DIVE -->
<h3 style="margin: 40px 0 20px; color: #1f4e78; font-size: 22px;">📊 Given Target vs Adjusted Target - Deep Dive</h3>
<div style="background: white; border: 3px solid #3b82f6; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
<h4 style="color: #1e40af; margin-bottom: 20px; font-size: 18px;">🎯 Target Allocation Comparison</h4>
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 25px; margin-bottom: 25px;">
<div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 20px; border-radius: 8px;">
<div style="font-size: 14px; color: #1e40af; font-weight: 600; margin-bottom: 8px;">GIVEN TARGET (BEFORE)</div>
<div style="font-size: 32px; font-weight: 700; color: #1e40af; margin-bottom: 8px;">2,012</div>
<div style="font-size: 13px; color: #64748b;">Algorithmic allocation</div>
<div style="font-size: 13px; color: #64748b;">Average: 33.0 per partner</div>
<div style="font-size: 12px; margin-top: 6px;"><span style="color: #dc2626;">↓52.3%</span> vs Jan (4,221)</div>
</div>
<div style="background: #fee2e2; border-left: 4px solid #dc2626; padding: 20px; border-radius: 8px;">
<div style="font-size: 14px; color: #dc2626; font-weight: 600; margin-bottom: 8px;">ADJUSTED TARGET (AFTER)</div>
<div style="font-size: 32px; font-weight: 700; color: #dc2626; margin-bottom: 8px;">1,839</div>
<div style="font-size: 13px; color: #64748b;">Manual adjustment</div>
<div style="font-size: 13px; color: #64748b;">Average: 30.1 per partner</div>
<div style="font-size: 12px; margin-top: 6px;"><span style="color: #dc2626;">↓56.7%</span> vs Jan (4,246)</div>
</div>
<div style="background: #fee2e2; border-left: 4px solid #dc2626; padding: 20px; border-radius: 8px;">
<div style="font-size: 14px; color: #dc2626; font-weight: 600; margin-bottom: 8px;">NET CHANGE</div>
<div style="font-size: 32px; font-weight: 700; color: #dc2626; margin-bottom: 8px;">-173</div>
<div style="font-size: 13px; color: #64748b;">-8.6% overall</div>
<div style="font-size: 13px; color: #64748b;">+423 added / -596 removed</div>
<div style="font-size: 12px; margin-top: 6px;"><span style="color: #dc2626;">↓792%</span> vs Jan (+25)</div>
</div>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>Change Direction</th>
<th># Of Partners with adjustment</th>
<th>% of Total</th>
<th>Total Capacity Moved</th>
<th>Avg Change per Partner</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr style="background: #d1fae5;">
<td><strong>📈 Target Increases</strong></td>
<td style="font-size: 18px; font-weight: 600;">27</td>
<td style="color: #10b981; font-weight: 600;">44.3%</td>
<td style="color: #10b981; font-weight: 600;">+423 riders</td>
<td style="color: #10b981;">+15.7 riders</td>
<td>🟢 Capacity Addition</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>📉 Target Decreases</strong></td>
<td style="font-size: 18px; font-weight: 600;">34</td>
<td style="color: #dc2626; font-weight: 600;">55.7%</td>
<td style="color: #dc2626; font-weight: 600;">-596 riders</td>
<td style="color: #dc2626;">-17.5 riders</td>
<td>🔴 Capacity Reduction</td>
</tr>
<tr style="background: #e5e7eb;">
<td><strong>➡️ No Change</strong></td>
<td style="font-size: 18px; font-weight: 600;">0</td>
<td>0%</td>
<td>0 riders</td>
<td>-</td>
<td>⚪ Kept Original</td>
</tr>
<tr style="background: #fee2e2; font-weight: bold;">
<td>Total/Net</td>
<td>61</td>
<td>100%</td>
<td style="color: #dc2626; font-weight: 700;">-173 riders</td>
<td style="color: #dc2626;">-2.8 avg</td>
<td>🔴 Net Reduction</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="background: #fee2e2; border-left: 4px solid #dc2626; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
<p style="color: #991b1b; margin: 0; font-size: 14px;"><strong>💡 KEY INSIGHT:</strong> February shows <strong>net capacity reduction (-8.6%)</strong> vs January's slight increase (+0.6%). More partners received decreases (55.7%) than increases (44.3%), with driver card compliance being the primary factor. <span style="background: rgba(220,38,38,0.1); padding: 2px 6px; border-radius: 4px;">MoM: Shift from +25 to -173 net change</span></p>
</div>
<!-- REASON CATEGORIES - BIG HIGHLIGHTED TABLES -->
<h3 style="margin: 40px 0 20px; color: #1f4e78; font-size: 22px;">🎯 ADJUSTMENT REASON CLASSIFICATION</h3>
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 25px; margin-bottom: 25px; color: white;">
<h4 style="color: white; margin-bottom: 15px; font-size: 18px;">📋 Categorized Adjustment Reasons (PMM Comments Analysis)</h4>
<p style="font-size: 14px; line-height: 1.6; margin: 0;">Partners categorized into 12 distinct reason categories based on detailed analysis of PMM adjustment comments. This classification reveals operational gaps, performance patterns, and strategic priorities.</p>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="width: 50px;">Rank</th>
<th>Reason Category</th>
<th>Partners</th>
<th>% of Total</th>
<th>Typical Action</th>
<th>Priority Level</th>
</tr>
</thead>
<tbody>
<tr style="background: #fee2e2;">
<td><strong>1</strong></td>
<td><strong>Driver Card Issues (Low/No Cards)</strong></td>
<td style="font-size: 20px; font-weight: 700; color: #dc2626;">23</td>
<td style="font-size: 18px; font-weight: 700; color: #dc2626;">37.7%</td>
<td>⬇️⬇️ Heavy Reduction</td>
<td><span style="background: #dc2626; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">🔴 CRITICAL</span></td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>2</strong></td>
<td><strong>FR/Performance Non-Compliance</strong></td>
<td style="font-size: 20px; font-weight: 700; color: #dc2626;">8</td>
<td style="font-size: 18px; font-weight: 700; color: #dc2626;">13.1%</td>
<td>⬇️⬇️ Target Cut</td>
<td><span style="background: #dc2626; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">🔴 COMPLIANCE</span></td>
</tr>
<tr style="background: #fef3c7;">
<td><strong>3</strong></td>
<td><strong>2% Buffer/Demand Gap Coverage</strong></td>
<td style="font-size: 18px; font-weight: 600;">7</td>
<td style="font-size: 16px; font-weight: 600;">11.5%</td>
<td>⬆️ Capacity Buffer</td>
<td><span style="background: #f59e0b; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">🟡 STRATEGIC</span></td>
</tr>
<tr style="background: #e0f2fe;">
<td><strong>4</strong></td>
<td><strong>New Partner Onboarding</strong></td>
<td style="font-size: 16px; font-weight: 600;">5</td>
<td>8.2%</td>
<td>🆕 Initial Setup</td>
<td><span style="background: #3b82f6; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">🔵 SUPPORT</span></td>
</tr>
<tr style="background: #d1fae5;">
<td><strong>5</strong></td>
<td><strong>Capacity Transfer/Redistribution</strong></td>
<td style="font-size: 16px; font-weight: 600;">4</td>
<td>6.6%</td>
<td>↔️ Transfer to capable</td>
<td><span style="background: #10b981; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">🟢 REBALANCE</span></td>
</tr>
<tr style="background: #fef3c7;">
<td><strong>6</strong></td>
<td><strong>High Performance Reward</strong></td>
<td style="font-size: 16px; font-weight: 600;">3</td>
<td>4.9%</td>
<td>⬆️ Capacity Increase</td>
<td><span style="background: #10b981; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">🟢 REWARD</span></td>
</tr>
<tr>
<td><strong>7</strong></td>
<td><strong>Partner Inability to Fulfill</strong></td>
<td>2</td>
<td>3.3%</td>
<td>⬇️ Reduce Target</td>
<td>🟠 REVIEW</td>
</tr>
<tr>
<td><strong>8</strong></td>
<td><strong>City Capacity Need</strong></td>
<td>2</td>
<td>3.3%</td>
<td>⬆️ Fill Gap</td>
<td>🔵 STRATEGIC</td>
</tr>
<tr style="background: #e5e7eb;">
<td><strong>9</strong></td>
<td><strong>Other/Mixed Reasons</strong></td>
<td style="font-size: 16px; font-weight: 600;">7</td>
<td>11.5%</td>
<td>🔄 Varied</td>
<td><span style="background: #6b7280; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">⚪ MIXED</span></td>
</tr>
<tr style="background: #1f2937; color: white; font-weight: bold;">
<td colspan="2">TOTAL</td>
<td>61</td>
<td>100.0%</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
<!-- Critical Findings Boxes -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
<div style="background: #fee2e2; border-left: 6px solid #dc2626; border-radius: 12px; padding: 20px;">
<h4 style="color: #991b1b; margin-bottom: 12px; font-size: 16px;">🚨 TOP REDUCTION REASON</h4>
<div style="font-size: 36px; font-weight: 700; color: #dc2626; margin: 10px 0;">50.8%</div>
<p style="color: #7f1d1d; font-size: 13px; margin: 0; line-height: 1.6;">
<strong>31 partners reduced</strong> for driver card issues (37.7%) and FR/performance non-compliance (13.1%). Driver card availability is the #1 adjustment driver in February.
</p>
</div>
<div style="background: #fef3c7; border-left: 6px solid #f59e0b; border-radius: 12px; padding: 20px;">
<h4 style="color: #92400e; margin-bottom: 12px; font-size: 16px;">📊 STRATEGIC ALLOCATIONS</h4>
<div style="font-size: 36px; font-weight: 700; color: #f59e0b; margin: 10px 0;">26.2%</div>
<p style="color: #78350f; font-size: 13px; margin: 0; line-height: 1.6;">
<strong>16 partners</strong> adjusted for strategic reasons: 2% buffer (7), new partner support (5), and capacity transfer (4). Focus on demand coverage and redistribution.
</p>
</div>
</div>
<div style="background: #fee2e2; border-left: 6px solid #dc2626; border-radius: 12px; padding: 20px; margin-top: 20px;">
<h4 style="color: #991b1b; margin-bottom: 12px; font-size: 16px;">🚗 Driver Card Compliance Crisis</h4>
<p style="color: #991b1b; font-size: 14px; margin: 0; line-height: 1.8;">
February shows <strong>driver card issues as the dominant factor</strong> affecting 50.8% of all adjustments (31 partners). This represents a significant shift from January's performance-based adjustments. <span style="background: rgba(220,38,38,0.15); padding: 2px 6px; border-radius: 4px;">MoM: Driver card issues now primary driver vs performance penalties</span>
</p>
</div>

<!-- CITY-LEVEL ANALYSIS -->
<h3 style="margin: 40px 0 20px; color: #1f4e78; font-size: 20px;">🏙️ City-Level Adjustment Analysis</h3>
<div class="table-container">
<table class="compact-table">
<thead>
<tr>
<th>City</th>
<th>Partners</th>
<th>Given Target</th>
<th>Adjusted Target</th>
<th>Net Change</th>
<th>Avg Change</th>
<th>Increases</th>
<th>Decreases</th>
<th>% Change</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr style="background: #fee2e2;">
<td><strong>Riyadh</strong></td>
<td>40</td>
<td>1,769</td>
<td>1,620</td>
<td class="negative" style="font-size: 16px; font-weight: 700;">-149</td>
<td class="negative">-3.7</td>
<td>14</td>
<td style="font-weight: 600;">25</td>
<td class="negative" style="font-weight: 600;">-8.4%</td>
<td>🔴 Major Reduction</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>Jeddah</strong></td>
<td>8</td>
<td>119</td>
<td>0</td>
<td class="negative" style="font-size: 16px; font-weight: 700;">-119</td>
<td class="negative">-14.9</td>
<td>0</td>
<td style="font-weight: 600;">8</td>
<td class="negative" style="font-weight: 600;">-100%</td>
<td>🔴 Complete Removal</td>
</tr>
<tr style="background: #d1fae5;">
<td>Tabuk</td>
<td>2</td>
<td>45</td>
<td>50</td>
<td class="positive">+5</td>
<td class="positive">+2.5</td>
<td style="font-weight: 600;">2</td>
<td>0</td>
<td class="positive">+11.1%</td>
<td>🟢 Growth</td>
</tr>
<tr style="background: #d1fae5;">
<td>Taif</td>
<td>4</td>
<td>35</td>
<td>45</td>
<td class="positive">+10</td>
<td class="positive">+2.5</td>
<td style="font-weight: 600;">3</td>
<td>1</td>
<td class="positive">+28.6%</td>
<td>🟢 Growth</td>
</tr>
<tr style="background: #fef9c3;">
<td>Makkah</td>
<td>2</td>
<td>44</td>
<td>44</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0%</td>
<td>⚪ Balanced</td>
</tr>
<tr style="background: #d1fae5;">
<td>Madinah</td>
<td>2</td>
<td>0</td>
<td>29</td>
<td class="positive" style="font-weight: 600;">+29</td>
<td class="positive">+14.5</td>
<td style="font-weight: 600;">2</td>
<td>0</td>
<td class="positive" style="font-weight: 600;">N/A</td>
<td>🟢 New Activation</td>
</tr>
<tr style="background: #d1fae5;">
<td>Jubail</td>
<td>1</td>
<td>0</td>
<td>25</td>
<td class="positive" style="font-weight: 600;">+25</td>
<td class="positive">+25.0</td>
<td style="font-weight: 600;">1</td>
<td>0</td>
<td class="positive" style="font-weight: 600;">N/A</td>
<td>🟢 New Activation</td>
</tr>
<tr style="background: #d1fae5;">
<td>Al Ahsa</td>
<td>1</td>
<td>0</td>
<td>16</td>
<td class="positive">+16</td>
<td class="positive">+16.0</td>
<td style="font-weight: 600;">1</td>
<td>0</td>
<td class="positive">N/A</td>
<td>🟢 New Activation</td>
</tr>
<tr style="background: #d1fae5;">
<td>Jazan</td>
<td>1</td>
<td>0</td>
<td>10</td>
<td class="positive">+10</td>
<td class="positive">+10.0</td>
<td style="font-weight: 600;">1</td>
<td>0</td>
<td class="positive">N/A</td>
<td>🟢 New Activation</td>
</tr>
<tr style="background: #fee2e2; font-weight: bold;">
<td>TOTAL</td>
<td>61</td>
<td>2,012</td>
<td>1,839</td>
<td class="negative">-173</td>
<td class="negative">-2.8</td>
<td>27</td>
<td>34</td>
<td class="negative">-8.6%</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
<div style="background: #fee2e2; border-left: 4px solid #dc2626; border-radius: 8px; padding: 15px; margin-top: 20px;">
<p style="color: #991b1b; margin: 0; font-size: 14px;"><strong>🔍 Key City Insights:</strong> Riyadh accounts for 65.6% of all adjusted partners (40/61) with net <span style="color: #dc2626; font-weight: 600;">-149 riders (-8.4%)</span>. Jeddah saw complete removal (-119, -100%) of all 8 partners' targets. New city activations: Madinah (+29), Jubail (+25), Al Ahsa (+16), Jazan (+10). <span style="background: rgba(220,38,38,0.1); padding: 2px 6px; border-radius: 4px;">MoM: Significant reduction vs Jan's +18 net in Riyadh</span></p>
</div>
<div class="chart-container" style="margin-top: 30px;">
<h3 class="chart-title">City-Level Target Changes (Top Cities)</h3>
<canvas id="adjustmentCityChart"></canvas>
</div>
<!-- PERFORMANCE IMPACT ANALYSIS -->
<h3 style="margin: 40px 0 20px; color: #1f4e78; font-size: 20px;">📊 Performance Impact Analysis</h3>
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px;">
<div style="background: #0f172a; color: white; border-radius: 10px; padding: 12px 14px;">
<div style="font-size: 11px; color: #cbd5f5;">Net Change</div>
<div style="font-size: 18px; font-weight: 700;">-173</div>
<div style="font-size: 11px; color: #fca5a5;">-8.6% vs Jan</div>
</div>
<div style="background: #0b3b2e; color: white; border-radius: 10px; padding: 12px 14px;">
<div style="font-size: 11px; color: #bbf7d0;">Capacity Moved</div>
<div style="font-size: 18px; font-weight: 700;">1,019</div>
<div style="font-size: 11px; color: #fca5a5;">-47.7% vs Jan</div>
</div>
<div style="background: #3f1d0f; color: white; border-radius: 10px; padding: 12px 14px;">
<div style="font-size: 11px; color: #fed7aa;">Driver Card 0-50%</div>
<div style="font-size: 18px; font-weight: 700;">-280 net</div>
<div style="font-size: 11px; color: #fde68a;">44 partners impacted</div>
</div>
<div style="background: #1e293b; color: white; border-radius: 10px; padding: 12px 14px;">
<div style="font-size: 11px; color: #cbd5e1;">High FR (80-100%)</div>
<div style="font-size: 18px; font-weight: 700;">-322 net</div>
<div style="font-size: 11px; color: #fca5a5;">Primary reduction pool</div>
</div>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
<!-- Quarterly Performance -->
<div style="background: white; border: 2px solid #cbd5e1; border-radius: 12px; padding: 20px;">
<h4 style="color: #1f4e78; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; justify-content: space-between;">
<span>📅 Quarterly Performance Impact</span>
<svg width="68" height="18" viewBox="0 0 68 18" aria-hidden="true">
<polyline fill="none" stroke="#64748b" stroke-width="2" points="2,6 22,4 44,10 66,14" />
</svg>
</h4>
<div class="table-container">
<table style="font-size: 12px;">
<thead>
<tr>
<th>Performance</th>
<th>Partners</th>
<th>Given</th>
<th>Adjusted</th>
<th>Net (Vs Jan)</th>
<th>Avg</th>
</tr>
</thead>
<tbody>
<tr style="background: #d1fae5;">
<td><strong>Good</strong></td>
<td>43</td>
<td>1,615</td>
<td>1,267</td>
<td class="negative">-348<div style="font-size: 11px; color: #64748b;">Jan -431 | <span style="color: #16a34a;">MoM +19.3% ^</span></div></td>
<td class="negative">-8.1</td>
</tr>
<tr style="background: #fef3c7;">
<td><strong>Average</strong></td>
<td>47</td>
<td>277</td>
<td>247</td>
<td class="negative">-30<div style="font-size: 11px; color: #64748b;">Jan -61 | <span style="color: #16a34a;">MoM +50.8% ^</span></div></td>
<td class="negative">-0.6</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>Bad</strong></td>
<td>25</td>
<td>32</td>
<td>149</td>
<td class="positive">+117<div style="font-size: 11px; color: #64748b;">Jan +322 | <span style="color: #dc2626;">MoM -63.7% v</span></div></td>
<td class="positive">+4.7</td>
</tr>
</tbody>
</table>
</div>
<p style="font-size: 11px; color: #64748b; margin-top: 10px;">⚠️ "Bad" partners remain positive (+117) but below Jan (+322). Good partners improved vs Jan, yet remain net negative.</p>
</div>
<!-- New vs Old -->
<div style="background: white; border: 2px solid #cbd5e1; border-radius: 12px; padding: 20px;">
<h4 style="color: #1f4e78; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; justify-content: space-between;">
<span>🆕 New vs Old Partners</span>
<svg width="68" height="18" viewBox="0 0 68 18" aria-hidden="true">
<polyline fill="none" stroke="#64748b" stroke-width="2" points="2,12 22,10 44,6 66,8" />
</svg>
</h4>
<div class="table-container">
<table style="font-size: 12px;">
<thead>
<tr>
<th>Type</th>
<th>Partners</th>
<th>Given</th>
<th>Adjusted</th>
<th>Net (Vs Jan)</th>
<th>Avg</th>
</tr>
</thead>
<tbody>
<tr style="background: #d1fae5;">
<td><strong>New</strong></td>
<td>13</td>
<td>133</td>
<td>188</td>
<td class="positive">+55<div style="font-size: 11px; color: #64748b;">Jan +149 | <span style="color: #dc2626;">MoM -63.1% v</span></div></td>
<td class="positive">+4.2</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>Old</strong></td>
<td>40</td>
<td>1,801</td>
<td>1,490</td>
<td class="negative">-311<div style="font-size: 11px; color: #64748b;">Jan -319 | <span style="color: #16a34a;">MoM +2.5% ^</span></div></td>
<td class="negative">-7.8</td>
</tr>
</tbody>
</table>
</div>
<p style="font-size: 11px; color: #64748b; margin-top: 10px;">📊 New partner support reduced vs Jan (+55 vs +149). Old partner reductions remain large (-311 vs -319).</p>
</div>
<!-- FR Rate Impact -->
<div style="background: white; border: 2px solid #cbd5e1; border-radius: 12px; padding: 20px;">
<h4 style="color: #1f4e78; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; justify-content: space-between;">
<span>📸 FR Rate Impact</span>
<svg width="68" height="18" viewBox="0 0 68 18" aria-hidden="true">
<polyline fill="none" stroke="#64748b" stroke-width="2" points="2,10 22,14 44,6 66,12" />
</svg>
</h4>
<div class="table-container">
<table style="font-size: 12px;">
<thead>
<tr>
<th>FR Range</th>
<th>Partners</th>
<th>Given</th>
<th>Adjusted</th>
<th>Net (Vs Jan)</th>
<th>Avg</th>
</tr>
</thead>
<tbody>
<tr style="background: #d1fae5;">
<td><strong>0-30%</strong></td>
<td>1</td>
<td>10</td>
<td>15</td>
<td class="positive">+5<div style="font-size: 11px; color: #64748b;">Jan +106 | <span style="color: #dc2626;">MoM -95.3% v</span></div></td>
<td class="positive">+5.0</td>
</tr>
<tr>
<td><strong>30-50%</strong></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0<div style="font-size: 11px; color: #64748b;">Jan +39 | <span style="color: #dc2626;">MoM -100% v</span></div></td>
<td>0.0</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>50-70%</strong></td>
<td>3</td>
<td>22</td>
<td>11</td>
<td class="negative">-11<div style="font-size: 11px; color: #64748b;">Jan -144 | <span style="color: #16a34a;">MoM +92.4% ^</span></div></td>
<td class="negative">-3.7</td>
</tr>
<tr>
<td><strong>70-80%</strong></td>
<td>5</td>
<td>110</td>
<td>182</td>
<td class="positive">+72<div style="font-size: 11px; color: #64748b;">Jan -33 | <span style="color: #16a34a;">MoM +318.2% ^</span></div></td>
<td class="positive">+14.4</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>80-100%</strong></td>
<td>44</td>
<td>1,792</td>
<td>1,470</td>
<td class="negative">-322<div style="font-size: 11px; color: #64748b;">Jan -240 | <span style="color: #dc2626;">MoM -34.2% v</span></div></td>
<td class="negative">-7.3</td>
</tr>
<tr>
<td><strong>No FR rate</strong></td>
<td>8</td>
<td>78</td>
<td>161</td>
<td class="positive">+83<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="positive">+10.4</td>
</tr>
<tr style="background: #e5e7eb; font-weight: 700;">
<td>Total</td>
<td>61</td>
<td>2,012</td>
<td>1,839</td>
<td class="negative">-173<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="negative">-2.8</td>
</tr>
</tbody>
</table>
</div>
<p style="font-size: 11px; color: #64748b; margin-top: 10px;">High FR (80-100%) absorbed most cuts (-322 vs Jan -240). Mid-range 70-80% swung from -33 to +72.</p>
</div>
<!-- Driver Card Impact -->
<div style="background: white; border: 2px solid #cbd5e1; border-radius: 12px; padding: 20px;">
<h4 style="color: #1f4e78; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; justify-content: space-between;">
<span>🪪 Driver Card Impact</span>
<svg width="68" height="18" viewBox="0 0 68 18" aria-hidden="true">
<polyline fill="none" stroke="#64748b" stroke-width="2" points="2,8 22,10 44,12 66,6" />
</svg>
</h4>
<div class="table-container">
<table style="font-size: 12px;">
<thead>
<tr>
<th>Range</th>
<th>Partners</th>
<th>Given</th>
<th>Adjusted</th>
<th>Net (Vs Jan)</th>
<th>Avg</th>
</tr>
</thead>
<tbody>
<tr style="background: #fee2e2;">
<td><strong>0-10%</strong></td>
<td>28</td>
<td>898</td>
<td>746</td>
<td class="negative">-152<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="negative">-5.4</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>10-30%</strong></td>
<td>8</td>
<td>400</td>
<td>342</td>
<td class="negative">-58<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="negative">-7.3</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>30-50%</strong></td>
<td>8</td>
<td>326</td>
<td>256</td>
<td class="negative">-70<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="negative">-8.8</td>
</tr>
<tr style="background: #fee2e2;">
<td><strong>50-80%</strong></td>
<td>2</td>
<td>129</td>
<td>100</td>
<td class="negative">-29<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="negative">-14.5</td>
</tr>
<tr style="background: #d1fae5;">
<td><strong>80-100%</strong></td>
<td>7</td>
<td>181</td>
<td>234</td>
<td class="positive">+53<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="positive">+7.6</td>
</tr>
<tr>
<td><strong>No DC rate</strong></td>
<td>8</td>
<td>78</td>
<td>161</td>
<td class="positive">+83<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="positive">+10.4</td>
</tr>
<tr style="background: #e5e7eb; font-weight: 700;">
<td>Total</td>
<td>61</td>
<td>2,012</td>
<td>1,839</td>
<td class="negative">-173<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td class="negative">-2.8</td>
</tr>
</tbody>
</table>
</div>
<p style="font-size: 11px; color: #64748b; margin-top: 10px;">Driver card 0-50% accounts for -280 net across 44 partners. Jan values not provided for this table.</p>
</div>
</div>
<div style="background: #ede9fe; border-left: 6px solid #8b5cf6; border-radius: 12px; padding: 20px; margin-top: 20px;">
<h4 style="color: #6b21a8; margin-bottom: 12px; font-size: 16px;">🤔 Counterintuitive Findings Require Investigation</h4>
<div style="color: #6b21a8; font-size: 14px; line-height: 1.8;">
<p><strong>1. "Bad" Quarterly Performance Partners Still Receive Net Increases:</strong><br/>
25 partners classified as "Bad" received +117 net riders (+4.7 avg) while "Good" partners lost -348 net riders (-8.1 avg).</p>
<p><strong>2. FR vs Allocation Mismatch:</strong><br/>
High FR (80-100%) absorbed -322 net cuts while 70-80% gained +72 and No FR rate gained +83. This diverges from quality-first allocation.</p>
<p><strong>3. Driver Card Compliance Concentration:</strong><br/>
Partners with 0-50% driver card compliance account for -280 net change across 44 partners, outweighing any high-compliance gains.</p>
<p><strong>Possible Explanations:</strong><br/>
• Low-performance and low-FR partners may be new partners in ramp-up support programs<br/>
• High-performing partners could be over-allocated in January and corrected in February<br/>
• Driver card compliance gates may override performance metrics in manual adjustments<br/>
• Cross-referencing needed: Are "bad" partners also "new" and low driver card compliance?</p>
</div>
</div>
<!-- STRATEGIC INSIGHTS -->
<details id="strategic-insights" style="margin: 40px 0 20px; border: 2px solid #e5e7eb; border-radius: 10px; padding: 14px; background: #f9fafb;">
<summary style="cursor: pointer; font-size: 20px; font-weight: 700; color: #1f4e78; display: flex; align-items: center; gap: 10px; list-style: none;">
<span id="insightsArrow" style="font-size: 18px; color: #1f4e78;">▶</span>
<span>💡 Strategic Insights &amp; Key Findings — click to expand/collapse</span>
</summary>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px; margin-bottom: 10px;">
<div style="background: white; border-left: 6px solid #dc2626; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
<h4 style="color: #dc2626; margin-bottom: 15px; font-size: 16px;">1️⃣ Driver Card Compliance Crisis (37.7%)</h4>
<p style="font-size: 14px; color: #374151; line-height: 1.7; margin: 0;">
<strong>23 of 61 partners adjusted</strong> due to driver card availability issues. This is the dominant factor in February, replacing January's performance-based adjustments. Represents a shift in operational priorities.
</p>
</div>
<div style="background: white; border-left: 6px solid #10b981; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
<h4 style="color: #10b981; margin-bottom: 15px; font-size: 16px;">2️⃣ Significant Capacity Reduction (-8.6%)</h4>
<p style="font-size: 14px; color: #374151; line-height: 1.7; margin: 0;">
<strong>Net change -173 riders (-8.6%)</strong> vs January's +25. 27 partners gained +423 riders, while 34 partners lost -596 riders. This reflects tighter capacity management and performance-based culling.
</p>
</div>
<div style="background: white; border-left: 6px solid #f59e0b; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
<h4 style="color: #f59e0b; margin-bottom: 15px; font-size: 16px;">3️⃣ Compliance-Driven Adjustments (50.8%)</h4>
<p style="font-size: 14px; color: #374151; line-height: 1.7; margin: 0;">
<strong>Driver card (37.7%) + FR/Performance (13.1%)</strong> = 50.8% of adjustments. Compliance is now the primary adjustment driver. Strategic allocations (buffer, new partner, capacity transfer) account for 26.2%.
</p>
</div>
<div style="background: white; border-left: 6px solid #8b5cf6; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
<h4 style="color: #8b5cf6; margin-bottom: 15px; font-size: 16px;">4️⃣ City-Level Concentration</h4>
<p style="font-size: 14px; color: #374151; line-height: 1.7; margin: 0;">
<strong>Riyadh: 40 partners (-149 net)</strong><br/>
<strong>Jeddah: 8 partners (-119 net)</strong><br/>
Two cities account for 78.7% of partners and most net reductions. Smaller cities (Tabuk, Taif, Madinah, Jubail, Al Ahsa, Jazan) showing positive net changes.
</p>
</div>
<div style="background: white; border-left: 6px solid #3b82f6; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
<h4 style="color: #3b82f6; margin-bottom: 15px; font-size: 16px;">5️⃣ Old Partner Capacity Reduction</h4>
<p style="font-size: 14px; color: #374151; line-height: 1.7; margin: 0;">
<strong>40 old partners received -311 net riders</strong> while 13 new partners gained +55 net riders. Established partners face stricter compliance enforcement while new partners receive support for ramp-up.
</p>
</div>
<div style="background: white; border-left: 6px solid #ec4899; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
<h4 style="color: #ec4899; margin-bottom: 15px; font-size: 16px;">6️⃣ Portfolio Streamlining</h4>
<p style="font-size: 14px; color: #374151; line-height: 1.7; margin: 0;">
<strong>50.4% fewer partners adjusted</strong> (61 vs 123 in January). Suggests either more focused intervention or reduced partner base. Average adjustment impact: -3.5 riders per partner vs +0.2 in January.
</p>
</div>
</div>
<!-- Collapsed additions: Recommendations + Executive Summary -->
<div style="background: #f0fdf4; border: 3px solid #10b981; border-radius: 12px; padding: 30px; margin-top: 16px;">
<h3 style="color: #065f46; font-size: 20px; margin-bottom: 20px;">🎯 Recommendations</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
<div>
<h4 style="color: #047857; margin-bottom: 12px; font-size: 15px;">📋 Process Improvements</h4>
<ol style="color: #065f46; font-size: 13px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li><strong>Driver Card Program:</strong> Address the 37.7% driver card issue rate through partner education and support programs.</li>
<li><strong>Compliance Monitoring:</strong> Implement real-time driver card availability tracking to proactively address issues before target adjustments.</li>
<li><strong>FR% Improvement Program:</strong> Target the 13.1% FR/performance non-compliance with specific intervention plans.</li>
<li><strong>New Partner Onboarding:</strong> Continue supporting new partners (8.2%) with ramp-up programs while monitoring quality metrics.</li>
</ol>
</div>
<div>
<h4 style="color: #047857; margin-bottom: 12px; font-size: 15px;">🔧 Model Enhancements</h4>
<ol style="color: #065f46; font-size: 13px; line-height: 1.8; margin: 0; padding-left: 20px;">
<li><strong>Add Driver Card Gate:</strong> Integrate driver card availability as hard prerequisite before capacity allocation.</li>
<li><strong>FR% Thresholds:</strong> Set minimum FR% requirement for capacity maintenance (e.g., 50% minimum).</li>
<li><strong>City-Specific Parameters:</strong> Model Riyadh and Jeddah separately given their 78.7% share of adjustments.</li>
<li><strong>New Partner Protection:</strong> Add explicit "new partner ramp-up" period (3-6 months) with modified targets.</li>
<li><strong>2% Buffer Optimization:</strong> Review and potentially automate the 11.5% of 2% buffer adjustments.</li>
<li><strong>Capacity Transfer Rules:</strong> Formalize capacity transfer criteria to reduce manual interventions.</li>
</ol>
</div>
</div>
</div>
<div style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border-radius: 12px; padding: 30px; margin-top: 16px; color: white;">
<h3 style="color: white; font-size: 20px; margin-bottom: 15px;">📌 Executive Summary</h3>
<div style="font-size: 14px; line-height: 2.0;">
<p style="margin: 0;">• <strong>Driver card compliance crisis:</strong> 37.7% of adjustments (23 partners) due to driver card availability issues — now #1 driver</p>
<p style="margin: 0;">• <strong>Net -173 riders (-8.6%)</strong> vs January's +25: 27 partners +423, 34 partners -596 — significant capacity reduction</p>
<p style="margin: 0;">• <strong>50.8% compliance-driven</strong> adjustments (driver card 37.7% + FR/performance 13.1%) vs strategic allocations (26.2%)</p>
<p style="margin: 0;">• <strong>Old partners reduced:</strong> 40 old partners lost -311 net riders while 13 new partners gained +55 net</p>
<p style="margin: 0;">• <strong>Riyadh &amp; Jeddah dominate:</strong> 48 partners (78.7%), -268 combined net reduction</p>
<p style="margin: 0;">• <strong>Smaller cities positive:</strong> Tabuk +5, Taif +10, Madinah +29, Jubail +25, Al Ahsa +16, Jazan +10</p>
<p style="margin: 0;">• <strong>50.4% fewer partners adjusted</strong> (61 vs 123): More focused intervention or reduced partner base</p>
</div>
</div>
</details>
<!-- PMM Analysis -->
<details id="pmm-details" style="margin-top: 40px; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px; background: #f9fafb;">
<summary style="cursor: pointer; font-size: 20px; font-weight: 700; color: #1f4e78; display: flex; align-items: center; gap: 10px; list-style: none; margin-bottom: 12px;">
<span id="pmmArrow" style="font-size: 18px; color: #1f4e78;">▶</span>
<span>👨‍💼 PMM Adjustment Summary</span>
</summary>
<div style="background: #fef9c3; border: 2px solid #f59e0b; border-radius: 10px; padding: 12px 14px; margin: 0 0 10px 0; font-size: 13px; color: #92400e;">
21 PMMs recorded manual adjustments for 61 partners. Click on each PMM row to expand and view their managed brands. <span style="background: rgba(220,38,38,0.15); padding: 2px 6px; border-radius: 4px;">MoM: ↓50.4% partners adjusted (was 123)</span>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>PMM Name</th>
<th>Partners Managed</th>
<th>Adjustments Made</th>
<th>Adjustment Rate</th>
</tr>
</thead>
<tbody>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Abdul Aziz</span></td>
<td>14<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td>4<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td style="color: #dc2626; font-weight: 600;">28.6%<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Farsan<br>Masar almrafiq<br>Meyzat Al-Takamul<br>Mountain logistics
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Faisal Alghamdi</span></td>
<td>22<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td style="color: #dc2626; font-weight: 600;">9.1%<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
ِAlastool almuntaim<br>alshuhna almumayaza
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Asad Javed</span></td>
<td>15<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td style="color: #dc2626; font-weight: 600;">13.3%<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
ASIL AL-IZZ<br>Delivery heroes limited
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Ali Ibrahim</span></td>
<td>16<div style="font-size: 11px; color: #64748b;">Jan 12 | <span style="color: #16a34a;">MoM +33.3% ^</span></div></td>
<td>4<div style="font-size: 11px; color: #64748b;">Jan 1 | <span style="color: #16a34a;">MoM +300.0% ^</span></div></td>
<td style="color: #dc2626; font-weight: 600;">25.0%<div style="font-size: 11px; color: #64748b;">Jan 8.3% | <span style="color: #16a34a;">MoM +200.0% ^</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Adlek<br>AL-BARAQ AL-KHATEF<br>MAF<br>Sultan abdulaziz saad Albathrah for logistic services
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ 彭兵</span></td>
<td>19<div style="font-size: 11px; color: #64748b;">Jan 7 | <span style="color: #16a34a;">MoM +171.4% ^</span></div></td>
<td>4<div style="font-size: 11px; color: #64748b;">Jan 1 | <span style="color: #16a34a;">MoM +300.0% ^</span></div></td>
<td style="color: #dc2626; font-weight: 600;">21.1%<div style="font-size: 11px; color: #64748b;">Jan 14.3% | <span style="color: #16a34a;">MoM +47.4% ^</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
AREEJ (2)<br>Nebras<br>Step Logistic
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Adilahmed Mohammad</span></td>
<td>23<div style="font-size: 11px; color: #64748b;">Jan 20 | <span style="color: #16a34a;">MoM +15.0% ^</span></div></td>
<td>3<div style="font-size: 11px; color: #64748b;">Jan 5 | <span style="color: #dc2626;">MoM -40.0% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">13.0%<div style="font-size: 11px; color: #64748b;">Jan 25.0% | <span style="color: #dc2626;">MoM -48.0% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
MasarMomaiz Co logistics Services<br>Nukhba<br>YANABEE
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Abdullah Aldweik</span></td>
<td>16<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td>3<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td style="color: #dc2626; font-weight: 600;">18.8%<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Barq AlIbda<br>Tomorrow's Falcons Company<br>Trax
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Anas Ejaz</span></td>
<td>18<div style="font-size: 11px; color: #64748b;">Jan 23 | <span style="color: #dc2626;">MoM -21.7% v</span></div></td>
<td>3<div style="font-size: 11px; color: #64748b;">Jan 4 | <span style="color: #dc2626;">MoM -25.0% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">16.7%<div style="font-size: 11px; color: #64748b;">Jan 17.4% | <span style="color: #dc2626;">MoM -4.0% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
NADA<br>wjahat khaleej<br>Zahra Al Rawda
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Abdulrehman Qureshi</span></td>
<td>20<div style="font-size: 11px; color: #64748b;">Jan 13 | <span style="color: #16a34a;">MoM +53.8% ^</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan 6 | <span style="color: #dc2626;">MoM -66.7% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">10.0%<div style="font-size: 11px; color: #64748b;">Jan 46.2% | <span style="color: #dc2626;">MoM -78.3% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
AHMED SHUAIB GHAZWAN<br>Anan Capital
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Muzammil Ahmed</span></td>
<td>19<div style="font-size: 11px; color: #64748b;">Jan 9 | <span style="color: #16a34a;">MoM +111.1% ^</span></div></td>
<td>4<div style="font-size: 11px; color: #64748b;">Jan 4 | <span style="color: #6b7280;">MoM 0.0% =</span></div></td>
<td style="color: #dc2626; font-weight: 600;">21.1%<div style="font-size: 11px; color: #64748b;">Jan 44.4% | <span style="color: #dc2626;">MoM -52.6% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Bawadir<br>Husool<br>Innovation Gate<br>KAVAA ALTOSEIL
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ 黎嘉豪</span></td>
<td>19<div style="font-size: 11px; color: #64748b;">Jan 30 | <span style="color: #dc2626;">MoM -36.7% v</span></div></td>
<td>6<div style="font-size: 11px; color: #64748b;">Jan 17 | <span style="color: #dc2626;">MoM -64.7% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">31.6%<div style="font-size: 11px; color: #64748b;">Jan 56.7% | <span style="color: #dc2626;">MoM -44.3% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
ABDULMHASSEN AZAIZ BAYJAN AL-ROQI<br>Aibtukir<br>Aldaem Alkhaleejiah<br>E-ter logistics<br>Razan Altabi Logiestics<br>Yuma
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Aamir Ibrahim</span></td>
<td>18<div style="font-size: 11px; color: #64748b;">Jan 37 | <span style="color: #dc2626;">MoM -51.4% v</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan 19 | <span style="color: #dc2626;">MoM -89.5% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">11.1%<div style="font-size: 11px; color: #64748b;">Jan 51.4% | <span style="color: #dc2626;">MoM -78.4% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Masar<br>ZIYAR
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Shahid Ali</span></td>
<td>19<div style="font-size: 11px; color: #64748b;">Jan 28 | <span style="color: #dc2626;">MoM -32.1% v</span></div></td>
<td>3<div style="font-size: 11px; color: #64748b;">Jan 15 | <span style="color: #dc2626;">MoM -80.0% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">15.8%<div style="font-size: 11px; color: #64748b;">Jan 53.6% | <span style="color: #dc2626;">MoM -70.5% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Driver KM logistics<br>Nader logistics<br>services delivery
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Abdul Basitmalik</span></td>
<td>16<div style="font-size: 11px; color: #64748b;">Jan 40 | <span style="color: #dc2626;">MoM -60.0% v</span></div></td>
<td>6<div style="font-size: 11px; color: #64748b;">Jan 19 | <span style="color: #dc2626;">MoM -68.4% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">37.5%<div style="font-size: 11px; color: #64748b;">Jan 47.5% | <span style="color: #dc2626;">MoM -21.1% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Code Car<br>DRER AL-TANAFITHIH<br>Easy Trip For Logistics Services<br>MDT<br>Shdh Logistics<br>Sultan Bin Abdullah
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Junaid Munir</span></td>
<td>14<div style="font-size: 11px; color: #64748b;">Jan 9 | <span style="color: #16a34a;">MoM +55.6% ^</span></div></td>
<td>1<div style="font-size: 11px; color: #64748b;">Jan 3 | <span style="color: #dc2626;">MoM -66.7% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">7.1%<div style="font-size: 11px; color: #64748b;">Jan 33.3% | <span style="color: #dc2626;">MoM -78.6% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Mostaqbal Watan
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Malik Nassar</span></td>
<td>16<div style="font-size: 11px; color: #64748b;">Jan 19 | <span style="color: #dc2626;">MoM -15.8% v</span></div></td>
<td>1<div style="font-size: 11px; color: #64748b;">Jan 1 | <span style="color: #6b7280;">MoM 0.0% =</span></div></td>
<td style="color: #dc2626; font-weight: 600;">6.3%<div style="font-size: 11px; color: #64748b;">Jan 5.3% | <span style="color: #16a34a;">MoM +18.8% ^</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
DTD
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Muhannad Atallah</span></td>
<td>16<div style="font-size: 11px; color: #64748b;">Jan 23 | <span style="color: #dc2626;">MoM -30.4% v</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan 1 | <span style="color: #16a34a;">MoM +100.0% ^</span></div></td>
<td style="color: #dc2626; font-weight: 600;">12.5%<div style="font-size: 11px; color: #64748b;">Jan 4.3% | <span style="color: #16a34a;">MoM +187.5% ^</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
alahdaf aldhahabiya<br>RAYA AL-IMDAD
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Adnan Siddique</span></td>
<td>14<div style="font-size: 11px; color: #64748b;">Jan 18 | <span style="color: #dc2626;">MoM -22.2% v</span></div></td>
<td>4<div style="font-size: 11px; color: #64748b;">Jan 2 | <span style="color: #16a34a;">MoM +100.0% ^</span></div></td>
<td style="color: #dc2626; font-weight: 600;">28.6%<div style="font-size: 11px; color: #64748b;">Jan 11.1% | <span style="color: #16a34a;">MoM +157.1% ^</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services<br>Delivery heroes limited<br>DZL<br>wajihat alruwad almutamayyiz company (Al Taif)
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Mostafa Soliman</span></td>
<td>21<div style="font-size: 11px; color: #64748b;">Jan 26 | <span style="color: #dc2626;">MoM -19.2% v</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan 2 | <span style="color: #6b7280;">MoM 0.0% =</span></div></td>
<td style="color: #dc2626; font-weight: 600;">9.5%<div style="font-size: 11px; color: #64748b;">Jan 7.7% | <span style="color: #16a34a;">MoM +23.8% ^</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
RADHI ABDULSAMEA<br>Rawasy Afaq
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Khalid Ahmad</span></td>
<td>8<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td>2<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
<td style="color: #dc2626; font-weight: 600;">25.0%<div style="font-size: 11px; color: #64748b;">Jan - | <span style="color: #6b7280;">MoM N/A</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Establishment ONE TRIP Express ( Tabuk )<br>KDC Logistics
</div>
</td>
</tr>
<tr onclick="toggleRow(this)" style="cursor: pointer; background: #f3f4f6;">
<td><span style="font-weight: 600;">▶ Mohammad Talha</span></td>
<td>21<div style="font-size: 11px; color: #64748b;">Jan 29 | <span style="color: #dc2626;">MoM -27.6% v</span></div></td>
<td>1<div style="font-size: 11px; color: #64748b;">Jan 2 | <span style="color: #dc2626;">MoM -50.0% v</span></div></td>
<td style="color: #dc2626; font-weight: 600;">4.8%<div style="font-size: 11px; color: #64748b;">Jan 6.9% | <span style="color: #dc2626;">MoM -31.0% v</span></div></td>
</tr>
<tr style="display: none; background: #eff6ff;">
<td colspan="4" style="padding: 15px;">
<div style="font-size: 13px; line-height: 1.8; color: #374151;">
<strong style="color: #1e40af;">Partner brand name with adjustment:</strong><br>
Company AL-DAHAN HIAR INTERNASHONAL Ltd. ( Tabuk )
</div>
</td>
</tr>
<tr style="background: #1f2937; color: white; font-weight: bold;">
<td>TOTAL (Feb)</td>
<td>364<div style="font-size: 11px; color: #cbd5e1; font-weight: 500;">Jan 475 | <span style="color: #fca5a5;">MoM -23.4% v</span></div></td>
<td>61<div style="font-size: 11px; color: #cbd5e1; font-weight: 500;">Jan 123 | <span style="color: #fca5a5;">MoM -50.4% v</span></div></td>
<td>16.8%<div style="font-size: 11px; color: #cbd5e1; font-weight: 500;">Jan 25.9% | <span style="color: #fca5a5;">MoM -35.1% v</span></div></td>
</tr>
</tbody>
</table>
</div>
<script>
// Arrow toggle for PMM section
(function() {
    const detailsEl = document.getElementById('pmm-details');
    const arrowEl = document.getElementById('pmmArrow');
    if (detailsEl && arrowEl) {
        const setArrow = () => { arrowEl.textContent = detailsEl.open ? '▼' : '▶'; };
        detailsEl.addEventListener('toggle', setArrow);
        setArrow();
    }
})();

// toggleRow function for PMM table
function toggleRow(row) {
    const nextRow = row.nextElementSibling;
    if (nextRow && nextRow.style.display === 'none') {
        nextRow.style.display = '';
        row.querySelector('span').textContent = row.querySelector('span').textContent.replace('▶', '▼');
    } else if (nextRow) {
        nextRow.style.display = 'none';
        row.querySelector('span').textContent = row.querySelector('span').textContent.replace('▼', '▶');
    }
}

// Arrow toggle for Strategic Insights
(function() {
    const detailsEl = document.getElementById('strategic-insights');
    const arrowEl = document.getElementById('insightsArrow');
    if (detailsEl && arrowEl) {
        const setArrow = () => { arrowEl.textContent = detailsEl.open ? '▼' : '▶'; };
        detailsEl.addEventListener('toggle', setArrow);
        setArrow();
    }
})();
</script>

<!-- COLLAPSED REASON SEGMENTS SECTION -->
<details id="reason-segment-details" style="margin-top: 40px; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px; background: #f9fafb;">
<summary style="cursor: pointer; font-size: 20px; font-weight: 700; color: #1f4e78; display: flex; align-items: center; gap: 10px; list-style: none; margin-bottom: 12px;">
<span id="reasonArrow" style="font-size: 18px; color: #1f4e78;">▶</span>
<span>📋 Reason Segment Selection</span>
</summary>
<div class="table-container">
<table>
<thead>
<tr>
<th>Reason Segment</th>
<th>Partners</th>
<th>% of Total</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr style="background: #d1fae5;">
<td><strong>New partner</strong></td>
<td style="font-weight: 600;">6</td>
<td>9.8%</td>
<td>Newly onboarded partners</td>
</tr>
<tr style="background: #fef3c7;">
<td><strong>Others</strong></td>
<td style="font-size: 18px; font-weight: 600;">49</td>
<td style="font-weight: 600;">80.3%</td>
<td>Miscellaneous reasons not fitting other categories</td>
</tr>
<tr>
<td><strong>The partner has stated their inability to fulfill the capacity</strong></td>
<td>2</td>
<td>3.3%</td>
<td>Cannot meet capacity requirements</td>
</tr>
<tr style="background: #e0f2fe;">
<td><strong>Transfer the capacity from enable partner to this partner</strong></td>
<td style="font-size: 18px; font-weight: 600;">4</td>
<td style="font-weight: 600;">6.6%</td>
<td>Capacity moved from one partner to another</td>
</tr>
<tr style="background: #e5e7eb; font-weight: bold;">
<td>Total</td>
<td>61</td>
<td>100%</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</details>

<!-- COLLAPSED COMPLETE LIST SECTION -->
<details id="reason-list-details" style="margin-top: 40px; border: 2px solid #e5e7eb; border-radius: 10px; padding: 12px; background: #f9fafb;">
<summary style="cursor: pointer; font-size: 20px; font-weight: 700; color: #1f4e78; display: flex; align-items: center; gap: 10px; list-style: none; margin-bottom: 12px;">
<span id="reasonListArrow" style="font-size: 18px; color: #1f4e78;">▶</span>
<span>📝 Complete List of All PMM Adjustment Reasons</span>
</summary>
<div style="background: #f8fafc; border: 2px solid #cbd5e1; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
<p style="color: #475569; font-size: 13px; margin-bottom: 20px;"><strong>Total Unique Reasons: 37</strong> | Each reason below shows the exact PMM comment with partner count and percentage.</p>
<div class="table-container" style="max-height: 600px; overflow-y: auto;">
<table style="font-size: 13px;">
<thead style="position: sticky; top: 0; background: white; z-index: 10;">
<tr>
<th style="width: 40px;">#</th>
<th style="width: 80px;">Partners</th>
<th style="width: 70px;">%</th>
<th>PMM Reason Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>8</td>
<td>13.1%</td>
<td>Not achieving FR target and drivers card</td>
</tr>
<tr>
<td>2</td>
<td>7</td>
<td>11.5%</td>
<td>2% buffer due to gap in online riders causing bad experience</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>6.6%</td>
<td>driver card rate is low</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>4.9%</td>
<td>they just have 1 driver card, need to reduce the target to control the risk</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>3.3%</td>
<td>100% driver card</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>3.3%</td>
<td>Adjusted target from other partner who is unable to provide driver cards.</td>
</tr>
<tr>
<td>7</td>
<td>2</td>
<td>3.3%</td>
<td>Due to driver Cards issue</td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td>3.3%</td>
<td>due to kiwa issuses, they can not increase capacity</td>
</tr>
<tr>
<td>9</td>
<td>2</td>
<td>3.3%</td>
<td>they just have 2 driver card, need to reduce the target to control the risk</td>
</tr>
<tr>
<td>10</td>
<td>2</td>
<td>3.3%</td>
<td>this is the extra manpower to cover the risk of high demands.</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
<td>1.6%</td>
<td>0 progress shown for driver cards, 0 proof shared for appointment</td>
</tr>
<tr>
<td>12</td>
<td>1</td>
<td>1.6%</td>
<td>0% driver card</td>
</tr>
<tr>
<td>13</td>
<td>1</td>
<td>1.6%</td>
<td>Driver card 0%</td>
</tr>
<tr>
<td>14</td>
<td>1</td>
<td>1.6%</td>
<td>Driver card 100%</td>
</tr>
<tr>
<td>15</td>
<td>1</td>
<td>1.6%</td>
<td>Fulfill city capacity to save experience.</td>
</tr>
<tr>
<td>16</td>
<td>1</td>
<td>1.6%</td>
<td>High performance partner, high coopreation</td>
</tr>
<tr>
<td>17</td>
<td>1</td>
<td>1.6%</td>
<td>less driver cards, no improvment after 5%</td>
</tr>
<tr>
<td>18</td>
<td>1</td>
<td>1.6%</td>
<td>less driver cards, targeting 15%</td>
</tr>
<tr>
<td>19</td>
<td>1</td>
<td>1.6%</td>
<td>Need immediate courier capacity in Jazan.</td>
</tr>
<tr>
<td>20</td>
<td>1</td>
<td>1.6%</td>
<td>no driver card</td>
</tr>
<tr>
<td>21</td>
<td>1</td>
<td>1.6%</td>
<td>no driver card for car</td>
</tr>
<tr>
<td>22</td>
<td>1</td>
<td>1.6%</td>
<td>no driver cards till date, very low number of driver cards</td>
</tr>
<tr>
<td>23</td>
<td>1</td>
<td>1.6%</td>
<td>Partner has issued driver cards and fully compliant</td>
</tr>
<tr>
<td>24</td>
<td>1</td>
<td>1.6%</td>
<td>Partner shared the Appointment for the driver card they will complete before 24th FEB</td>
</tr>
<tr>
<td>25</td>
<td>1</td>
<td>1.6%</td>
<td>Riders have booked appointments for change licence</td>
</tr>
<tr>
<td>26</td>
<td>1</td>
<td>1.6%</td>
<td>risk partners, who coorpate with hs, and stop operation</td>
</tr>
<tr>
<td>27</td>
<td>1</td>
<td>1.6%</td>
<td>specia case,due to special reason,will protect their capacity three month(2-4)，which align with chandler&amp;iron。</td>
</tr>
<tr>
<td>28</td>
<td>1</td>
<td>1.6%</td>
<td>TGA suspended the bike driver cards.</td>
</tr>
<tr>
<td>29</td>
<td>1</td>
<td>1.6%</td>
<td>Their current evaluation is due to 12 riders being blocked in January because of an operations card issue. They have 15 high-performing and compliant riders, and currently, 100% of these riders are un</td>
</tr>
<tr>
<td>30</td>
<td>1</td>
<td>1.6%</td>
<td>Their driver card just 67, cannot increase 170 within one month</td>
</tr>
<tr>
<td>31</td>
<td>1</td>
<td>1.6%</td>
<td>Their riders all have rider cards, but due to issues with vehicle registration certificates, none of the riders have completed the system update.Their owner strongly appealed</td>
</tr>
<tr>
<td>32</td>
<td>1</td>
<td>1.6%</td>
<td>They don't drver card issuse</td>
</tr>
<tr>
<td>33</td>
<td>1</td>
<td>1.6%</td>
<td>They had an issue with the operations manager, who has been replaced. This company is new, having completed only two months of operation, and should ideally be exempted during its first three months.</td>
</tr>
<tr>
<td>34</td>
<td>1</td>
<td>1.6%</td>
<td>this partner was working in PT project and never worked as full timer, will have 16 full time riders and 6 as PT riders</td>
</tr>
<tr>
<td>35</td>
<td>1</td>
<td>1.6%</td>
<td>Unable to get driver cards.</td>
</tr>
<tr>
<td>36</td>
<td>1</td>
<td>1.6%</td>
<td>will have driver Card before 15th Feb</td>
</tr>
<tr>
<td>37</td>
<td>1</td>
<td>1.6%</td>
<td>(blank)</td>
</tr>
<tr style="background: #e5e7eb; font-weight: bold;">
<td>Total</td>
<td>61</td>
<td>100%</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>

<script>
// Arrow toggle for Reason Segment Details
document.getElementById('reason-segment-details').addEventListener('toggle', function() {
    const arrow = document.getElementById('reasonArrow');
    if (this.open) {
        arrow.textContent = '▼';
    } else {
        arrow.textContent = '▶';
    }
});

// Arrow toggle for Reason List Details
document.getElementById('reason-list-details').addEventListener('toggle', function() {
    const arrow = document.getElementById('reasonListArrow');
    if (this.open) {
        arrow.textContent = '▼';
    } else {
        arrow.textContent = '▶';
    }
});
</script>

</div>


<div class="tab-content" id="dailyView">
<style>
.daily-view-title { margin-bottom: 8px; color: #1f4e78; font-size: 24px; font-weight: 700; }
.daily-view-subtitle { color: #5a6a7a; font-size: 14px; margin-bottom: 20px; }
.daily-kpi-row { display: flex; gap: 14px; flex-wrap: wrap; margin-bottom: 22px; }
.daily-kpi-card { flex: 1; min-width: 180px; background: linear-gradient(135deg, #f8fafc 0%, #e8f0fe 100%); border-radius: 12px; padding: 16px 18px; border-left: 4px solid #1f4e78; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: relative; }
.daily-kpi-card .kpi-label { font-size: 12px; color: #637282; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
.daily-kpi-card .kpi-value { font-size: 26px; font-weight: 800; color: #1f4e78; line-height: 1.1; }
.daily-kpi-card .kpi-sub { font-size: 11px; color: #8899aa; margin-top: 4px; }
.daily-kpi-card.kpi-green { border-left-color: #27ae60; }
.daily-kpi-card.kpi-green .kpi-value { color: #27ae60; }
.daily-kpi-card.kpi-amber { border-left-color: #f39c12; }
.daily-kpi-card.kpi-amber .kpi-value { color: #e67e22; }
.daily-kpi-card.kpi-red { border-left-color: #e74c3c; }
.daily-kpi-card.kpi-red .kpi-value { color: #e74c3c; }
.daily-kpi-card.kpi-blue { border-left-color: #2980b9; }
.daily-kpi-card.kpi-blue .kpi-value { color: #2980b9; }
.daily-kpi-card .tooltip-daily { visibility: hidden; opacity: 0; position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: #1a2a3a; color: #fff; padding: 10px 14px; border-radius: 8px; font-size: 11.5px; line-height: 1.5; white-space: nowrap; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.25); transition: opacity 0.2s; pointer-events: none; }
.daily-kpi-card .tooltip-daily::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 6px solid transparent; border-top-color: #1a2a3a; }
.daily-kpi-card:hover .tooltip-daily { visibility: visible; opacity: 1; }
.daily-slicer { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
.daily-slicer-btn { padding: 8px 18px; border: 2px solid #d0dbe8; background: #fff; border-radius: 20px; font-size: 13px; font-weight: 600; color: #4a5a6a; cursor: pointer; transition: all 0.2s; }
.daily-slicer-btn:hover { background: #e8f0fe; border-color: #2980b9; }
.daily-slicer-btn.active { background: #1f4e78; color: #fff; border-color: #1f4e78; }
.daily-slicer-btn[data-cat="good"].active { background: #27ae60; border-color: #27ae60; }
.daily-slicer-btn[data-cat="average"].active { background: #f39c12; border-color: #f39c12; }
.daily-slicer-btn[data-cat="bad"].active { background: #e74c3c; border-color: #e74c3c; }
.daily-slicer-btn[data-cat="new"].active { background: #8e44ad; border-color: #8e44ad; }
.daily-mini-note { margin: -8px 0 14px; padding: 8px 12px; border-left: 4px solid #8e44ad; background: #f7f0fb; border-radius: 8px; font-size: 12px; color: #4b3a5a; }
.daily-mini-note strong { color: #6c2ea8; }
.city-view-section { margin-top: 18px; padding-top: 12px; border-top: 2px dashed #dbe7f3; }
.city-view-title { font-size: 20px; font-weight: 800; color: #1f4e78; margin: 4px 0 10px; }
.city-mini-note { margin: 0 0 14px; padding: 9px 12px; border-left: 4px solid #2980b9; background: #eef6ff; border-radius: 8px; font-size: 12px; color: #2f4f6f; }
.city-mini-note strong { color: #1f4e78; }
.city-slicer { display:flex; align-items:center; gap:10px; margin: 10px 0 14px; flex-wrap: wrap; }
.city-slicer-label { font-size: 12px; font-weight: 700; color: #1f4e78; }
.city-slicer-buttons { display:flex; gap:8px; flex-wrap:wrap; }
.city-slicer-btn { padding: 7px 14px; font-size: 12px; }
.city-slicer-legend { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin: -2px 0 12px 0; font-size: 11px; color:#5a6a7a; }
.city-slicer-legend .lg-item { display:flex; align-items:center; gap:5px; }
.city-slicer-legend .lg-dot { width:10px; height:10px; border-radius:50%; display:inline-block; }
.city-slicer-legend .lg-good { background:#27ae60; }
.city-slicer-legend .lg-amber { background:#f39c12; }
.city-slicer-legend .lg-red { background:#e74c3c; }
.city-slicer-btn.city-band-all { background: #eef6ff; color: #1f4e78; border-color: #2980b9; }
.city-slicer-btn.city-band-good { background: #edf9f0; color: #1a7a3a; border-color: #27ae60; }
.city-slicer-btn.city-band-amber { background: #fff7ea; color: #b66c06; border-color: #f39c12; }
.city-slicer-btn.city-band-red { background: #fdeeee; color: #b93c2f; border-color: #e74c3c; }
.city-slicer-btn.city-band-all.active { background: #2980b9; color: #fff; border-color: #2980b9; }
.city-slicer-btn.city-band-good.active { background: #27ae60; color: #fff; border-color: #27ae60; }
.city-slicer-btn.city-band-amber.active { background: #f39c12; color: #fff; border-color: #f39c12; }
.city-slicer-btn.city-band-red.active { background: #e74c3c; color: #fff; border-color: #e74c3c; }
.daily-charts-row { display: flex; gap: 18px; margin-bottom: 20px; flex-wrap: wrap; }
.daily-chart-box { flex: 1; min-width: 380px; background: #fff; border-radius: 12px; padding: 18px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); border: 1px solid #e8eef4; }
.daily-chart-box-full { width: 100%; background: #fff; border-radius: 12px; padding: 18px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); border: 1px solid #e8eef4; margin-bottom: 20px; }
.daily-chart-title { font-size: 14px; font-weight: 700; color: #1f4e78; margin-bottom: 10px; }
.daily-chart-canvas-wrap { position: relative; width: 100%; height: 300px; }
.daily-chart-canvas-wrap-sm { position: relative; width: 100%; height: 250px; }
.daily-details { margin-bottom: 16px; }
.daily-details > summary { font-size: 15px; font-weight: 700; color: #1f4e78; cursor: pointer; padding: 12px 16px; background: linear-gradient(135deg, #f0f5fa 0%, #e2ecf5 100%); border-radius: 10px; border: 1px solid #d0dbe8; user-select: none; list-style: none; display: flex; align-items: center; gap: 8px; }
.daily-details > summary::-webkit-details-marker { display: none; }
.daily-details > summary::before { content: '\25B6'; font-size: 11px; transition: transform 0.2s; }
.daily-details[open] > summary::before { transform: rotate(90deg); }
.daily-details > summary:hover { background: linear-gradient(135deg, #e2ecf5 0%, #d4e2f0 100%); }
.daily-details-content { padding: 16px 8px; }
.daily-insight-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px; margin-top: 12px; }
.daily-insight-item { padding: 12px 14px; border-radius: 8px; border-left: 3px solid #2980b9; background: #f8fafc; font-size: 12.5px; line-height: 1.6; color: #3a4a5a; }
.daily-insight-item.insight-good { border-left-color: #27ae60; }
.daily-insight-item.insight-warn { border-left-color: #f39c12; }
.daily-insight-item.insight-bad { border-left-color: #e74c3c; }
.daily-insight-item strong { color: #1f4e78; }
.daily-table-wrap { overflow-x: auto; margin-top: 10px; }
.daily-table { width: 100%; border-collapse: collapse; font-size: 12px; }
.daily-table th { background: #1f4e78; color: #fff; padding: 8px 10px; text-align: center; font-weight: 600; font-size: 11px; white-space: nowrap; position: sticky; top: 0; z-index: 2; }
.daily-table td { padding: 6px 8px; text-align: center; border-bottom: 1px solid #e8eef4; white-space: nowrap; }
.daily-table tr:hover { background: #f0f5fa; }
.daily-table .perf-good { color: #27ae60; font-weight: 700; }
.daily-table .perf-average { color: #f39c12; font-weight: 700; }
.daily-table .perf-bad { color: #e74c3c; font-weight: 700; }
.daily-table .ach-green { color: #27ae60; font-weight: 600; }
.daily-table .ach-amber { color: #e67e22; font-weight: 600; }
.daily-table .ach-red { color: #e74c3c; font-weight: 600; }
.daily-table .rank-top { background: #e8f8e8; }
.daily-table .rank-bottom { background: #fde8e8; }
.daily-search-bar { margin-bottom: 10px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.daily-search-input { padding: 7px 14px; border: 1px solid #d0dbe8; border-radius: 8px; font-size: 13px; width: 220px; outline: none; }
.daily-search-input:focus { border-color: #2980b9; box-shadow: 0 0 0 2px rgba(41,128,185,0.15); }
.daily-table-info { font-size: 12px; color: #8899aa; }
.daily-highlight-row { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
.daily-highlight-card { flex: 1; min-width: 200px; padding: 14px; border-radius: 10px; font-size: 13px; line-height: 1.5; }
.daily-highlight-card.hl-green { background: #e8f8e8; border: 1px solid #27ae60; color: #1a5c2e; }
.daily-highlight-card.hl-amber { background: #fef6e8; border: 1px solid #f39c12; color: #7a5a10; }
.daily-highlight-card.hl-red { background: #fde8e8; border: 1px solid #e74c3c; color: #7a1a1a; }
.daily-highlight-card strong { font-size: 14px; }
.daily-data-section { margin-bottom: 14px; }
.daily-data-section h4 { font-size: 14px; font-weight: 700; color: #1f4e78; margin: 0 0 8px 0; }
.daily-data-tbl { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 14px; }
.daily-data-tbl th { background: #1f4e78; color: #fff; padding: 7px 10px; text-align: center; font-weight: 600; font-size: 11px; white-space: nowrap; }
.daily-data-tbl td { padding: 6px 8px; text-align: center; border: 1px solid #e0e8f0; white-space: nowrap; font-size: 12px; }
.daily-data-tbl tr:nth-child(even) { background: #f8fafe; }
.daily-data-tbl .lbl-cell { text-align: left; font-weight: 600; color: #1f4e78; background: #f0f5fa; min-width: 110px; }
.daily-data-tbl .ach-val { color: #1a7a3a; font-weight: 700; }
.daily-data-tbl .ach-val-red { color: #c0392b; font-weight: 700; }
.daily-data-tbl .ach-val-amber { color: #d68910; font-weight: 700; }
.daily-data-tbl .hdr-blue th { background: #2980b9; }
.daily-data-tbl .hdr-green th { background: #27ae60; }
.daily-data-tbl .hdr-orange th { background: #f39c12; }
.daily-data-tbl .hdr-red th { background: #e74c3c; }
.daily-data-tbl .hdr-purple th { background: #8e44ad; }
.perf-new { color: #8e44ad; font-weight: 700; }
@media(max-width:768px) {
  .daily-kpi-row { gap: 8px; }
  .daily-kpi-card { min-width: 140px; padding: 10px 12px; }
  .daily-kpi-card .kpi-value { font-size: 20px; }
  .daily-chart-box { min-width: 100%; }
  .daily-chart-canvas-wrap { height: 250px; }
  .daily-chart-canvas-wrap-sm { height: 200px; }
}
</style>

<h2 class="daily-view-title">&#128197; Capacity Target Achievement (Daily View)</h2>
<p class="daily-view-subtitle">February 1&#8211;15, 2026 &nbsp;|&nbsp; Daily performance tracking across <strong>596</strong> partners &nbsp;|&nbsp; Delivery &amp; Online rider achievement analysis</p>

<!-- NEW ADVANCED DATA SECTION -->
<div id="advancedDataSection" style="margin-bottom: 30px;">
  <style>
    .adv-toggle-row { display:flex; gap:12px; margin-bottom:18px; flex-wrap:wrap; }
    .adv-toggle-btn { padding:10px 20px; background:linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border:2px solid #1976d2; border-radius:12px; font-size:14px; font-weight:700; color:#0d47a1; cursor:pointer; transition:all 0.3s; box-shadow:0 2px 8px rgba(25,118,210,0.15); }
    .adv-toggle-btn:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(25,118,210,0.25); }
    .adv-toggle-btn.active { background:linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color:#fff; border-color:#0d47a1; }
    .adv-sub-slicer { display:flex; gap:8px; margin:12px 0 16px; flex-wrap:wrap; }
    .adv-sub-btn { padding:6px 14px; background:#fff; border:2px solid #bdbdbd; border-radius:8px; font-size:12px; font-weight:600; color:#424242; cursor:pointer; transition:all 0.2s; }
    .adv-sub-btn:hover { border-color:#1976d2; background:#e3f2fd; }
    .adv-sub-btn.active { background:#1976d2; color:#fff; border-color:#0d47a1; }
    .adv-content-box { display:none; background:#fff; border-radius:14px; padding:20px; box-shadow:0 3px 12px rgba(0,0,0,0.08); border:1px solid #e0e0e0; }
    .adv-content-box.active { display:block; animation:fadeInUp 0.4s ease-out; }
    @keyframes fadeInUp { from{opacity:0; transform:translateY(15px);} to{opacity:1; transform:translateY(0);} }
    .adv-cards-row { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:14px; margin-bottom:18px; }
    .adv-card { background:linear-gradient(135deg, #f8fafc 0%, #e8f4f8 100%); border-radius:12px; padding:16px; border-left:4px solid #1976d2; }
    .adv-card .card-label { font-size:11px; color:#546e7a; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
    .adv-card .card-value { font-size:24px; font-weight:800; color:#0d47a1; line-height:1.1; }
    .adv-card .card-sub { font-size:11px; color:#78909c; margin-top:4px; }
    .adv-card.green { border-left-color:#2e7d32; background:linear-gradient(135deg, #f1f8e9 0%, #dcedc8 100%); }
    .adv-card.green .card-value { color:#1b5e20; }
    .adv-card.amber { border-left-color:#f57c00; background:linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); }
    .adv-card.amber .card-value { color:#e65100; }
    .adv-card.red { border-left-color:#c62828; background:linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); }
    .adv-card.red .card-value { color:#b71c1c; }
    .adv-table-container { margin-bottom:16px; }
    .adv-table-title { font-size:15px; font-weight:700; color:#0d47a1; margin-bottom:10px; display:flex; align-items:center; gap:8px; }
    .adv-table-wrap { overflow-x:auto; border-radius:10px; box-shadow:0 1px 6px rgba(0,0,0,0.08); }
    .adv-table { width:100%; border-collapse:collapse; font-size:12px; background:#fff; }
    .adv-table th { background:linear-gradient(135deg, #1565c0 0%, #0d47a1 100%); color:#fff; padding:10px 12px; text-align:center; font-weight:700; font-size:11.5px; white-space:nowrap; border-right:1px solid rgba(255,255,255,0.2); position:sticky; left:0; z-index:3; }
    .adv-table th:first-child { position:sticky; left:0; z-index:4; }
    .adv-table td { padding:8px 10px; text-align:center; border:1px solid #e0e0e0; white-space:nowrap; transition:background 0.2s; }
    .adv-table tr:hover td { background:#e3f2fd; }
    .adv-table td:first-child { font-weight:600; text-align:left; background:#f5f5f5; position:sticky; left:0; z-index:2; min-width:150px; }
    .adv-table .period-col { background:#f0f4f8; font-weight:600; }
    .adv-table .val-excellent { color:#2e7d32; font-weight:700; }
    .adv-table .val-good { color:#558b2f; font-weight:600; }
    .adv-table .val-warning { color:#f57c00; font-weight:600; }
    .adv-table .val-critical { color:#c62828; font-weight:700; }
    .adv-legend { display:flex; gap:16px; margin:10px 0 14px; font-size:11px; flex-wrap:wrap; align-items:center; padding:10px 14px; background:#f9fafb; border-radius:8px; border:1px solid #e0e0e0; }
    .adv-legend-item { display:flex; align-items:center; gap:6px; }
    .adv-legend-dot { width:12px; height:12px; border-radius:50%; display:inline-block; }
    .adv-legend .dot-excellent { background:#2e7d32; }
    .adv-legend .dot-good { background:#558b2f; }
    .adv-legend .dot-warning { background:#f57c00; }
    .adv-legend .dot-critical { background:#c62828; }
    .adv-highlight-box { margin:14px 0; padding:14px 18px; border-radius:10px; border-left:4px solid #1976d2; background:linear-gradient(135deg, #e3f2fd 0%, #bbdefb 30%, #e3f2fd 100%); font-size:13px; line-height:1.6; color:#0d47a1; }
    .adv-highlight-box strong { font-size:14px; color:#01579b; }
    .adv-highlight-box.green { border-left-color:#2e7d32; background:linear-gradient(135deg, #f1f8e9 0%, #dcedc8 30%, #f1f8e9 100%); color:#1b5e20; }
    .adv-highlight-box.green strong { color:#1b5e20; }
    .adv-highlight-box.amber { border-left-color:#f57c00; background:linear-gradient(135deg, #fff3e0 0%, #ffe0b2 30%, #fff3e0 100%); color:#e65100; }
    .adv-highlight-box.amber strong { color:#e65100; }
    .adv-chart-details { margin-top:12px; }
    .adv-chart-details summary { padding:10px 16px; background:linear-gradient(135deg, #eceff1 0%, #cfd8dc 100%); border-radius:8px; cursor:pointer; font-weight:700; font-size:13px; color:#263238; list-style:none; display:flex; align-items:center; gap:8px; }
    .adv-chart-details summary::-webkit-details-marker { display:none; }
    .adv-chart-details summary::before { content:'▶'; font-size:10px; transition:transform 0.2s; }
    .adv-chart-details[open] summary::before { transform:rotate(90deg); }
    .adv-chart-details summary:hover { background:linear-gradient(135deg, #cfd8dc 0%, #b0bec5 100%); }
    .adv-chart-wrap { margin-top:12px; padding:16px; background:#fafafa; border-radius:8px; }
    .adv-chart-canvas { position:relative; height:280px; }
    .adv-expand-btn { padding:6px 14px; background:#fff; border:2px solid #1976d2; border-radius:6px; font-size:11px; font-weight:600; color:#1976d2; cursor:pointer; transition:all 0.2s; margin-top:8px; }
    .adv-expand-btn:hover { background:#1976d2; color:#fff; }
.adv-daily-cols { display:none; }
    .adv-daily-cols.expanded { display:table-cell; }
  </style>

  <div class="adv-toggle-row">
    <button class="adv-toggle-btn active" data-section="totalOverview" onclick="switchAdvSection('totalOverview', this)">📊 Total Overview</button>
    <button class="adv-toggle-btn" data-section="partnersStrat" onclick="switchAdvSection('partnersStrat', this)">👥 Partners Stratification</button>
    <button class="adv-toggle-btn" data-section="cityLevel" onclick="switchAdvSection('cityLevel', this)">🏙️ City Level Data</button>
  </div>

  <!-- TOTAL OVERVIEW SECTION -->
  <div id="totalOverviewContent" class="adv-content-box active">
    <div class="adv-cards-row">
      <div class="adv-card amber">
        <div class="card-label">MTD Achievement</div>
        <div class="card-value">93.5%</div>
        <div class="card-sub">Delivery | Target: 19,405</div>
      </div>
      <div class="adv-card green">
        <div class="card-label">W1 Performance</div>
        <div class="card-value">92.9%</div>
        <div class="card-sub">Feb 1-7 | Stable</div>
      </div>
      <div class="adv-card amber">
        <div class="card-label">W2 Performance</div>
        <div class="card-value">92.9%</div>
        <div class="card-sub">Feb 8-14 | Flat trend</div>
      </div>
      <div class="adv-card">
        <div class="card-label">Total GAP</div>
        <div class="card-value">448</div>
        <div class="card-sub">Riders | Online vs Del</div>
      </div>
    </div>

    <div class="adv-legend">
      <strong>Color Legend:</strong>
      <div class="adv-legend-item"><span class="adv-legend-dot dot-excellent"></span> ≥95% Excellent</div>
      <div class="adv-legend-item"><span class="adv-legend-dot dot-good"></span> 90-94.9% Good</div>
      <div class="adv-legend-item"><span class="adv-legend-dot dot-warning"></span> 85-89.9% Warning</div>
      <div class="adv-legend-item"><span class="adv-legend-dot dot-critical"></span> <85% Critical</div>
    </div>

    <div class="adv-table-container">
      <div class="adv-table-title">📈 Overall Performance Summary</div>
      <div class="adv-table-wrap">
        <table class="adv-table" id="totalOverviewTable">
          <thead>
            <tr>
              <th>Metric</th>
              <th>MTD</th>
              <th>W1 (Feb 1-7)</th>
              <th>W2 (Feb 8-14)</th>
              <th class="adv-daily-cols">Day 1</th>
              <th class="adv-daily-cols">Day 2</th>
              <th class="adv-daily-cols">Day 3</th>
              <th class="adv-daily-cols">Day 4</th>
              <th class="adv-daily-cols">Day 5</th>
              <th class="adv-daily-cols">Day 6</th>
              <th class="adv-daily-cols">Day 7</th>
              <th class="adv-daily-cols">Day 8</th>
              <th class="adv-daily-cols">Day 9</th>
              <th class="adv-daily-cols">Day 10</th>
              <th class="adv-daily-cols">Day 11</th>
              <th class="adv-daily-cols">Day 12</th>
              <th class="adv-daily-cols">Day 13</th>
              <th class="adv-daily-cols">Day 14</th>
              <th class="adv-daily-cols">Day 15</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Target</td>
              <td>19,405</td>
              <td>19,405</td>
              <td>19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
              <td class="adv-daily-cols">19,405</td>
            </tr>
            <tr>
              <td>Online Riders</td>
              <td>18,585</td>
              <td>18,528</td>
              <td>18,403</td>
              <td class="adv-daily-cols">19,557</td>
              <td class="adv-daily-cols">18,436</td>
              <td class="adv-daily-cols">18,504</td>
              <td class="adv-daily-cols">18,209</td>
              <td class="adv-daily-cols">18,357</td>
              <td class="adv-daily-cols">18,313</td>
              <td class="adv-daily-cols">18,321</td>
              <td class="adv-daily-cols">18,178</td>
              <td class="adv-daily-cols">18,255</td>
              <td class="adv-daily-cols">18,355</td>
              <td class="adv-daily-cols">18,386</td>
              <td class="adv-daily-cols">18,526</td>
              <td class="adv-daily-cols">18,542</td>
              <td class="adv-daily-cols">18,576</td>
              <td class="adv-daily-cols">18,353</td>
            </tr>
            <tr>
              <td>Delivery Riders</td>
              <td>18,137</td>
              <td>18,037</td>
              <td>18,020</td>
              <td class="adv-daily-cols">18,185</td>
              <td class="adv-daily-cols">18,240</td>
              <td class="adv-daily-cols">18,263</td>
              <td class="adv-daily-cols">17,662</td>
              <td class="adv-daily-cols">17,998</td>
              <td class="adv-daily-cols">17,948</td>
              <td class="adv-daily-cols">17,962</td>
              <td class="adv-daily-cols">17,571</td>
              <td class="adv-daily-cols">17,738</td>
              <td class="adv-daily-cols">17,981</td>
              <td class="adv-daily-cols">18,001</td>
              <td class="adv-daily-cols">18,238</td>
              <td class="adv-daily-cols">18,330</td>
              <td class="adv-daily-cols">18,282</td>
              <td class="adv-daily-cols">17,783</td>
            </tr>
            <tr>
              <td><strong>Achievement %</strong></td>
              <td class="val-good">93.5%</td>
              <td class="val-good">92.9%</td>
              <td class="val-good">92.9%</td>
              <td class="adv-daily-cols val-good">93.7%</td>
              <td class="adv-daily-cols val-good">94.0%</td>
              <td class="adv-daily-cols val-good">94.1%</td>
              <td class="adv-daily-cols val-good">91.0%</td>
              <td class="adv-daily-cols val-good">92.7%</td>
              <td class="adv-daily-cols val-good">92.5%</td>
              <td class="adv-daily-cols val-good">92.6%</td>
              <td class="adv-daily-cols val-good">90.5%</td>
              <td class="adv-daily-cols val-good">91.4%</td>
              <td class="adv-daily-cols val-good">92.7%</td>
              <td class="adv-daily-cols val-good">92.8%</td>
              <td class="adv-daily-cols val-good">94.0%</td>
              <td class="adv-daily-cols val-good">94.5%</td>
              <td class="adv-daily-cols val-good">94.2%</td>
              <td class="adv-daily-cols val-good">91.6%</td>
            </tr>
            <tr>
              <td>GAP (Riders)</td>
              <td>448</td>
              <td>491</td>
              <td>382</td>
              <td class="adv-daily-cols">1,372</td>
              <td class="adv-daily-cols">196</td>
              <td class="adv-daily-cols">241</td>
              <td class="adv-daily-cols">547</td>
              <td class="adv-daily-cols">359</td>
              <td class="adv-daily-cols">365</td>
              <td class="adv-daily-cols">359</td>
              <td class="adv-daily-cols">607</td>
              <td class="adv-daily-cols">517</td>
              <td class="adv-daily-cols">374</td>
              <td class="adv-daily-cols">385</td>
              <td class="adv-daily-cols">288</td>
              <td class="adv-daily-cols">212</td>
              <td class="adv-daily-cols">294</td>
              <td class="adv-daily-cols">570</td>
            </tr>
          </tbody>
        </table>
      </div>
      <button class="adv-expand-btn" onclick="toggleDailyExpand('totalOverviewTable')">📅 Expand Daily View</button>
    </div>

    <div class="adv-highlight-box amber">
      <strong>📊 Key Insights:</strong> MTD achievement at 93.5% remains below the 100% target. Performance stable across both weeks (W1: 92.9%, W2: 92.9%), suggesting consistent underperformance. Day 1 shows highest GAP (1,372 riders) due to online spike. Improvement needed: Daily achievement ranges 90.5%-94.5% - target ≥95% for optimal performance.
    </div>

    <details class="adv-chart-details">
      <summary>📈 Daily Achievement Trend Chart</summary>
      <div class="adv-chart-wrap">
        <div class="adv-chart-canvas"><canvas id="totalOverviewChart"></canvas></div>
      </div>
    </details>
  </div>

  <!-- PARTNERS STRATIFICATION SECTION -->
  <div id="partnersStratContent" class="adv-content-box">
    <div class="adv-sub-slicer">
      <button class="adv-sub-btn active" data-cat="good" onclick="switchPartnerCat('good', this)">✅ Good Partners</button>
      <button class="adv-sub-btn" data-cat="average" onclick="switchPartnerCat('average', this)">⚠️ Average Partners</button>
      <button class="adv-sub-btn" data-cat="bad" onclick="switchPartnerCat('bad', this)">❌ Bad Partners</button>
      <button class="adv-sub-btn" data-cat="inc20" onclick="switchPartnerCat('inc20', this)">📈 Increase >20</button>
      <button class="adv-sub-btn" data-cat="inc1020" onclick="switchPartnerCat('inc1020', this)">📊 Increase 10-20</button>
      <button class="adv-sub-btn" data-cat="inc110" onclick="switchPartnerCat('inc110', this)">📉 Increase 1-10</button>
      <button class="adv-sub-btn" data-cat="inc0" onclick="switchPartnerCat('inc0', this)">↔️ Others (≤0)</button>
    </div>

    <div id="partnerCatContent"></div>
  </div>

  <!-- CITY LEVEL DATA SECTION -->
  <div id="cityLevelContent" class="adv-content-box">
    <div class="adv-sub-slicer">
      <button class="adv-sub-btn active" data-city="gap" onclick="switchCityMetric('gap', this)">📉 GAP % (Del vs Capacity)</button>
      <button class="adv-sub-btn" data-city="ach" onclick="switchCityMetric('ach', this)">📊 Achievement Rate</button>
    </div>

    <div id="cityMetricContent"></div>
  </div>
</div>

<script>
// Data storage
var advDataLoaded = false;

function switchAdvSection(section, btn) {
  document.querySelectorAll('.adv-toggle-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.adv-content-box').forEach(box=>box.classList.remove('active'));
  document.getElementById(section+'Content').classList.add('active');
  
  if(!advDataLoaded) {
    advDataLoaded = true;
    initAdvCharts();
    renderPartnerCat('good');
    renderCityMetric('gap');
  } else if(section === 'partnersStrat') {
    renderPartnerCat('good');
  } else if(section === 'cityLevel') {
    renderCityMetric('gap');
  }
}

function toggleDailyExpand(tableId) {
  var table = document.getElementById(tableId);
  var dailyCols = table.querySelectorAll('.adv-daily-cols');
  var isExpanded = dailyCols[0].classList.contains('expanded');
  
  dailyCols.forEach(col => {
    if(isExpanded) {
      col.classList.remove('expanded');
    } else {
      col.classList.add('expanded');
    }
  });
  
  var btn = table.parentElement.querySelector('.adv-expand-btn');
  btn.textContent = isExpanded ? '📅 Expand Daily View' : '📅 Collapse Daily View';
}

function switchPartnerCat(cat, btn) {
  document.querySelectorAll('#partnersStratContent .adv-sub-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderPartnerCat(cat);
}

function switchCityMetric(metric, btn) {
  document.querySelectorAll('#cityLevelContent .adv-sub-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderCityMetric(metric);
}

function getColorClass(val) {
  var v = parseFloat(val);
  if(v >= 95) return 'val-excellent';
  if(v >= 90) return 'val-good';
  if(v >= 85) return 'val-warning';
  return 'val-critical';
}

function getGapColorClass(val) {
  var v = Math.abs(parseFloat(val));
  if(v <= 1.0) return 'val-excellent';
  if(v <= 2.0) return 'val-good';
  if(v <= 3.0) return 'val-warning';
  return 'val-critical';
}

function initAdvCharts() {
  var ctx = document.getElementById('totalOverviewChart');
  if(!ctx) return;
  ctx = ctx.getContext('2d');
  
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Day 1','Day 2','Day 3','Day 4','Day 5','Day 6','Day 7','Day 8','Day 9','Day 10','Day 11','Day 12','Day 13','Day 14','Day 15'],
      datasets: [{
        label: 'Achievement %',
        data: [93.7,94.0,94.1,91.0,92.7,92.5,92.6,90.5,91.4,92.7,92.8,94.0,94.5,94.2,91.6],
        borderColor: '#1976d2',
        backgroundColor: 'rgba(25,118,210,0.1)',
        tension: 0.3,
        fill: true,
        borderWidth: 3,
        pointRadius: 4,
        pointBackgroundColor: '#1976d2'
      },{
        label: '95% Target',
        data: Array(15).fill(95),
        borderColor: '#2e7d32',
        borderWidth: 2,
        borderDash: [5,5],
        pointRadius: 0,
        fill: false
      },{
        label: '90% threshold',
        data: Array(15).fill(90),
        borderColor: '#f57c00',
        borderWidth: 2,
        borderDash: [5,5],
        pointRadius: 0,
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'top' },
        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        y: { beginAtZero: false, min: 85, max: 100, ticks: { callback: v=>v+'%' } }
      }
    }
  });
}

function renderPartnerCat(cat) {
  var data = { good: {
    title: '✅ Good Partners (252)',
    target: '10,104',
    mtd: '94.7%',
    w1: '95.2%',
    w2: '94.4%',
    gap: '210',
    insight: 'Good partners maintain strong performance above 94%, with W1 at 95.2%. 45% of partners achieving ≥100%, and 82% above 90%. Only 5% fall below 80%, indicating solid fundamentals.',
    data: [[10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104,10104],
           [9784,9861,9717,10406,9830,9850,9695,9764,9759,9720,9657,9671,9685,9705,9782,9759,9757,9635],
           [9573,9623,9542,9703,9741,9737,9434,9600,9601,9548,9361,9429,9525,9542,9658,9647,9634,9360],
           [94.7,95.2,94.4,96.0,96.4,96.4,93.4,95.0,95.0,94.5,92.6,93.3,94.3,94.4,95.6,95.5,95.3,92.6]],
    breakdown: [[45,113,90,125,126,136,92,107,107,101,76,76,83,85,103,104,106,75],
                [65,164,143,173,181,187,137,163,157,151,120,124,137,137,163,159,160,116],
                [82,208,201,209,214,222,192,207,205,206,186,190,194,203,211,215,211,182],
                [94,237,238,238,238,238,229,240,240,239,231,235,236,238,244,239,242,233],
                [5,12,9,14,11,14,18,9,7,10,13,10,12,9,6,8,6,17]],
    daily: [96.0,96.4,96.4,93.4,95.0,95.0,94.5,92.6,93.3,94.3,94.4,95.6,95.5,95.3,92.6]
  }, average: {
    title: '⚠️ Average Partners (261)',
    target: '8,346',
    mtd: '92.0%',
    w1: '93.0%',
    w2: '91.6%',
    gap: '221',
    insight: 'Average partners show declining trend from W1 (93.0%) to W2 (91.6%). Only 37% achieving ≥100%, with 12% below 80%. Performance concentration in 90-95% range suggests need for targeted improvement interventions.',
    data: [[8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346,8346],
           [7925,8004,7839,8575,8005,8007,7842,7911,7848,7843,7755,7798,7832,7816,7861,7894,7920,7808],
           [7704,7762,7646,7934,7907,7893,7568,7721,7649,7665,7471,7545,7632,7613,7703,7796,7765,7539],
           [92.3,93.0,91.6,95.1,94.7,94.6,90.7,92.5,91.6,91.8,89.5,90.4,91.4,91.2,92.3,93.4,93.0,90.3]],
    breakdown: [[37,97,80,120,117,110,64,86,96,89,54,72,74,78,94,99,92,62],
                [51.6,135,123,149,160,151,96,128,135,124,96,106,113,113,137,149,145,111],
                [68.8,180,175,183,192,191,158,181,173,177,150,162,171,174,189,190,190,168],
                [85.4,223,224,228,234,232,213,219,217,217,216,218,221,222,227,236,231,221],
                [12.0,31,30,23,23,26,40,34,37,37,35,38,31,31,28,24,24,34]],
    daily: [95.1,94.7,94.6,90.7,92.5,91.6,91.8,89.5,90.4,91.4,91.2,92.3,93.4,93.0,90.3]
  }, bad: {
    title: '❌ Bad Partners (20)',
    target: '375',
    mtd: '91.7%',
    w1: '91.5%',
    w2: '92.2%',
    gap: '8',
    insight: 'Bad partners show improvement from W1 (91.5%) to W2 (92.2%). Despite "bad" classification, 54% achieve ≥100%, indicating potential for rehabilitation. Only 19.3% below 80% - relatively small absolute numbers allow focused intervention.',
    data: [[375,375,375,375,375,375,375,375,375,375,375,375,375,375,375,375,375,375],
           [353,355,351,374,349,352,351,355,347,354,350,343,351,351,351,356,355,352],
           [344,343,346,346,341,337,341,349,341,347,335,337,347,344,350,355,351,345],
           [91.7,91.5,92.2,92.3,90.9,89.9,90.9,93.1,90.9,92.5,89.3,89.9,92.5,91.7,93.3,94.7,93.6,92.0]],
    breakdown: [[54,11,10,11,14,13,10,11,8,11,8,11,10,9,9,11,11,9],
                [56.4,11,10,12,14,13,10,11,8,11,8,11,10,9,9,11,12,9],
                [72.1,14,14,16,14,14,13,15,15,14,13,12,16,13,13,15,14,12],
                [80.7,16,18,17,15,15,16,17,16,17,17,17,17,18,18,19,18,17],
                [19.3,4,2,3,5,5,4,3,4,3,3,3,3,2,2,1,2,3]],
    daily: [92.3,90.9,89.9,90.9,93.1,90.9,92.5,89.3,89.9,92.5,91.7,93.3,94.7,93.6,92.0]
  }, inc20: {
    title: '📈 Increase >20 (84 partners)',
    target: '6,112',
    mtd: '93.3%',
    w1: '91.3%',
    w2: '92.5%',
    gap: '134',
    insight: 'Partners with >20 increase show recovery from W1 (91.3%) to W2 (92.5%). Only 21% achieve ≥100%, suggesting aggressive targets. 74% maintain >90%, indicating targets are challenging but largely achievable with effort.',
    data: [[6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112,6112],
           [5836,5721,5773,5882,5696,5727,5656,5701,5682,5704,5672,5720,5757,5767,5811,5824,5859,5793],
           [5702,5579,5656,5552,5625,5657,5474,5593,5558,5593,5493,5556,5661,5629,5712,5767,5773,5620],
           [93.3,91.3,92.5,90.8,92.0,92.6,89.6,91.5,90.9,91.5,89.9,90.9,92.6,92.1,93.5,94.4,94.5,92.0]],
    breakdown: [[21,18,15,23,20,23,9,15,14,19,7,15,15,11,16,18,20,15],
                [53,45,42,47,52,58,36,43,39,37,30,34,40,36,46,55,50,40],
                [74,63,65,61,65,67,57,64,62,62,58,57,66,63,69,70,70,58],
                [86,72,77,69,71,74,70,71,73,75,73,75,76,76,76,80,80,76],
                [14,11,7,14,12,10,12,13,11,8,11,8,8,8,8,4,4,8]],
    daily: [90.8,92.0,92.6,89.6,91.5,90.9,91.5,89.9,90.9,92.6,92.1,93.5,94.4,94.5,92.0]
  }, inc1020: {
    title: '📊 Increase 10-20 (47 partners)',
    target: '1,584',
    mtd: '93.6%',
    w1: '90.9%',
    w2: '93.3%',
    gap: '32',
    insight: 'Moderate increase group shows strong improvement W1→W2 (90.9% to 93.3%). 44% achieve ≥100%, highest among increase slabs. 82% above 80% indicates well-calibrated targets with room for optimization.',
    data: [[1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584,1584],
           [1514,1469,1508,1511,1459,1458,1446,1464,1474,1469,1468,1489,1509,1511,1525,1531,1523,1502],
           [1482,1439,1477,1436,1450,1439,1408,1438,1455,1448,1410,1452,1476,1481,1501,1519,1503,1452],
           [93.6,90.9,93.3,90.7,91.5,90.8,88.9,90.8,91.9,91.4,89.0,91.7,93.2,93.5,94.8,95.9,94.9,91.7]],
    breakdown: [[44,21,15,22,24,24,14,20,23,19,12,12,12,12,12,17,21,17],
                [57,27,25,28,30,28,20,27,29,27,16,22,22,26,27,33,29,19],
                [71,33,36,33,34,32,30,34,34,35,30,36,33,36,38,41,41,36],
                [82,38,42,37,38,37,37,38,41,41,40,40,41,42,43,43,43,41],
                [17,8,4,10,9,10,10,8,5,5,6,6,6,4,4,4,4,6]],
    daily: [90.7,91.5,90.8,88.9,90.8,91.9,91.4,89.0,91.7,93.2,93.5,94.8,95.9,94.9,91.7]
  }, inc110: {
    title: '📉 Increase 1-10 (100 partners)',
    target: '3,166',
    mtd: '93.5%',
    w1: '93.5%',
    w2: '93.2%',
    gap: '66',
    insight: 'Minor increase group maintains stable performance (W1: 93.5%, W2: 93.2%). 35% achieve ≥100%, 72% above 90%, 91% above 80%. Small target increases appear well-absorbed with consistent execution.',
    data: [[3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166,3166],
           [3026,3031,3011,3192,3013,3028,2990,2993,3004,2998,2981,2987,2998,2997,3032,3039,3041,3011],
           [2960,2961,2952,2979,2985,3000,2911,2947,2952,2954,2900,2909,2931,2946,2990,3006,2982,2924],
           [93.5,93.5,93.2,94.1,94.3,94.8,91.9,93.1,93.2,93.3,91.6,91.9,92.6,93.1,94.4,94.9,94.2,92.4]],
    breakdown: [[35,53,39,52,53,48,24,35,46,41,20,22,27,26,35,39,40,28],
                [48,72,60,78,77,74,47,66,69,66,45,55,56,63,71,73,72,64],
                [60,79,79,78,82,82,73,78,80,79,74,77,80,82,87,88,85,79],
                [75,93,92,90,92,93,89,90,92,93,90,92,92,93,95,94,94,92],
                [10,7,7,10,8,7,10,10,7,7,10,8,8,7,5,6,6,8]],
    daily: [94.1,94.3,94.8,91.9,93.1,93.2,93.3,91.6,91.9,92.6,93.1,94.4,94.9,94.2,92.4]
  }, inc0: {
    title: '↔️ Others (≤0) (325 partners)',
    target: '8,543',
    mtd: '93.6%',
    w1: '94.3%',
    w2: '92.9%',
    gap: '216',
    insight: 'Partners with flat/reduced targets show declining trend (W1: 94.3% to W2: 92.9%). 48% achieve ≥100%, highest overall. 88% above 80%. May indicate capacity adjustment or operational challenges offsetting target reduction benefit.',
    data: [[8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543,8543],
           [8209,8307,8111,8972,8268,8291,8117,8199,8153,8150,8057,8059,8091,8111,8158,8148,8153,8047],
           [7992,8058,7935,8218,8180,8167,7869,8020,7983,7967,7768,7821,7913,7945,8035,8038,8024,7787],
           [93.6,94.3,92.9,96.2,95.8,95.6,92.1,93.9,93.4,93.3,90.9,91.5,92.6,93.0,94.1,94.1,93.9,91.2]],
    breakdown: [[48,155,128,176,178,177,119,141,148,143,106,110,116,121,145,150,146,113],
                [60,195,171,208,222,215,153,192,189,184,148,151,164,159,193,189,193,152],
                [75,244,234,252,253,256,219,244,240,242,216,229,234,249,253,249,253,218],
                [88,286,286,293,293,290,276,286,281,282,273,282,282,288,293,293,292,283],
                [10,32,29,25,27,32,39,30,34,35,34,34,33,27,24,26,23,35]],
    daily: [96.2,95.8,95.6,92.1,93.9,93.4,93.3,90.9,91.5,92.6,93.0,94.1,94.1,93.9,91.2]
  }};
  
  var d = data[cat];
  var html = '<div class="adv-cards-row">';
  html += '<div class="adv-card '+((parseFloat(d.mtd)>=95)?'green':(parseFloat(d.mtd)>=90)?'amber':'red')+'"><div class="card-label">MTD Achievement</div><div class="card-value">'+d.mtd+'</div><div class="card-sub">Target: '+d.target+'</div></div>';
  html += '<div class="adv-card '+((parseFloat(d.w1)>=95)?'green':(parseFloat(d.w1)>=90)?'amber':'red')+'"><div class="card-label">W1 Performance</div><div class="card-value">'+d.w1+'</div><div class="card-sub">Feb 1-7</div></div>';
  html += '<div class="adv-card '+((parseFloat(d.w2)>=95)?'green':(parseFloat(d.w2)>=90)?'amber':'red')+'"><div class="card-label">W2 Performance</div><div class="card-value">'+d.w2+'</div><div class="card-sub">Feb 8-14</div></div>';
  html += '<div class="adv-card"><div class="card-label">Total GAP</div><div class="card-value">'+d.gap+'</div><div class="card-sub">Riders</div></div>';
  html += '</div>';
  
  html += '<div class="adv-legend"><strong>Color Legend:</strong>';
  html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-excellent"></span> ≥95% Excellent</div>';
  html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-good"></span> 90-94.9% Good</div>';
  html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-warning"></span> 85-89.9% Warning</div>';
  html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-critical"></span> <85% Critical</div>';
  html += '</div>';
  
  html += '<div class="adv-table-container"><div class="adv-table-title">'+d.title+' Performance</div><div class="adv-table-wrap"><table class="adv-table" id="partner'+cat+'Table"><thead><tr><th>Metric</th><th>MTD</th><th>W1</th><th>W2</th>';
  for(var i=1; i<=15; i++) html+='<th class="adv-daily-cols">Day '+i+'</th>';
  html += '</tr></thead><tbody>';
  
  var rows = ['Target','Online Riders','Delivery Riders','Achievement %'];
  for(var r=0; r<4; r++) {
    html += '<tr><td>'+(r===3?'<strong>'+rows[r]+'</strong>':rows[r])+'</td>';
    for(var c=0; c<3; c++) {
      var val = d.data[r][c];
      var cls = 'period-col';
      if(r===3 && c>0) cls += ' '+getColorClass(val);
      html += '<td class="'+cls+'">'+(typeof val === 'number' && r===3 ? val.toFixed(1)+'%' : (typeof val === 'number' ? val.toLocaleString() : val))+'</td>';
    }
    for(var c=3; c<d.data[r].length; c++) {
      var val = d.data[r][c];
      var cls = (r===3) ? 'adv-daily-cols '+getColorClass(val) : 'adv-daily-cols';
      html += '<td class="'+cls+'">'+(typeof val === 'number' && r===3 ? val.toFixed(1)+'%' : (typeof val === 'number' ? val.toLocaleString() : val))+'</td>';
    }
    html += '</tr>';
  }
  
  // Achievement breakdown rows
  var breakdownRows = ['achievement rate ≥100%','achievement rate >95%','achievement rate >90%','achievement rate >80%','achievement rate <80%'];
  for(var b=0; b<5; b++) {
    html += '<tr><td>'+breakdownRows[b]+'</td>';
    // MTD column (index 0) is a percentage
    var mtdVal = d.breakdown[b][0];
    html += '<td class="period-col">'+(mtdVal % 1 !== 0 ? mtdVal.toFixed(1) : mtdVal)+'%</td>';
    // W1 and W2 columns (index 1,2) are counts
    for(var c=1; c<3; c++) {
      var val = d.breakdown[b][c];
      html += '<td class="period-col">'+val+'</td>';
    }
    for(var c=3; c<d.breakdown[b].length; c++) {
      var val = d.breakdown[b][c];
      html += '<td class="adv-daily-cols">'+val+'</td>';
    }
    html += '</tr>';
  }
  
  html += '</tbody></table></div><button class="adv-expand-btn" onclick="toggleDailyExpand(\'partner'+cat+'Table\')">📅 Expand Daily View</button></div>';
  
  var color = (parseFloat(d.mtd)>=95)?'green':(parseFloat(d.mtd)>=90)?'amber':'amber';
  html += '<div class="adv-highlight-box '+color+'"><strong>📊 Key Insights:</strong> '+d.insight+'</div>';
  
  html += '<details class="adv-chart-details"><summary>📈 Daily Trend Chart</summary><div class="adv-chart-wrap"><div class="adv-chart-canvas"><canvas id="partner'+cat+'Chart"></canvas></div></div></details>';
  
  document.getElementById('partnerCatContent').innerHTML = html;
  
  setTimeout(function(){
    var ctx = document.getElementById('partner'+cat+'Chart');
    if(!ctx) return;
    ctx = ctx.getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['D1','D2','D3','D4','D5','D6','D7','D8','D9','D10','D11','D12','D13','D14','D15'],
        datasets: [{
          label: 'Achievement %',
          data: d.daily,
          borderColor: '#1976d2',
          backgroundColor: 'rgba(25,118,210,0.1)',
          tension: 0.3,
          fill: true,
          borderWidth: 3,
          pointRadius: 4
        },{
          label: '95% Target',
          data: Array(15).fill(95),
          borderColor: '#2e7d32',
          borderWidth: 2,
          borderDash: [5,5],
          pointRadius: 0,
          fill: false
        },{
          label: '90% Threshold',
          data: Array(15).fill(90),
          borderColor: '#f57c00',
          borderWidth: 2,
          borderDash: [5,5],
          pointRadius: 0,
          fill: false
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top' },
          tooltip: { mode: 'index', intersect: false }
        },
        scales: {
          y: { beginAtZero: false, min: 85, max: 105, ticks: { callback: v=>v+'%' } }
        }
      }
    });
  }, 100);
}

function renderCityMetric(metric) {
  var cities = ['Al Ahsa','Dammam','Hafar Albatin','Jubail','Riyadh','Al Kharj','Buraydah','Hail','Jeddah','Madinah','Tabuk','Yanbu','Abha','Jazan','Makkah','Najran','Taif'];
  
  var gapData = {
    mtd: [1.1,1.8,1.1,1.7,3.3,1.6,1.4,1.7,1.8,1.4,1.7,2.6,1.7,1.9,2.1,1.5,1.8],
    w1: [-0.9,-2.2,-1.5,-2.0,-3.4,-2.0,-1.6,-1.5,-1.6,-1.6,-1.9,-3.8,-1.6,-1.3,-2.2,-1.2,-1.6],
    w2: [-1.0,-1.5,-0.8,-1.9,-2.8,-1.7,-0.6,-2.6,-1.9,-1.5,-2.0,-3.0,-2.0,-2.7,-1.8,-1.2,-1.8],
    daily: [[-2.9,-0.1,-0.1,-1.6,-0.4,-0.7,-0.3,-2.2,-1.4,-0.8,-0.8,-0.8,-0.8,-0.8,-0.8],
            [-8.8,-0.4,-0.5,-2.6,-1.0,-0.5,-1.3,-2.2,-2.0,-1.4,-1.4,-1.4,-1.4,-1.4,-1.4],
            [-8.7,-1.0,0.0,0.0,0.0,0.0,-1.0,-1.0,0.0,-1.0,-1.0,-1.0,-1.0,-1.0,-1.0],
            [-6.0,-0.9,-1.4,0.0,-0.9,-0.9,-3.7,-2.8,-2.8,-0.9,-0.9,-0.9,-0.9,-0.9,-0.9],
            [-8.1,-1.4,-1.9,-4.1,-2.9,-3.1,-2.5,-3.9,-3.3,-2.4,-2.4,-2.4,-2.4,-2.4,-2.4],
            [-8.3,-0.7,0.0,-1.3,-1.3,-0.7,-1.7,-4.0,-2.0,-1.0,-1.0,-1.0,-1.0,-1.0,-1.0],
            [-7.4,0.0,-0.4,-1.6,-0.8,-0.4,-0.4,-1.2,-2.5,0.0,0.0,0.0,0.0,0.0,0.0],
            [-3.5,-1.2,0.0,-0.6,-1.2,0.0,-4.1,-4.7,0.0,-2.3,-2.3,-2.3,-2.3,-2.3,-2.3],
            [-4.9,-0.8,-0.6,-1.5,-1.0,-0.8,-1.2,-2.6,-2.4,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8],
            [-4.9,-0.4,-1.1,-1.4,-1.3,-1.2,-1.0,-1.8,-1.8,-1.4,-1.4,-1.4,-1.4,-1.4,-1.4],
            [-8.7,-0.5,0.0,-1.4,-0.5,-1.0,-1.0,-1.9,-1.4,-2.4,-2.4,-2.4,-2.4,-2.4,-2.4],
            [-13.5,-0.6,-2.9,-4.1,-1.2,-0.6,-3.5,-3.5,-4.7,-2.3,-2.3,-2.3,-2.3,-2.3,-2.3],
            [-3.4,-1.9,-1.1,-1.1,0.0,-1.5,-2.3,-1.5,-1.1,-2.3,-2.3,-2.3,-2.3,-2.3,-2.3],
            [-3.8,0.0,0.0,-1.3,-1.3,-1.3,-1.3,0.0,-2.6,-3.8,-3.8,-3.8,-3.8,-3.8,-3.8],
            [-8.7,-1.0,-0.8,-1.9,-0.9,-1.4,-1.0,-3.2,-2.2,-1.6,-1.6,-1.6,-1.6,-1.6,-1.6],
            [-5.6,0.0,0.0,0.0,-1.4,0.0,-1.4,-5.6,-1.4,0.0,0.0,0.0,0.0,0.0,0.0],
            [-2.8,-0.7,-1.0,-1.7,-1.4,-2.1,-1.4,-1.4,-3.1,-1.7,-1.7,-1.7,-1.7,-1.7,-1.7]]
  };
  
  var achData = {
    mtd: [93.4,95.2,100.1,97.4,90.8,100.7,98.4,95.2,95.2,97.3,95.9,96.1,98.8,98.8,94.6,97.6,96.8],
    w1: [94.2,95.6,100.1,97.5,89.5,103.5,99.1,98.4,95.0,98.3,95.3,95.2,100.9,93.4,94.0,101.4,92.5],
    w2: [92.1,94.6,99.0,93.1,89.5,98.4,97.1,91.4,93.8,95.8,95.7,97.0,96.3,100.2,92.9,92.7,98.9],
    daily: [[93.8,93.0,94.8,93.6,95.1,94.8,94.7,90.5,91.4,92.1,92.1,92.1,92.1,92.1,92.1],
            [95.7,96.0,96.7,92.9,96.0,96.4,95.6,93.1,94.0,94.8,94.8,94.8,94.8,94.8,94.8],
            [100.0,98.1,99.0,101.9,100.0,101.0,101.0,99.0,101.0,98.1,98.1,98.1,98.1,98.1,98.1],
            [97.2,99.1,99.5,100.5,97.2,98.6,90.2,89.3,90.7,95.3,95.3,95.3,95.3,95.3,95.3],
            [90.3,91.0,90.9,87.6,89.2,88.2,89.3,87.3,88.4,90.3,90.3,90.3,90.3,90.3,90.3],
            [104.3,104.3,104.7,103.0,103.0,103.3,101.7,98.7,98.0,97.7,97.7,97.7,97.7,97.7,97.7],
            [101.2,99.6,99.6,97.9,97.5,98.8,99.2,98.4,96.7,96.3,96.3,96.3,96.3,96.3,96.3],
            [99.4,98.8,100.0,98.3,98.8,98.3,95.3,94.2,97.1,88.4,88.4,88.4,88.4,88.4,88.4],
            [96.3,96.3,96.1,92.2,94.5,95.3,94.2,91.9,93.1,94.3,94.3,94.3,94.3,94.3,94.3],
            [101.0,100.3,100.0,97.1,97.5,96.0,96.1,95.5,95.8,95.8,95.8,95.8,95.8,95.8,95.8],
            [93.7,96.1,97.6,95.2,95.2,94.7,94.7,95.2,95.2,96.1,96.1,96.1,96.1,96.1,96.1],
            [95.9,95.3,94.2,91.8,97.1,97.7,94.2,95.9,95.9,98.2,98.2,98.2,98.2,98.2,98.2],
            [106.1,102.7,102.3,98.9,99.6,98.9,98.1,97.7,97.7,95.1,95.1,95.1,95.1,95.1,95.1],
            [89.7,91.0,88.5,87.2,93.6,101.3,102.6,105.1,103.8,97.4,97.4,97.4,97.4,97.4,97.4],
            [93.4,94.1,95.0,92.2,94.5,94.3,94.6,91.5,92.0,93.1,93.1,93.1,93.1,93.1,93.1],
            [104.2,101.4,102.8,101.4,101.4,101.4,97.2,87.5,91.7,93.1,93.1,93.1,93.1,93.1,93.1],
            [88.5,90.6,89.9,91.3,93.4,96.2,97.6,99.3,96.9,99.7,99.7,99.7,99.7,99.7,99.7]]
  };
  
  var data = (metric==='gap') ? gapData : achData;
  var title = (metric==='gap') ? '📉 City GAP % (Delivery vs Capacity)' : '📊 City Achievement Rate';
  var insight = (metric==='gap') ? 'GAP analysis shows Yanbu with highest MTD gap (2.6%), Riyadh (3.3%), and Dammam (1.8%). Negative W1 values indicate delivery exceeded capacity in shorter window. Day 1 shows extreme spikes (Yanbu -13.5%, multiple cities <-8%) suggesting initialization or data timing issues. Most cities stabilize at <-2% daily gap by Day 3 onwards.' : 'Achievement rates show strong performers: Al Kharj (100.7%), Hafar Albatin (100.1%), Madinah (97.3%), and Buraydah (98.4%) consistently above 95%. Riyadh struggles at 90.8% MTD with W1=W2=89.5%, indicating systemic underperformance. Jazan volatile (93.4% W1 → 100.2% W2). Taif improves dramatically (92.5% W1 → 98.9% W2).';
  
  var bestCity = '', bestVal = (metric==='ach' ? -999 : 999), worstCity = '', worstVal = (metric==='ach' ? 999 : -999);
  for(var i=0; i<cities.length; i++) {
    var val = data.mtd[i];
    if(metric==='ach') {
      if(val>bestVal) { bestVal=val; bestCity=cities[i]; }
      if(val<worstVal) { worstVal=val; worstCity=cities[i]; }
    } else {
      var absVal = Math.abs(val);
      if(absVal<Math.abs(bestVal)) { bestVal=val; bestCity=cities[i]; }
      if(absVal>Math.abs(worstVal)) { worstVal=val; worstCity=cities[i]; }
    }
  }
  
  var html = '<div class="adv-cards-row">';
  html += '<div class="adv-card green"><div class="card-label">Best City</div><div class="card-value">'+bestCity+'</div><div class="card-sub">'+bestVal.toFixed(1)+(metric==='ach'?'%':'%')+'</div></div>';
  html += '<div class="adv-card red"><div class="card-label">Worst City</div><div class="card-value">'+worstCity+'</div><div class="card-sub">'+worstVal.toFixed(1)+(metric==='ach'?'%':'%')+'</div></div>';
  html += '<div class="adv-card"><div class="card-label">Cities Tracked</div><div class="card-value">17</div><div class="card-sub">Across KSA</div></div>';
  html += '<div class="adv-card"><div class="card-label">Avg '+(metric==='gap'?'GAP':'Achievement')+'</div><div class="card-value">'+(data.mtd.reduce((a,b)=>a+b,0)/17).toFixed(1)+(metric==='ach'?'%':'%')+'</div><div class="card-sub">MTD Average</div></div>';
  html += '</div>';
  
  if(metric==='ach') {
    html += '<div class="adv-legend"><strong>Color Legend:</strong>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-excellent"></span> ≥95% Excellent</div>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-good"></span> 90-94.9% Good</div>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-warning"></span> 85-89.9% Warning</div>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-critical"></span> <85% Critical</div>';
    html += '</div>';
  } else {
    html += '<div class="adv-legend"><strong>Color Legend (GAP %):</strong>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-excellent"></span> ≤1.0% Excellent</div>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-good"></span> 1.1-2.0% Good</div>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-warning"></span> 2.1-3.0% Warning</div>';
    html += '<div class="adv-legend-item"><span class="adv-legend-dot dot-critical"></span> >3.0% Critical</div>';
    html += '</div>';
  }
  
  html += '<div class="adv-table-container"><div class="adv-table-title">'+title+'</div><div class="adv-table-wrap"><table class="adv-table" id="city'+metric+'Table"><thead><tr><th>City</th><th>MTD</th><th>W1</th><th>W2</th>';
  for(var i=1; i<=15; i++) html+='<th class="adv-daily-cols">Day '+i+'</th>';
  html += '</tr></thead><tbody>';
  
  for(var c=0; c<cities.length; c++) {
    html += '<tr><td>'+cities[c]+'</td>';
    html += '<td class="period-col '+(metric==='ach'?getColorClass(data.mtd[c]):getGapColorClass(data.mtd[c]))+'">'+data.mtd[c].toFixed(1)+(metric==='ach'?'%':'%')+'</td>';
    html += '<td class="period-col '+(metric==='ach'?getColorClass(data.w1[c]):getGapColorClass(data.w1[c]))+'">'+data.w1[c].toFixed(1)+(metric==='ach'?'%':'%')+'</td>';
    html += '<td class="period-col '+(metric==='ach'?getColorClass(data.w2[c]):getGapColorClass(data.w2[c]))+'">'+data.w2[c].toFixed(1)+(metric==='ach'?'%':'%')+'</td>';
    for(var d=0; d<15; d++) {
      html += '<td class="adv-daily-cols '+(metric==='ach'?getColorClass(data.daily[c][d]):getGapColorClass(data.daily[c][d]))+'">'+data.daily[c][d].toFixed(1)+(metric==='ach'?'%':'%')+'</td>';
    }
    html += '</tr>';
  }
  
  html += '</tbody></table></div><button class="adv-expand-btn" onclick="toggleDailyExpand(\'city'+metric+'Table\')">📅 Expand Daily View</button></div>';
  
  html += '<div class="adv-highlight-box amber"><strong>📊 Key Insights:</strong> '+insight+'</div>';
  
  html += '<details class="adv-chart-details"><summary>📈 City Comparison Chart</summary><div class="adv-chart-wrap"><div class="adv-chart-canvas"><canvas id="city'+metric+'Chart"></canvas></div></div></details>';
  
  document.getElementById('cityMetricContent').innerHTML = html;
  
  setTimeout(function(){
    var ctx = document.getElementById('city'+metric+'Chart');
    if(!ctx) return;
    ctx = ctx.getContext('2d');
    
    var datasets = [];
    var colors = ['#1976d2','#2e7d32','#f57c00','#c62828','#7b1fa2','#0097a7','#fbc02d','#455a64'];
    for(var c=0; c<Math.min(cities.length,8); c++) {
      datasets.push({
        label: cities[c],
        data: data.daily[c],
        borderColor: colors[c%colors.length],
        backgroundColor: colors[c%colors.length]+'33',
        tension: 0.2,
        borderWidth: 2,
        pointRadius: 3
      });
    }
    
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['D1','D2','D3','D4','D5','D6','D7','D8','D9','D10','D11','D12','D13','D14','D15'],
        datasets: datasets
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top', labels: { boxWidth: 12, font: { size: 10 } } },
          tooltip: { mode: 'index', intersect: false }
        },
        scales: {
          y: { beginAtZero: false, ticks: { callback: v=>v+(metric==='ach'?'%':'%') } }
        }
      }
    });
  }, 100);
}
</script>

<!-- KPI CARDS -->
<div class="daily-kpi-row">
  <div class="daily-kpi-card">
    <div class="kpi-label">Total Partners</div>
    <div class="kpi-value">553</div>
    <div class="kpi-sub">Good: 252 &middot; Average: 260 &middot; Bad: 20 &middot; New: 21</div>
    <div class="tooltip-daily">Partners with active capacity targets in Feb 1-10, 2026. Cap: 19,345<br>Good: 252 (45.6%) &middot; Average: 260 (47%) &middot; Bad: 20 (3.6%) &middot; New: 21 (3.8%)<br>Del riders: 18,054 &middot; Onl riders: 18,550 &middot; DCR: 59.2%</div>
  </div>
  <div class="daily-kpi-card kpi-amber">
    <div class="kpi-label">Avg Achievement (Delivery)</div>
    <div class="kpi-value">93.6%</div>
    <div class="kpi-sub">10-day avg &middot; 18,054 / 19,345 target</div>
    <div class="tooltip-daily">Overall delivery achievement: 93.6%.<br>Good: 95.5% &middot; Average: 92.3% &middot; Bad: 91.2% &middot; New: 65.3%<br>Delivery achievement below the 100% target.</div>
  </div>
  <div class="daily-kpi-card kpi-green">
    <div class="kpi-label">Avg Achievement (Online)</div>
    <div class="kpi-value">96.3%</div>
    <div class="kpi-sub">10-day avg &middot; 18,550 / 19,345 target</div>
    <div class="tooltip-daily">Overall online achievement: 96.3%.<br>Good: 97.0% &middot; Average: 95.5% &middot; Bad: 93.9% &middot; New: 66.1%<br>Online exceeds delivery by ~2.7%.</div>
  </div>
  <div class="daily-kpi-card kpi-blue">
    <div class="kpi-label">Best / Worst Day</div>
    <div class="kpi-value" style="font-size:20px;">Feb 3 <span style="color:#27ae60;">&#8593;</span> / Feb 8 <span style="color:#e74c3c;">&#8595;</span></div>
    <div class="kpi-sub">Best: 94.4% &nbsp;&middot;&nbsp; Worst: 90.8%</div>
    <div class="tooltip-daily">Best performing day: Feb 3 with 94.4% delivery achievement.<br>Weakest day: Feb 8 with 90.8% delivery achievement.<br>Variance of 3.6pp across the 10-day period.</div>
  </div>
  <div class="daily-kpi-card kpi-amber">
    <div class="kpi-label">Avg Gap (Del vs Online)</div>
    <div class="kpi-value">2.7%</div>
    <div class="kpi-sub">497 rider gap &middot; DCR: 59.2%</div>
    <div class="tooltip-daily">Gap: 96.3% - 93.6% = 2.7%. Rider gap: 497 (18,550 - 18,054).<br>Good: 1.5% &middot; Average: 3.2% &middot; Bad: 2.7% &middot; New: 0.8%<br>Feb 1 highest gap (7.9%) due to online spike.</div>
  </div>
</div>

<!-- CATEGORY SLICER -->
<div class="daily-slicer" id="dailyViewSlicer">
  <button class="daily-slicer-btn active" data-cat="total" onclick="switchDailyCat('total', this)">&#128202; All Partners (553)</button>
  <button class="daily-slicer-btn" data-cat="good" onclick="switchDailyCat('good', this)">&#9989; Good (252)</button>
  <button class="daily-slicer-btn" data-cat="average" onclick="switchDailyCat('average', this)">&#9888;&#65039; Average (260)</button>
  <button class="daily-slicer-btn" data-cat="bad" onclick="switchDailyCat('bad', this)">&#10060; Bad (20)</button>
  <button class="daily-slicer-btn" data-cat="new" onclick="switchDailyCat('new', this)">&#127381; New (21)</button>
</div>
<div class="daily-mini-note"><strong>Note:</strong> New partners are partners without a performance assessment (Good, Average, or Bad) who were added to PMM capacity target.</div>

<!-- OVERVIEW & DATA TABLES -->
<details class="daily-details" id="dailyOverviewTables">
  <summary>&#128202; Overview &amp; Detailed Data Tables</summary>
  <div class="daily-details-content">
<div class='daily-data-section'><h4>&#128200; Overall View</h4><table class='daily-data-tbl'><thead><tr><th># Partners</th><th>Del Riders</th><th>Onl Riders</th><th>Gap</th><th>Ach Del</th><th>Ach Onl</th><th>DCR</th></tr></thead><tbody><tr><td style='font-weight:700'>553</td><td>18,054</td><td>18,550</td><td>497</td><td class='ach-val-amber'>93.6%</td><td class='ach-val'>96.3%</td><td>59.2%</td></tr></tbody></table></div>
<div class='daily-data-section'><h4>&#128202; All Partners - Daily Data</h4><table class='daily-data-tbl'><thead><tr class='hdr-blue'><th>Metric</th><th>DCR</th><th>Cap</th><th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th><th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th></tr></thead><tbody><tr><td class='lbl-cell'>Del Riders (553)</td><td>59.2%</td><td style='font-weight:700'>19,345</td><td>18,185</td><td>18,240</td><td>18,263</td><td>17,662</td><td>17,998</td><td>17,948</td><td>17,962</td><td>17,571</td><td>17,738</td><td>17,981</td></tr><tr><td class='lbl-cell' colspan='3'>Delivery Ach Rate</td><td class='ach-val-amber'>94%</td><td class='ach-val-amber'>94.3%</td><td class='ach-val-amber'>94.4%</td><td class='ach-val-amber'>91.3%</td><td class='ach-val-amber'>93%</td><td class='ach-val-amber'>92.8%</td><td class='ach-val-amber'>92.9%</td><td class='ach-val-amber'>90.8%</td><td class='ach-val-amber'>91.7%</td><td class='ach-val-amber'>92.9%</td></tr><tr><td class='lbl-cell'>Onl Riders</td><td></td><td></td><td>19,557</td><td>18,436</td><td>18,504</td><td>18,209</td><td>18,357</td><td>18,313</td><td>18,321</td><td>18,178</td><td>18,255</td><td>18,355</td></tr><tr><td class='lbl-cell' colspan='3'>Online Ach Rate</td><td class='ach-val'>101.1%</td><td class='ach-val'>95.3%</td><td class='ach-val'>95.7%</td><td class='ach-val-amber'>94.1%</td><td class='ach-val-amber'>94.9%</td><td class='ach-val-amber'>94.7%</td><td class='ach-val-amber'>94.7%</td><td class='ach-val-amber'>94%</td><td class='ach-val-amber'>94.4%</td><td class='ach-val-amber'>94.9%</td></tr><tr><td class='lbl-cell' colspan='3'>Gap (Onl-Del)</td><td style='color:#2980b9;font-weight:600'>7.9%</td><td style='color:#2980b9;font-weight:600'>1%</td><td style='color:#2980b9;font-weight:600'>1.3%</td><td style='color:#2980b9;font-weight:600'>2.7%</td><td style='color:#2980b9;font-weight:600'>1.8%</td><td style='color:#2980b9;font-weight:600'>1.8%</td><td style='color:#2980b9;font-weight:600'>1.9%</td><td style='color:#2980b9;font-weight:600'>3.1%</td><td style='color:#2980b9;font-weight:600'>2.6%</td><td style='color:#2980b9;font-weight:600'>2.1%</td></tr></tbody></table></div>
<div class='daily-data-section'><h4>&#9989; Good Partners</h4><table class='daily-data-tbl'><thead><tr class='hdr-green'><th>Metric</th><th>DCR</th><th>Cap</th><th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th><th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th></tr></thead><tbody><tr><td class='lbl-cell'>Del Riders (252)</td><td>59.2%</td><td style='font-weight:700'>10,104</td><td>9,703</td><td>9,741</td><td>9,737</td><td>9,434</td><td>9,600</td><td>9,601</td><td>9,548</td><td>9,361</td><td>9,429</td><td>9,525</td></tr><tr><td class='lbl-cell' colspan='3'>Delivery Ach Rate</td><td class='ach-val'>96%</td><td class='ach-val'>96.4%</td><td class='ach-val'>96.4%</td><td class='ach-val-amber'>93.4%</td><td class='ach-val'>95%</td><td class='ach-val'>95%</td><td class='ach-val-amber'>94.5%</td><td class='ach-val-amber'>92.6%</td><td class='ach-val-amber'>93.3%</td><td class='ach-val-amber'>94.3%</td></tr><tr><td class='lbl-cell'>Onl Riders</td><td></td><td></td><td>10,406</td><td>9,830</td><td>9,850</td><td>9,695</td><td>9,764</td><td>9,759</td><td>9,720</td><td>9,657</td><td>9,671</td><td>9,685</td></tr><tr><td class='lbl-cell' colspan='3'>Online Ach Rate</td><td class='ach-val'>103%</td><td class='ach-val'>97.3%</td><td class='ach-val'>97.5%</td><td class='ach-val'>96%</td><td class='ach-val'>96.6%</td><td class='ach-val'>96.6%</td><td class='ach-val'>96.2%</td><td class='ach-val'>95.6%</td><td class='ach-val'>95.7%</td><td class='ach-val'>95.9%</td></tr><tr><td class='lbl-cell' colspan='3'>Gap (Onl-Del)</td><td style='color:#2980b9;font-weight:600'>7%</td><td style='color:#2980b9;font-weight:600'>0.9%</td><td style='color:#2980b9;font-weight:600'>1.1%</td><td style='color:#2980b9;font-weight:600'>2.6%</td><td style='color:#2980b9;font-weight:600'>1.6%</td><td style='color:#2980b9;font-weight:600'>1.6%</td><td style='color:#2980b9;font-weight:600'>1.7%</td><td style='color:#2980b9;font-weight:600'>3%</td><td style='color:#2980b9;font-weight:600'>2.4%</td><td style='color:#2980b9;font-weight:600'>1.6%</td></tr></tbody></table></div>
<div class='daily-data-section'><h4>&#9888;&#65039; Average Partners</h4><table class='daily-data-tbl'><thead><tr class='hdr-orange'><th>Metric</th><th>DCR</th><th>Cap</th><th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th><th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th></tr></thead><tbody><tr><td class='lbl-cell'>Del Riders (260)</td><td>56.2%</td><td style='font-weight:700'>8,189</td><td>7,785</td><td>7,759</td><td>7,746</td><td>7,419</td><td>7,574</td><td>7,501</td><td>7,523</td><td>7,337</td><td>7,409</td><td>7,489</td></tr><tr><td class='lbl-cell' colspan='3'>Delivery Ach Rate</td><td class='ach-val'>95.1%</td><td class='ach-val-amber'>94.7%</td><td class='ach-val-amber'>94.6%</td><td class='ach-val-amber'>90.6%</td><td class='ach-val-amber'>92.5%</td><td class='ach-val-amber'>91.6%</td><td class='ach-val-amber'>91.9%</td><td class='ach-val-amber'>89.6%</td><td class='ach-val-amber'>90.5%</td><td class='ach-val-amber'>91.5%</td></tr><tr><td class='lbl-cell'>Onl Riders</td><td></td><td></td><td>8,419</td><td>7,854</td><td>7,856</td><td>7,692</td><td>7,763</td><td>7,697</td><td>7,698</td><td>7,615</td><td>7,659</td><td>7,689</td></tr><tr><td class='lbl-cell' colspan='3'>Online Ach Rate</td><td class='ach-val'>102.8%</td><td class='ach-val'>95.9%</td><td class='ach-val'>95.9%</td><td class='ach-val-amber'>93.9%</td><td class='ach-val-amber'>94.8%</td><td class='ach-val-amber'>94%</td><td class='ach-val-amber'>94%</td><td class='ach-val-amber'>93%</td><td class='ach-val-amber'>93.5%</td><td class='ach-val-amber'>93.9%</td></tr><tr><td class='lbl-cell' colspan='3'>Gap (Onl-Del)</td><td style='color:#2980b9;font-weight:600'>7.7%</td><td style='color:#2980b9;font-weight:600'>1.2%</td><td style='color:#2980b9;font-weight:600'>1.3%</td><td style='color:#2980b9;font-weight:600'>3.3%</td><td style='color:#2980b9;font-weight:600'>2.3%</td><td style='color:#2980b9;font-weight:600'>2.4%</td><td style='color:#2980b9;font-weight:600'>2.1%</td><td style='color:#2980b9;font-weight:600'>3.4%</td><td style='color:#2980b9;font-weight:600'>3%</td><td style='color:#2980b9;font-weight:600'>2.4%</td></tr></tbody></table></div>
<div class='daily-data-section'><h4>&#10060; Bad Partners</h4><table class='daily-data-tbl'><thead><tr class='hdr-red'><th>Metric</th><th>DCR</th><th>Cap</th><th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th><th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th></tr></thead><tbody><tr><td class='lbl-cell'>Del Riders (20)</td><td>56.5%</td><td style='font-weight:700'>375</td><td>346</td><td>341</td><td>337</td><td>341</td><td>349</td><td>341</td><td>347</td><td>335</td><td>337</td><td>347</td></tr><tr><td class='lbl-cell' colspan='3'>Delivery Ach Rate</td><td class='ach-val-amber'>92.3%</td><td class='ach-val-amber'>90.9%</td><td class='ach-val-amber'>89.9%</td><td class='ach-val-amber'>90.9%</td><td class='ach-val-amber'>93.1%</td><td class='ach-val-amber'>90.9%</td><td class='ach-val-amber'>92.5%</td><td class='ach-val-amber'>89.3%</td><td class='ach-val-amber'>89.9%</td><td class='ach-val-amber'>92.5%</td></tr><tr><td class='lbl-cell'>Onl Riders</td><td></td><td></td><td>374</td><td>349</td><td>352</td><td>351</td><td>355</td><td>347</td><td>354</td><td>350</td><td>343</td><td>351</td></tr><tr><td class='lbl-cell' colspan='3'>Online Ach Rate</td><td class='ach-val'>99.7%</td><td class='ach-val-amber'>93.1%</td><td class='ach-val-amber'>93.9%</td><td class='ach-val-amber'>93.6%</td><td class='ach-val-amber'>94.7%</td><td class='ach-val-amber'>92.5%</td><td class='ach-val-amber'>94.4%</td><td class='ach-val-amber'>93.3%</td><td class='ach-val-amber'>91.5%</td><td class='ach-val-amber'>93.6%</td></tr><tr><td class='lbl-cell' colspan='3'>Gap (Onl-Del)</td><td style='color:#2980b9;font-weight:600'>7.4%</td><td style='color:#2980b9;font-weight:600'>2.2%</td><td style='color:#2980b9;font-weight:600'>4%</td><td style='color:#2980b9;font-weight:600'>2.7%</td><td style='color:#2980b9;font-weight:600'>1.6%</td><td style='color:#2980b9;font-weight:600'>1.6%</td><td style='color:#2980b9;font-weight:600'>1.9%</td><td style='color:#2980b9;font-weight:600'>4%</td><td style='color:#2980b9;font-weight:600'>1.6%</td><td style='color:#2980b9;font-weight:600'>1.1%</td></tr></tbody></table></div>
<div class='daily-data-section'><h4>&#127381; New Partners</h4><table class='daily-data-tbl'><thead><tr class='hdr-purple'><th>Metric</th><th>DCR</th><th>Cap</th><th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th><th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th></tr></thead><tbody><tr><td class='lbl-cell'>Del Riders (21)</td><td>91.9%</td><td style='font-weight:700'>530</td><td>202</td><td>251</td><td>296</td><td>319</td><td>328</td><td>357</td><td>402</td><td>404</td><td>427</td><td>477</td></tr><tr><td class='lbl-cell' colspan='3'>Delivery Ach Rate</td><td class='ach-val-red'>38.1%</td><td class='ach-val-red'>47.4%</td><td class='ach-val-red'>55.8%</td><td class='ach-val-red'>60.2%</td><td class='ach-val-red'>61.9%</td><td class='ach-val-red'>67.4%</td><td class='ach-val-red'>75.8%</td><td class='ach-val-red'>76.2%</td><td class='ach-val-amber'>80.6%</td><td class='ach-val-amber'>90%</td></tr><tr><td class='lbl-cell'>Onl Riders</td><td></td><td></td><td>202</td><td>252</td><td>295</td><td>321</td><td>327</td><td>359</td><td>404</td><td>416</td><td>443</td><td>487</td></tr><tr><td class='lbl-cell' colspan='3'>Online Ach Rate</td><td class='ach-val-red'>38.1%</td><td class='ach-val-red'>47.5%</td><td class='ach-val-red'>55.7%</td><td class='ach-val-red'>60.6%</td><td class='ach-val-red'>61.7%</td><td class='ach-val-red'>67.7%</td><td class='ach-val-red'>76.2%</td><td class='ach-val-red'>78.5%</td><td class='ach-val-amber'>83.6%</td><td class='ach-val-amber'>91.9%</td></tr><tr><td class='lbl-cell' colspan='3'>Gap (Onl-Del)</td><td style='color:#2980b9;font-weight:600'>0%</td><td style='color:#2980b9;font-weight:600'>0.1%</td><td style='color:#2980b9;font-weight:600'>-0.1%</td><td style='color:#2980b9;font-weight:600'>0.4%</td><td style='color:#2980b9;font-weight:600'>-0.2%</td><td style='color:#2980b9;font-weight:600'>0.3%</td><td style='color:#2980b9;font-weight:600'>0.4%</td><td style='color:#2980b9;font-weight:600'>2.3%</td><td style='color:#2980b9;font-weight:600'>3%</td><td style='color:#2980b9;font-weight:600'>1.9%</td></tr></tbody></table></div>
  </div>
</details>

<!-- HIGHLIGHT CARDS -->
<div class="daily-highlight-row" id="dailyHighlightCards">
  <div class="daily-highlight-card hl-amber">
    <strong>&#9888;&#65039; Near Target</strong><br>
    Overall delivery: <strong>93.6%</strong>, Online: <strong>96.3%</strong>. Gap: 497 riders. <span id="hlGoodCount">252</span> good partners lead at 95.5% delivery.
  </div>
  <div class="daily-highlight-card hl-amber">
    <strong>&#9888;&#65039; Watch Points</strong><br>
    Feb 8 lowest delivery (90.8%). Feb 1 online spike (101.1%). <span id="hlAvgCount">260</span> average partners at 92.3% delivery.
  </div>
  <div class="daily-highlight-card hl-green">
    <strong>&#127381; New Partners Growing</strong><br>
    21 new partners show rapid growth: 38.1% &#8594; 90.0% delivery over 10 days. DCR: 91.9%. Cap target: 530.
  </div>
</div>

<!-- CHARTS -->
<div class="daily-charts-row">
  <div class="daily-chart-box">
    <div class="daily-chart-title">&#128200; Daily Achievement Rate Trend (Delivery vs Online)</div>
    <div class="daily-chart-canvas-wrap"><canvas id="dailyTrendChart"></canvas></div>
  </div>
  <div class="daily-chart-box">
    <div class="daily-chart-title">&#128202; Daily Delivery vs Online Riders Count</div>
    <div class="daily-chart-canvas-wrap"><canvas id="dailyBarChart"></canvas></div>
  </div>
</div>
<div class="daily-chart-box-full">
    <div class="daily-chart-title" id="dailyGapChartTitle">&#128201; Achievement Gap Analysis (Delivery vs Online) by Category &#8212; All Partners</div>
  <div class="daily-chart-canvas-wrap-sm"><canvas id="dailyGapChart"></canvas></div>
</div>

<!-- INSIGHTS (COLLAPSED) -->
<details class="daily-details">
  <summary>&#128204; Daily Performance Highlights &amp; Insights</summary>
  <div class="daily-details-content">
    <div class="daily-insight-grid">
      <div class="daily-insight-item insight-warn">
        <strong>&#128202; Delivery Achievement Overview</strong><br>
        Overall delivery achievement is <strong>93.6%</strong>, below the 100% target. Good partners lead at <strong>95.5%</strong>, average at <strong>92.3%</strong>, bad at <strong>91.2%</strong>. New partners show rapid growth from 38.1% to 90.0%.
      </div>
      <div class="daily-insight-item insight-good">
        <strong>&#128200; Online vs Delivery Performance</strong><br>
        Online achievement (<strong>96.3%</strong>) outperforms delivery (<strong>93.6%</strong>) by 2.7pp. Rider gap: <strong>497</strong> (18,550 online vs 18,054 delivery). DCR: <strong>59.2%</strong>.
      </div>
      <div class="daily-insight-item insight-warn">
        <strong>&#9888;&#65039; Day-of-Week Pattern</strong><br>
        Performance dips: <strong>Feb 8</strong> (90.8%), <strong>Feb 4</strong> (91.3%), <strong>Feb 9</strong> (91.7%) are the weakest days. Best: <strong>Feb 3</strong> (94.4%). Variance of 3.6pp across the period.
      </div>
      <div class="daily-insight-item insight-warn">
        <strong>&#128201; Feb 1 Online Spike</strong><br>
        Feb 1 online riders (<strong>19,557</strong>) far exceed other days (~18,200&#8211;18,500). Online ach spikes to <strong>101.1%</strong>. Gap reaches <strong>7.9%</strong> vs 1&#8211;3% normally.
      </div>
      <div class="daily-insight-item insight-good">
        <strong>&#127381; New Partners Ramp-Up</strong><br>
        21 new partners (cap: <strong>530</strong>) show strong growth. Delivery: <strong>38.1%</strong> (Feb 1) to <strong>90.0%</strong> (Feb 10). Online: 38.1% &#8594; 91.9%. DCR: <strong>91.9%</strong>.
      </div>
      <div class="daily-insight-item insight-good">
        <strong>&#127919; Capacity Utilization</strong><br>
        Total capacity: <strong>19,345 riders</strong>. Good: 10,104 (52.2%), Average: 8,189 (42.3%), Bad: 375 (1.9%), New: 530 (2.7%).
      </div>
    </div>
  </div>
</details>

<!-- TOP/BOTTOM PARTNERS (COLLAPSED) -->
<details class="daily-details" id="dailyTopBottomDetails">
  <summary>&#127942; Top &amp; Bottom 5 Partners (by Delivery Achievement Rate)</summary>
  <div class="daily-details-content">
    <div id="dailyTopBottomContainer"></div>
  </div>
</details>

<!-- FULL PARTNERS TABLE (COLLAPSED) -->
<details class="daily-details" id="dailyFullTableDetails">
  <summary>&#128203; Full Partner List (<span id="dailyTableCount">553</span> partners)</summary>
  <div class="daily-details-content">
    <div class="daily-search-bar">
      <input type="text" class="daily-search-input" id="dailySearchInput" placeholder="Search partner ID..." oninput="filterDailyTable()">
      <select class="daily-search-input" id="dailyPerfFilter" onchange="filterDailyTable()" style="width:140px;">
        <option value="all">All Categories</option>
        <option value="good">Good</option>
        <option value="average">Average</option>
        <option value="bad">Bad</option>
        <option value="new">New</option>
      </select>
      <span class="daily-table-info" id="dailyFilterInfo">Showing 553 of 553 partners</span>
    </div>
    <div class="daily-table-wrap" style="max-height:500px; overflow-y:auto;">
      <table class="daily-table" id="dailyFullTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Partner ID</th>
            <th>Category</th>
            <th>Cap Target</th>
            <th>Ach% Del</th>
            <th>Ach% Onl</th>
            <th>Gap</th>
            <th>DCR%</th>
            <th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th>
            <th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th>
          </tr>
        </thead>
        <tbody id="dailyTableBody"></tbody>
      </table>
    </div>
  </div>
</details>

<!-- CITY VIEW SECTION -->
<div class="city-view-section" id="cityViewSection">
    <h3 class="city-view-title">&#127961;&#65039; City View (Feb 1-10)</h3>
    <div class="city-mini-note"><strong>Scope:</strong> City-level capacity target, delivery, online, and gap performance. Tables and charts use the same Feb 1-10 structure and highlighting logic as Daily View.</div>

    <div class="daily-kpi-row" id="cityStatsCards">
        <div class="daily-kpi-card kpi-red">
            <div class="kpi-label">Highest Gap City</div>
            <div class="kpi-value" id="cityGapHighName">-</div>
            <div class="kpi-sub" id="cityGapHighVal">-</div>
            <div class="tooltip-daily" id="cityGapHighTip"></div>
        </div>
        <div class="daily-kpi-card kpi-green">
            <div class="kpi-label">Lowest Gap City</div>
            <div class="kpi-value" id="cityGapLowName">-</div>
            <div class="kpi-sub" id="cityGapLowVal">-</div>
            <div class="tooltip-daily" id="cityGapLowTip"></div>
        </div>
        <div class="daily-kpi-card kpi-blue">
            <div class="kpi-label">Highest Del Ach</div>
            <div class="kpi-value" id="cityDelHighName">-</div>
            <div class="kpi-sub" id="cityDelHighVal">-</div>
            <div class="tooltip-daily" id="cityDelHighTip"></div>
        </div>
        <div class="daily-kpi-card kpi-amber">
            <div class="kpi-label">Lowest Del Ach</div>
            <div class="kpi-value" id="cityDelLowName">-</div>
            <div class="kpi-sub" id="cityDelLowVal">-</div>
            <div class="tooltip-daily" id="cityDelLowTip"></div>
        </div>
        <div class="daily-kpi-card kpi-green">
            <div class="kpi-label">Highest Onl Ach</div>
            <div class="kpi-value" id="cityOnlHighName">-</div>
            <div class="kpi-sub" id="cityOnlHighVal">-</div>
            <div class="tooltip-daily" id="cityOnlHighTip"></div>
        </div>
        <div class="daily-kpi-card kpi-red">
            <div class="kpi-label">Lowest Onl Ach</div>
            <div class="kpi-value" id="cityOnlLowName">-</div>
            <div class="kpi-sub" id="cityOnlLowVal">-</div>
            <div class="tooltip-daily" id="cityOnlLowTip"></div>
        </div>
    </div>

    <div class="city-slicer">
        <span class="city-slicer-label">City slicer:</span>
        <div class="city-slicer-buttons" id="citySlicerButtons"></div>
    </div>
    <div class="city-slicer-legend">
        <span class="lg-item"><span class="lg-dot lg-good"></span>Green: &ge;95%</span>
        <span class="lg-item"><span class="lg-dot lg-amber"></span>Amber: 90&#8211;94.9%</span>
        <span class="lg-item"><span class="lg-dot lg-red"></span>Red: &lt;90%</span>
    </div>
    <div class="daily-chart-box-full">
        <div class="daily-chart-title" id="cityComboTitle">&#128202; All Cities: Delivery vs Online + Gap + Achievement Trend</div>
        <div class="daily-chart-canvas-wrap"><canvas id="cityComboChart"></canvas></div>
    </div>

    <details class="daily-details" id="cityHighlightsDetails" open>
        <summary>&#128204; City Highlights Summary</summary>
        <div class="daily-details-content">
            <div class="daily-insight-grid">
                <div class="daily-insight-item insight-good"><strong>&#127942; Top Capacity Cities</strong><br>Riyadh (8,952), Jeddah (3,414), and Dammam (2,139) carry most city-level capacity target.</div>
                <div class="daily-insight-item insight-warn"><strong>&#128201; Gap Concentration</strong><br>Largest absolute gaps are in Riyadh (305), Jeddah (61), and Dammam (44), driving most of the total rider gap.</div>
                <div class="daily-insight-item insight-good"><strong>&#9989; Over-Target Delivery Cities</strong><br>Al Kharj (102.0%) exceeds delivery target. Several cities stay near target with stable day-to-day variance.</div>
                <div class="daily-insight-item insight-warn"><strong>&#9888;&#65039; Watch Cities</strong><br>Riyadh and Taif show lower delivery achievement bands in multiple days and should remain priority watch points.</div>
            </div>
        </div>
    </details>

    <details class="daily-details" id="cityTablesDetails">
        <summary>&#128202; City Overview &amp; Detailed Data Tables</summary>
        <div class="daily-details-content">
            <div id="cityOverviewTableWrap"></div>
            <div id="cityDelTableWrap"></div>
            <div id="cityDelAchTableWrap"></div>
            <div id="cityOnlTableWrap"></div>
            <div id="cityOnlAchTableWrap"></div>
        </div>
    </details>
</div>

<script>
(function(){
var dDates = ['Feb 1','Feb 2','Feb 3','Feb 4','Feb 5','Feb 6','Feb 7','Feb 8','Feb 9','Feb 10'];
var dCounts = {total:553,good:252,average:260,bad:20,new:21};
var dDelRiders = {
  total:[18185,18240,18263,17662,17998,17948,17962,17571,17738,17981],
  good:[9703,9741,9737,9434,9600,9601,9548,9361,9429,9525],
  average:[7785,7759,7746,7419,7574,7501,7523,7337,7409,7489],
  bad:[346,341,337,341,349,341,347,335,337,347],
  new:[202,251,296,319,328,357,402,404,427,477]
};
var dOnlRiders = {
  total:[19557,18436,18504,18209,18357,18313,18321,18178,18255,18355],
  good:[10406,9830,9850,9695,9764,9759,9720,9657,9671,9685],
  average:[8419,7854,7856,7692,7763,7697,7698,7615,7659,7689],
  bad:[374,349,352,351,355,347,354,350,343,351],
  new:[202,252,295,321,327,359,404,416,443,487]
};
var dAchDel = {
  total:[94.0,94.3,94.4,91.3,93.0,92.8,92.9,90.8,91.7,92.9],
  good:[96.0,96.4,96.4,93.4,95.0,95.0,94.5,92.6,93.3,94.3],
  average:[95.1,94.7,94.6,90.6,92.5,91.6,91.9,89.6,90.5,91.5],
  bad:[92.3,90.9,89.9,90.9,93.1,90.9,92.5,89.3,89.9,92.5],
  new:[38.1,47.4,55.8,60.2,61.9,67.4,75.8,76.2,80.6,90.0]
};
var dAchOnl = {
  total:[101.1,95.3,95.7,94.1,94.9,94.7,94.7,94.0,94.4,94.9],
  good:[103.0,97.3,97.5,96.0,96.6,96.6,96.2,95.6,95.7,95.9],
  average:[102.8,95.9,95.9,93.9,94.8,94.0,94.0,93.0,93.5,93.9],
  bad:[99.7,93.1,93.9,93.6,94.7,92.5,94.4,93.3,91.5,93.6],
  new:[38.1,47.5,55.7,60.6,61.7,67.7,76.2,78.5,83.6,91.9]
};
var dGap = {
  total:[7.9,1.0,1.3,2.7,1.8,1.8,1.9,3.1,2.6,2.1],
  good:[7.0,0.9,1.1,2.6,1.6,1.6,1.7,3.0,2.4,1.6],
  average:[7.7,1.2,1.3,3.3,2.3,2.4,2.1,3.4,3.0,2.4],
  bad:[7.4,2.2,4.0,2.7,1.6,1.6,1.9,4.0,1.6,1.1],
  new:[0.0,0.1,-0.1,0.4,-0.2,0.3,0.4,2.3,3.0,1.9]
};

var topBottom = {
  total:{top:[{id:'1750590112299957',p:'good',ad:188.2,ao:194.6,c:11,g:6},{id:'1739183741299507',p:'good',ad:174.6,ao:179.2,c:13,g:5},{id:'1761200325353714',p:'average',ad:148.7,ao:155.3,c:15,g:7},{id:'1755595960039864',p:'good',ad:126.9,ao:128.6,c:29,g:2},{id:'1761822173112506',p:'average',ad:119.2,ao:122.5,c:12,g:3}],bottom:[{id:'1749013700039441',p:'good',ad:25,ao:25,c:10,g:0},{id:'1769413715353484',p:'new',ad:15,ao:15.5,c:20,g:0},{id:'1768293401353377',p:'new',ad:14.8,ao:14.8,c:21,g:0},{id:'1770119270299540',p:'new',ad:9.8,ao:11,c:40,g:1},{id:'1769347448353507',p:'new',ad:6.5,ao:6.5,c:20,g:0}]},
  good:{top:[{id:'1750590112299957',p:'good',ad:188.2,ao:194.6,c:11,g:6},{id:'1739183741299507',p:'good',ad:174.6,ao:179.2,c:13,g:5},{id:'1755595960039864',p:'good',ad:126.9,ao:128.6,c:29,g:2},{id:'1749013602299766',p:'good',ad:115.5,ao:115.5,c:11,g:0},{id:'1750587597353007',p:'good',ad:113.9,ao:114.7,c:36,g:1}],bottom:[{id:'1755677427039694',p:'good',ad:74.5,ao:76.8,c:120,g:2},{id:'1762942864299719',p:'good',ad:71.4,ao:74.3,c:21,g:3},{id:'1731859360299952',p:'good',ad:70.4,ao:74,c:25,g:4},{id:'1723976548112703',p:'good',ad:26.1,ao:37.9,c:80,g:12},{id:'1749013700039441',p:'good',ad:25,ao:25,c:10,g:0}]},
  average:{top:[{id:'1761200325353714',p:'average',ad:148.7,ao:155.3,c:15,g:7},{id:'1761822173112506',p:'average',ad:119.2,ao:122.5,c:12,g:3},{id:'1755429108039697',p:'average',ad:116,ao:122,c:10,g:6},{id:'1749097037039862',p:'average',ad:111.2,ao:116.5,c:17,g:5},{id:'1762670804039587',p:'average',ad:109.5,ao:113,c:20,g:4}],bottom:[{id:'1758453876112334',p:'average',ad:54,ao:58,c:10,g:4},{id:'1760604898039540',p:'average',ad:46,ao:46,c:10,g:0},{id:'1757497691112346',p:'average',ad:38.6,ao:40.6,c:36,g:2},{id:'1727622427353116',p:'average',ad:38,ao:42.5,c:20,g:4},{id:'1759657006039687',p:'average',ad:30,ao:36,c:10,g:6}]},
  bad:{top:[{id:'1726491045299602',p:'bad',ad:110,ao:116,c:25,g:6},{id:'1765097343299500',p:'bad',ad:104.7,ao:106.7,c:15,g:2},{id:'1764248042039231',p:'bad',ad:104.7,ao:107.9,c:19,g:3},{id:'1735220868112171',p:'bad',ad:100.8,ao:102.8,c:25,g:2},{id:'1740637628039402',p:'bad',ad:100,ao:100,c:10,g:0}],bottom:[{id:'1756627547353079',p:'bad',ad:92.7,ao:102.7,c:11,g:10},{id:'1730902572353719',p:'bad',ad:83.7,ao:84.8,c:27,g:1},{id:'1761227213112065',p:'bad',ad:67.9,ao:74.2,c:19,g:6},{id:'1760449452299497',p:'bad',ad:65.4,ao:67.4,c:15,g:2},{id:'1756210395039936',p:'bad',ad:47.6,ao:48,c:25,g:0}]}
,
  new:{top:[{id:'Top New Partner',p:'new',ad:90.0,ao:91.9,c:530,g:2}],bottom:[{id:'Btm New Partner',p:'new',ad:38.1,ao:38.1,c:530,g:0}]}};

var curCat = 'total';
var dailyTrendChart, dailyBarChart, dailyGapChart;
var dailyChartsInited = false;

function achClass(v) { return v >= 95 ? 'ach-green' : v >= 80 ? 'ach-amber' : 'ach-red'; }
function perfClass(p) { return p==='good'?'perf-good':p==='average'?'perf-average':p==='bad'?'perf-bad':p==='new'?'perf-new':''; }
function perfLabel(p) { return p==='good'?'Good':p==='average'?'Average':p==='bad'?'Bad':p==='new'?'New':'Other'; }

function initDailyCharts() {
  var cat = curCat;
  var ctx1 = document.getElementById('dailyTrendChart');
  if (!ctx1) return;
  try {
  if (dailyTrendChart) dailyTrendChart.destroy();
  dailyTrendChart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: dDates,
      datasets: [
        { label: 'Delivery Achievement %', data: dAchDel[cat], borderColor: '#2980b9', backgroundColor: 'rgba(41,128,185,0.08)', borderWidth: 2.5, pointRadius: 4, pointBackgroundColor: '#2980b9', fill: true, tension: 0.3 },
        { label: 'Online Achievement %', data: dAchOnl[cat], borderColor: '#27ae60', backgroundColor: 'rgba(39,174,96,0.08)', borderWidth: 2.5, pointRadius: 4, pointBackgroundColor: '#27ae60', fill: true, tension: 0.3 },
        { label: '100% Target', data: Array(10).fill(100), borderColor: '#e74c3c', borderWidth: 1.5, borderDash: [6,4], pointRadius: 0, fill: false }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom', labels: { font: {size:11}, usePointStyle: true, padding: 12 } },
        tooltip: { callbacks: { label: function(c){ return c.dataset.label+': '+c.parsed.y+'%'; } } },
        datalabels: { display: function(c) { return c.datasetIndex < 2; }, anchor: 'end', align: 'top', font: {size:10, weight:'bold'}, color: function(c) { return c.datasetIndex===0?'#2980b9':'#27ae60'; }, formatter: function(v) { return v+'%'; } }
      },
      scales: {
        y: { min: cat==='new'?30:cat==='bad'?80:85, grid: {color:'#f0f0f0'}, ticks: {font:{size:11}, callback:function(v){return v+'%';}} },
        x: { grid: {display:false}, ticks: {font:{size:11}} }
      }
    }
  });
  } catch(e) { console.error('Trend chart error:', e); }

  var ctx2 = document.getElementById('dailyBarChart');
  if (!ctx2) return;
  try {
  if (dailyBarChart) dailyBarChart.destroy();
  var barDelData = dDelRiders[cat];
  var barOnlData = dOnlRiders[cat];
  var barGapRiders = barOnlData.map(function(v,i){ return v - barDelData[i]; });
  var barGapPct = dGap[cat];
  dailyBarChart = new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: dDates,
      datasets: [
        { label: 'Delivery Riders', data: barDelData, backgroundColor: 'rgba(41,128,185,0.7)', borderColor: '#2980b9', borderWidth: 1, borderRadius: 4, order: 2 },
        { label: 'Online Riders', data: barOnlData, backgroundColor: 'rgba(39,174,96,0.7)', borderColor: '#27ae60', borderWidth: 1, borderRadius: 4, order: 2 },
        { label: 'Gap (Riders - %)', data: barGapRiders, type: 'line', borderColor: '#e74c3c', backgroundColor: 'rgba(231,76,60,0.08)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#e74c3c', fill: false, tension: 0.3, yAxisID: 'y1', order: 1 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom', labels: { font: {size:11}, usePointStyle: true, padding: 12 } },
        tooltip: { mode: 'index', intersect: false, callbacks: { label: function(c){ if(c.datasetIndex===2){ return 'Gap: '+c.parsed.y.toLocaleString()+' riders ('+barGapPct[c.dataIndex]+'%)'; } return c.dataset.label+': '+c.parsed.y.toLocaleString(); } } },
        datalabels: {
          display: function(c){ return true; },
          anchor: function(c){ return c.datasetIndex===2?'end':'center'; },
          align: function(c){ return c.datasetIndex===2?'bottom':'center'; },
          offset: function(c){ return c.datasetIndex===2?4:0; },
          font: function(c){ return c.datasetIndex===2?{size:10,weight:'bold'}:{size:9,weight:'bold'}; },
          color: function(c){ return c.datasetIndex===2?'#fff':'#fff'; },
          backgroundColor: function(c){ return c.datasetIndex===2?'rgba(192,57,43,0.88)':'transparent'; },
          borderRadius: function(c){ return c.datasetIndex===2?4:0; },
          padding: function(c){ return c.datasetIndex===2?{top:2,bottom:2,left:5,right:5}:0; },
          formatter: function(v,c){ if(c.datasetIndex===2){ return v.toLocaleString()+' ('+barGapPct[c.dataIndex]+'%)'; } return v.toLocaleString(); },
          textShadowBlur: function(c){ return c.datasetIndex===2?0:3; },
          textShadowColor: function(c){ return c.datasetIndex===2?'transparent':'rgba(0,0,0,0.5)'; }
        }
      },
      scales: {
        y: { beginAtZero: false, grid: {color:'#f0f0f0'}, ticks: {font:{size:11}, callback:function(v){return v.toLocaleString();}} },
        y1: { position: 'right', beginAtZero: true, grid: {drawOnChartArea:false}, ticks: {font:{size:10}, color:'#e74c3c', callback:function(v){return v.toLocaleString();}} },
        x: { grid: {display:false}, ticks: {font:{size:11}} }
      }
    }
  });
  } catch(e) { console.error('Bar chart error:', e); }

  var ctx3 = document.getElementById('dailyGapChart');
  if (!ctx3) return;
    var gapTitle = document.getElementById('dailyGapChartTitle');
    if (gapTitle) gapTitle.innerHTML = '&#128201; Achievement Gap Analysis (Delivery vs Online) by Category &#8212; ' + (cat === 'total' ? 'All Partners' : perfLabel(cat));
  try {
  if (dailyGapChart) dailyGapChart.destroy();
    var gapDs = cat === 'total' ? [
        { label: 'Good Gap', data: dGap.good, borderColor: '#27ae60', backgroundColor: 'rgba(39,174,96,0.1)', borderWidth: 2, pointRadius: 3, fill: false, tension: 0.3 },
        { label: 'Average Gap', data: dGap.average, borderColor: '#f39c12', backgroundColor: 'rgba(243,156,18,0.1)', borderWidth: 2, pointRadius: 3, fill: false, tension: 0.3 },
        { label: 'Bad Gap', data: dGap.bad, borderColor: '#e74c3c', backgroundColor: 'rgba(231,76,60,0.1)', borderWidth: 2, pointRadius: 3, fill: false, tension: 0.3 },
        { label: 'New Gap', data: dGap.new, borderColor: '#8e44ad', backgroundColor: 'rgba(142,68,173,0.1)', borderWidth: 2, pointRadius: 3, fill: false, tension: 0.3 }
    ] : [
        { label: perfLabel(cat)+' Gap', data: dGap[cat], borderColor: cat==='good'?'#27ae60':cat==='average'?'#f39c12':cat==='bad'?'#e74c3c':'#8e44ad', backgroundColor: cat==='good'?'rgba(39,174,96,0.15)':cat==='average'?'rgba(243,156,18,0.15)':cat==='bad'?'rgba(231,76,60,0.15)':'rgba(142,68,173,0.15)', borderWidth: 2.5, pointRadius: 4, fill: false, tension: 0.3 }
    ];
  dailyGapChart = new Chart(ctx3, {
    type: 'line',
    data: { labels: dDates, datasets: gapDs },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom', labels: { font:{size:11}, usePointStyle:true, padding:12 } },
        tooltip: { mode: 'index', intersect: false, callbacks: { label: function(c){ return c.dataset.label+': '+c.parsed.y+'%'; } } },
        datalabels: { display: true, anchor:'end', align:'top', font:{size:10,weight:'bold'}, formatter:function(v){return v+'%';}, color: function(c){ return c.dataset.borderColor; } }
      },
      scales: {
        y: { min:0, grid:{color:'#f0f0f0'}, ticks:{font:{size:11}, callback:function(v){return v+'%';}} },
        x: { grid:{display:false}, ticks:{font:{size:11}} }
      }
    }
  });
  } catch(e) { console.error('Gap chart error:', e); }
  dailyChartsInited = true;
}

function renderTopBottom() {
  var container = document.getElementById('dailyTopBottomContainer');
  if (!container) return;
  var data = topBottom[curCat] || topBottom.total;
  var html = '<div style="display:flex;gap:16px;flex-wrap:wrap;">';
  html += '<div style="flex:1;min-width:340px;"><h4 style="color:#27ae60;margin-bottom:8px;">&#127942; Top 5 Partners</h4>';
  html += '<table class="daily-table"><thead><tr><th>#</th><th>Partner ID</th><th>Category</th><th>Cap Target</th><th>Ach% Del</th><th>Ach% Onl</th><th>Gap</th></tr></thead><tbody>';
  data.top.forEach(function(p,i){
    html += '<tr class="rank-top"><td>'+(i+1)+'</td><td style="font-family:monospace;font-size:11px;">'+p.id+'</td><td class="'+perfClass(p.p)+'">'+perfLabel(p.p)+'</td><td>'+p.c+'</td><td class="'+achClass(p.ad)+'">'+p.ad+'%</td><td class="'+achClass(p.ao)+'">'+p.ao+'%</td><td>'+p.g+'%</td></tr>';
  });
  html += '</tbody></table></div>';
  html += '<div style="flex:1;min-width:340px;"><h4 style="color:#e74c3c;margin-bottom:8px;">&#9888;&#65039; Bottom 5 Partners</h4>';
  html += '<table class="daily-table"><thead><tr><th>#</th><th>Partner ID</th><th>Category</th><th>Cap Target</th><th>Ach% Del</th><th>Ach% Onl</th><th>Gap</th></tr></thead><tbody>';
  data.bottom.forEach(function(p,i){
    html += '<tr class="rank-bottom"><td>'+(i+1)+'</td><td style="font-family:monospace;font-size:11px;">'+p.id+'</td><td class="'+perfClass(p.p)+'">'+perfLabel(p.p)+'</td><td>'+p.c+'</td><td class="'+achClass(p.ad)+'">'+p.ad+'%</td><td class="'+achClass(p.ao)+'">'+p.ao+'%</td><td>'+p.g+'%</td></tr>';
  });
  html += '</tbody></table></div></div>';
  container.innerHTML = html;
}

window.switchDailyCat = function(cat, btn) {
  curCat = cat;
  document.querySelectorAll('#dailyViewSlicer .daily-slicer-btn').forEach(function(b){b.classList.remove('active');});
  if (btn) btn.classList.add('active');
    initDailyCharts();
  renderTopBottom();
};

window.dailyAllPartners = [];
window.filterDailyTable = function() {
  var search = (document.getElementById('dailySearchInput')||{}).value || '';
  var perfF = (document.getElementById('dailyPerfFilter')||{}).value || 'all';
  search = search.toLowerCase();
  var tbody = document.getElementById('dailyTableBody');
  if (!tbody) return;
  var filtered = window.dailyAllPartners.filter(function(p){
    if (perfF !== 'all' && p.p !== perfF) return false;
    if (search && p.fid.toLowerCase().indexOf(search) < 0) return false;
    return true;
  });
  var html = '';
  filtered.forEach(function(p,i){
    html += '<tr><td>'+(i+1)+'</td>';
    html += '<td style="font-family:monospace;font-size:11px;">'+p.fid+'</td>';
    html += '<td class="'+perfClass(p.p)+'">'+perfLabel(p.p)+'</td>';
    html += '<td>'+p.c+'</td>';
    html += '<td class="'+achClass(p.ad)+'">'+p.ad+'%</td>';
    html += '<td class="'+achClass(p.ao)+'">'+p.ao+'%</td>';
    html += '<td>'+p.g+'%</td>';
    html += '<td>'+(p.dr||0)+'%</td>';
    for(var d=0;d<10;d++){
      var v = (p.dad && p.dad[d] !== undefined) ? p.dad[d] : 0;
      html += '<td class="'+achClass(v)+'">'+v+'%</td>';
    }
    html += '</tr>';
  });
  tbody.innerHTML = html;
  var info = document.getElementById('dailyFilterInfo');
  if (info) info.textContent = 'Showing '+filtered.length+' of '+window.dailyAllPartners.length+' partners';
  var cnt = document.getElementById('dailyTableCount');
  if (cnt) cnt.textContent = window.dailyAllPartners.length;
};

function initDailyView() {
  initDailyCharts();
  renderTopBottom();
  if (window.dailyAllPartners.length === 0 && typeof loadDailyPartnerData === 'function') {
    loadDailyPartnerData();
  }
}

// Use ID-based selectors for robustness
var tbDet = document.getElementById('dailyTopBottomDetails');
if (tbDet) {
  tbDet.addEventListener('toggle', function() {
    if (this.open) renderTopBottom();
  });
}
var ftDet = document.getElementById('dailyFullTableDetails');
if (ftDet) {
  ftDet.addEventListener('toggle', function() {
    if (this.open && window.dailyAllPartners.length === 0 && typeof loadDailyPartnerData === 'function') {
      loadDailyPartnerData();
    }
  });
}

var dailyViewTab = document.getElementById('dailyView');
if (dailyViewTab) {
  var _dvObs = new MutationObserver(function(mutations) {
    mutations.forEach(function(m) {
      if (m.attributeName === 'class' && dailyViewTab.classList.contains('active')) {
        setTimeout(initDailyView, 250);
      }
    });
  });
  _dvObs.observe(dailyViewTab, {attributes:true});
}
})();
</script>

<script>
(function(){
var cityDates = ['Feb 1','Feb 2','Feb 3','Feb 4','Feb 5','Feb 6','Feb 7','Feb 8','Feb 9','Feb 10'];
var cityRows = [
    {city:'Al Ahsa', cap:768, del:[720,714,728,719,730,728,727,695,702,707], onl:[742,715,729,731,733,733,729,712,713,713], delAch:[93.8,93.0,94.8,93.6,95.1,94.8,94.7,90.5,91.4,92.1], onlAch:[96.6,93.1,94.9,95.2,95.4,95.4,94.9,92.7,92.8,92.8], delT:717, onlT:725, gap:8},
    {city:'Dammam', cap:2139, del:[2048,2053,2068,1988,2054,2063,2045,1991,2010,2028], onl:[2237,2062,2078,2043,2075,2074,2072,2038,2052,2057], delAch:[95.7,96.0,96.7,92.9,96.0,96.4,95.6,93.1,94.0,94.8], onlAch:[104.6,96.4,97.1,95.5,97.0,97.0,96.9,95.3,95.9,96.2], delT:2037, onlT:2081, gap:44},
    {city:'Hafar Albatin', cap:104, del:[104,102,103,106,104,105,105,103,105,102], onl:[113,103,103,106,104,105,106,104,105,103], delAch:[100.0,98.1,99.0,101.9,100.0,101.0,101.0,99.0,101.0,98.1], onlAch:[108.7,99.0,99.0,101.9,100.0,101.0,101.9,100.0,101.0,99.0], delT:104, onlT:105, gap:1},
    {city:'Jubail', cap:215, del:[209,213,214,216,209,212,194,192,195,205], onl:[222,215,217,216,211,214,202,198,201,207], delAch:[97.2,99.1,99.5,100.5,97.2,98.6,90.2,89.3,90.7,95.3], onlAch:[103.3,100.0,100.9,100.5,98.1,99.5,94.0,92.1,93.5,96.3], delT:206, onlT:210, gap:4},
    {city:'Riyadh', cap:8952, del:[8128,8190,8185,7885,8026,7939,8039,7863,7956,8131], onl:[8853,8318,8359,8254,8286,8217,8265,8218,8255,8345], delAch:[90.8,91.5,91.4,88.1,89.7,88.7,89.8,87.8,88.9,90.8], onlAch:[98.9,92.9,93.4,92.2,92.6,91.8,92.3,91.8,92.2,93.2], delT:8095, onlT:8400, gap:305},
    {city:'Al Kharj', cap:300, del:[313,313,314,309,309,310,305,296,294,293], onl:[338,315,314,313,313,312,310,308,300,296], delAch:[104.3,104.3,104.7,103.0,103.0,103.3,101.7,98.7,98.0,97.7], onlAch:[112.7,105.0,104.7,104.3,104.3,104.0,103.3,102.7,100.0,98.7], delT:306, onlT:312, gap:6},
    {city:'Buraydah', cap:243, del:[246,242,242,238,237,240,241,239,235,234], onl:[264,242,243,242,239,241,242,242,241,234], delAch:[101.2,99.6,99.6,97.9,97.5,98.8,99.2,98.4,96.7,96.3], onlAch:[108.6,99.6,100.0,99.6,98.4,99.2,99.6,99.6,99.2,96.3], delT:239, onlT:243, gap:4},
    {city:'Hail', cap:172, del:[171,170,172,169,170,169,164,162,167,152], onl:[177,172,172,170,172,169,171,170,167,156], delAch:[99.4,98.8,100.0,98.3,98.8,98.3,95.3,94.2,97.1,88.4], onlAch:[102.9,100.0,100.0,98.8,100.0,98.3,99.4,98.8,97.1,90.7], delT:167, onlT:170, gap:3},
    {city:'Jeddah', cap:3414, del:[3289,3288,3280,3147,3226,3255,3217,3137,3178,3220], onl:[3457,3317,3302,3198,3260,3281,3259,3225,3260,3282], delAch:[96.3,96.3,96.1,92.2,94.5,95.3,94.2,91.9,93.1,94.3], onlAch:[101.3,97.2,96.7,93.7,95.5,96.1,95.5,94.5,95.5,96.1], delT:3247, onlT:3308, gap:61},
    {city:'Medina', cap:1054, del:[1065,1057,1054,1023,1028,1012,1013,1007,1010,1010], onl:[1117,1061,1066,1038,1042,1025,1024,1026,1029,1025], delAch:[101.0,100.3,100.0,97.1,97.5,96.0,96.1,95.5,95.8,95.8], onlAch:[106.0,100.7,101.1,98.5,98.9,97.2,97.2,97.3,97.6,97.2], delT:1028, onlT:1045, gap:17},
    {city:'Tabuk', cap:207, del:[194,199,202,197,197,196,196,197,197,199], onl:[212,200,202,200,198,198,198,201,200,204], delAch:[93.7,96.1,97.6,95.2,95.2,94.7,94.7,95.2,95.2,96.1], onlAch:[102.4,96.6,97.6,96.6,95.7,95.7,95.7,97.1,96.6,98.6], delT:197, onlT:201, gap:4},
    {city:'Yanbu', cap:171, del:[164,163,161,157,166,167,161,164,164,168], onl:[187,164,166,164,168,168,167,170,172,172], delAch:[95.9,95.3,94.2,91.8,97.1,97.7,94.2,95.9,95.9,98.2], onlAch:[109.4,95.9,97.1,95.9,98.2,98.2,97.7,99.4,100.6,100.6], delT:164, onlT:170, gap:6},
    {city:'Abha', cap:264, del:[280,271,270,261,263,261,259,258,258,251], onl:[289,276,273,264,263,265,265,262,261,257], delAch:[106.1,102.7,102.3,98.9,99.6,98.9,98.1,97.7,97.7,95.1], onlAch:[109.5,104.5,103.4,100.0,99.6,100.4,100.4,99.2,98.9,97.3], delT:263, onlT:268, gap:4},
    {city:'Jazan', cap:78, del:[70,71,69,68,73,79,80,82,81,76], onl:[73,71,69,69,74,80,81,82,83,79], delAch:[89.7,91.0,88.5,87.2,93.6,101.3,102.6,105.1,103.8,97.4], onlAch:[93.6,91.0,88.5,88.5,94.9,102.6,103.8,105.1,106.4,101.3], delT:77, onlT:79, gap:1},
    {city:'Makkah', cap:905, del:[855,861,869,844,865,863,866,837,842,852], onl:[935,870,876,861,873,876,875,866,862,867], delAch:[94.5,95.1,96.0,93.3,95.6,95.4,95.7,92.5,93.0,94.1], onlAch:[103.3,96.1,96.8,95.1,96.5,96.8,96.7,95.7,95.2,95.8], delT:860, onlT:881, gap:21},
    {city:'Najran', cap:72, del:[75,73,74,73,73,73,70,63,66,67], onl:[79,73,74,73,74,73,71,67,67,67], delAch:[104.2,101.4,102.8,101.4,101.4,101.4,97.2,87.5,91.7,93.1], onlAch:[109.7,101.4,102.8,101.4,102.8,101.4,98.6,93.1,93.1,93.1], delT:71, onlT:72, gap:1},
    {city:'Taif', cap:287, del:[254,260,258,262,268,276,280,285,278,286], onl:[262,262,261,267,272,282,284,289,287,291], delAch:[88.5,90.6,89.9,91.3,93.4,96.2,97.6,99.3,96.9,99.7], onlAch:[91.3,91.3,90.9,93.0,94.8,98.3,99.0,100.7,100.0,101.4], delT:276, onlT:281, gap:5}
];
var cityAvgDelAch = [97.2,97.0,97.2,95.6,96.8,97.4,96.3,94.8,95.3,95.1];
var cityAvgOnlAch = [103.7,97.7,97.9,97.1,97.8,98.4,98.0,97.4,97.4,96.7];
var cityTotalDel = [18185,18240,18263,17662,17998,17948,17962,17571,17738,17981];
var cityTotalOnl = [19557,18436,18504,18209,18357,18313,18321,18178,18255,18355];
var cityTotalGapPct = [7.9,1.0,1.3,2.7,1.8,1.8,1.9,3.1,2.6,2.1];

var cityComboChart;
var cityTablesRendered = false;
var cityCur = 'all';

function cityAchClass(v){ return v >= 95 ? 'ach-val' : v >= 80 ? 'ach-val-amber' : 'ach-val-red'; }
function cityPct(v){ return v.toFixed(1)+'%'; }
function cityNum(v){ return Number(v).toLocaleString(); }

function renderCityTableBlock(titleHtml, headerClass, rowsHtml){
    return "<div class='daily-data-section'><h4>"+titleHtml+"</h4><table class='daily-data-tbl'><thead><tr class='"+headerClass+"'><th>City</th><th>Capacity target</th><th>Feb 1</th><th>Feb 2</th><th>Feb 3</th><th>Feb 4</th><th>Feb 5</th><th>Feb 6</th><th>Feb 7</th><th>Feb 8</th><th>Feb 9</th><th>Feb 10</th></tr></thead><tbody>"+rowsHtml+"</tbody></table></div>";
}

function renderCityTables(){
    if (cityTablesRendered) return;
    var ov = document.getElementById('cityOverviewTableWrap');
    var del = document.getElementById('cityDelTableWrap');
    var delAch = document.getElementById('cityDelAchTableWrap');
    var onl = document.getElementById('cityOnlTableWrap');
    var onlAch = document.getElementById('cityOnlAchTableWrap');
    if (!ov || !del || !delAch || !onl || !onlAch) return;

    var ovRows = cityRows.map(function(r){
        return "<tr><td class='lbl-cell'>"+r.city+"</td><td style='font-weight:700'>"+cityNum(r.cap)+"</td><td>"+cityNum(r.delT)+"</td><td>"+cityNum(r.onlT)+"</td><td style='color:#2980b9;font-weight:700'>"+cityNum(r.gap)+"</td></tr>";
    }).join('');
    ov.innerHTML = "<div class='daily-data-section'><h4>&#127961;&#65039; City overview</h4><table class='daily-data-tbl'><thead><tr class='hdr-blue'><th>City</th><th>Capacity target</th><th>Delivery riders</th><th>Online riders</th><th>Gap</th></tr></thead><tbody>"+ovRows+"</tbody></table></div>";

    var delRows = cityRows.map(function(r){
        return "<tr><td class='lbl-cell'>"+r.city+"</td><td style='font-weight:700'>"+cityNum(r.cap)+"</td>"+r.del.map(function(v){return "<td>"+cityNum(v)+"</td>";}).join('')+"</tr>";
    }).join('') + "<tr><td class='lbl-cell' style='font-weight:800'>Total</td><td style='font-weight:800'>19,345</td>"+cityTotalDel.map(function(v){return "<td style='font-weight:800'>"+cityNum(v)+"</td>";}).join('')+"</tr>";
    del.innerHTML = renderCityTableBlock('&#128202; Delivery rider city view','hdr-blue',delRows);

    var delAchRows = cityRows.map(function(r){
        return "<tr><td class='lbl-cell'>"+r.city+"</td><td style='font-weight:700'>"+cityNum(r.cap)+"</td>"+r.delAch.map(function(v){return "<td class='"+cityAchClass(v)+"'>"+cityPct(v)+"</td>";}).join('')+"</tr>";
    }).join('') + "<tr><td class='lbl-cell' style='font-weight:800'>Avr</td><td></td>"+cityAvgDelAch.map(function(v){return "<td class='"+cityAchClass(v)+"' style='font-weight:800'>"+cityPct(v)+"</td>";}).join('')+"</tr>";
    delAch.innerHTML = renderCityTableBlock('&#128200; Ach rate delivery rider','hdr-green',delAchRows);

    var onlRows = cityRows.map(function(r){
        return "<tr><td class='lbl-cell'>"+r.city+"</td><td style='font-weight:700'>"+cityNum(r.cap)+"</td>"+r.onl.map(function(v){return "<td>"+cityNum(v)+"</td>";}).join('')+"</tr>";
    }).join('') + "<tr><td class='lbl-cell' style='font-weight:800'>Total</td><td style='font-weight:800'>19,345</td>"+cityTotalOnl.map(function(v){return "<td style='font-weight:800'>"+cityNum(v)+"</td>";}).join('')+"</tr>";
    onl.innerHTML = renderCityTableBlock('&#128202; Online rider city view','hdr-orange',onlRows);

    var onlAchRows = cityRows.map(function(r){
        return "<tr><td class='lbl-cell'>"+r.city+"</td><td style='font-weight:700'>"+cityNum(r.cap)+"</td>"+r.onlAch.map(function(v){return "<td class='"+cityAchClass(v)+"'>"+cityPct(v)+"</td>";}).join('')+"</tr>";
    }).join('') + "<tr><td class='lbl-cell' style='font-weight:800'>Avr</td><td></td>"+cityAvgOnlAch.map(function(v){return "<td class='"+cityAchClass(v)+"' style='font-weight:800'>"+cityPct(v)+"</td>";}).join('')+"</tr>";
    onlAch.innerHTML = renderCityTableBlock('&#128200; Ach rate online rider','hdr-purple',onlAchRows);

    cityTablesRendered = true;
}

function getCitySeries(cityKey){
    if (cityKey === 'all') {
        return {
            name: 'All Cities',
            cap: 19345,
            del: cityTotalDel,
            onl: cityTotalOnl,
            delAch: cityAvgDelAch,
            onlAch: cityAvgOnlAch,
            gapPct: cityTotalGapPct
        };
    }
    var row = cityRows.find(function(r){ return r.city === cityKey; });
    if (!row) return null;
    return {
        name: row.city,
        cap: row.cap,
        del: row.del,
        onl: row.onl,
        delAch: row.delAch,
        onlAch: row.onlAch,
        gapPct: row.onl.map(function(v,i){ return +(((v - row.del[i]) / row.cap) * 100).toFixed(1); })
    };
}

function renderCitySummaryCards(){
    if (window.__citySummaryRendered) return;
    var metrics = cityRows.map(function(r){
        return {
            city: r.city,
            cap: r.cap,
            delT: r.delT,
            onlT: r.onlT,
            gap: r.gap,
            delAch: +((r.delT / r.cap) * 100).toFixed(1),
            onlAch: +((r.onlT / r.cap) * 100).toFixed(1)
        };
    });

    function ext(key, type){
        var vals = metrics.map(function(m){ return m[key]; });
        var value = type === 'max' ? Math.max.apply(null, vals) : Math.min.apply(null, vals);
        var items = metrics.filter(function(m){ return m[key] === value; });
        return { value: value, items: items };
    }
    function names(items){ return items.map(function(i){ return i.city; }).join(' / '); }

    var gapHigh = ext('gap','max');
    var gapLow = ext('gap','min');
    var delHigh = ext('delAch','max');
    var delLow = ext('delAch','min');
    var onlHigh = ext('onlAch','max');
    var onlLow = ext('onlAch','min');

    function cityRow(name){ return cityRows.find(function(r){ return r.city === name; }); }
    function dayPick(arr, mode){
        var idx = 0;
        for (var i = 1; i < arr.length; i++) {
            if ((mode === 'max' && arr[i] > arr[idx]) || (mode === 'min' && arr[i] < arr[idx])) idx = i;
        }
        return idx;
    }
    function tipForGap(type, group){
        var one = group.items[0];
        var row = cityRow(one.city);
        var dayGap = row.onl.map(function(v,i){ return v - row.del[i]; });
        var idx = dayPick(dayGap, type);
        var tieTxt = group.items.length > 1 ? ('<br>Tie cities: ' + names(group.items) + '.') : '';
        return 'Period basis: City overview average for Feb 1&#8211;10 (not single day).<br>' +
               one.city + ' single-day ' + (type==='max'?'peak':'lowest') + ' gap: ' + cityNum(dayGap[idx]) + ' riders on ' + cityDates[idx] + '.' + tieTxt;
    }
    function subForGap(type, group){
        var one = group.items[0];
        var row = cityRow(one.city);
        var dayGap = row.onl.map(function(v,i){ return v - row.del[i]; });
        var idx = dayPick(dayGap, type);
        return cityNum(group.value) + ' riders avg | ' + (type==='max'?'Day peak':'Day low') + ': ' + cityNum(dayGap[idx]) + ' (' + cityDates[idx] + ')';
    }
    function tipForAch(type, group, key, label){
        var one = group.items[0];
        var row = cityRow(one.city);
        var arr = key === 'delAch' ? row.delAch : row.onlAch;
        var idx = dayPick(arr, type);
        var tieTxt = group.items.length > 1 ? ('<br>Tie cities: ' + names(group.items) + '.') : '';
        return 'Period basis: City overview average for Feb 1&#8211;10 (riders/capacity).<br>' +
               one.city + ' single-day ' + (type==='max'?'peak':'lowest') + ' ' + label + ': ' + arr[idx].toFixed(1) + '% on ' + cityDates[idx] + '.' + tieTxt;
    }
        function subForAch(type, group, key){
                var one = group.items[0];
                var row = cityRow(one.city);
                var arr = key === 'delAch' ? row.delAch : row.onlAch;
                var idx = dayPick(arr, type);
                return group.value.toFixed(1) + '% avg | ' + (type==='max'?'Day peak':'Day low') + ': ' + arr[idx].toFixed(1) + '% (' + cityDates[idx] + ')';
        }

    var map = {
            cityGapHighName: names(gapHigh.items), cityGapHighVal: subForGap('max', gapHigh), cityGapHighTip: tipForGap('max', gapHigh),
            cityGapLowName: names(gapLow.items), cityGapLowVal: subForGap('min', gapLow), cityGapLowTip: tipForGap('min', gapLow),
            cityDelHighName: names(delHigh.items), cityDelHighVal: subForAch('max', delHigh, 'delAch'), cityDelHighTip: tipForAch('max', delHigh, 'delAch', 'delivery achievement'),
            cityDelLowName: names(delLow.items), cityDelLowVal: subForAch('min', delLow, 'delAch'), cityDelLowTip: tipForAch('min', delLow, 'delAch', 'delivery achievement'),
            cityOnlHighName: names(onlHigh.items), cityOnlHighVal: subForAch('max', onlHigh, 'onlAch'), cityOnlHighTip: tipForAch('max', onlHigh, 'onlAch', 'online achievement'),
            cityOnlLowName: names(onlLow.items), cityOnlLowVal: subForAch('min', onlLow, 'onlAch'), cityOnlLowTip: tipForAch('min', onlLow, 'onlAch', 'online achievement')
    };
    Object.keys(map).forEach(function(id){
        var el = document.getElementById(id);
        if (!el) return;
        if (/Tip$/.test(id)) el.innerHTML = map[id];
        else el.textContent = map[id];
    });
    window.__citySummaryRendered = true;
}

function initCityCharts(){
    var canvas = document.getElementById('cityComboChart');
    if (!canvas) return;
    var series = getCitySeries(cityCur);
    if (!series) return;
    var cityGapRiders = series.onl.map(function(v,i){ return v - series.del[i]; });
    var title = document.getElementById('cityComboTitle');
    if (title) title.innerHTML = '&#128202; ' + series.name + ': Delivery vs Online + Gap + Achievement Trend';
    try {
        if (cityComboChart) cityComboChart.destroy();
        cityComboChart = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: cityDates,
                datasets: [
                    { label: 'Delivery Riders', data: series.del, backgroundColor: 'rgba(41,128,185,0.7)', borderColor: '#2980b9', borderWidth: 1, borderRadius: 4, order: 4 },
                    { label: 'Online Riders', data: series.onl, backgroundColor: 'rgba(39,174,96,0.7)', borderColor: '#27ae60', borderWidth: 1, borderRadius: 4, order: 4 },
                    { label: 'Gap (Riders - %)', data: cityGapRiders, type: 'line', borderColor: '#e74c3c', backgroundColor: 'rgba(231,76,60,0.08)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#e74c3c', fill: false, tension: 0.3, yAxisID: 'y1', order: 1 },
                    { label: 'Delivery Ach %', data: series.delAch, type: 'line', borderColor: '#1f5f8a', backgroundColor: 'rgba(31,95,138,0.08)', borderWidth: 1.8, pointRadius: 3, pointBackgroundColor: '#1f5f8a', fill: false, tension: 0.25, yAxisID: 'y2', order: 2 },
                    { label: 'Online Ach %', data: series.onlAch, type: 'line', borderColor: '#1f8f4e', backgroundColor: 'rgba(31,143,78,0.08)', borderWidth: 1.8, pointRadius: 3, pointBackgroundColor: '#1f8f4e', fill: false, tension: 0.25, yAxisID: 'y2', order: 2 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { font: {size:11}, usePointStyle: true, padding: 12 } },
                    tooltip: { mode: 'index', intersect: false, callbacks: { label: function(c){
                        if (c.datasetIndex === 2) return 'Gap: ' + c.parsed.y.toLocaleString() + ' riders (' + series.gapPct[c.dataIndex] + '%)';
                        if (c.datasetIndex >= 3) return c.dataset.label + ': ' + c.parsed.y + '%';
                        return c.dataset.label + ': ' + c.parsed.y.toLocaleString();
                    } } },
                    datalabels: {
                        display: function(c){ return c.datasetIndex === 2; },
                        anchor: 'end', align: 'bottom', offset: 4,
                        font: {size:10,weight:'bold'}, color: '#fff',
                        backgroundColor: 'rgba(192,57,43,0.88)', borderRadius: 4, padding: {top:2,bottom:2,left:5,right:5},
                        formatter: function(v,c){ return v.toLocaleString() + ' (' + series.gapPct[c.dataIndex] + '%)'; }
                    }
                },
                scales: {
                    y: { beginAtZero: false, grid: {color:'#f0f0f0'}, ticks: {font:{size:11}, callback:function(v){return v.toLocaleString();}} },
                    y1: { position: 'right', beginAtZero: true, grid: {drawOnChartArea:false}, ticks: {font:{size:10}, color:'#e74c3c', callback:function(v){return v.toLocaleString();}} },
                    y2: { position: 'right', min: 80, max: 115, grid: {drawOnChartArea:false}, ticks: {font:{size:10}, color:'#1f4e78', callback:function(v){return v+'%';}} },
                    x: { grid: {display:false}, ticks: {font:{size:11}} }
                }
            }
        });
    } catch(e) { console.error('City combo chart error:', e); }
}

function initCitySlicer(){
    var wrap = document.getElementById('citySlicerButtons');
    if (!wrap) return;
    if (!wrap.dataset.bound) {
        var html = "<button class='daily-slicer-btn city-slicer-btn city-band-all active' data-city='all'>All Cities</button>";
        html += cityRows.map(function(r){
            var ach = (r.delT / r.cap) * 100;
            var band = ach >= 95 ? 'good' : ach >= 90 ? 'amber' : 'red';
            return "<button class='daily-slicer-btn city-slicer-btn city-band-" + band + "' data-city='" + r.city + "'>" + r.city + "</button>";
        }).join('');
        wrap.innerHTML = html;
        wrap.addEventListener('click', function(e){
            var btn = e.target.closest('button[data-city]');
            if (!btn) return;
            cityCur = btn.getAttribute('data-city') || 'all';
            wrap.querySelectorAll('.city-slicer-btn').forEach(function(b){ b.classList.remove('active'); });
            btn.classList.add('active');
            initCityCharts();
        });
        wrap.dataset.bound = '1';
    }
    wrap.querySelectorAll('.city-slicer-btn').forEach(function(b){
        b.classList.toggle('active', b.getAttribute('data-city') === cityCur);
    });
}

window.initCityViewSection = function(){
    initCitySlicer();
    renderCitySummaryCards();
    renderCityTables();
    initCityCharts();
};

var dailyViewTab = document.getElementById('dailyView');
if (dailyViewTab) {
    var _cityObs = new MutationObserver(function(mutations) {
        mutations.forEach(function(m) {
            if (m.attributeName === 'class' && dailyViewTab.classList.contains('active')) {
                setTimeout(window.initCityViewSection, 300);
            }
        });
    });
    _cityObs.observe(dailyViewTab, {attributes:true});
}
})();
</script>

<script>
function loadDailyPartnerData() {
window.dailyAllPartners = [
{fid:'1737979265299627',p:'average',c:25,ad:72.4,ao:72.8,g:0.4,dr:43.5,dad:[68,64,64,64,60,64,68,88,92,92],dao:[68,64,64,64,64,64,68,88,92,92]},
{fid:'1738149544299513',p:'average',c:46,ad:88.7,ao:89.1,g:0.4,dr:100,dad:[87,89.1,91.3,91.3,91.3,91.3,91.3,84.8,82.6,87],dao:[89.1,91.3,91.3,91.3,91.3,91.3,91.3,84.8,82.6,87]},
{fid:'1738149838353270',p:'good',c:25,ad:98,ao:98.4,g:0.4,dr:76,dad:[96,96,100,100,100,96,96,96,100,100],dao:[96,96,100,100,100,100,96,96,100,100]},
{fid:'1738164049112797',p:'average',c:40,ad:95.8,ao:96.2,g:0.4,dr:74.4,dad:[97.5,97.5,97.5,97.5,97.5,97.5,92.5,87.5,97.5,95],dao:[97.5,97.5,97.5,97.5,97.5,97.5,92.5,92.5,97.5,95]},
{fid:'1738507418353582',p:'good',c:18,ad:92.7,ao:95,g:2.3,dr:100,dad:[88.9,94.4,94.4,94.4,94.4,94.4,88.9,88.9,94.4,94.4],dao:[105.6,94.4,94.4,94.4,94.4,94.4,88.9,88.9,94.4,100]},
{fid:'1738591734039461',p:'good',c:20,ad:103.5,ao:104.5,g:1,dr:60.9,dad:[110,105,105,105,105,100,100,105,95,105],dao:[110,105,105,105,105,100,100,105,105,105]},
{fid:'1738745947039668',p:'good',c:23,ad:93.9,ao:94.4,g:0.5,dr:100,dad:[95.7,95.7,100,91.3,95.7,95.7,95.7,91.3,82.6,95.7],dao:[95.7,95.7,100,91.3,95.7,95.7,95.7,91.3,87,95.7]},
{fid:'1738764780112044',p:'average',c:50,ad:99.8,ao:100.2,g:0.4,dr:90.6,dad:[94,96,100,98,102,102,102,100,102,102],dao:[94,96,100,102,102,102,102,100,102,102]},
{fid:'1739110249353775',p:'good',c:27,ad:98.1,ao:98.9,g:0.8,dr:100,dad:[100,100,100,100,100,100,100,96.3,88.9,96.3],dao:[100,100,100,100,100,100,100,96.3,92.6,100]},
{fid:'1739168829039485',p:'average',c:31,ad:98.7,ao:98.7,g:0,dr:100,dad:[100,96.8,100,100,100,100,100,93.5,96.8,100],dao:[100,96.8,100,100,100,100,100,93.5,96.8,100]},
{fid:'1739183741299507',p:'good',c:13,ad:174.6,ao:179.2,g:4.6,dr:22.2,dad:[200,207.7,207.7,215.4,207.7,207.7,200,107.7,92.3,100],dao:[200,207.7,215.4,215.4,207.7,207.7,200,138.5,100,100]},
{fid:'1739342746039656',p:'average',c:17,ad:92.9,ao:94.7,g:1.8,dr:46.7,dad:[100,94.1,94.1,94.1,94.1,94.1,94.1,88.2,94.1,82.4],dao:[111.8,94.1,94.1,94.1,94.1,94.1,94.1,94.1,94.1,82.4]},
{fid:'1739440888299032',p:'average',c:35,ad:90.8,ao:92,g:1.2,dr:82.9,dad:[85.7,85.7,91.4,94.3,94.3,91.4,91.4,94.3,88.6,91.4],dao:[88.6,85.7,91.4,94.3,94.3,91.4,91.4,94.3,94.3,94.3]},
{fid:'1739441021353760',p:'average',c:28,ad:94.6,ao:95.4,g:0.8,dr:100,dad:[82.1,82.1,92.9,96.4,100,100,100,100,100,92.9],dao:[85.7,82.1,92.9,96.4,100,100,100,100,100,96.4]},
{fid:'1739444011039812',p:'average',c:66,ad:89.5,ao:90,g:0.5,dr:96.9,dad:[81.8,81.8,86.4,87.9,92.4,90.9,92.4,93.9,93.9,93.9],dao:[81.8,81.8,86.4,89.4,92.4,92.4,93.9,93.9,93.9,93.9]},
{fid:'1739683872299050',p:'average',c:11,ad:92.7,ao:99.1,g:6.4,dr:100,dad:[100,100,100,63.6,90.9,90.9,90.9,90.9,100,100],dao:[127.3,100,100,100,90.9,90.9,90.9,90.9,100,100]},
{fid:'1739698159353436',p:'good',c:45,ad:95.6,ao:96.5,g:0.9,dr:100,dad:[95.6,95.6,95.6,97.8,97.8,97.8,97.8,93.3,93.3,91.1],dao:[95.6,95.6,95.6,97.8,97.8,97.8,97.8,95.6,97.8,93.3]},
{fid:'1739787321039598',p:'average',c:18,ad:92.2,ao:97.8,g:5.6,dr:20,dad:[100,100,100,94.4,94.4,77.8,88.9,88.9,94.4,83.3],dao:[116.7,100,100,100,94.4,94.4,88.9,100,94.4,88.9]},
{fid:'1739793365039345',p:'good',c:32,ad:94.4,ao:95.3,g:0.9,dr:71.9,dad:[100,100,100,100,100,100,100,78.1,78.1,87.5],dao:[100,100,100,100,100,100,100,84.4,81.2,87.5]},
{fid:'1744711370112904',p:'good',c:33,ad:83.9,ao:84.2,g:0.3,dr:100,dad:[84.8,81.8,81.8,78.8,84.8,84.8,84.8,84.8,84.8,87.9],dao:[84.8,81.8,81.8,81.8,84.8,84.8,84.8,84.8,84.8,87.9]},
{fid:'1744786462299517',p:'good',c:25,ad:92.8,ao:93.6,g:0.8,dr:70.8,dad:[92,92,92,96,92,96,96,84,96,92],dao:[92,92,92,96,96,96,96,88,96,92]},
{fid:'1753952568112660',p:'good',c:25,ad:96.4,ao:97.6,g:1.2,dr:41.7,dad:[96,100,100,92,92,100,96,96,96,96],dao:[96,100,100,96,96,100,96,100,96,96]},
{fid:'1755085653112653',p:'average',c:40,ad:77.2,ao:77.8,g:0.6,dr:12.9,dad:[80,82.5,82.5,72.5,77.5,77.5,80,75,75,70],dao:[80,82.5,82.5,77.5,77.5,77.5,80,75,75,70]},
{fid:'1755496824039761',p:'average',c:26,ad:95,ao:95.8,g:0.8,dr:35.7,dad:[96.2,96.2,96.2,96.2,96.2,96.2,96.2,92.3,92.3,92.3],dao:[96.2,96.2,96.2,96.2,96.2,96.2,96.2,96.2,96.2,92.3]},
{fid:'1758026580353192',p:'average',c:18,ad:66.7,ao:70,g:3.3,dr:61.5,dad:[100,61.1,61.1,61.1,61.1,66.7,66.7,55.6,66.7,66.7],dao:[127.8,61.1,61.1,61.1,61.1,66.7,66.7,61.1,66.7,66.7]},
{fid:'1762167035299278',p:'bad',c:16,ad:93.8,ao:94.4,g:0.6,dr:95.7,dad:[93.8,100,93.8,93.8,93.8,93.8,93.8,87.5,93.8,93.8],dao:[93.8,100,93.8,93.8,93.8,93.8,93.8,93.8,93.8,93.8]},
{fid:'1763016804039750',p:'average',c:15,ad:105.4,ao:108,g:2.6,dr:93.8,dad:[106.7,100,106.7,106.7,106.7,106.7,100,106.7,106.7,106.7],dao:[126.7,100,106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7]},
{fid:'1731996902299187',p:'good',c:60,ad:90.8,ao:91.2,g:0.4,dr:41.4,dad:[93.3,91.7,93.3,91.7,90,91.7,91.7,86.7,83.3,95],dao:[93.3,91.7,93.3,91.7,90,90,93.3,86.7,86.7,95]},
{fid:'1732464890112292',p:'average',c:28,ad:94.6,ao:97.5,g:2.9,dr:39.3,dad:[96.4,100,100,85.7,85.7,96.4,100,96.4,96.4,89.3],dao:[96.4,103.6,100,89.3,96.4,100,100,96.4,100,92.9]},
{fid:'1732533924353910',p:'average',c:54,ad:92.6,ao:95,g:2.4,dr:71.2,dad:[88.9,92.6,92.6,88.9,92.6,96.3,96.3,92.6,92.6,92.6],dao:[100,92.6,92.6,92.6,94.4,96.3,96.3,96.3,94.4,94.4]},
{fid:'1732693865299226',p:'average',c:45,ad:95.8,ao:100.5,g:4.7,dr:56.8,dad:[100,97.8,97.8,93.3,100,97.8,97.8,91.1,86.7,95.6],dao:[126.7,97.8,100,97.8,100,97.8,97.8,95.6,93.3,97.8]},
{fid:'1732775742299450',p:'good',c:35,ad:98.6,ao:99.7,g:1.1,dr:15.2,dad:[102.9,102.9,102.9,97.1,94.3,102.9,100,100,91.4,91.4],dao:[105.7,102.9,102.9,97.1,94.3,102.9,100,100,100,91.4]},
{fid:'1733054941039246',p:'good',c:70,ad:97.3,ao:98.9,g:1.6,dr:34.8,dad:[97.1,98.6,98.6,91.4,98.6,98.6,98.6,98.6,98.6,94.3],dao:[105.7,98.6,98.6,97.1,98.6,98.6,98.6,98.6,98.6,95.7]},
{fid:'1733219495299639',p:'good',c:10,ad:97,ao:98,g:1,dr:90,dad:[90,90,90,100,100,100,100,100,100,100],dao:[100,90,90,100,100,100,100,100,100,100]},
{fid:'1733659814353728',p:'average',c:35,ad:98,ao:100,g:2,dr:88.9,dad:[102.9,100,102.9,94.3,102.9,94.3,97.1,97.1,94.3,94.3],dao:[111.4,102.9,102.9,97.1,102.9,94.3,100,97.1,97.1,94.3]},
{fid:'1733734369039634',p:'average',c:12,ad:74.2,ao:77.5,g:3.3,dr:0,dad:[75,75,75,75,75,75,75,75,66.7,75],dao:[108.3,75,75,75,75,75,75,75,66.7,75]},
{fid:'1733993576112725',p:'average',c:25,ad:96,ao:103.6,g:7.6,dr:64,dad:[100,96,96,92,88,100,100,100,92,96],dao:[168,100,96,96,88,100,100,100,92,96]},
{fid:'1734244141112453',p:'good',c:40,ad:99.2,ao:103,g:3.8,dr:76.2,dad:[105,100,100,92.5,97.5,100,100,102.5,97.5,97.5],dao:[130,100,100,97.5,100,100,100,102.5,100,100]},
{fid:'1734250153299116',p:'average',c:25,ad:97.2,ao:100,g:2.8,dr:0,dad:[100,100,100,84,96,100,100,96,100,96],dao:[116,100,100,88,100,100,100,100,100,96]},
{fid:'1734262474112330',p:'good',c:60,ad:98.2,ao:99.5,g:1.3,dr:28.3,dad:[100,100,100,96.7,100,98.3,100,95,93.3,98.3],dao:[105,100,100,98.3,100,98.3,100,98.3,95,100]},
{fid:'1734442474353466',p:'average',c:31,ad:93.9,ao:95.2,g:1.3,dr:61.3,dad:[100,96.8,96.8,87.1,96.8,96.8,93.5,87.1,87.1,96.8],dao:[103.2,96.8,96.8,90.3,96.8,96.8,96.8,87.1,90.3,96.8]},
{fid:'1734596202039994',p:'good',c:45,ad:97.4,ao:97.4,g:0,dr:100,dad:[100,100,97.8,97.8,95.6,95.6,97.8,93.3,97.8,97.8],dao:[100,100,97.8,97.8,95.6,95.6,97.8,93.3,97.8,97.8]},
{fid:'1734596323112228',p:'average',c:25,ad:95.6,ao:98,g:2.4,dr:8,dad:[100,100,96,84,100,100,100,84,100,92],dao:[112,100,96,88,104,100,100,88,100,92]},
{fid:'1734606485039234',p:'good',c:51,ad:97.4,ao:98.8,g:1.4,dr:74.5,dad:[100,98,100,94.1,98,98,96.1,98,96.1,96.1],dao:[102,100,100,98,98,100,96.1,98,98,98]},
{fid:'1734962222039092',p:'average',c:25,ad:97.6,ao:101.2,g:3.6,dr:52,dad:[108,100,100,88,96,100,100,84,100,100],dao:[128,100,100,100,96,100,100,88,100,100]},
{fid:'1735115028112900',p:'good',c:84,ad:97,ao:98.1,g:1.1,dr:25.3,dad:[97.6,98.8,97.6,95.2,97.6,97.6,95.2,96.4,96.4,97.6],dao:[101.2,98.8,98.8,96.4,97.6,98.8,97.6,96.4,97.6,97.6]},
{fid:'1735220868112171',p:'bad',c:25,ad:100.8,ao:102.8,g:2,dr:100,dad:[104,100,100,100,100,104,100,100,100,100],dao:[116,108,100,100,100,104,100,100,100,100]},
{fid:'1735470218353307',p:'average',c:28,ad:97.5,ao:99.3,g:1.8,dr:15.4,dad:[100,100,100,92.9,100,100,100,96.4,92.9,92.9],dao:[114.3,100,100,92.9,100,100,100,96.4,96.4,92.9]},
{fid:'1735556758353501',p:'average',c:37,ad:91.4,ao:92.2,g:0.8,dr:83.3,dad:[89.2,94.6,94.6,94.6,97.3,94.6,94.6,86.5,86.5,81.1],dao:[89.2,94.6,94.6,94.6,97.3,97.3,94.6,86.5,86.5,86.5]},
{fid:'1735557080039875',p:'average',c:50,ad:99.4,ao:101.4,g:2,dr:76.5,dad:[100,102,102,100,102,100,100,96,96,96],dao:[104,102,102,102,102,102,102,100,100,98]},
{fid:'1735636217112494',p:'good',c:30,ad:91.3,ao:94,g:2.7,dr:96.7,dad:[90,90,93.3,90,86.7,93.3,93.3,96.7,90,90],dao:[100,90,93.3,93.3,90,93.3,93.3,96.7,96.7,93.3]},
{fid:'1735715955299148',p:'average',c:44,ad:99.1,ao:101.4,g:2.3,dr:100,dad:[97.7,100,100,100,100,100,100,93.2,100,100],dao:[115.9,100,100,100,100,100,100,97.7,100,100]},
{fid:'1735716628353097',p:'good',c:28,ad:98.2,ao:98.9,g:0.7,dr:10.7,dad:[100,100,100,96.4,96.4,96.4,100,100,96.4,96.4],dao:[100,100,100,100,100,96.4,100,100,96.4,96.4]},
{fid:'1735727912039513',p:'average',c:39,ad:93.6,ao:95.1,g:1.5,dr:82.1,dad:[89.7,89.7,94.9,94.9,92.3,92.3,94.9,92.3,97.4,97.4],dao:[94.9,89.7,94.9,94.9,94.9,92.3,94.9,97.4,97.4,100]},
{fid:'1735732017112767',p:'good',c:25,ad:86.4,ao:89.6,g:3.2,dr:100,dad:[92,88,88,84,84,84,84,72,92,96],dao:[104,88,88,84,88,84,88,72,100,100]},
{fid:'1735818663353002',p:'good',c:47,ad:97.4,ao:98.5,g:1.1,dr:100,dad:[100,100,100,93.6,100,100,95.7,91.5,95.7,97.9],dao:[100,100,100,95.7,100,100,97.9,95.7,97.9,97.9]},
{fid:'1736069375112480',p:'average',c:30,ad:91.3,ao:99,g:7.7,dr:100,dad:[100,96.7,96.7,93.3,93.3,83.3,70,96.7,90,93.3],dao:[103.3,100,96.7,96.7,96.7,96.7,100,100,100,100]},
{fid:'1736172809353890',p:'good',c:30,ad:92.7,ao:96.7,g:4,dr:10,dad:[100,100,100,90,93.3,96.7,86.7,86.7,80,93.3],dao:[103.3,100,100,96.7,96.7,96.7,96.7,93.3,90,93.3]},
{fid:'1736255110039353',p:'good',c:24,ad:95.4,ao:98.7,g:3.3,dr:41.7,dad:[100,100,100,95.8,100,95.8,100,91.7,83.3,87.5],dao:[100,100,100,100,100,95.8,100,95.8,100,95.8]},
{fid:'1736323914039078',p:'good',c:30,ad:82.3,ao:84.3,g:2,dr:44.4,dad:[83.3,83.3,76.7,73.3,83.3,86.7,86.7,80,86.7,83.3],dao:[83.3,83.3,83.3,76.7,83.3,86.7,86.7,86.7,86.7,86.7]},
{fid:'1736405106299036',p:'average',c:15,ad:94.7,ao:104.6,g:9.9,dr:46.7,dad:[100,100,86.7,80,93.3,100,93.3,93.3,100,100],dao:[173.3,100,93.3,93.3,93.3,100,100,93.3,100,100]},
{fid:'1736669509353820',p:'good',c:22,ad:88.7,ao:91.4,g:2.7,dr:5.3,dad:[95.5,95.5,95.5,81.8,86.4,90.9,90.9,86.4,86.4,77.3],dao:[95.5,95.5,95.5,95.5,95.5,90.9,90.9,86.4,90.9,77.3]},
{fid:'1736772704353216',p:'average',c:25,ad:98.4,ao:102,g:3.6,dr:26.7,dad:[100,100,100,100,100,100,92,96,92,104],dao:[120,100,100,100,100,100,92,96,96,116]},
{fid:'1736920599112742',p:'average',c:45,ad:97.1,ao:99.1,g:2,dr:20,dad:[100,100,100,93.3,100,100,100,86.7,93.3,97.8],dao:[100,100,100,95.6,100,100,100,100,95.6,100]},
{fid:'1737029123112876',p:'average',c:15,ad:104,ao:106.7,g:2.7,dr:25,dad:[100,106.7,106.7,106.7,106.7,106.7,106.7,106.7,100,93.3],dao:[120,106.7,106.7,106.7,106.7,106.7,106.7,106.7,100,100]},
{fid:'1737530409299986',p:'good',c:55,ad:88.9,ao:90.5,g:1.6,dr:66,dad:[89.1,89.1,89.1,89.1,89.1,89.1,89.1,87.3,87.3,90.9],dao:[103.6,89.1,89.1,89.1,90.9,89.1,89.1,87.3,87.3,90.9]},
{fid:'1737617220039019',p:'average',c:30,ad:95,ao:99.3,g:4.3,dr:46.7,dad:[93.3,100,100,90,93.3,100,100,90,93.3,90],dao:[110,100,100,96.7,100,100,100,96.7,93.3,96.7]},
{fid:'1748270750039007',p:'average',c:33,ad:89.4,ao:90.3,g:0.9,dr:87.9,dad:[81.8,84.8,84.8,84.8,93.9,87.9,90.9,90.9,97,97],dao:[84.8,84.8,84.8,84.8,93.9,87.9,93.9,90.9,97,100]},
{fid:'1755504838353609',p:'average',c:54,ad:92.4,ao:94.6,g:2.2,dr:25.5,dad:[98.1,92.6,92.6,87,90.7,92.6,94.4,92.6,90.7,92.6],dao:[109.3,94.4,96.3,90.7,90.7,92.6,94.4,94.4,90.7,92.6]},
{fid:'1756029294299648',p:'average',c:33,ad:100.9,ao:104.2,g:3.3,dr:22.9,dad:[106.1,106.1,103,100,100,106.1,103,97,93.9,93.9],dao:[118.2,109.1,106.1,109.1,103,106.1,103,97,97,93.9]},
{fid:'1756039946039719',p:'good',c:35,ad:94,ao:95.7,g:1.7,dr:44.1,dad:[97.1,94.3,94.3,91.4,91.4,94.3,94.3,94.3,94.3,94.3],dao:[105.7,94.3,97.1,97.1,91.4,94.3,94.3,94.3,94.3,94.3]},
{fid:'1756297666112408',p:'good',c:33,ad:96.7,ao:97.6,g:0.9,dr:24.2,dad:[97,100,100,100,97,100,97,93.9,93.9,87.9],dao:[103,100,100,100,97,100,97,97,93.9,87.9]},
{fid:'1756811135353734',p:'average',c:33,ad:94.2,ao:96,g:1.8,dr:65.6,dad:[93.9,93.9,87.9,93.9,97,93.9,93.9,93.9,97,97],dao:[103,93.9,93.9,93.9,97,93.9,93.9,97,97,97]},
{fid:'1758119973112601',p:'average',c:27,ad:77.8,ao:80,g:2.2,dr:0,dad:[85.2,81.5,81.5,81.5,81.5,74.1,74.1,70.4,77.8,70.4],dao:[85.2,81.5,81.5,81.5,81.5,77.8,77.8,77.8,81.5,74.1]},
{fid:'1758437100353364',p:'average',c:32,ad:94.7,ao:97.5,g:2.8,dr:35.5,dad:[96.9,96.9,96.9,93.8,96.9,96.9,90.6,87.5,96.9,93.8],dao:[103.1,96.9,96.9,96.9,96.9,96.9,96.9,96.9,96.9,96.9]},
{fid:'1758444604112750',p:'good',c:20,ad:102,ao:105,g:3,dr:52.4,dad:[95,100,95,100,105,105,105,100,105,110],dao:[110,100,95,105,105,105,105,105,110,110]},
{fid:'1758550187039289',p:'good',c:20,ad:103,ao:103,g:0,dr:4.8,dad:[105,105,105,100,105,105,95,100,105,105],dao:[105,105,105,100,105,105,95,100,105,105]},
{fid:'1758803681039316',p:'average',c:40,ad:98.5,ao:100,g:1.5,dr:42.5,dad:[102.5,100,100,90,100,100,97.5,97.5,97.5,100],dao:[110,100,100,95,100,100,97.5,100,97.5,100]},
{fid:'1759038674353806',p:'good',c:40,ad:98.2,ao:100,g:1.8,dr:50,dad:[100,100,100,92.5,100,100,100,95,95,100],dao:[112.5,100,100,95,100,100,100,95,97.5,100]},
{fid:'1759244322112234',p:'good',c:30,ad:98.3,ao:99.3,g:1,dr:30,dad:[100,100,100,93.3,100,96.7,96.7,96.7,100,100],dao:[106.7,100,100,93.3,100,96.7,96.7,100,100,100]},
{fid:'1759663862112957',p:'average',c:21,ad:104.8,ao:104.8,g:0,dr:54.5,dad:[109.5,114.3,104.8,100,104.8,100,100,104.8,104.8,104.8],dao:[109.5,114.3,104.8,100,104.8,100,100,104.8,104.8,104.8]},
{fid:'1760421504353695',p:'good',c:45,ad:93.8,ao:94.7,g:0.9,dr:50,dad:[95.6,93.3,97.8,97.8,97.8,93.3,95.6,88.9,91.1,86.7],dao:[102.2,93.3,97.8,97.8,97.8,93.3,95.6,88.9,91.1,88.9]},
{fid:'1760606153299227',p:'good',c:18,ad:98.3,ao:99.4,g:1.1,dr:77.8,dad:[94.4,94.4,100,94.4,100,100,100,100,100,100],dao:[105.6,94.4,100,94.4,100,100,100,100,100,100]},
{fid:'1761544205299782',p:'good',c:24,ad:93.7,ao:96.6,g:2.9,dr:95.7,dad:[87.5,95.8,95.8,91.7,95.8,91.7,91.7,95.8,95.8,95.8],dao:[104.2,95.8,95.8,95.8,95.8,95.8,95.8,95.8,95.8,95.8]},
{fid:'1762260920039881',p:'average',c:20,ad:97,ao:97.5,g:0.5,dr:85,dad:[105,105,100,95,95,95,80,95,100,100],dao:[115,105,100,95,95,90,80,95,100,100]},
{fid:'1762326888353011',p:'average',c:25,ad:98.8,ao:100.4,g:1.6,dr:100,dad:[100,100,100,100,100,100,92,96,100,100],dao:[108,100,100,100,100,100,96,100,100,100]},
{fid:'1762328524112388',p:'good',c:27,ad:99.6,ao:101.1,g:1.5,dr:86.7,dad:[100,100,103.7,96.3,100,100,103.7,96.3,100,96.3],dao:[100,100,103.7,103.7,100,103.7,103.7,100,100,96.3]},
{fid:'1762872662299968',p:'average',c:10,ad:99,ao:103,g:4,dr:100,dad:[100,100,100,100,90,100,100,100,100,100],dao:[130,100,100,100,100,100,100,100,100,100]},
{fid:'1763018018112737',p:'average',c:20,ad:87.5,ao:89,g:1.5,dr:100,dad:[90,90,90,90,90,90,90,75,85,85],dao:[90,90,90,90,90,90,90,90,85,85]},
{fid:'1763474990039154',p:'good',c:23,ad:97.8,ao:98.3,g:0.5,dr:95.7,dad:[91.3,100,100,100,95.7,100,100,91.3,100,100],dao:[91.3,100,100,100,100,100,100,91.3,100,100]},
{fid:'1764250295299794',p:'good',c:17,ad:88.2,ao:88.8,g:0.6,dr:100,dad:[64.7,64.7,64.7,94.1,100,100,100,100,94.1,100],dao:[64.7,64.7,64.7,94.1,100,100,100,100,100,100]},
{fid:'1749013602299766',p:'good',c:11,ad:115.5,ao:115.5,g:0,dr:100,dad:[109.1,109.1,109.1,118.2,118.2,118.2,118.2,118.2,118.2,118.2],dao:[109.1,109.1,109.1,118.2,118.2,118.2,118.2,118.2,118.2,118.2]},
{fid:'1749043768299595',p:'good',c:29,ad:102,ao:103.1,g:1.1,dr:96.8,dad:[103.4,103.4,103.4,106.9,100,100,100,100,103.4,100],dao:[113.8,103.4,103.4,106.9,100,100,100,100,103.4,100]},
{fid:'1750147103112814',p:'good',c:10,ad:82,ao:86,g:4,dr:55.6,dad:[70,70,70,80,90,90,90,90,90,80],dao:[100,70,70,80,90,90,90,90,90,90]},
{fid:'1754475687353575',p:'average',c:10,ad:90,ao:92,g:2,dr:90,dad:[90,90,90,90,80,90,90,80,100,100],dao:[90,90,90,90,80,90,100,90,100,100]},
{fid:'1754804188112648',p:'average',c:11,ad:100,ao:103.6,g:3.6,dr:100,dad:[109.1,90.9,100,100,100,100,100,100,100,100],dao:[136.4,100,100,100,100,100,100,100,100,100]},
{fid:'1754825536353683',p:'good',c:10,ad:97,ao:97,g:0,dr:25,dad:[100,100,100,100,100,100,100,100,100,70],dao:[100,100,100,100,100,100,100,100,100,70]},
{fid:'1762077004299718',p:'good',c:23,ad:103,ao:103,g:0,dr:100,dad:[104.3,104.3,104.3,104.3,104.3,104.3,104.3,100,95.7,104.3],dao:[104.3,104.3,104.3,104.3,104.3,104.3,104.3,100,95.7,104.3]},
{fid:'1749724325039821',p:'average',c:32,ad:91.9,ao:92.2,g:0.3,dr:96.9,dad:[84.4,87.5,87.5,93.8,90.6,96.9,96.9,90.6,90.6,100],dao:[84.4,87.5,90.6,93.8,90.6,96.9,96.9,90.6,90.6,100]},
{fid:'1750077984299777',p:'good',c:15,ad:104.7,ao:106.7,g:2,dr:38.5,dad:[106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,86.7],dao:[113.3,113.3,113.3,106.7,106.7,106.7,106.7,106.7,106.7,86.7]},
{fid:'1750339974112010',p:'good',c:26,ad:91.2,ao:93.8,g:2.6,dr:38.5,dad:[88.5,92.3,96.2,92.3,88.5,96.2,92.3,92.3,80.8,92.3],dao:[92.3,92.3,96.2,92.3,92.3,96.2,92.3,100,92.3,92.3]},
{fid:'1750590112299957',p:'good',c:11,ad:188.2,ao:194.6,g:6.4,dr:33.3,dad:[227.3,236.4,236.4,236.4,236.4,236.4,109.1,100,100,163.6],dao:[236.4,236.4,236.4,236.4,236.4,236.4,154.5,100,109.1,163.6]},
{fid:'1750593557299687',p:'good',c:27,ad:97.8,ao:98.1,g:0.3,dr:26.9,dad:[100,100,100,100,92.6,92.6,96.3,100,100,96.3],dao:[100,100,100,100,92.6,96.3,96.3,100,100,96.3]},
{fid:'1750762744299020',p:'average',c:10,ad:91,ao:93,g:2,dr:44.4,dad:[100,90,90,100,100,100,70,80,90,90],dao:[100,100,90,100,100,100,80,80,90,90]},
{fid:'1750775247112359',p:'good',c:42,ad:91.2,ao:95,g:3.8,dr:46.2,dad:[95.2,92.9,92.9,92.9,88.1,92.9,92.9,83.3,92.9,88.1],dao:[119,92.9,95.2,92.9,90.5,92.9,92.9,90.5,92.9,90.5]},
{fid:'1755584967039859',p:'average',c:25,ad:70.8,ao:73.2,g:2.4,dr:28.6,dad:[60,72,72,72,72,68,68,72,72,80],dao:[60,72,72,72,72,72,72,76,80,84]},
{fid:'1758121109353355',p:'average',c:15,ad:86.7,ao:87.3,g:0.6,dr:42.9,dad:[93.3,93.3,93.3,93.3,86.7,80,73.3,80,86.7,86.7],dao:[93.3,93.3,93.3,93.3,86.7,80,80,80,86.7,86.7]},
{fid:'1760965704112179',p:'new',c:12,ad:99.2,ao:99.2,g:0,dr:100,dad:[100,100,100,100,100,91.7,91.7,100,100,108.3],dao:[100,100,100,100,100,91.7,91.7,100,100,108.3]},
{fid:'1721737433299444',p:'good',c:88,ad:76.5,ao:80,g:3.5,dr:54.3,dad:[75,79.5,76.1,78.4,79.5,77.3,75,76.1,71.6,76.1],dao:[83,81.8,81.8,80.7,83,78.4,80.7,77.3,76.1,77.3]},
{fid:'1723084762112557',p:'average',c:22,ad:91.4,ao:95.5,g:4.1,dr:71.4,dad:[95.5,95.5,90.9,90.9,86.4,95.5,95.5,90.9,81.8,90.9],dao:[100,100,95.5,95.5,90.9,95.5,95.5,95.5,90.9,95.5]},
{fid:'1723455618112177',p:'average',c:77,ad:93.9,ao:98.8,g:4.9,dr:23.7,dad:[93.5,100,96.1,97.4,90.9,92.2,90.9,94.8,87,96.1],dao:[98.7,102.6,98.7,100,97.4,96.1,98.7,98.7,100,97.4]},
{fid:'1723515527353938',p:'average',c:30,ad:102,ao:105.7,g:3.7,dr:65.6,dad:[110,106.7,103.3,103.3,103.3,93.3,100,103.3,96.7,100],dao:[133.3,106.7,106.7,103.3,103.3,96.7,100,103.3,103.3,100]},
{fid:'1723516221299677',p:'good',c:123,ad:95,ao:100.2,g:5.2,dr:25.2,dad:[98.4,99.2,100.8,95.1,86.2,88.6,95.1,93.5,95.1,97.6],dao:[99.2,101.6,102.4,101.6,101.6,100,98.4,98.4,98.4,100]},
{fid:'1723688690039736',p:'good',c:65,ad:96.8,ao:101.7,g:4.9,dr:4.5,dad:[106.2,96.9,98.5,90.8,100,96.9,98.5,89.2,92.3,98.5],dao:[136.9,98.5,100,95.4,100,98.5,98.5,95.4,95.4,98.5]},
{fid:'1723973654299286',p:'average',c:49,ad:74.7,ao:75.5,g:0.8,dr:60.5,dad:[77.6,77.6,77.6,69.4,73.5,73.5,75.5,71.4,75.5,75.5],dao:[77.6,77.6,77.6,71.4,75.5,75.5,75.5,73.5,75.5,75.5]},
{fid:'1723976548112703',p:'good',c:80,ad:26.1,ao:37.9,g:11.8,dr:0,dad:[38.8,22.5,26.2,25,25,25,25,23.8,25,25],dao:[128.8,28.7,43.8,27.5,25,25,25,25,25,25]},
{fid:'1724120070353222',p:'average',c:15,ad:92.7,ao:111.3,g:18.6,dr:46.7,dad:[113.3,100,100,80,86.7,86.7,100,86.7,86.7,86.7],dao:[246.7,100,100,100,93.3,93.3,100,100,86.7,93.3]},
{fid:'1724140127112126',p:'average',c:40,ad:93.5,ao:99,g:5.5,dr:85,dad:[100,97.5,100,95,87.5,92.5,92.5,87.5,90,92.5],dao:[100,100,102.5,102.5,92.5,92.5,100,100,100,100]},
{fid:'1724140950112020',p:'good',c:89,ad:92.1,ao:96.1,g:4,dr:16.9,dad:[98.9,96.6,100,85.4,86.5,100,92.1,74.2,95.5,92.1],dao:[103.4,97.8,100,92.1,92.1,100,96.6,87.6,95.5,95.5]},
{fid:'1724142035353386',p:'good',c:60,ad:92.3,ao:95.3,g:3,dr:89.5,dad:[88.3,93.3,96.7,90,91.7,93.3,93.3,93.3,93.3,90],dao:[106.7,93.3,96.7,93.3,93.3,93.3,95,95,95,91.7]},
{fid:'1724142498353383',p:'average',c:45,ad:98,ao:99.8,g:1.8,dr:73.3,dad:[100,100,95.6,91.1,97.8,100,100,95.6,100,100],dao:[108.9,100,97.8,97.8,97.8,100,100,95.6,100,100]},
{fid:'1724142937299214',p:'average',c:60,ad:92.2,ao:96.2,g:4,dr:6.8,dad:[95,96.7,98.3,80,90,98.3,96.7,85,86.7,95],dao:[105,98.3,98.3,93.3,91.7,100,100,86.7,90,98.3]},
{fid:'1724233868299210',p:'average',c:40,ad:89.2,ao:93.5,g:4.3,dr:78,dad:[67.5,95,92.5,92.5,97.5,92.5,90,85,87.5,92.5],dao:[70,97.5,97.5,97.5,100,97.5,95,92.5,92.5,95]},
{fid:'1724309481299755',p:'good',c:75,ad:92.9,ao:98.8,g:5.9,dr:21.3,dad:[97.3,97.3,97.3,92,92,88,92,92,88,93.3],dao:[108,102.7,100,100,100,97.3,96,93.3,94.7,96]},
{fid:'1724309986353392',p:'average',c:21,ad:75.2,ao:87.6,g:12.4,dr:4.8,dad:[76.2,95.2,61.9,76.2,76.2,66.7,71.4,76.2,71.4,81],dao:[95.2,95.2,95.2,95.2,90.5,85.7,85.7,81,76.2,76.2]},
{fid:'1724575046353505',p:'average',c:34,ad:94.7,ao:95,g:0.3,dr:72.2,dad:[85.3,88.2,88.2,88.2,97.1,94.1,97.1,100,102.9,105.9],dao:[85.3,88.2,88.2,88.2,100,94.1,97.1,100,102.9,105.9]},
{fid:'1724656829112251',p:'average',c:15,ad:91.3,ao:96.7,g:5.4,dr:100,dad:[100,100,93.3,93.3,93.3,86.7,86.7,86.7,86.7,86.7],dao:[106.7,100,100,93.3,100,93.3,93.3,100,93.3,86.7]},
{fid:'1724658606112944',p:'good',c:40,ad:97.2,ao:98.8,g:1.6,dr:15,dad:[100,100,100,90,100,100,100,95,100,87.5],dao:[102.5,100,100,95,100,100,100,97.5,100,92.5]},
{fid:'1725157848353375',p:'good',c:185,ad:92,ao:97.6,g:5.6,dr:97.3,dad:[65.9,93,83.8,99.5,100,94.6,96.2,93.5,95.7,97.8],dao:[80,101.6,95.7,101.6,101.6,99.5,99.5,98.4,98.4,99.5]},
{fid:'1725980422299407',p:'average',c:30,ad:89.3,ao:93,g:3.7,dr:31,dad:[100,96.7,100,83.3,80,80,83.3,93.3,86.7,90],dao:[100,100,103.3,93.3,90,83.3,83.3,96.7,90,90]},
{fid:'1726048823112191',p:'good',c:118,ad:92.9,ao:96,g:3.1,dr:26.5,dad:[95.8,97.5,95.8,90.7,93.2,83.9,92.4,95.8,89,94.9],dao:[99.2,97.5,96.6,94.9,95.8,93.2,94.9,96.6,94.9,96.6]},
{fid:'1726057050299560',p:'average',c:60,ad:98.7,ao:101.2,g:2.5,dr:24.6,dad:[100,101.7,101.7,95,100,96.7,98.3,95,98.3,100],dao:[108.3,101.7,101.7,101.7,101.7,100,100,98.3,98.3,100]},
{fid:'1726404074112794',p:'good',c:25,ad:90.8,ao:98.8,g:8,dr:33.3,dad:[92,92,92,64,92,88,96,96,100,96],dao:[128,92,92,92,92,92,100,100,100,100]},
{fid:'1726409077299412',p:'average',c:106,ad:82.4,ao:87.3,g:4.9,dr:29.2,dad:[88.7,84.9,82.1,76.4,79.2,82.1,82.1,83,86.8,79.2],dao:[90.6,89.6,87.7,82.1,83,88.7,89.6,88.7,89.6,83]},
{fid:'1726415584039736',p:'good',c:80,ad:92.6,ao:96.2,g:3.6,dr:17.7,dad:[97.5,98.8,97.5,90,82.5,95,91.2,88.8,92.5,92.5],dao:[106.2,100,100,92.5,91.2,96.2,93.8,93.8,93.8,95]},
{fid:'1726491675039053',p:'good',c:50,ad:94.8,ao:97,g:2.2,dr:80,dad:[94,96,98,92,96,96,94,92,92,98],dao:[96,96,98,94,100,98,98,96,94,100]},
{fid:'1726495997039637',p:'good',c:65,ad:89.7,ao:90.3,g:0.6,dr:85.5,dad:[92.3,93.8,90.8,83.1,84.6,90.8,90.8,89.2,90.8,90.8],dao:[93.8,93.8,90.8,84.6,84.6,90.8,90.8,90.8,92.3,90.8]},
{fid:'1726563421353941',p:'average',c:15,ad:94.7,ao:98,g:3.3,dr:73.3,dad:[100,100,100,86.7,86.7,100,93.3,93.3,93.3,93.3],dao:[100,100,100,100,86.7,100,100,93.3,100,100]},
{fid:'1726570976353867',p:'good',c:35,ad:87.4,ao:91.2,g:3.8,dr:8.1,dad:[97.1,97.1,102.9,85.7,80,82.9,82.9,80,85.7,80],dao:[100,100,102.9,94.3,85.7,85.7,88.6,82.9,85.7,85.7]},
{fid:'1726649064039003',p:'good',c:36,ad:100.6,ao:106.1,g:5.5,dr:36.8,dad:[97.2,105.6,100,97.2,102.8,97.2,100,100,102.8,102.8],dao:[111.1,111.1,105.6,102.8,105.6,102.8,102.8,105.6,105.6,108.3]},
{fid:'1726741761353000',p:'average',c:30,ad:97.3,ao:102.7,g:5.4,dr:6.3,dad:[103.3,103.3,103.3,96.7,96.7,96.7,93.3,86.7,93.3,100],dao:[126.7,103.3,103.3,100,96.7,103.3,96.7,93.3,100,103.3]},
{fid:'1726758891353690',p:'good',c:60,ad:99.5,ao:101.2,g:1.7,dr:83.9,dad:[100,100,101.7,100,101.7,100,98.3,93.3,100,100],dao:[106.7,100,101.7,101.7,101.7,101.7,98.3,100,100,100]},
{fid:'1727176463039830',p:'average',c:45,ad:82.2,ao:84.7,g:2.5,dr:97.5,dad:[86.7,88.9,86.7,62.2,82.2,77.8,86.7,84.4,84.4,82.2],dao:[86.7,88.9,86.7,71.1,86.7,80,86.7,88.9,88.9,82.2]},
{fid:'1727197193039710',p:'average',c:50,ad:88.4,ao:91.2,g:2.8,dr:86.7,dad:[90,88,92,88,86,88,86,88,88,90],dao:[94,92,92,92,90,90,88,90,92,92]},
{fid:'1727319270353895',p:'good',c:80,ad:95.9,ao:99.4,g:3.5,dr:51.3,dad:[98.8,98.8,98.8,90,97.5,100,100,91.2,90,93.8],dao:[107.5,98.8,98.8,97.5,97.5,100,100,98.8,97.5,97.5]},
{fid:'1727349613353878',p:'good',c:200,ad:94.8,ao:97.6,g:2.8,dr:32.5,dad:[96.5,98,97.5,94,95.5,94,93,93,91.5,95.5],dao:[101.5,99,98,98,97.5,96.5,96,96,96.5,96.5]},
{fid:'1727622113112093',p:'good',c:195,ad:97.3,ao:100.3,g:3,dr:64.1,dad:[101,98.5,97.4,89.2,98.5,99.5,99.5,90.3,100.5,99],dao:[120.5,99.5,97.4,94.9,100,99.5,99.5,91.8,100.5,99.5]},
{fid:'1727622427353116',p:'average',c:20,ad:38,ao:42.5,g:4.5,dr:100,dad:[45,40,40,40,40,35,35,35,35,35],dao:[45,45,45,45,45,40,40,40,40,40]},
{fid:'1727689132299846',p:'good',c:98,ad:98.2,ao:99.8,g:1.6,dr:24.2,dad:[99,100,99,90.8,99,98,100,99,99,98],dao:[102,100,100,96.9,99,100,100,100,101,99]},
{fid:'1727793978039271',p:'good',c:28,ad:101.8,ao:104,g:2.2,dr:93.5,dad:[103.6,103.6,103.6,96.4,96.4,103.6,100,103.6,103.6,103.6],dao:[114.3,103.6,103.6,100,100,103.6,103.6,103.6,103.6,103.6]},
{fid:'1727881456112311',p:'average',c:44,ad:90.2,ao:96.6,g:6.4,dr:74.4,dad:[102.3,102.3,102.3,90.9,77.3,81.8,86.4,84.1,84.1,90.9],dao:[104.5,102.3,102.3,100,100,90.9,88.6,90.9,93.2,93.2]},
{fid:'1728226186039617',p:'average',c:38,ad:71.3,ao:80,g:8.7,dr:50,dad:[84.2,78.9,81.6,63.2,71.1,76.3,76.3,52.6,63.2,65.8],dao:[84.2,84.2,84.2,78.9,78.9,78.9,78.9,76.3,73.7,81.6]},
{fid:'1729006591112898',p:'average',c:15,ad:101.4,ao:106,g:4.6,dr:6.3,dad:[106.7,106.7,106.7,100,106.7,106.7,100,80,100,100],dao:[126.7,106.7,106.7,106.7,106.7,106.7,100,93.3,106.7,100]},
{fid:'1729061894353129',p:'good',c:35,ad:101.2,ao:107.2,g:6,dr:10.8,dad:[111.4,102.9,102.9,100,102.9,100,102.9,97.1,97.1,94.3],dao:[148.6,102.9,102.9,102.9,105.7,100,102.9,102.9,102.9,100]},
{fid:'1729236910112944',p:'good',c:30,ad:101,ao:105.3,g:4.3,dr:40,dad:[103.3,96.7,100,90,106.7,106.7,106.7,96.7,103.3,100],dao:[123.3,96.7,100,103.3,106.7,106.7,106.7,106.7,103.3,100]},
{fid:'1729508774299495',p:'good',c:80,ad:88.9,ao:90.9,g:2,dr:17.1,dad:[91.2,88.8,91.2,85,88.8,92.5,88.8,83.8,88.8,90],dao:[92.5,90,91.2,88.8,88.8,92.5,90,92.5,92.5,90]},
{fid:'1729575467039860',p:'good',c:35,ad:79.7,ao:85.7,g:6,dr:78.1,dad:[71.4,82.9,77.1,77.1,80,80,80,80,82.9,85.7],dao:[80,85.7,82.9,82.9,88.6,82.9,88.6,88.6,88.6,88.6]},
{fid:'1729580853299920',p:'average',c:40,ad:84,ao:89.2,g:5.2,dr:97.6,dad:[95,95,92.5,82.5,72.5,57.5,70,85,92.5,97.5],dao:[95,95,97.5,97.5,82.5,60,77.5,92.5,95,100]},
{fid:'1729581055353521',p:'good',c:40,ad:94.2,ao:96.5,g:2.3,dr:55.3,dad:[97.5,97.5,97.5,95,92.5,87.5,95,92.5,92.5,95],dao:[97.5,97.5,97.5,97.5,97.5,92.5,97.5,97.5,95,95]},
{fid:'1729669980112248',p:'average',c:34,ad:98.8,ao:104.7,g:5.9,dr:92.5,dad:[108.8,97.1,100,111.8,94.1,91.2,100,97.1,94.1,94.1],dao:[135.3,100,105.9,111.8,102.9,94.1,105.9,102.9,94.1,94.1]},
{fid:'1729770780299328',p:'average',c:34,ad:100.6,ao:103.8,g:3.2,dr:65.7,dad:[94.1,102.9,102.9,102.9,102.9,100,102.9,97.1,102.9,97.1],dao:[120.6,102.9,102.9,102.9,102.9,100,102.9,97.1,102.9,102.9]},
{fid:'1729781615353835',p:'good',c:33,ad:92.7,ao:95.4,g:2.7,dr:90.6,dad:[93.9,100,97,93.9,97,90.9,87.9,78.8,93.9,93.9],dao:[97,100,100,100,100,93.9,90.9,84.8,93.9,93.9]},
{fid:'1730037376039130',p:'good',c:88,ad:93.4,ao:94.9,g:1.5,dr:2.4,dad:[96.6,96.6,96.6,95.5,93.2,92,93.2,92,89.8,88.6],dao:[97.7,96.6,96.6,97.7,95.5,93.2,93.2,93.2,93.2,92]},
{fid:'1730038747299966',p:'good',c:150,ad:92.3,ao:94.3,g:2,dr:43.8,dad:[93.3,93.3,96,92,90.7,92,88,90.7,92.7,94],dao:[102,94.7,96,93.3,93.3,94,88.7,92.7,94,94.7]},
{fid:'1730106275039324',p:'good',c:73,ad:95.2,ao:97,g:1.8,dr:64.8,dad:[97.3,95.9,97.3,95.9,97.3,97.3,86.3,97.3,94.5,93.2],dao:[97.3,97.3,97.3,95.9,97.3,97.3,95.9,97.3,97.3,97.3]},
{fid:'1730106483353222',p:'good',c:60,ad:95,ao:99.3,g:4.3,dr:1.6,dad:[98.3,100,100,93.3,95,96.7,98.3,80,91.7,96.7],dao:[103.3,100,100,100,100,98.3,98.3,95,98.3,100]},
{fid:'1730106549039928',p:'good',c:25,ad:92.4,ao:94.8,g:2.4,dr:0,dad:[96,96,96,96,92,88,92,88,88,92],dao:[96,96,96,96,96,92,96,96,92,92]},
{fid:'1730128387299452',p:'average',c:121,ad:92.1,ao:97.7,g:5.6,dr:35.8,dad:[96.7,98.3,95.9,90.1,90.1,85.1,91.7,91.7,91.7,89.3],dao:[113.2,99.2,97.5,97.5,94.2,96.7,95.9,92.6,95.9,94.2]},
{fid:'1730209137039348',p:'good',c:47,ad:99.6,ao:101.7,g:2.1,dr:97.9,dad:[102.1,100,100,97.9,100,100,100,95.7,100,100],dao:[112.8,100,100,97.9,100,100,100,102.1,102.1,102.1]},
{fid:'1730263369039832',p:'average',c:35,ad:98.6,ao:100.6,g:2,dr:52.8,dad:[100,100,94.3,100,100,100,100,94.3,100,97.1],dao:[100,100,97.1,102.9,102.9,102.9,100,97.1,102.9,100]},
{fid:'1730272982353664',p:'average',c:22,ad:75.9,ao:78.2,g:2.3,dr:50,dad:[77.3,72.7,68.2,59.1,72.7,77.3,81.8,81.8,77.3,90.9],dao:[77.3,77.3,68.2,68.2,72.7,77.3,86.4,81.8,81.8,90.9]},
{fid:'1730298844299488',p:'average',c:35,ad:97.7,ao:99.7,g:2,dr:0,dad:[94.3,100,97.1,94.3,100,97.1,100,97.1,100,97.1],dao:[100,100,100,100,100,97.1,100,100,100,100]},
{fid:'1730642397039373',p:'average',c:23,ad:70,ao:75.7,g:5.7,dr:10,dad:[73.9,69.6,73.9,65.2,73.9,69.6,73.9,56.5,73.9,69.6],dao:[95.7,78.3,78.3,65.2,78.3,69.6,78.3,65.2,78.3,69.6]},
{fid:'1730730587112166',p:'average',c:88,ad:90.1,ao:92.9,g:2.8,dr:56.6,dad:[90.9,93.2,94.3,89.8,92,89.8,89.8,86.4,86.4,88.6],dao:[92,94.3,94.3,95.5,94.3,93.2,92,92,89.8,92]},
{fid:'1730817316353999',p:'average',c:95,ad:77.8,ao:81.2,g:3.4,dr:0,dad:[97.9,96.8,98.9,94.7,95.8,67.4,68.4,58.9,49.5,49.5],dao:[100,98.9,100,100,98.9,70.5,69.5,66.3,53.7,53.7]},
{fid:'1730817552353549',p:'good',c:35,ad:101.4,ao:105.5,g:4.1,dr:0,dad:[105.7,100,102.9,100,100,102.9,102.9,102.9,97.1,100],dao:[134.3,102.9,102.9,100,102.9,102.9,102.9,102.9,102.9,100]},
{fid:'1730902572353719',p:'bad',c:27,ad:83.7,ao:84.8,g:1.1,dr:100,dad:[85.2,63,77.8,92.6,88.9,74.1,88.9,88.9,85.2,92.6],dao:[88.9,66.7,77.8,92.6,92.6,74.1,88.9,88.9,85.2,92.6]},
{fid:'1731403116353870',p:'good',c:38,ad:90.3,ao:90.8,g:0.5,dr:100,dad:[86.8,92.1,92.1,86.8,92.1,89.5,89.5,89.5,92.1,92.1],dao:[86.8,92.1,92.1,89.5,92.1,92.1,89.5,89.5,92.1,92.1]},
{fid:'1731561077353502',p:'good',c:135,ad:97.9,ao:99.7,g:1.8,dr:89.8,dad:[100,99.3,99.3,98.5,97,97.8,98.5,95.6,96.3,97],dao:[101.5,100,99.3,99.3,98.5,99.3,99.3,100,99.3,100.7]},
{fid:'1732450151299475',p:'average',c:10,ad:88,ao:88,g:0,dr:100,dad:[70,80,90,90,90,80,100,100,90,90],dao:[70,80,90,90,90,80,100,100,90,90]},
{fid:'1733392226299836',p:'good',c:60,ad:101.8,ao:103.8,g:2,dr:98.4,dad:[103.3,105,103.3,101.7,103.3,100,100,105,98.3,98.3],dao:[103.3,105,103.3,103.3,103.3,103.3,105,105,101.7,105]},
{fid:'1734857717353362',p:'average',c:22,ad:95,ao:97.3,g:2.3,dr:4.3,dad:[95.5,100,95.5,95.5,95.5,86.4,95.5,86.4,95.5,104.5],dao:[95.5,100,100,95.5,95.5,90.9,95.5,95.5,100,104.5]},
{fid:'1736419007353652',p:'average',c:27,ad:103.3,ao:104.8,g:1.5,dr:89.7,dad:[103.7,103.7,103.7,100,103.7,107.4,107.4,92.6,107.4,103.7],dao:[111.1,103.7,103.7,103.7,103.7,107.4,107.4,92.6,107.4,107.4]},
{fid:'1736748561112340',p:'average',c:150,ad:96.5,ao:101.5,g:5,dr:40.5,dad:[97.3,99.3,99.3,97.3,94.7,97.3,96,95.3,92,96.7],dao:[112.7,101.3,101.3,101.3,99.3,100.7,100,100,98.7,99.3]},
{fid:'1738055418353458',p:'good',c:55,ad:86.2,ao:88.7,g:2.5,dr:4.1,dad:[90.9,90.9,90.9,87.3,89.1,87.3,80,80,81.8,83.6],dao:[90.9,90.9,90.9,90.9,90.9,90.9,87.3,83.6,83.6,87.3]},
{fid:'1738055781299520',p:'good',c:15,ad:99.3,ao:104,g:4.7,dr:64.7,dad:[106.7,100,106.7,100,93.3,100,100,100,93.3,93.3],dao:[126.7,106.7,106.7,106.7,100,100,100,100,93.3,100]},
{fid:'1738066737039181',p:'average',c:60,ad:96,ao:98.2,g:2.2,dr:0,dad:[100,98.3,98.3,96.7,95,90,96.7,96.7,95,93.3],dao:[103.3,100,98.3,98.3,98.3,95,96.7,98.3,98.3,95]},
{fid:'1738160887039313',p:'good',c:61,ad:98.2,ao:102,g:3.8,dr:1.6,dad:[100,96.7,98.4,100,100,90.2,100,96.7,100,100],dao:[108.2,100,101.6,101.6,101.6,101.6,103.3,101.6,100,100]},
{fid:'1738219028299362',p:'average',c:45,ad:73.6,ao:76.7,g:3.1,dr:50,dad:[77.8,75.6,77.8,66.7,77.8,75.6,73.3,73.3,66.7,71.1],dao:[77.8,77.8,80,77.8,77.8,75.6,75.6,75.6,73.3,75.6]},
{fid:'1738225871112685',p:'average',c:50,ad:94.8,ao:98.2,g:3.4,dr:30.2,dad:[102,98,98,96,90,90,96,84,98,96],dao:[108,100,100,100,98,98,96,88,98,96]},
{fid:'1738585299353529',p:'good',c:46,ad:94.4,ao:98.3,g:3.9,dr:89.1,dad:[97.8,100,100,93.5,100,93.5,91.3,82.6,91.3,93.5],dao:[102.2,100,100,100,100,97.8,93.5,97.8,95.7,95.7]},
{fid:'1738822710299488',p:'good',c:185,ad:99.2,ao:102.1,g:2.9,dr:20.1,dad:[102.7,100.5,100,97.3,99.5,98.9,98.4,97.8,97.8,99.5],dao:[117.3,101.1,102.7,101.1,101.6,100,98.9,99.5,99.5,99.5]},
{fid:'1739252492039167',p:'average',c:15,ad:98.7,ao:102,g:3.3,dr:37.5,dad:[100,100,100,100,100,86.7,93.3,93.3,106.7,106.7],dao:[100,100,106.7,106.7,106.7,100,93.3,93.3,106.7,106.7]},
{fid:'1739426223039856',p:'good',c:25,ad:75.2,ao:78,g:2.8,dr:15,dad:[72,80,76,72,72,80,76,76,76,72],dao:[84,80,80,72,72,80,80,80,80,72]},
{fid:'1739671437039633',p:'good',c:50,ad:100,ao:102.4,g:2.4,dr:20.8,dad:[100,98,102,104,100,102,98,98,98,100],dao:[112,100,104,108,102,102,98,100,98,100]},
{fid:'1740036381299370',p:'average',c:48,ad:97.1,ao:98.5,g:1.4,dr:4.3,dad:[100,100,97.9,93.8,97.9,97.9,97.9,93.8,93.8,97.9],dao:[106.2,100,97.9,95.8,97.9,97.9,97.9,95.8,97.9,97.9]},
{fid:'1740506712353708',p:'average',c:43,ad:97,ao:98.8,g:1.8,dr:100,dad:[100,100,100,95.3,100,100,97.7,90.7,90.7,95.3],dao:[100,100,102.3,97.7,100,100,100,97.7,93,97.7]},
{fid:'1740899561353982',p:'good',c:125,ad:91.9,ao:93.4,g:1.5,dr:27.7,dad:[94.4,94.4,96,90.4,90.4,91.2,88,91.2,88.8,94.4],dao:[95.2,94.4,96,94.4,93.6,91.2,90.4,92,92.8,94.4]},
{fid:'1741515082353980',p:'average',c:33,ad:76.1,ao:80,g:3.9,dr:100,dad:[87.9,90.9,90.9,87.9,72.7,54.5,57.6,69.7,69.7,78.8],dao:[93.9,93.9,93.9,90.9,81.8,57.6,63.6,69.7,72.7,81.8]},
{fid:'1743158188039170',p:'new',c:35,ad:79.7,ao:80.9,g:1.2,dr:100,dad:[74.3,74.3,80,74.3,77.1,80,85.7,80,85.7,85.7],dao:[74.3,74.3,80,80,77.1,82.9,85.7,82.9,85.7,85.7]},
{fid:'1744024229039624',p:'good',c:37,ad:94.1,ao:96.2,g:2.1,dr:25.7,dad:[94.6,97.3,91.9,94.6,94.6,94.6,91.9,94.6,91.9,94.6],dao:[97.3,97.3,97.3,97.3,94.6,94.6,97.3,97.3,94.6,94.6]},
{fid:'1744866480039169',p:'average',c:18,ad:87.8,ao:92.2,g:4.4,dr:94.1,dad:[88.9,88.9,88.9,83.3,88.9,88.9,94.4,94.4,77.8,83.3],dao:[94.4,88.9,88.9,88.9,88.9,94.4,94.4,94.4,94.4,94.4]},
{fid:'1745418534299263',p:'average',c:34,ad:93,ao:93.8,g:0.8,dr:84.8,dad:[91.2,97.1,97.1,97.1,94.1,97.1,94.1,85.3,88.2,88.2],dao:[94.1,97.1,97.1,97.1,97.1,97.1,94.1,85.3,91.2,88.2]},
{fid:'1752501581112921',p:'average',c:14,ad:100,ao:104.3,g:4.3,dr:0,dad:[107.1,107.1,107.1,92.9,78.6,107.1,107.1,92.9,100,100],dao:[114.3,107.1,107.1,100,100,107.1,107.1,100,100,100]},
{fid:'1755002417299825',p:'good',c:25,ad:99.6,ao:100.8,g:1.2,dr:50,dad:[104,104,104,96,104,100,92,96,96,100],dao:[108,100,104,96,108,100,96,96,96,104]},
{fid:'1755522302039363',p:'average',c:20,ad:70.5,ao:85.5,g:15,dr:10.5,dad:[80,85,75,75,75,60,65,60,65,65],dao:[90,95,95,95,85,85,80,75,75,80]},
{fid:'1755524840112579',p:'average',c:64,ad:91.1,ao:93.5,g:2.4,dr:95.2,dad:[90.6,90.6,89.1,93.8,95.3,90.6,90.6,89.1,90.6,90.6],dao:[93.8,92.2,93.8,95.3,95.3,93.8,92.2,92.2,92.2,93.8]},
{fid:'1755525040299034',p:'good',c:47,ad:95.1,ao:97.9,g:2.8,dr:72.3,dad:[100,97.9,100,85.1,95.7,95.7,93.6,91.5,93.6,97.9],dao:[102.1,100,100,91.5,97.9,100,95.7,97.9,93.6,100]},
{fid:'1755525200353183',p:'bad',c:20,ad:98.5,ao:98.5,g:0,dr:100,dad:[95,100,100,100,100,95,100,100,100,95],dao:[95,100,100,100,100,95,100,100,100,95]},
{fid:'1755525963039881',p:'average',c:47,ad:97.2,ao:98.5,g:1.3,dr:6.4,dad:[102.1,97.9,97.9,95.7,95.7,95.7,97.9,95.7,93.6,100],dao:[104.3,100,97.9,100,97.9,97.9,97.9,95.7,93.6,100]},
{fid:'1755582920039894',p:'average',c:25,ad:68.4,ao:91.2,g:22.8,dr:88,dad:[80,84,80,84,60,36,56,68,64,72],dao:[96,96,92,88,88,92,92,88,88,92]},
{fid:'1755592962299682',p:'average',c:35,ad:94.8,ao:99.4,g:4.6,dr:45.7,dad:[97.1,97.1,97.1,97.1,85.7,88.6,94.3,97.1,97.1,97.1],dao:[100,100,100,100,100,97.1,97.1,100,100,100]},
{fid:'1755603022112680',p:'average',c:15,ad:96.7,ao:110,g:13.3,dr:50,dad:[100,93.3,100,86.7,100,100,106.7,93.3,100,86.7],dao:[186.7,93.3,100,93.3,106.7,113.3,106.7,100,100,100]},
{fid:'1755672377353070',p:'good',c:40,ad:100.5,ao:104,g:3.5,dr:72.1,dad:[100,97.5,100,100,102.5,102.5,102.5,100,102.5,97.5],dao:[127.5,97.5,100,100,102.5,102.5,105,100,102.5,102.5]},
{fid:'1755675847353518',p:'good',c:165,ad:97.4,ao:99.5,g:2.1,dr:100,dad:[98.8,98.8,99.4,96.4,99.4,95.2,97.6,94.5,98.2,95.8],dao:[98.8,99.4,100,100,100,99.4,100,100,98.8,98.2]},
{fid:'1755677427039694',p:'good',c:120,ad:74.5,ao:76.8,g:2.3,dr:90.7,dad:[71.7,71.7,72.5,70,73.3,75.8,72.5,73.3,79.2,85],dao:[75,73.3,73.3,75,75,75.8,75,78.3,81.7,85.8]},
{fid:'1755686591353457',p:'good',c:25,ad:94.8,ao:98.8,g:4,dr:3.8,dad:[100,104,92,100,96,92,96,92,92,84],dao:[116,104,96,104,100,96,96,92,96,88]},
{fid:'1755696133039848',p:'average',c:30,ad:62.7,ao:69.3,g:6.6,dr:81,dad:[76.7,73.3,66.7,50,60,63.3,53.3,56.7,56.7,70],dao:[80,76.7,70,66.7,66.7,70,63.3,66.7,63.3,70]},
{fid:'1755789727112380',p:'good',c:53,ad:89.6,ao:91.5,g:1.9,dr:70,dad:[84.9,90.6,90.6,86.8,92.5,94.3,90.6,90.6,84.9,90.6],dao:[88.7,90.6,90.6,90.6,94.3,94.3,92.5,94.3,88.7,90.6]},
{fid:'1756018737299329',p:'average',c:25,ad:83.2,ao:85.2,g:2,dr:0,dad:[88,88,88,80,84,80,80,84,72,88],dao:[88,88,88,88,88,80,80,84,80,88]},
{fid:'1756021330299988',p:'average',c:12,ad:71.7,ao:73.3,g:1.6,dr:33.3,dad:[75,75,75,66.7,75,66.7,75,75,58.3,75],dao:[75,75,75,75,75,66.7,75,75,66.7,75]},
{fid:'1756044393353158',p:'bad',c:20,ad:93,ao:101,g:8,dr:10,dad:[95,100,50,100,95,95,95,100,100,100],dao:[105,105,100,100,100,100,100,100,100,100]},
{fid:'1756110201299269',p:'average',c:16,ad:98.8,ao:99.4,g:0.6,dr:37.5,dad:[100,100,100,100,93.8,100,100,93.8,100,100],dao:[100,100,100,100,100,100,100,93.8,100,100]},
{fid:'1756119877112257',p:'good',c:41,ad:85.8,ao:87.8,g:2,dr:16.2,dad:[87.8,90.2,87.8,80.5,90.2,85.4,87.8,78,80.5,90.2],dao:[87.8,90.2,87.8,85.4,90.2,87.8,90.2,82.9,85.4,90.2]},
{fid:'1756125796353635',p:'good',c:30,ad:98.3,ao:100.3,g:2,dr:100,dad:[100,100,100,100,96.7,96.7,93.3,96.7,100,100],dao:[103.3,100,100,100,100,100,100,100,100,100]},
{fid:'1756128618039656',p:'average',c:45,ad:87.3,ao:94.2,g:6.9,dr:100,dad:[86.7,91.1,93.3,73.3,91.1,86.7,91.1,84.4,86.7,88.9],dao:[95.6,93.3,93.3,93.3,93.3,93.3,95.6,95.6,93.3,95.6]},
{fid:'1756210024112171',p:'average',c:27,ad:78.5,ao:93.3,g:14.8,dr:100,dad:[85.2,92.6,92.6,77.8,66.7,44.4,88.9,88.9,70.4,77.8],dao:[92.6,92.6,96.3,92.6,96.3,88.9,92.6,92.6,96.3,92.6]},
{fid:'1756305075299923',p:'average',c:22,ad:100.9,ao:103.6,g:2.7,dr:100,dad:[100,100,104.5,100,104.5,100,104.5,95.5,100,100],dao:[100,104.5,104.5,104.5,104.5,104.5,109.1,100,100,104.5]},
{fid:'1756627547353079',p:'bad',c:11,ad:92.7,ao:102.7,g:10,dr:0,dad:[109.1,100,100,100,90.9,81.8,100,81.8,81.8,81.8],dao:[136.4,109.1,100,100,100,100,109.1,100,81.8,90.9]},
{fid:'1756715284112207',p:'good',c:31,ad:91,ao:94.5,g:3.5,dr:93.1,dad:[93.5,96.8,96.8,90.3,90.3,87.1,87.1,83.9,93.5,90.3],dao:[96.8,100,96.8,96.8,93.5,93.5,90.3,90.3,93.5,93.5]},
{fid:'1756807593112922',p:'average',c:46,ad:87.8,ao:92.8,g:5,dr:88,dad:[87,84.8,82.6,87,82.6,82.6,82.6,91.3,97.8,100],dao:[91.3,89.1,89.1,91.3,87,91.3,84.8,100,102.2,102.2]},
{fid:'1756819711112101',p:'average',c:25,ad:92.8,ao:94,g:1.2,dr:0,dad:[96,96,96,96,96,88,88,88,92,92],dao:[96,96,96,96,96,96,92,88,92,92]},
{fid:'1756820133299305',p:'good',c:33,ad:93,ao:93.6,g:0.6,dr:93.8,dad:[93.9,93.9,97,93.9,97,93.9,93.9,84.8,90.9,90.9],dao:[93.9,93.9,97,93.9,97,97,97,84.8,90.9,90.9]},
{fid:'1756823946112602',p:'good',c:39,ad:96.6,ao:102.8,g:6.2,dr:48.8,dad:[97.4,97.4,97.4,97.4,97.4,92.3,92.3,94.9,100,100],dao:[130.8,97.4,97.4,102.6,100,100,100,100,100,100]},
{fid:'1757241643353966',p:'good',c:13,ad:107.7,ao:113.1,g:5.4,dr:5.9,dad:[107.7,107.7,107.7,92.3,115.4,123.1,123.1,84.6,107.7,107.7],dao:[115.4,107.7,107.7,100,115.4,130.8,123.1,115.4,107.7,107.7]},
{fid:'1757497691112346',p:'average',c:36,ad:38.6,ao:40.6,g:2,dr:100,dad:[88.9,47.2,30.6,27.8,30.6,30.6,30.6,27.8,30.6,41.7],dao:[91.7,58.3,30.6,30.6,30.6,30.6,30.6,30.6,30.6,41.7]},
{fid:'1757855616353530',p:'average',c:15,ad:81.3,ao:86,g:4.7,dr:41.2,dad:[113.3,106.7,93.3,86.7,93.3,93.3,86.7,86.7,20,33.3],dao:[120,106.7,100,86.7,93.3,100,113.3,86.7,20,33.3]},
{fid:'1758185655039910',p:'average',c:69,ad:91.8,ao:95.8,g:4,dr:11.4,dad:[100,100,101.4,87,98.6,88.4,94.2,84.1,76.8,87],dao:[104.3,100,105.8,91.3,100,97.1,94.2,88.4,88.4,88.4]},
{fid:'1758444432039635',p:'good',c:65,ad:95.5,ao:97.2,g:1.7,dr:100,dad:[96.9,95.4,98.5,95.4,96.9,95.4,92.3,95.4,93.8,95.4],dao:[98.5,98.5,98.5,96.9,96.9,95.4,93.8,98.5,96.9,98.5]},
{fid:'1758804985353300',p:'average',c:33,ad:75.8,ao:77.9,g:2.1,dr:57.1,dad:[78.8,81.8,78.8,78.8,81.8,72.7,69.7,75.8,72.7,66.7],dao:[81.8,81.8,78.8,78.8,81.8,75.8,72.7,81.8,75.8,69.7]},
{fid:'1758805585299453',p:'average',c:90,ad:79.7,ao:80.7,g:1,dr:45.2,dad:[80,81.1,78.9,82.2,80,77.8,78.9,78.9,78.9,80],dao:[81.1,81.1,81.1,82.2,81.1,80,78.9,81.1,80,80]},
{fid:'1758812037112123',p:'good',c:32,ad:97.8,ao:101.9,g:4.1,dr:93.8,dad:[96.9,96.9,100,96.9,100,96.9,96.9,96.9,96.9,100],dao:[106.2,100,103.1,103.1,103.1,100,100,100,100,103.1]},
{fid:'1759231201299569',p:'good',c:26,ad:80.8,ao:84.6,g:3.8,dr:78.3,dad:[84.6,84.6,80.8,76.9,84.6,84.6,69.2,80.8,76.9,84.6],dao:[84.6,84.6,84.6,84.6,84.6,84.6,84.6,84.6,84.6,84.6]},
{fid:'1759326695112530',p:'average',c:27,ad:82.2,ao:85.2,g:3,dr:31.8,dad:[88.9,85.2,85.2,85.2,81.5,85.2,81.5,85.2,70.4,74.1],dao:[88.9,88.9,85.2,85.2,85.2,85.2,85.2,85.2,85.2,77.8]},
{fid:'1759651447112089',p:'average',c:25,ad:78,ao:94.4,g:16.4,dr:59.3,dad:[80,76,76,76,76,76,76,76,76,92],dao:[212,76,80,80,80,76,76,76,88,100]},
{fid:'1759657006039687',p:'average',c:10,ad:30,ao:36,g:6,dr:80,dad:[50,40,40,30,30,30,20,20,20,20],dao:[50,60,50,40,40,30,30,20,20,20]},
{fid:'1759669384039698',p:'bad',c:24,ad:94.2,ao:97.1,g:2.9,dr:11.5,dad:[91.7,87.5,100,100,95.8,91.7,100,95.8,87.5,91.7],dao:[100,87.5,100,100,95.8,91.7,100,95.8,100,100]},
{fid:'1759730017299887',p:'average',c:18,ad:87.8,ao:90,g:2.2,dr:11.8,dad:[94.4,94.4,94.4,83.3,88.9,88.9,77.8,83.3,83.3,88.9],dao:[94.4,94.4,94.4,88.9,88.9,88.9,88.9,83.3,88.9,88.9]},
{fid:'1759745245112177',p:'good',c:28,ad:96.8,ao:99.6,g:2.8,dr:3.6,dad:[96.4,96.4,100,89.3,96.4,96.4,100,100,96.4,96.4],dao:[100,96.4,100,100,100,100,100,100,100,100]},
{fid:'1759915962353403',p:'average',c:20,ad:93.5,ao:95,g:1.5,dr:31.6,dad:[95,95,90,90,95,95,90,95,95,95],dao:[100,95,95,90,95,95,95,95,95,95]},
{fid:'1759916089039128',p:'good',c:25,ad:103.2,ao:109.6,g:6.4,dr:37.9,dad:[116,104,104,104,100,104,104,104,104,88],dao:[148,104,112,104,104,104,108,104,104,104]},
{fid:'1760255271299118',p:'average',c:20,ad:99,ao:104.5,g:5.5,dr:8.7,dad:[105,95,100,100,100,95,95,105,95,100],dao:[115,105,100,100,110,105,95,105,105,105]},
{fid:'1760448505353704',p:'good',c:35,ad:90.8,ao:91.4,g:0.6,dr:15.6,dad:[94.3,91.4,91.4,88.6,91.4,91.4,91.4,88.6,88.6,91.4],dao:[94.3,91.4,91.4,88.6,91.4,91.4,91.4,91.4,91.4,91.4]},
{fid:'1760507839299438',p:'good',c:22,ad:95.9,ao:97.3,g:1.4,dr:27.3,dad:[100,100,100,95.5,100,100,90.9,90.9,86.4,95.5],dao:[100,100,100,100,100,100,90.9,95.5,90.9,95.5]},
{fid:'1761131847039718',p:'good',c:40,ad:93.5,ao:94.2,g:0.7,dr:42.1,dad:[90,92.5,95,92.5,97.5,95,95,90,92.5,95],dao:[90,92.5,95,92.5,97.5,95,95,95,92.5,97.5]},
{fid:'1761132848353075',p:'average',c:25,ad:87.2,ao:88.4,g:1.2,dr:4.3,dad:[84,80,88,84,92,88,88,88,88,92],dao:[88,80,88,88,92,92,88,88,88,92]},
{fid:'1761138572299048',p:'bad',c:25,ad:97.2,ao:97.6,g:0.4,dr:100,dad:[96,100,100,92,96,92,96,100,100,100],dao:[96,100,100,92,96,92,100,100,100,100]},
{fid:'1761138738299544',p:'average',c:27,ad:96.3,ao:99.3,g:3,dr:100,dad:[96.3,96.3,100,81.5,100,100,100,100,92.6,96.3],dao:[96.3,100,100,100,100,100,100,100,100,96.3]},
{fid:'1761200170112703',p:'average',c:30,ad:86.7,ao:90,g:3.3,dr:85.7,dad:[86.7,86.7,86.7,90,93.3,86.7,86.7,80,83.3,86.7],dao:[93.3,86.7,86.7,93.3,93.3,93.3,90,83.3,86.7,93.3]},
{fid:'1761200325353714',p:'average',c:15,ad:148.7,ao:155.3,g:6.6,dr:12.5,dad:[160,160,146.7,146.7,153.3,153.3,146.7,140,140,140],dao:[166.7,173.3,146.7,153.3,153.3,160,153.3,146.7,146.7,153.3]},
{fid:'1761227213112065',p:'bad',c:19,ad:67.9,ao:74.2,g:6.3,dr:100,dad:[73.7,78.9,73.7,68.4,68.4,68.4,63.2,52.6,57.9,73.7],dao:[78.9,78.9,78.9,73.7,73.7,73.7,68.4,73.7,63.2,78.9]},
{fid:'1761465525039327',p:'good',c:23,ad:92.6,ao:97.9,g:5.3,dr:100,dad:[82.6,91.3,91.3,95.7,91.3,95.7,95.7,91.3,95.7,95.7],dao:[113,91.3,95.7,100,95.7,95.7,100,95.7,95.7,95.7]},
{fid:'1761471807299132',p:'average',c:23,ad:97.9,ao:98.3,g:0.4,dr:30.4,dad:[100,95.7,95.7,100,100,100,100,95.7,95.7,95.7],dao:[104.3,95.7,95.7,100,100,100,100,95.7,95.7,95.7]},
{fid:'1761491709353866',p:'bad',c:10,ad:97,ao:98,g:1,dr:0,dad:[100,100,100,90,100,100,90,90,100,100],dao:[110,100,100,90,100,100,90,90,100,100]},
{fid:'1761576730039283',p:'good',c:130,ad:92.3,ao:94.4,g:2.1,dr:13.6,dad:[95.4,94.6,95.4,89.2,93.8,93.1,91.5,89.2,90.8,90],dao:[96.9,95.4,95.4,94.6,95.4,93.1,93.1,93.1,94.6,92.3]},
{fid:'1761641292353628',p:'average',c:20,ad:91.5,ao:93,g:1.5,dr:15,dad:[80,95,95,95,95,95,95,95,85,85],dao:[85,95,95,95,95,100,95,95,85,90]},
{fid:'1761748701353054',p:'good',c:22,ad:90,ao:90.9,g:0.9,dr:5,dad:[95.5,90.9,90.9,90.9,90.9,90.9,90.9,86.4,86.4,86.4],dao:[95.5,90.9,90.9,90.9,90.9,90.9,90.9,90.9,90.9,86.4]},
{fid:'1761748797353921',p:'good',c:72,ad:98.6,ao:99.9,g:1.3,dr:58.1,dad:[95.8,97.2,95.8,100,100,98.6,97.2,101.4,100,100],dao:[95.8,97.2,95.8,101.4,101.4,101.4,101.4,102.8,101.4,100]},
{fid:'1762242620299772',p:'average',c:21,ad:95.7,ao:101,g:5.3,dr:95.5,dad:[104.8,104.8,95.2,95.2,90.5,90.5,100,85.7,95.2,95.2],dao:[104.8,104.8,104.8,100,95.2,100,100,100,100,100]},
{fid:'1762250971112919',p:'average',c:25,ad:98.4,ao:102.8,g:4.4,dr:11.5,dad:[104,104,104,96,100,88,88,100,104,96],dao:[128,104,104,100,100,92,88,104,104,104]},
{fid:'1762264951112665',p:'good',c:30,ad:81.3,ao:83.3,g:2,dr:25.9,dad:[86.7,86.7,86.7,83.3,83.3,83.3,76.7,80,76.7,70],dao:[90,86.7,86.7,83.3,83.3,83.3,80,83.3,80,76.7]},
{fid:'1762339529299852',p:'average',c:20,ad:89.5,ao:95.5,g:6,dr:100,dad:[95,95,95,95,80,75,80,90,90,100],dao:[105,95,95,95,100,90,85,95,95,100]},
{fid:'1762424478353154',p:'average',c:16,ad:93.8,ao:98.8,g:5,dr:100,dad:[93.8,100,100,100,100,100,100,93.8,81.2,68.8],dao:[93.8,100,100,100,100,100,100,100,100,93.8]},
{fid:'1762667657039196',p:'good',c:20,ad:79.5,ao:85.5,g:6,dr:11.1,dad:[85,85,85,65,85,80,85,60,80,85],dao:[95,85,85,70,85,85,85,85,90,90]},
{fid:'1762776235112703',p:'new',c:30,ad:98.7,ao:98.7,g:0,dr:100,dad:[90,100,100,100,100,100,100,96.7,100,100],dao:[86.7,100,100,100,100,100,100,100,100,100]},
{fid:'1762860208112834',p:'average',c:21,ad:60,ao:62.4,g:2.4,dr:0,dad:[95.2,76.2,76.2,71.4,57.1,38.1,61.9,23.8,33.3,66.7],dao:[100,76.2,81,71.4,57.1,38.1,66.7,23.8,33.3,76.2]},
{fid:'1762865510299363',p:'average',c:15,ad:89.3,ao:92,g:2.7,dr:35.7,dad:[93.3,93.3,86.7,93.3,93.3,86.7,93.3,80,86.7,86.7],dao:[93.3,93.3,93.3,93.3,93.3,93.3,93.3,93.3,86.7,86.7]},
{fid:'1762867070353093',p:'average',c:15,ad:79.3,ao:86.7,g:7.4,dr:46.2,dad:[93.3,93.3,73.3,66.7,86.7,73.3,66.7,86.7,73.3,80],dao:[100,93.3,80,86.7,93.3,73.3,80,86.7,86.7,86.7]},
{fid:'1762942864299719',p:'good',c:21,ad:71.4,ao:74.3,g:2.9,dr:18.8,dad:[76.2,76.2,76.2,57.1,71.4,71.4,76.2,61.9,71.4,76.2],dao:[76.2,76.2,76.2,71.4,76.2,71.4,76.2,66.7,76.2,76.2]},
{fid:'1762949701039984',p:'good',c:32,ad:92.5,ao:94.7,g:2.2,dr:16.1,dad:[93.8,93.8,93.8,90.6,93.8,90.6,90.6,93.8,90.6,93.8],dao:[96.9,96.9,93.8,90.6,93.8,93.8,93.8,96.9,96.9,93.8]},
{fid:'1762949806112858',p:'bad',c:19,ad:93.2,ao:97.4,g:4.2,dr:0,dad:[115.8,78.9,89.5,89.5,89.5,94.7,94.7,94.7,89.5,94.7],dao:[121.1,89.5,94.7,94.7,94.7,94.7,94.7,100,94.7,94.7]},
{fid:'1763445167353013',p:'good',c:37,ad:81.6,ao:83.3,g:1.7,dr:12.1,dad:[83.8,83.8,81.1,78.4,81.1,81.1,81.1,83.8,81.1,81.1],dao:[83.8,83.8,83.8,81.1,86.5,83.8,83.8,83.8,81.1,81.1]},
{fid:'1763473638353750',p:'average',c:20,ad:109.5,ao:112,g:2.5,dr:0,dad:[105,115,115,110,110,100,105,105,115,115],dao:[115,115,115,110,115,105,105,110,115,115]},
{fid:'1763479611299802',p:'average',c:15,ad:104,ao:108.7,g:4.7,dr:88.2,dad:[113.3,100,106.7,106.7,100,100,106.7,100,106.7,100],dao:[140,100,106.7,106.7,100,100,106.7,106.7,106.7,113.3]},
{fid:'1763556451353175',p:'average',c:25,ad:94.8,ao:95.6,g:0.8,dr:0,dad:[96,96,92,92,96,96,96,96,96,92],dao:[96,96,96,92,96,96,96,96,96,96]},
{fid:'1763622561039897',p:'new',c:60,ad:94.5,ao:96.5,g:2,dr:98.1,dad:[96.7,98.3,100,100,90,98.3,96.7,95,85,85],dao:[96.7,100,100,100,90,98.3,98.3,100,93.3,88.3]},
{fid:'1763979493112705',p:'average',c:32,ad:80.6,ao:84.4,g:3.8,dr:80,dad:[84.4,81.2,84.4,81.2,78.1,75,78.1,78.1,81.2,84.4],dao:[90.6,81.2,84.4,84.4,84.4,81.2,81.2,81.2,87.5,87.5]},
{fid:'1764143269039832',p:'average',c:15,ad:97.3,ao:103.3,g:6,dr:46.7,dad:[100,100,93.3,86.7,93.3,100,100,100,100,100],dao:[133.3,100,100,100,100,100,100,100,100,100]},
{fid:'1764163198039470',p:'average',c:25,ad:90,ao:93.6,g:3.6,dr:44,dad:[80,88,88,92,92,84,92,92,96,96],dao:[100,88,92,92,92,88,92,96,100,96]},
{fid:'1764164047039488',p:'average',c:25,ad:93.6,ao:95.2,g:1.6,dr:4.3,dad:[100,96,96,96,92,92,92,92,88,92],dao:[100,96,96,96,92,96,96,96,92,92]},
{fid:'1764230497039387',p:'average',c:22,ad:96.4,ao:101.8,g:5.4,dr:95.8,dad:[90.9,90.9,90.9,100,104.5,100,95.5,95.5,95.5,100],dao:[104.5,90.9,90.9,109.1,109.1,100,109.1,104.5,95.5,104.5]},
{fid:'1764230711299723',p:'average',c:50,ad:81.2,ao:82,g:0.8,dr:95.6,dad:[68,72,80,80,82,86,84,84,86,90],dao:[74,72,82,80,82,86,84,84,86,90]},
{fid:'1764230811112357',p:'average',c:20,ad:88,ao:102.5,g:14.5,dr:5,dad:[90,95,90,95,85,95,85,95,80,70],dao:[145,95,100,100,100,100,95,100,95,95]},
{fid:'1764239990039692',p:'new',c:30,ad:89.3,ao:90.7,g:1.4,dr:100,dad:[83.3,83.3,83.3,83.3,96.7,96.7,96.7,80,93.3,96.7],dao:[83.3,83.3,83.3,83.3,96.7,96.7,96.7,90,93.3,100]},
{fid:'1764248042039231',p:'bad',c:19,ad:104.7,ao:107.9,g:3.2,dr:9.1,dad:[110.5,110.5,100,100,110.5,100,110.5,100,100,105.3],dao:[115.8,110.5,105.3,110.5,110.5,110.5,110.5,100,100,105.3]},
{fid:'1764255678353382',p:'average',c:14,ad:99.3,ao:102.1,g:2.8,dr:35.7,dad:[100,100,100,100,100,100,100,100,100,92.9],dao:[121.4,100,100,100,100,100,100,100,100,100]},
{fid:'1764256590299410',p:'average',c:40,ad:89,ao:89.8,g:0.8,dr:8.3,dad:[90,87.5,90,90,87.5,90,90,90,85,90],dao:[90,90,90,90,90,90,90,90,87.5,90]},
{fid:'1764497110299774',p:'average',c:27,ad:88.2,ao:90.4,g:2.2,dr:66.7,dad:[77.8,77.8,88.9,77.8,85.2,92.6,96.3,96.3,96.3,92.6],dao:[88.9,81.5,88.9,81.5,88.9,92.6,96.3,96.3,96.3,92.6]},
{fid:'1764497767112219',p:'good',c:26,ad:88.9,ao:90.8,g:1.9,dr:68,dad:[88.5,88.5,88.5,80.8,88.5,92.3,92.3,88.5,88.5,92.3],dao:[88.5,88.5,88.5,84.6,88.5,92.3,92.3,92.3,96.2,96.2]},
{fid:'1764499368299890',p:'average',c:20,ad:81,ao:81.5,g:0.5,dr:27.8,dad:[80,85,85,75,65,80,85,90,85,80],dao:[85,85,85,75,65,80,85,90,85,80]},
{fid:'1764745985039216',p:'average',c:25,ad:92,ao:97.2,g:5.2,dr:100,dad:[88,88,96,100,96,96,92,84,88,92],dao:[88,88,100,100,96,96,100,104,96,104]},
{fid:'1764756801039832',p:'average',c:44,ad:97.5,ao:102,g:4.5,dr:86.7,dad:[100,100,100,95.5,95.5,97.7,90.9,97.7,100,97.7],dao:[102.3,102.3,102.3,97.7,100,104.5,97.7,102.3,109.1,102.3]},
{fid:'1766398323039046',p:'good',c:22,ad:95,ao:98.7,g:3.7,dr:100,dad:[90.9,90.9,100,95.5,95.5,95.5,95.5,95.5,95.5,95.5],dao:[122.7,90.9,104.5,95.5,95.5,95.5,95.5,95.5,95.5,95.5]},
{fid:'1766759626112588',p:'average',c:42,ad:100,ao:106.4,g:6.4,dr:17.8,dad:[100,100,102.4,92.9,97.6,102.4,100,97.6,107.1,100],dao:[109.5,102.4,107.1,104.8,107.1,107.1,107.1,104.8,107.1,107.1]},
{fid:'1768230240353091',p:'new',c:31,ad:89.4,ao:91.3,g:1.9,dr:100,dad:[3.2,100,103.2,100,100,96.8,100,96.8,96.8,96.8],dao:[6.5,100,103.2,100,100,100,100,100,100,103.2]},
{fid:'1769079783039953',p:'new',c:30,ad:100,ao:100,g:0,dr:100,dad:[100,100,100,100,93.3,103.3,103.3,93.3,103.3,103.3],dao:[100,100,100,100,93.3,103.3,103.3,93.3,103.3,103.3]},
{fid:'1723116238299225',p:'average',c:15,ad:98,ao:100,g:2,dr:0,dad:[100,100,100,93.3,100,100,100,100,93.3,93.3],dao:[100,100,100,100,100,100,100,100,100,100]},
{fid:'1726475969353081',p:'good',c:75,ad:98.8,ao:100.3,g:1.5,dr:57.3,dad:[100,98.7,101.3,98.7,98.7,100,97.3,98.7,97.3,97.3],dao:[105.3,101.3,101.3,100,100,100,98.7,100,98.7,97.3]},
{fid:'1726491045299602',p:'bad',c:25,ad:110,ao:116,g:6,dr:44.8,dad:[116,116,116,116,116,112,108,100,100,100],dao:[160,116,116,116,116,112,112,112,100,100]},
{fid:'1727959868353755',p:'average',c:30,ad:108.3,ao:112,g:3.7,dr:73.5,dad:[113.3,113.3,113.3,113.3,113.3,113.3,113.3,100,96.7,93.3],dao:[133.3,113.3,113.3,113.3,113.3,113.3,113.3,110,100,96.7]},
{fid:'1728207891353774',p:'average',c:90,ad:99.7,ao:100.9,g:1.2,dr:22,dad:[103.3,101.1,101.1,98.9,98.9,98.9,100,100,97.8,96.7],dao:[103.3,101.1,101.1,101.1,101.1,101.1,101.1,100,101.1,97.8]},
{fid:'1762166475299708',p:'good',c:30,ad:98.3,ao:99,g:0.7,dr:93.9,dad:[90,100,100,100,96.7,100,100,96.7,100,100],dao:[90,100,100,100,100,100,100,100,100,100]},
{fid:'1762670804039587',p:'average',c:20,ad:109.5,ao:113,g:3.5,dr:42.9,dad:[120,120,115,115,115,115,105,95,95,100],dao:[140,120,115,115,115,115,110,105,95,100]},
{fid:'1765097343299500',p:'bad',c:15,ad:104.7,ao:106.7,g:2,dr:56.7,dad:[106.7,106.7,106.7,106.7,106.7,106.7,100,93.3,106.7,106.7],dao:[106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7]},
{fid:'1749041184112621',p:'average',c:15,ad:96,ao:98,g:2,dr:66.7,dad:[100,93.3,93.3,73.3,100,100,100,100,100,100],dao:[100,93.3,93.3,93.3,100,100,100,100,100,100]},
{fid:'1749988591039031',p:'good',c:25,ad:100,ao:100.8,g:0.8,dr:76,dad:[104,100,100,100,100,100,100,96,100,100],dao:[108,100,100,100,100,100,100,100,100,100]},
{fid:'1750656168299700',p:'good',c:40,ad:100,ao:101.2,g:1.2,dr:100,dad:[102.5,100,100,100,100,100,100,97.5,100,100],dao:[112.5,100,100,100,100,100,100,100,100,100]},
{fid:'1754480983039245',p:'good',c:35,ad:93.7,ao:94.3,g:0.6,dr:100,dad:[100,100,97.1,100,94.3,91.4,97.1,97.1,91.4,68.6],dao:[100,100,97.1,100,94.3,94.3,97.1,97.1,94.3,68.6]},
{fid:'1754489297039709',p:'good',c:24,ad:98.7,ao:100.4,g:1.7,dr:75,dad:[100,100,95.8,100,95.8,100,100,100,95.8,100],dao:[100,100,100,100,100,100,104.2,100,100,100]},
{fid:'1755692566039641',p:'average',c:15,ad:90.7,ao:93.3,g:2.6,dr:73.3,dad:[93.3,86.7,93.3,86.7,80,93.3,86.7,93.3,93.3,100],dao:[106.7,86.7,93.3,86.7,80,93.3,86.7,100,100,100]},
{fid:'1756131375299136',p:'good',c:25,ad:98.8,ao:102.4,g:3.6,dr:88,dad:[100,100,100,100,100,100,100,96,92,100],dao:[128,100,100,100,100,100,100,96,100,100]},
{fid:'1757505629112786',p:'good',c:25,ad:102.8,ao:104.4,g:1.6,dr:100,dad:[104,104,108,100,100,100,100,104,104,104],dao:[116,104,108,104,100,100,100,104,104,104]},
{fid:'1757919719299451',p:'good',c:39,ad:101.3,ao:102.1,g:0.8,dr:95,dad:[102.6,102.6,102.6,102.6,100,102.6,102.6,100,94.9,102.6],dao:[105.1,102.6,102.6,102.6,102.6,102.6,102.6,100,97.4,102.6]},
{fid:'1749622527039126',p:'good',c:15,ad:98.7,ao:102,g:3.3,dr:92.9,dad:[100,106.7,106.7,100,106.7,93.3,100,86.7,93.3,93.3],dao:[113.3,106.7,106.7,100,106.7,93.3,106.7,100,93.3,93.3]},
{fid:'1750589916299072',p:'good',c:35,ad:94.8,ao:97.1,g:2.3,dr:21.4,dad:[100,97.1,97.1,97.1,100,97.1,88.6,97.1,97.1,77.1],dao:[102.9,97.1,97.1,97.1,100,97.1,97.1,105.7,100,77.1]},
{fid:'1750854948112276',p:'good',c:88,ad:99.4,ao:99.9,g:0.5,dr:94.4,dad:[100,101.1,101.1,100,98.9,101.1,100,96.6,98.9,96.6],dao:[100,102.3,101.1,100,101.1,101.1,101.1,97.7,97.7,96.6]},
{fid:'1755178746039784',p:'good',c:16,ad:84.4,ao:88.1,g:3.7,dr:78.6,dad:[93.8,81.2,93.8,87.5,87.5,87.5,87.5,81.2,87.5,56.2],dao:[93.8,87.5,93.8,93.8,87.5,87.5,87.5,87.5,87.5,75]},
{fid:'1757337517299478',p:'good',c:18,ad:97.8,ao:101.7,g:3.9,dr:38.9,dad:[100,100,100,100,100,100,88.9,94.4,100,94.4],dao:[116.7,100,100,100,100,100,100,100,100,100]},
{fid:'1731511775112065',p:'good',c:35,ad:103.4,ao:104.9,g:1.5,dr:2.7,dad:[105.7,105.7,105.7,105.7,97.1,102.9,102.9,100,102.9,105.7],dao:[105.7,105.7,105.7,105.7,105.7,105.7,102.9,102.9,102.9,105.7]},
{fid:'1731589445039174',p:'average',c:91,ad:92.4,ao:97.4,g:5,dr:83.5,dad:[96.7,97.8,98.9,95.6,94.5,96.7,92.3,83.5,80.2,87.9],dao:[100,98.9,98.9,97.8,96.7,96.7,94.5,96.7,97.8,95.6]},
{fid:'1731853501353563',p:'average',c:20,ad:80.5,ao:80.5,g:0,dr:41.2,dad:[80,85,85,80,80,85,80,75,80,75],dao:[80,85,85,80,80,85,80,75,80,75]},
{fid:'1731859360299952',p:'good',c:25,ad:70.4,ao:74,g:3.6,dr:42.1,dad:[76,76,76,60,64,76,76,60,64,76],dao:[88,76,76,60,76,72,76,68,72,76]},
{fid:'1731928103039556',p:'good',c:30,ad:88.7,ao:89.3,g:0.6,dr:35.7,dad:[93.3,90,93.3,76.7,90,90,90,93.3,83.3,86.7],dao:[93.3,90,93.3,80,90,90,90,93.3,86.7,86.7]},
{fid:'1731930815353380',p:'average',c:16,ad:74.4,ao:77.5,g:3.1,dr:0,dad:[81.2,81.2,75,75,68.8,75,75,68.8,75,68.8],dao:[81.2,81.2,81.2,81.2,75,81.2,81.2,68.8,75,68.8]},
{fid:'1731997868112317',p:'average',c:33,ad:90.6,ao:92.1,g:1.5,dr:75.8,dad:[90.9,87.9,93.9,93.9,100,100,87.9,84.8,81.8,84.8],dao:[90.9,90.9,93.9,93.9,100,100,90.9,87.9,84.8,87.9]},
{fid:'1731998450112448',p:'average',c:61,ad:100.6,ao:102.3,g:1.7,dr:16.1,dad:[104.9,101.6,101.6,91.8,101.6,101.6,101.6,98.4,101.6,101.6],dao:[116.4,101.6,101.6,93.4,101.6,101.6,101.6,101.6,101.6,101.6]},
{fid:'1732011430353974',p:'good',c:63,ad:97.6,ao:100.6,g:3,dr:81.8,dad:[96.8,100,98.4,96.8,98.4,100,95.2,92.1,96.8,101.6],dao:[96.8,103.2,98.4,101.6,100,100,100,101.6,103.2,101.6]},
{fid:'1732102833039790',p:'good',c:70,ad:92.3,ao:93.3,g:1,dr:18.2,dad:[92.9,92.9,91.4,87.1,94.3,94.3,94.3,91.4,92.9,91.4],dao:[92.9,94.3,91.4,90,94.3,94.3,94.3,92.9,94.3,94.3]},
{fid:'1732103573112219',p:'average',c:50,ad:98.4,ao:99.6,g:1.2,dr:29.2,dad:[102,100,100,100,100,100,98,98,94,92],dao:[110,100,100,100,100,100,100,100,94,92]},
{fid:'1732115766299260',p:'average',c:18,ad:90.5,ao:93.9,g:3.4,dr:17.6,dad:[94.4,100,88.9,94.4,88.9,88.9,88.9,94.4,77.8,88.9],dao:[122.2,100,88.9,94.4,94.4,88.9,88.9,94.4,77.8,88.9]},
{fid:'1732178203353605',p:'average',c:45,ad:98.2,ao:99.6,g:1.4,dr:65.2,dad:[100,100,100,93.3,95.6,100,97.8,100,97.8,97.8],dao:[102.2,100,100,97.8,95.6,102.2,97.8,102.2,97.8,100]},
{fid:'1732197408299622',p:'average',c:85,ad:97.8,ao:98.5,g:0.7,dr:45.9,dad:[100,100,100,94.1,96.5,97.6,100,95.3,96.5,97.6],dao:[102.4,100,100,95.3,97.6,98.8,100,96.5,96.5,97.6]},
{fid:'1732619295299383',p:'average',c:112,ad:97.6,ao:98.8,g:1.2,dr:31.2,dad:[98.2,100,100.9,91.1,100.9,100,100,91.1,97.3,96.4],dao:[104.5,100,100.9,94.6,100.9,100,100,92,98.2,97.3]},
{fid:'1733383442353779',p:'average',c:56,ad:96.4,ao:97.3,g:0.9,dr:10.7,dad:[98.2,100,98.2,94.6,96.4,98.2,94.6,96.4,94.6,92.9],dao:[101.8,100,98.2,94.6,96.4,98.2,96.4,96.4,94.6,96.4]},
{fid:'1733398120039648',p:'average',c:96,ad:93,ao:95.1,g:2.1,dr:78.1,dad:[97.9,96.9,94.8,87.5,92.7,96.9,92.7,87.5,90.6,92.7],dao:[103.1,99,94.8,88.5,93.8,97.9,96.9,89.6,92.7,94.8]},
{fid:'1733399776299924',p:'good',c:30,ad:97.7,ao:98.7,g:1,dr:100,dad:[96.7,100,100,100,100,96.7,100,96.7,96.7,90],dao:[96.7,100,100,100,100,96.7,100,100,100,93.3]},
{fid:'1733727557112280',p:'average',c:18,ad:85.6,ao:91.6,g:6,dr:58.8,dad:[88.9,88.9,88.9,88.9,88.9,77.8,77.8,88.9,83.3,83.3],dao:[100,94.4,94.4,88.9,94.4,83.3,83.3,94.4,94.4,88.9]},
{fid:'1733738033112486',p:'good',c:25,ad:96,ao:102,g:6,dr:96.2,dad:[96,96,100,100,100,104,96,88,92,88],dao:[108,100,104,104,100,104,104,100,100,96]},
{fid:'1733751429353729',p:'good',c:30,ad:93.4,ao:95.7,g:2.3,dr:73.3,dad:[96.7,96.7,96.7,90,96.7,90,96.7,90,86.7,93.3],dao:[106.7,96.7,96.7,90,96.7,93.3,96.7,96.7,90,93.3]},
{fid:'1733817235112702',p:'average',c:44,ad:100,ao:101.4,g:1.4,dr:95.7,dad:[97.7,97.7,95.5,100,100,100,102.3,102.3,102.3,102.3],dao:[100,97.7,95.5,100,102.3,102.3,102.3,104.5,104.5,104.5]},
{fid:'1734285249112973',p:'good',c:28,ad:97.5,ao:98.6,g:1.1,dr:100,dad:[100,92.9,100,100,100,96.4,96.4,96.4,92.9,100],dao:[107.1,92.9,100,100,100,96.4,96.4,96.4,96.4,100]},
{fid:'1734342196299775',p:'good',c:110,ad:96.9,ao:98.6,g:1.7,dr:44.5,dad:[97.3,99.1,97.3,94.5,95.5,96.4,97.3,94.5,99.1,98.2],dao:[103.6,99.1,99.1,95.5,97.3,98.2,98.2,97.3,99.1,98.2]},
{fid:'1734355405112404',p:'average',c:41,ad:91.7,ao:94.6,g:2.9,dr:100,dad:[97.6,95.1,92.7,92.7,95.1,95.1,87.8,87.8,82.9,90.2],dao:[100,97.6,97.6,92.7,95.1,95.1,90.2,90.2,92.7,95.1]},
{fid:'1734438974299682',p:'average',c:47,ad:95.1,ao:97,g:1.9,dr:83,dad:[97.9,100,100,89.4,93.6,97.9,100,83,97.9,91.5],dao:[97.9,100,100,97.9,93.6,97.9,100,87.2,97.9,97.9]},
{fid:'1734527544039834',p:'good',c:47,ad:97.2,ao:100,g:2.8,dr:100,dad:[100,100,100,95.7,95.7,100,97.9,93.6,93.6,95.7],dao:[112.8,100,100,100,95.7,100,97.9,100,95.7,97.9]},
{fid:'1734603474112774',p:'good',c:56,ad:102.2,ao:103.6,g:1.4,dr:37.9,dad:[103.6,103.6,103.6,101.8,101.8,101.8,103.6,98.2,103.6,100],dao:[107.1,103.6,103.6,101.8,101.8,103.6,103.6,103.6,103.6,103.6]},
{fid:'1734606779112538',p:'good',c:13,ad:109.2,ao:112.3,g:3.1,dr:93.3,dad:[115.4,115.4,100,107.7,107.7,107.7,107.7,107.7,107.7,115.4],dao:[130.8,115.4,107.7,107.7,107.7,107.7,107.7,107.7,115.4,115.4]},
{fid:'1734638085353331',p:'average',c:42,ad:100,ao:100.2,g:0.2,dr:0,dad:[102.4,100,100,100,100,100,100,100,97.6,100],dao:[102.4,100,100,100,100,100,100,100,100,100]},
{fid:'1735218625039437',p:'good',c:25,ad:92.4,ao:93.2,g:0.8,dr:70.8,dad:[100,96,96,96,96,96,96,80,76,92],dao:[100,96,96,96,96,96,96,84,80,92]},
{fid:'1735383729353592',p:'average',c:50,ad:99.8,ao:100.8,g:1,dr:98,dad:[104,100,100,100,98,100,100,96,100,100],dao:[110,102,100,100,100,100,100,96,100,100]},
{fid:'1736060952112110',p:'good',c:25,ad:101.2,ao:102.4,g:1.2,dr:23.1,dad:[104,100,104,104,104,104,100,100,100,92],dao:[108,100,104,104,104,104,100,104,100,96]},
{fid:'1736088691112087',p:'good',c:42,ad:98.3,ao:99.8,g:1.5,dr:23.3,dad:[100,100,100,90.5,97.6,102.4,100,97.6,97.6,97.6],dao:[104.8,102.4,100,92.9,100,102.4,100,100,97.6,97.6]},
{fid:'1736143339039952',p:'good',c:49,ad:96.5,ao:98.6,g:2.1,dr:10,dad:[100,98,98,91.8,95.9,100,95.9,93.9,98,93.9],dao:[102,98,100,91.8,95.9,102,100,100,98,98]},
{fid:'1736169691299249',p:'average',c:131,ad:99.2,ao:100.1,g:0.9,dr:62.7,dad:[100.8,100,98.5,96.2,99.2,98.5,99.2,98.5,100.8,100.8],dao:[106.1,100.8,100,96.9,99.2,98.5,99.2,98.5,100.8,100.8]},
{fid:'1736258830039781',p:'average',c:90,ad:97.4,ao:98.5,g:1.1,dr:100,dad:[102.2,98.9,98.9,95.6,97.8,101.1,100,94.4,91.1,94.4],dao:[105.6,98.9,98.9,95.6,98.9,101.1,100,96.7,93.3,95.6]},
{fid:'1736411925112046',p:'average',c:24,ad:90,ao:90,g:0,dr:86.4,dad:[91.7,91.7,87.5,87.5,91.7,91.7,87.5,91.7,91.7,87.5],dao:[91.7,91.7,87.5,87.5,91.7,91.7,87.5,91.7,91.7,87.5]},
{fid:'1737373695039395',p:'average',c:30,ad:93.3,ao:96.7,g:3.4,dr:56.7,dad:[100,100,100,86.7,96.7,100,96.7,73.3,93.3,86.7],dao:[113.3,100,100,90,96.7,100,96.7,83.3,96.7,90]},
{fid:'1737455496112775',p:'average',c:60,ad:96.2,ao:97.2,g:1,dr:70,dad:[101.7,100,100,91.7,95,95,100,86.7,93.3,98.3],dao:[101.7,100,100,93.3,95,95,100,90,98.3,98.3]},
{fid:'1737548906112402',p:'average',c:20,ad:92.5,ao:96.5,g:4,dr:0,dad:[90,100,100,80,90,90,95,95,90,95],dao:[110,100,100,90,100,85,95,95,95,95]},
{fid:'1737807169112177',p:'good',c:92,ad:90.4,ao:91.2,g:0.8,dr:100,dad:[90.2,92.4,90.2,90.2,89.1,90.2,88,90.2,91.3,92.4],dao:[92.4,92.4,92.4,90.2,90.2,91.3,89.1,90.2,91.3,92.4]},
{fid:'1737999751299286',p:'average',c:42,ad:99,ao:101,g:2,dr:100,dad:[97.6,97.6,102.4,100,100,97.6,95.2,102.4,100,97.6],dao:[104.8,100,102.4,102.4,100,100,97.6,102.4,100,100]},
{fid:'1738052618112050',p:'good',c:100,ad:92.4,ao:95.4,g:3,dr:66.7,dad:[93,97,98,95,100,91,89,88,85,88],dao:[99,100,100,98,100,96,91,90,89,91]},
{fid:'1738053229299847',p:'good',c:28,ad:97.9,ao:100.4,g:2.5,dr:72.4,dad:[96.4,100,92.9,100,100,92.9,100,100,96.4,100],dao:[107.1,100,100,100,100,96.4,100,100,100,100]},
{fid:'1738417641299806',p:'good',c:28,ad:95,ao:97.8,g:2.8,dr:42.9,dad:[96.4,96.4,96.4,96.4,96.4,96.4,96.4,89.3,85.7,100],dao:[103.6,100,96.4,96.4,96.4,96.4,96.4,96.4,96.4,100]},
{fid:'1738660829353845',p:'good',c:26,ad:97.3,ao:100,g:2.7,dr:23.1,dad:[100,100,100,100,100,100,96.2,92.3,92.3,92.3],dao:[103.8,100,100,100,100,100,100,100,96.2,100]},
{fid:'1738666930299259',p:'good',c:132,ad:96.9,ao:99.6,g:2.7,dr:100,dad:[99.2,99.2,98.5,94.7,97,98.5,99.2,93.2,93.9,95.5],dao:[104.5,100.8,100,97,98.5,100,100.8,97.7,97.7,98.5]},
{fid:'1738756317112251',p:'average',c:25,ad:91.6,ao:94.8,g:3.2,dr:96,dad:[92,92,96,88,96,96,76,96,96,88],dao:[104,92,96,92,96,96,88,96,96,92]},
{fid:'1738864524039109',p:'average',c:60,ad:91.8,ao:93.7,g:1.9,dr:62.7,dad:[98.3,98.3,95,78.3,91.7,93.3,90,90,91.7,91.7],dao:[106.7,100,95,81.7,91.7,93.3,91.7,91.7,93.3,91.7]},
{fid:'1739185585039397',p:'good',c:35,ad:106,ao:107.7,g:1.7,dr:76.9,dad:[108.6,105.7,102.9,105.7,105.7,108.6,108.6,102.9,108.6,102.9],dao:[117.1,105.7,102.9,105.7,105.7,108.6,108.6,105.7,108.6,108.6]},
{fid:'1739683554353020',p:'average',c:31,ad:96.5,ao:98.4,g:1.9,dr:77.4,dad:[93.5,96.8,96.8,96.8,96.8,100,96.8,96.8,100,90.3],dao:[103.2,96.8,96.8,96.8,96.8,100,100,96.8,100,96.8]},
{fid:'1739939910039794',p:'average',c:25,ad:81.6,ao:84,g:2.4,dr:0,dad:[88,88,88,68,76,84,76,80,84,84],dao:[96,92,88,76,72,84,76,84,88,84]},
{fid:'1748782592039565',p:'good',c:30,ad:87.7,ao:89,g:1.3,dr:48.6,dad:[103.3,103.3,106.7,80,60,66.7,66.7,93.3,96.7,100],dao:[103.3,103.3,106.7,86.7,66.7,66.7,66.7,93.3,96.7,100]},
{fid:'1754895433112901',p:'good',c:45,ad:94.7,ao:95.6,g:0.9,dr:84.1,dad:[93.3,95.6,100,97.8,97.8,95.6,91.1,93.3,88.9,93.3],dao:[93.3,97.8,100,97.8,97.8,95.6,91.1,93.3,93.3,95.6]},
{fid:'1754911715353317',p:'good',c:57,ad:99.3,ao:99.3,g:0,dr:100,dad:[100,100,98.2,100,100,98.2,98.2,100,100,98.2],dao:[100,100,98.2,100,100,98.2,98.2,100,100,98.2]},
{fid:'1754977361039175',p:'good',c:90,ad:91.4,ao:93,g:1.6,dr:82.8,dad:[87.8,86.7,84.4,83.3,96.7,95.6,94.4,92.2,95.6,97.8],dao:[95.6,87.8,84.4,83.3,97.8,96.7,95.6,94.4,96.7,97.8]},
{fid:'1755156488299241',p:'average',c:30,ad:99.3,ao:101.3,g:2,dr:0,dad:[100,100,100,96.7,100,100,96.7,100,100,100],dao:[113.3,100,100,100,100,100,100,100,100,100]},
{fid:'1755518548039360',p:'bad',c:20,ad:98.5,ao:99,g:0.5,dr:95,dad:[100,100,100,100,100,100,100,95,90,100],dao:[100,105,100,100,100,100,100,95,90,100]},
{fid:'1755522256039319',p:'good',c:90,ad:95.9,ao:97.1,g:1.2,dr:87.2,dad:[100,98.9,100,96.7,92.2,93.3,91.1,94.4,94.4,97.8],dao:[102.2,98.9,100,96.7,91.1,95.6,94.4,96.7,96.7,98.9]},
{fid:'1755595960039864',p:'good',c:29,ad:126.9,ao:128.6,g:1.7,dr:13.2,dad:[124.1,131,131,131,127.6,127.6,131,127.6,124.1,113.8],dao:[127.6,131,131,131,131,127.6,131,131,127.6,117.2]},
{fid:'1756210395039936',p:'bad',c:25,ad:47.6,ao:48,g:0.4,dr:100,dad:[8,32,44,48,56,60,60,52,56,60],dao:[8,32,44,48,56,60,60,56,56,60]},
{fid:'1756634743112596',p:'good',c:18,ad:96.6,ao:98.3,g:1.7,dr:22.2,dad:[111.1,100,100,94.4,94.4,100,88.9,94.4,88.9,94.4],dao:[116.7,100,100,100,94.4,100,94.4,94.4,88.9,94.4]},
{fid:'1756725472112855',p:'good',c:62,ad:99.5,ao:100.3,g:0.8,dr:96.9,dad:[103.2,101.6,101.6,98.4,98.4,101.6,100,100,95.2,95.2],dao:[108.1,101.6,101.6,98.4,98.4,101.6,101.6,100,95.2,96.8]},
{fid:'1757417294112363',p:'average',c:19,ad:92.1,ao:94.2,g:2.1,dr:21.1,dad:[100,100,94.7,84.2,89.5,94.7,94.7,89.5,89.5,84.2],dao:[100,100,94.7,89.5,94.7,100,94.7,89.5,94.7,84.2]},
{fid:'1758011634299063',p:'average',c:20,ad:94,ao:95,g:1,dr:30,dad:[95,100,100,100,90,80,90,100,95,90],dao:[95,100,100,100,90,85,90,100,95,95]},
{fid:'1758111846299819',p:'average',c:19,ad:84.2,ao:85.8,g:1.6,dr:83.3,dad:[78.9,78.9,78.9,73.7,73.7,84.2,94.7,94.7,89.5,94.7],dao:[78.9,78.9,78.9,78.9,78.9,84.2,94.7,94.7,94.7,94.7]},
{fid:'1758189425112879',p:'good',c:19,ad:95.3,ao:101.6,g:6.3,dr:36.8,dad:[105.3,100,100,94.7,84.2,100,100,100,89.5,78.9],dao:[115.8,100,100,100,100,100,100,100,100,100]},
{fid:'1758538456299349',p:'good',c:15,ad:94,ao:94.7,g:0.7,dr:66.7,dad:[100,80,100,80,93.3,100,100,93.3,100,93.3],dao:[100,86.7,100,80,100,93.3,100,93.3,100,93.3]},
{fid:'1760518945112697',p:'good',c:22,ad:99.1,ao:101.8,g:2.7,dr:66.7,dad:[100,100,100,95.5,100,100,100,100,95.5,100],dao:[118.2,100,100,95.5,100,100,100,100,100,104.5]},
{fid:'1760530181299422',p:'average',c:25,ad:101.6,ao:102.8,g:1.2,dr:92.3,dad:[108,104,104,100,100,96,96,100,104,104],dao:[112,104,104,100,100,100,100,100,104,104]},
{fid:'1760604898039540',p:'average',c:10,ad:46,ao:46,g:0,dr:60,dad:[40,40,40,40,40,50,50,40,60,60],dao:[40,40,40,40,40,50,50,40,60,60]},
{fid:'1760879506112818',p:'good',c:20,ad:95,ao:96,g:1,dr:100,dad:[100,100,95,100,95,90,95,100,85,90],dao:[100,100,95,100,95,95,95,100,90,90]},
{fid:'1760970609039079',p:'good',c:20,ad:95.5,ao:97,g:1.5,dr:0,dad:[100,100,95,95,100,95,85,85,100,100],dao:[105,100,95,95,100,95,95,85,100,100]},
{fid:'1761136149353224',p:'average',c:10,ad:95,ao:106,g:11,dr:75,dad:[120,100,110,90,100,100,90,80,80,80],dao:[170,120,120,90,100,100,90,90,90,90]},
{fid:'1761556080299221',p:'good',c:15,ad:103.4,ao:104,g:0.6,dr:6.3,dad:[106.7,106.7,106.7,106.7,106.7,106.7,106.7,100,93.3,93.3],dao:[106.7,106.7,106.7,106.7,106.7,106.7,106.7,100,100,93.3]},
{fid:'1762681203353471',p:'good',c:33,ad:100.9,ao:101.2,g:0.3,dr:100,dad:[103,103,103,103,100,100,100,97,100,100],dao:[103,103,103,103,100,100,100,100,100,100]},
{fid:'1762858629353509',p:'average',c:14,ad:97.2,ao:97.9,g:0.7,dr:14.3,dad:[100,100,100,92.9,92.9,92.9,100,100,100,92.9],dao:[100,100,100,92.9,92.9,92.9,100,100,100,100]},
{fid:'1763044356353220',p:'average',c:10,ad:102,ao:112,g:10,dr:100,dad:[100,100,90,110,100,110,100,100,110,100],dao:[140,110,110,110,110,110,100,110,110,110]},
{fid:'1731509000039817',p:'average',c:60,ad:96.6,ao:99,g:2.4,dr:92.1,dad:[105,103.3,103.3,100,93.3,88.3,91.7,93.3,95,93.3],dao:[108.3,103.3,105,101.7,98.3,91.7,96.7,95,95,95]},
{fid:'1731510003112076',p:'good',c:20,ad:105,ao:106,g:1,dr:100,dad:[130,130,110,90,95,100,100,100,95,100],dao:[130,130,115,95,95,100,100,100,95,100]},
{fid:'1731854089039346',p:'average',c:120,ad:95.9,ao:99,g:3.1,dr:73.6,dad:[101.7,100.8,100.8,99.2,96.7,93.3,90.8,86.7,95,94.2],dao:[112.5,102.5,102.5,100,98.3,94.2,91.7,92.5,98.3,97.5]},
{fid:'1731867527039057',p:'good',c:35,ad:96.3,ao:96.8,g:0.5,dr:91.2,dad:[85.7,85.7,100,97.1,100,97.1,100,100,100,97.1],dao:[91.4,85.7,100,97.1,100,97.1,100,100,100,97.1]},
{fid:'1731868986112055',p:'average',c:10,ad:85,ao:87,g:2,dr:11.1,dad:[90,90,90,90,90,80,80,80,80,80],dao:[110,90,90,90,90,80,80,80,80,80]},
{fid:'1731934089353752',p:'average',c:10,ad:98,ao:98,g:0,dr:60,dad:[90,100,100,90,100,100,100,100,100,100],dao:[90,100,100,90,100,100,100,100,100,100]},
{fid:'1731935292039476',p:'good',c:15,ad:105.3,ao:107.3,g:2,dr:68.8,dad:[120,113.3,113.3,106.7,106.7,106.7,106.7,100,100,80],dao:[126.7,113.3,113.3,106.7,106.7,106.7,106.7,100,100,93.3]},
{fid:'1732012017299917',p:'average',c:33,ad:99.4,ao:101.8,g:2.4,dr:8.8,dad:[106.1,103,103,100,93.9,100,103,100,100,84.8],dao:[112.1,103,103,100,97,103,103,100,100,97]},
{fid:'1732528814112456',p:'average',c:44,ad:98,ao:100.2,g:2.2,dr:13.3,dad:[102.3,102.3,102.3,95.5,95.5,95.5,100,95.5,95.5,95.5],dao:[104.5,102.3,102.3,97.7,100,97.7,102.3,100,97.7,97.7]},
{fid:'1732622214353812',p:'good',c:32,ad:100,ao:101.6,g:1.6,dr:81.8,dad:[103.1,103.1,100,100,100,100,100,100,93.8,100],dao:[109.4,103.1,103.1,100,100,100,100,100,100,100]},
{fid:'1732706776299286',p:'average',c:40,ad:108,ao:109,g:1,dr:33.3,dad:[117.5,110,112.5,107.5,110,107.5,110,97.5,105,102.5],dao:[117.5,110,112.5,110,112.5,107.5,110,102.5,105,102.5]},
{fid:'1732791102299954',p:'good',c:23,ad:96.1,ao:97.8,g:1.7,dr:76,dad:[95.7,95.7,91.3,95.7,95.7,100,100,95.7,95.7,95.7],dao:[95.7,95.7,95.7,95.7,95.7,100,100,100,100,100]},
{fid:'1732809124112656',p:'average',c:15,ad:100,ao:102.7,g:2.7,dr:18.8,dad:[106.7,100,106.7,100,106.7,93.3,100,100,86.7,100],dao:[120,100,106.7,100,106.7,93.3,100,106.7,93.3,100]},
{fid:'1733387787353859',p:'average',c:35,ad:96.8,ao:98.3,g:1.5,dr:65.7,dad:[97.1,97.1,100,91.4,100,100,97.1,94.3,94.3,97.1],dao:[105.7,97.1,100,94.3,100,100,97.1,97.1,94.3,97.1]},
{fid:'1733812010299757',p:'good',c:32,ad:93.1,ao:96.3,g:3.2,dr:100,dad:[100,100,100,96.9,87.5,87.5,84.4,96.9,90.6,87.5],dao:[109.4,100,100,96.9,93.8,93.8,84.4,96.9,93.8,93.8]},
{fid:'1733826213299362',p:'good',c:85,ad:98.5,ao:98.9,g:0.4,dr:69.8,dad:[97.6,95.3,95.3,98.8,96.5,100,101.2,100,100,100],dao:[100,95.3,95.3,98.8,97.6,100,101.2,101.2,100,100]},
{fid:'1734259602039289',p:'good',c:10,ad:96,ao:98,g:2,dr:30,dad:[100,100,100,80,100,100,100,100,80,100],dao:[100,100,100,90,100,100,100,100,90,100]},
{fid:'1735111080353974',p:'bad',c:15,ad:94.7,ao:98,g:3.3,dr:0,dad:[100,100,100,66.7,93.3,100,100,93.3,100,93.3],dao:[100,100,100,86.7,100,100,100,100,100,93.3]},
{fid:'1735138930112770',p:'good',c:30,ad:100.7,ao:102.3,g:1.6,dr:40,dad:[103.3,103.3,103.3,100,100,100,100,100,96.7,100],dao:[113.3,103.3,103.3,103.3,100,100,100,100,100,100]},
{fid:'1738071524112063',p:'good',c:10,ad:97,ao:97,g:0,dr:100,dad:[100,100,100,90,90,100,100,90,100,100],dao:[100,100,100,90,90,100,100,90,100,100]},
{fid:'1746435034112017',p:'average',c:56,ad:93.6,ao:94.1,g:0.5,dr:87,dad:[92.9,92.9,92.9,92.9,92.9,92.9,92.9,94.6,94.6,96.4],dao:[92.9,92.9,94.6,92.9,94.6,92.9,92.9,94.6,96.4,96.4]},
{fid:'1747033048353584',p:'good',c:20,ad:98,ao:101.5,g:3.5,dr:55,dad:[110,110,95,100,100,90,95,95,90,95],dao:[110,110,110,100,100,100,95,95,100,95]},
{fid:'1756015547112984',p:'good',c:12,ad:107.5,ao:107.5,g:0,dr:100,dad:[108.3,108.3,108.3,108.3,108.3,100,108.3,108.3,108.3,108.3],dao:[108.3,108.3,108.3,108.3,108.3,100,108.3,108.3,108.3,108.3]},
{fid:'1756287112299481',p:'good',c:12,ad:105.8,ao:108.3,g:2.5,dr:0,dad:[108.3,108.3,108.3,100,108.3,108.3,100,108.3,100,108.3],dao:[108.3,108.3,108.3,108.3,108.3,108.3,108.3,108.3,108.3,108.3]},
{fid:'1756880631112939',p:'average',c:10,ad:97,ao:99,g:2,dr:70,dad:[100,100,100,100,100,100,100,90,90,90],dao:[120,100,100,100,100,100,100,90,90,90]},
{fid:'1756965373039728',p:'average',c:25,ad:108.4,ao:108.8,g:0.4,dr:92,dad:[120,120,120,116,120,96,96,96,100,100],dao:[120,120,120,116,120,100,96,96,100,100]},
{fid:'1758435201299879',p:'average',c:10,ad:101,ao:105,g:4,dr:100,dad:[100,100,100,100,110,100,100,100,100,100],dao:[140,100,100,100,110,100,100,100,100,100]},
{fid:'1758435368039299',p:'good',c:24,ad:103.4,ao:104.6,g:1.2,dr:0,dad:[100,104.2,104.2,104.2,104.2,104.2,104.2,104.2,100,104.2],dao:[108.3,104.2,104.2,104.2,104.2,104.2,104.2,104.2,104.2,104.2]},
{fid:'1761481086353043',p:'bad',c:15,ad:99.3,ao:103.3,g:4,dr:6.3,dad:[113.3,113.3,106.7,86.7,100,93.3,86.7,93.3,100,100],dao:[126.7,113.3,106.7,106.7,100,93.3,93.3,93.3,100,100]},
{fid:'1761544337039214',p:'average',c:25,ad:75.2,ao:75.2,g:0,dr:60,dad:[80,80,80,76,80,72,68,76,72,68],dao:[80,80,80,76,80,72,68,76,72,68]},
{fid:'1761803808299759',p:'good',c:16,ad:100.6,ao:102.5,g:1.9,dr:0,dad:[106.2,112.5,100,100,100,100,93.8,93.8,100,100],dao:[106.2,112.5,106.2,100,100,100,100,100,100,100]},
{fid:'1762348260112300',p:'average',c:44,ad:94.8,ao:95.2,g:0.4,dr:95.3,dad:[90.9,90.9,93.2,95.5,97.7,95.5,97.7,95.5,95.5,95.5],dao:[90.9,90.9,93.2,95.5,97.7,97.7,97.7,97.7,95.5,95.5]},
{fid:'1762760140112726',p:'good',c:13,ad:100,ao:100.8,g:0.8,dr:0,dad:[100,100,100,100,100,100,100,100,100,100],dao:[107.7,100,100,100,100,100,100,100,100,100]},
{fid:'1762786712353978',p:'average',c:55,ad:92,ao:93.4,g:1.4,dr:100,dad:[94.5,89.1,90.9,90.9,90.9,90.9,90.9,94.5,92.7,94.5],dao:[96.4,92.7,92.7,90.9,90.9,92.7,94.5,94.5,94.5,94.5]},
{fid:'1762954271039649',p:'good',c:23,ad:99.1,ao:99.6,g:0.5,dr:87,dad:[100,100,100,100,100,100,95.7,100,95.7,100],dao:[100,100,100,100,100,100,95.7,100,100,100]},
{fid:'1763307691299830',p:'average',c:10,ad:94,ao:94,g:0,dr:100,dad:[90,100,100,100,80,90,80,100,100,100],dao:[90,100,100,100,80,90,80,100,100,100]},
{fid:'1763307783112237',p:'good',c:10,ad:101,ao:105,g:4,dr:100,dad:[100,110,100,100,100,100,100,100,100,100],dao:[120,110,100,100,100,110,110,100,100,100]},
{fid:'1749971757112363',p:'average',c:23,ad:102.2,ao:103,g:0.8,dr:62.5,dad:[100,104.3,104.3,104.3,104.3,104.3,104.3,95.7,100,100],dao:[100,104.3,104.3,104.3,104.3,104.3,104.3,104.3,100,100]},
{fid:'1749992267112904',p:'good',c:18,ad:85.6,ao:87.8,g:2.2,dr:81.3,dad:[88.9,77.8,83.3,83.3,88.9,83.3,88.9,88.9,83.3,88.9],dao:[88.9,88.9,83.3,83.3,88.9,88.9,88.9,88.9,88.9,88.9]},
{fid:'1754491276353773',p:'good',c:15,ad:95.3,ao:96.7,g:1.4,dr:20,dad:[100,100,100,93.3,86.7,86.7,93.3,93.3,100,100],dao:[106.7,100,100,93.3,93.3,86.7,93.3,93.3,100,100]},
{fid:'1754493021112061',p:'good',c:17,ad:94.7,ao:96.5,g:1.8,dr:35.3,dad:[100,100,100,94.1,94.1,88.2,94.1,94.1,94.1,88.2],dao:[100,100,100,100,94.1,88.2,94.1,94.1,94.1,100]},
{fid:'1754559019353111',p:'average',c:27,ad:95.2,ao:96.3,g:1.1,dr:63,dad:[85.2,96.3,96.3,96.3,96.3,96.3,96.3,96.3,100,92.6],dao:[88.9,92.6,96.3,96.3,96.3,96.3,96.3,100,100,100]},
{fid:'1755429742299434',p:'good',c:23,ad:87.4,ao:88.7,g:1.3,dr:47.8,dad:[78.3,87,87,87,82.6,87,82.6,95.7,91.3,95.7],dao:[87,87,87,87,82.6,91.3,82.6,95.7,91.3,95.7]},
{fid:'1755604191039007',p:'good',c:18,ad:106.2,ao:107.8,g:1.6,dr:60,dad:[105.6,105.6,111.1,105.6,105.6,105.6,105.6,105.6,105.6,105.6],dao:[116.7,105.6,111.1,111.1,105.6,105.6,105.6,105.6,105.6,105.6]},
{fid:'1755611005112100',p:'average',c:20,ad:104.5,ao:106,g:1.5,dr:100,dad:[110,105,105,105,105,105,100,105,100,105],dao:[125,105,105,105,105,105,100,105,100,105]},
{fid:'1756131957112566',p:'average',c:16,ad:87.5,ao:95,g:7.5,dr:87.5,dad:[75,87.5,93.8,87.5,87.5,93.8,81.2,87.5,87.5,93.8],dao:[118.8,87.5,93.8,93.8,87.5,93.8,93.8,87.5,93.8,100]},
{fid:'1756637449299376',p:'average',c:13,ad:88.4,ao:90,g:1.6,dr:8.3,dad:[92.3,92.3,92.3,84.6,92.3,84.6,92.3,84.6,84.6,84.6],dao:[107.7,92.3,92.3,84.6,92.3,84.6,92.3,84.6,84.6,84.6]},
{fid:'1757578441039676',p:'good',c:17,ad:98.8,ao:100,g:1.2,dr:38.9,dad:[100,100,100,100,100,100,100,94.1,94.1,100],dao:[100,100,100,100,100,100,100,100,100,100]},
{fid:'1749014712299106',p:'good',c:13,ad:99.2,ao:99.2,g:0,dr:84.6,dad:[100,100,100,100,100,100,92.3,100,100,100],dao:[100,100,100,100,100,100,92.3,100,100,100]},
{fid:'1749276038112778',p:'good',c:10,ad:96,ao:96,g:0,dr:30,dad:[90,80,100,100,100,100,100,100,100,90],dao:[90,80,100,100,100,100,100,100,100,90]},
{fid:'1749626356112145',p:'average',c:10,ad:100,ao:100,g:0,dr:100,dad:[100,100,100,100,100,100,100,100,100,100],dao:[100,100,100,100,100,100,100,100,100,100]},
{fid:'1749711291039247',p:'good',c:35,ad:88.3,ao:95.7,g:7.4,dr:66.7,dad:[91.4,88.6,77.1,71.4,91.4,94.3,82.9,97.1,91.4,97.1],dao:[111.4,88.6,88.6,85.7,94.3,94.3,94.3,100,100,100]},
{fid:'1750667490353609',p:'good',c:20,ad:95.5,ao:99.5,g:4,dr:100,dad:[85,90,100,95,100,100,95,100,95,95],dao:[115,90,100,100,100,100,100,100,95,95]},
{fid:'1756130975299660',p:'average',c:13,ad:93.1,ao:93.1,g:0,dr:92.3,dad:[92.3,100,100,92.3,92.3,92.3,92.3,84.6,92.3,92.3],dao:[92.3,100,100,92.3,92.3,92.3,92.3,84.6,92.3,92.3]},
{fid:'1757417595112770',p:'average',c:20,ad:96,ao:102.5,g:6.5,dr:63,dad:[95,90,90,90,90,90,95,95,110,115],dao:[110,95,95,95,95,95,95,100,120,125]},
{fid:'1759321603299599',p:'average',c:12,ad:94.2,ao:98.3,g:4.1,dr:18.2,dad:[100,100,83.3,91.7,100,100,100,83.3,100,83.3],dao:[116.7,100,83.3,91.7,100,100,100,100,100,91.7]},
{fid:'1759674072353352',p:'average',c:10,ad:98,ao:101,g:3,dr:50,dad:[100,100,100,100,100,100,100,90,90,100],dao:[120,100,100,100,100,100,100,100,90,100]},
{fid:'1760001816112301',p:'good',c:28,ad:102.1,ao:105,g:2.9,dr:19.4,dad:[107.1,107.1,107.1,103.6,103.6,103.6,100,100,89.3,100],dao:[117.9,107.1,107.1,103.6,103.6,103.6,103.6,103.6,100,100]},
{fid:'1749097037039862',p:'average',c:17,ad:111.2,ao:116.5,g:5.3,dr:89.5,dad:[117.6,117.6,117.6,117.6,117.6,111.8,105.9,100,94.1,111.8],dao:[141.2,117.6,117.6,117.6,117.6,111.8,117.6,105.9,105.9,111.8]},
{fid:'1749098738112185',p:'good',c:30,ad:99.6,ao:101,g:1.4,dr:93.8,dad:[93.3,96.7,93.3,96.7,100,103.3,103.3,103.3,103.3,103.3],dao:[96.7,96.7,96.7,103.3,100,103.3,103.3,103.3,103.3,103.3]},
{fid:'1749275437353448',p:'average',c:18,ad:79.4,ao:80.6,g:1.2,dr:40,dad:[77.8,72.2,77.8,66.7,88.9,83.3,88.9,83.3,83.3,72.2],dao:[77.8,72.2,77.8,66.7,83.3,88.9,88.9,88.9,83.3,77.8]},
{fid:'1750061199112536',p:'good',c:18,ad:99.4,ao:102.2,g:2.8,dr:100,dad:[100,100,100,100,94.4,100,100,100,100,100],dao:[116.7,111.1,100,100,94.4,100,100,100,100,100]},
{fid:'1750238658112632',p:'good',c:20,ad:92.5,ao:92.5,g:0,dr:100,dad:[100,95,95,90,90,90,95,95,90,85],dao:[100,95,95,90,90,90,95,95,90,85]},
{fid:'1750655676353767',p:'good',c:18,ad:100,ao:100,g:0,dr:94.4,dad:[111.1,100,100,100,100,100,100,94.4,100,94.4],dao:[111.1,100,100,100,100,100,100,94.4,100,94.4]},
{fid:'1755429108039697',p:'average',c:10,ad:116,ao:122,g:6,dr:75,dad:[130,130,130,120,110,110,100,110,110,110],dao:[130,130,130,120,120,120,110,120,120,120]},
{fid:'1755439021039797',p:'average',c:12,ad:100,ao:101.7,g:1.7,dr:100,dad:[141.7,100,100,91.7,100,100,83.3,91.7,100,91.7],dao:[141.7,116.7,100,91.7,100,100,83.3,91.7,100,91.7]},
{fid:'1755522517112049',p:'good',c:12,ad:113.4,ao:115,g:1.6,dr:91.7,dad:[158.3,141.7,141.7,125,100,91.7,100,91.7,91.7,91.7],dao:[166.7,141.7,141.7,125,100,100,100,91.7,91.7,91.7]},
{fid:'1756796072299125',p:'good',c:30,ad:100,ao:101,g:1,dr:100,dad:[103.3,103.3,103.3,100,100,96.7,96.7,100,100,96.7],dao:[103.3,103.3,103.3,103.3,100,96.7,100,100,100,100]},
{fid:'1756904206112738',p:'average',c:10,ad:109,ao:109,g:0,dr:100,dad:[110,110,110,110,110,110,110,110,110,100],dao:[110,110,110,110,110,110,110,110,110,100]},
{fid:'1758027266299160',p:'average',c:18,ad:96.7,ao:98.3,g:1.6,dr:100,dad:[100,100,88.9,94.4,100,100,100,94.4,100,88.9],dao:[100,100,94.4,94.4,100,100,100,94.4,100,100]},
{fid:'1759388925112869',p:'good',c:10,ad:98,ao:98,g:0,dr:100,dad:[90,100,100,100,100,100,100,100,100,90],dao:[90,100,100,100,100,100,100,100,100,90]},
{fid:'1761490952299122',p:'new',c:10,ad:98,ao:98,g:0,dr:100,dad:[100,100,100,100,100,100,100,100,90,90],dao:[100,100,100,100,100,100,100,100,90,90]},
{fid:'1762159798039738',p:'good',c:31,ad:98.7,ao:101,g:2.3,dr:100,dad:[103.2,103.2,106.5,96.8,96.8,96.8,93.5,96.8,96.8,96.8],dao:[103.2,106.5,109.7,96.8,96.8,100,100,100,96.8,100]},
{fid:'1750571266353853',p:'average',c:12,ad:84.2,ao:86.6,g:2.4,dr:58.3,dad:[83.3,83.3,83.3,75,83.3,83.3,83.3,91.7,91.7,83.3],dao:[83.3,83.3,83.3,83.3,83.3,83.3,83.3,91.7,100,91.7]},
{fid:'1750587597353007',p:'good',c:36,ad:113.9,ao:114.7,g:0.8,dr:50,dad:[108.3,116.7,116.7,113.9,116.7,113.9,113.9,116.7,116.7,105.6],dao:[108.3,116.7,116.7,113.9,116.7,113.9,116.7,116.7,116.7,111.1]},
{fid:'1758453876112334',p:'average',c:10,ad:54,ao:58,g:4,dr:30,dad:[20,0,0,0,20,100,100,100,100,100],dao:[50,0,0,0,30,100,100,100,100,100]},
{fid:'1759038791039610',p:'good',c:20,ad:92,ao:93,g:1,dr:94.7,dad:[95,95,85,90,95,90,95,95,90,90],dao:[95,95,85,90,95,95,95,95,95,90]},
{fid:'1731511405039538',p:'good',c:35,ad:85.2,ao:86.6,g:1.4,dr:67.7,dad:[88.6,88.6,88.6,80,88.6,85.7,82.9,85.7,80,82.9],dao:[88.6,88.6,88.6,85.7,88.6,85.7,82.9,85.7,85.7,85.7]},
{fid:'1731934452112710',p:'average',c:10,ad:98,ao:99,g:1,dr:30,dad:[100,100,100,100,100,100,100,100,80,100],dao:[100,100,100,100,100,100,100,100,90,100]},
{fid:'1732080588112544',p:'good',c:18,ad:96.6,ao:98.3,g:1.7,dr:100,dad:[94.4,100,100,94.4,100,94.4,94.4,88.9,100,100],dao:[100,100,100,100,100,100,94.4,88.9,100,100]},
{fid:'1732528145299075',p:'average',c:80,ad:96.9,ao:98.8,g:1.9,dr:100,dad:[96.2,96.2,98.8,96.2,98.8,96.2,96.2,96.2,93.8,100],dao:[105,96.2,98.8,98.8,98.8,96.2,98.8,97.5,97.5,100]},
{fid:'1732531048353741',p:'average',c:10,ad:93,ao:97,g:4,dr:30,dad:[90,100,100,70,100,100,100,100,90,80],dao:[90,100,100,100,100,100,100,100,90,90]},
{fid:'1732611801039441',p:'average',c:17,ad:97.6,ao:100.6,g:3,dr:88.9,dad:[94.1,105.9,105.9,88.2,100,100,94.1,100,94.1,94.1],dao:[94.1,111.8,105.9,94.1,100,100,94.1,105.9,100,100]},
{fid:'1733064776039012',p:'average',c:10,ad:100,ao:101,g:1,dr:100,dad:[100,100,100,100,100,100,100,100,100,100],dao:[110,100,100,100,100,100,100,100,100,100]},
{fid:'1733224995039112',p:'good',c:15,ad:100.7,ao:109.3,g:8.6,dr:0,dad:[113.3,100,100,100,100,100,100,93.3,100,100],dao:[193.3,100,100,100,100,100,100,100,100,100]},
{fid:'1733383166039041',p:'average',c:30,ad:95,ao:98.7,g:3.7,dr:9.7,dad:[96.7,93.3,96.7,93.3,96.7,90,90,100,96.7,96.7],dao:[120,93.3,96.7,96.7,96.7,90,93.3,100,100,100]},
{fid:'1733394473112374',p:'average',c:40,ad:96,ao:99.5,g:3.5,dr:7.1,dad:[100,100,100,97.5,92.5,100,100,85,95,90],dao:[105,100,100,102.5,97.5,100,100,100,97.5,92.5]},
{fid:'1733896755039413',p:'average',c:20,ad:91,ao:96.5,g:5.5,dr:85,dad:[95,100,100,90,90,85,90,70,95,95],dao:[125,100,100,90,100,90,90,75,100,95]},
{fid:'1734245491299472',p:'average',c:30,ad:95.7,ao:97.7,g:2,dr:100,dad:[86.7,80,100,96.7,100,100,96.7,96.7,100,100],dao:[90,86.7,100,100,100,100,100,100,100,100]},
{fid:'1734606093353800',p:'average',c:15,ad:96,ao:96,g:0,dr:80,dad:[100,100,100,93.3,100,100,100,80,93.3,93.3],dao:[100,100,100,93.3,100,100,100,80,93.3,93.3]},
{fid:'1735025572353163',p:'average',c:27,ad:95.9,ao:98.2,g:2.3,dr:21.4,dad:[88.9,96.3,96.3,92.6,96.3,96.3,100,100,96.3,96.3],dao:[100,96.3,96.3,96.3,96.3,96.3,100,100,100,100]},
{fid:'1735124394299703',p:'good',c:45,ad:94.2,ao:95.8,g:1.6,dr:83.7,dad:[91.1,97.8,95.6,93.3,93.3,95.6,97.8,93.3,91.1,93.3],dao:[97.8,97.8,97.8,95.6,93.3,95.6,97.8,97.8,91.1,93.3]},
{fid:'1735203766112507',p:'good',c:15,ad:94.7,ao:96.7,g:2,dr:100,dad:[86.7,86.7,93.3,100,80,80,100,106.7,106.7,106.7],dao:[100,86.7,100,100,80,80,100,106.7,106.7,106.7]},
{fid:'1739976551353777',p:'average',c:32,ad:98.1,ao:99.1,g:1,dr:68.8,dad:[100,100,96.9,93.8,100,100,96.9,96.9,100,96.9],dao:[100,100,100,93.8,100,100,100,100,100,96.9]},
{fid:'1740055816112677',p:'average',c:25,ad:96.4,ao:99.6,g:3.2,dr:96,dad:[100,96,100,100,100,100,100,88,92,88],dao:[112,100,100,100,100,100,100,96,96,92]},
{fid:'1740544581112547',p:'good',c:33,ad:97.6,ao:98.5,g:0.9,dr:100,dad:[93.9,93.9,97,100,97,100,100,100,97,97],dao:[97,97,97,100,97,100,100,100,100,97]},
{fid:'1740637628039402',p:'bad',c:10,ad:100,ao:100,g:0,dr:100,dad:[100,100,100,100,100,100,100,100,100,100],dao:[100,100,100,100,100,100,100,100,100,100]},
{fid:'1746367517112083',p:'good',c:30,ad:97.7,ao:99.7,g:2,dr:78.1,dad:[96.7,100,100,100,96.7,96.7,96.7,100,93.3,96.7],dao:[100,103.3,100,100,96.7,100,100,100,96.7,100]},
{fid:'1746442273039981',p:'good',c:40,ad:94.2,ao:94.8,g:0.6,dr:55,dad:[95,97.5,97.5,95,92.5,97.5,95,87.5,87.5,97.5],dao:[97.5,97.5,97.5,95,95,97.5,95,87.5,87.5,97.5]},
{fid:'1747919015112899',p:'average',c:10,ad:92,ao:95,g:3,dr:80,dad:[100,100,100,80,100,100,100,70,90,80],dao:[110,100,100,80,100,100,100,100,80,80]},
{fid:'1754475535112125',p:'good',c:30,ad:95.4,ao:97,g:1.6,dr:100,dad:[96.7,96.7,96.7,96.7,96.7,96.7,96.7,86.7,96.7,93.3],dao:[100,96.7,96.7,96.7,96.7,96.7,96.7,96.7,96.7,96.7]},
{fid:'1756015404353334',p:'average',c:17,ad:99.4,ao:100,g:0.6,dr:94.1,dad:[100,100,100,100,94.1,100,100,100,100,100],dao:[105.9,100,100,100,94.1,100,100,100,100,100]},
{fid:'1756015640112079',p:'good',c:18,ad:96.1,ao:98.3,g:2.2,dr:100,dad:[100,100,100,94.4,100,94.4,94.4,94.4,94.4,88.9],dao:[100,100,100,100,100,100,94.4,100,94.4,94.4]},
{fid:'1756112350112527',p:'good',c:20,ad:99,ao:99.5,g:0.5,dr:45,dad:[95,100,100,100,100,95,100,100,100,100],dao:[95,100,100,100,100,100,100,100,100,100]},
{fid:'1756650056299259',p:'average',c:10,ad:99,ao:112,g:13,dr:0,dad:[100,100,100,90,100,100,100,100,100,100],dao:[140,110,110,100,110,110,110,110,110,110]},
{fid:'1757484669112333',p:'good',c:20,ad:87.5,ao:90.5,g:3,dr:100,dad:[90,95,95,90,85,80,90,85,80,85],dao:[90,95,95,90,90,90,90,95,80,90]},
{fid:'1757930882353861',p:'good',c:30,ad:96.7,ao:98.7,g:2,dr:93.3,dad:[93.3,100,100,100,96.7,96.7,100,93.3,96.7,90],dao:[93.3,100,100,100,100,96.7,100,96.7,100,100]},
{fid:'1758034071299409',p:'good',c:25,ad:92.4,ao:103.2,g:10.8,dr:60.9,dad:[112,100,100,100,100,84,80,84,80,84],dao:[188,100,100,100,104,100,88,84,84,84]},
{fid:'1758436496299927',p:'average',c:18,ad:89.4,ao:91.6,g:2.2,dr:100,dad:[94.4,94.4,94.4,94.4,94.4,88.9,94.4,77.8,77.8,83.3],dao:[100,100,100,94.4,94.4,94.4,94.4,77.8,77.8,83.3]},
{fid:'1759048573353058',p:'good',c:10,ad:98,ao:99,g:1,dr:33.3,dad:[100,100,100,100,100,100,100,90,90,100],dao:[100,100,100,100,100,100,100,90,100,100]},
{fid:'1759235003353202',p:'good',c:15,ad:102.7,ao:102.7,g:0,dr:93.8,dad:[100,106.7,106.7,86.7,106.7,106.7,100,106.7,100,106.7],dao:[100,106.7,106.7,86.7,106.7,106.7,100,106.7,100,106.7]},
{fid:'1759318665112340',p:'good',c:29,ad:92.8,ao:94.1,g:1.3,dr:100,dad:[96.6,89.7,93.1,93.1,93.1,93.1,93.1,89.7,93.1,93.1],dao:[103.4,93.1,93.1,93.1,93.1,93.1,93.1,93.1,93.1,93.1]},
{fid:'1760262359112294',p:'good',c:10,ad:99,ao:100,g:1,dr:100,dad:[100,100,100,100,100,100,100,90,100,100],dao:[100,100,100,100,100,100,100,100,100,100]},
{fid:'1760277948299260',p:'good',c:15,ad:105.4,ao:106,g:0.6,dr:12.5,dad:[106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,100,100],dao:[106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,106.7,100]},
{fid:'1760449452299497',p:'bad',c:15,ad:65.4,ao:67.4,g:2,dr:100,dad:[66.7,66.7,60,66.7,66.7,66.7,66.7,66.7,60,66.7],dao:[66.7,66.7,73.3,66.7,66.7,66.7,66.7,66.7,66.7,66.7]},
{fid:'1762408775039546',p:'new',c:13,ad:95.4,ao:95.4,g:0,dr:100,dad:[100,100,84.6,100,100,100,92.3,92.3,92.3,92.3],dao:[100,100,84.6,100,100,100,92.3,92.3,92.3,92.3]},
{fid:'1749275327112143',p:'good',c:15,ad:94.7,ao:96.7,g:2,dr:26.7,dad:[100,100,100,93.3,100,100,100,80,86.7,86.7],dao:[100,100,100,93.3,100,100,100,93.3,93.3,86.7]},
{fid:'1750150004299921',p:'good',c:12,ad:99.2,ao:100,g:0.8,dr:75,dad:[100,100,100,100,91.7,100,100,100,100,100],dao:[108.3,100,100,100,91.7,100,100,100,100,100]},
{fid:'1750413839112626',p:'average',c:20,ad:106,ao:107.5,g:1.5,dr:0,dad:[105,110,110,110,110,110,95,100,105,105],dao:[110,110,110,110,110,110,100,105,105,105]},
{fid:'1750594165039211',p:'good',c:15,ad:97.3,ao:99.3,g:2,dr:56.3,dad:[113.3,100,100,100,100,93.3,93.3,93.3,93.3,86.7],dao:[120,100,100,100,106.7,93.3,93.3,93.3,93.3,93.3]},
{fid:'1762086582299991',p:'average',c:10,ad:88,ao:89,g:1,dr:54.5,dad:[100,90,100,100,100,100,100,50,60,80],dao:[110,90,100,100,100,100,100,60,60,70]},
{fid:'1749015000299700',p:'good',c:28,ad:80.4,ao:81.1,g:0.7,dr:64.3,dad:[71.4,71.4,67.9,71.4,64.3,82.1,85.7,100,92.9,96.4],dao:[71.4,71.4,67.9,71.4,64.3,82.1,85.7,100,96.4,100]},
{fid:'1749031921039356',p:'good',c:40,ad:93.2,ao:97,g:3.8,dr:70,dad:[92.5,90,95,92.5,92.5,92.5,97.5,95,92.5,92.5],dao:[97.5,90,95,97.5,97.5,100,100,97.5,97.5,97.5]},
{fid:'1749998599353935',p:'good',c:18,ad:91.7,ao:91.7,g:0,dr:75,dad:[66.7,61.1,55.6,72.2,105.6,111.1,111.1,111.1,111.1,111.1],dao:[66.7,61.1,55.6,72.2,105.6,111.1,111.1,111.1,111.1,111.1]},
{fid:'1754391268039963',p:'average',c:28,ad:95.7,ao:96.1,g:0.4,dr:64.3,dad:[92.9,100,96.4,92.9,92.9,96.4,92.9,92.9,100,100],dao:[96.4,100,96.4,92.9,92.9,96.4,92.9,92.9,100,100]},
{fid:'1754804360039068',p:'good',c:12,ad:111.7,ao:113.3,g:1.6,dr:26.7,dad:[116.7,108.3,108.3,108.3,108.3,116.7,116.7,125,108.3,100],dao:[116.7,108.3,108.3,108.3,116.7,116.7,116.7,125,116.7,100]},
{fid:'1754826073353228',p:'average',c:25,ad:91.6,ao:94,g:2.4,dr:100,dad:[96,96,92,92,92,96,88,88,84,92],dao:[96,96,96,96,92,96,96,92,88,92]},
{fid:'1754831513112485',p:'good',c:20,ad:97.5,ao:99,g:1.5,dr:95,dad:[100,100,100,95,100,90,95,100,100,95],dao:[100,100,100,100,100,90,100,100,100,100]},
{fid:'1754917256299857',p:'average',c:24,ad:97.5,ao:99.2,g:1.7,dr:100,dad:[104.2,95.8,95.8,100,95.8,100,91.7,100,95.8,95.8],dao:[112.5,100,95.8,100,95.8,100,91.7,100,100,95.8]},
{fid:'1755007790353132',p:'good',c:33,ad:112.1,ao:112.8,g:0.7,dr:2.6,dad:[115.2,115.2,115.2,106.1,112.1,112.1,112.1,115.2,103,115.2],dao:[115.2,115.2,115.2,109.1,112.1,115.2,112.1,112.1,106.1,115.2]},
{fid:'1757839973112460',p:'good',c:12,ad:98.3,ao:100,g:1.7,dr:91.7,dad:[100,100,100,100,100,100,100,91.7,91.7,100],dao:[116.7,100,100,100,100,100,100,91.7,91.7,100]},
{fid:'1761485027353433',p:'average',c:10,ad:108,ao:116,g:8,dr:100,dad:[120,120,100,120,120,100,110,90,90,110],dao:[120,120,120,120,120,120,110,110,100,120]},
{fid:'1761822173112506',p:'average',c:12,ad:119.2,ao:122.5,g:3.3,dr:66.7,dad:[116.7,108.3,125,125,116.7,125,125,116.7,116.7,116.7],dao:[125,116.7,125,125,125,125,125,125,116.7,116.7]},
{fid:'1768397408299695',p:'new',c:25,ad:81.2,ao:81.2,g:0,dr:100,dad:[0,20,96,100,100,96,100,100,100,100],dao:[0,20,92,100,100,100,100,100,100,100]},
{fid:'1769430992353004',p:'new',c:15,ad:80,ao:80.7,g:0.7,dr:100,dad:[0,66.7,66.7,86.7,93.3,100,100,100,93.3,93.3],dao:[0,66.7,66.7,86.7,93.3,100,100,100,100,93.3]},
{fid:'1768458864039423',p:'new',c:25,ad:75.6,ao:76.4,g:0.8,dr:100,dad:[0,0,96,96,96,92,96,92,92,96],dao:[0,0,96,96,96,96,96,96,92,96]},
{fid:'1767270533299615',p:'new',c:25,ad:42.4,ao:46.4,g:4,dr:50,dad:[0,0,0,80,68,28,40,64,80,64],dao:[0,0,0,80,68,28,44,72,88,84]},
{fid:'1762431873112593',p:'new',c:25,ad:52.4,ao:52.4,g:0,dr:80.8,dad:[0,0,0,0,24,100,104,96,100,100],dao:[0,0,0,0,24,100,104,96,100,100]},
{fid:'1768973339039464',p:'new',c:13,ad:54.6,ao:54.6,g:0,dr:100,dad:[0,0,0,0,61.5,100,100,100,92.3,92.3],dao:[0,0,0,0,53.8,100,100,100,100,92.3]},
{fid:'1768721797299515',p:'new',c:25,ad:38.4,ao:38.4,g:0,dr:100,dad:[0,0,0,0,0,12,88,92,96,96],dao:[0,0,0,0,0,12,88,92,96,96]},
{fid:'1769443611353764',p:'new',c:25,ad:42.4,ao:41.6,g:0,dr:100,dad:[0,0,0,0,0,24,100,100,100,100],dao:[0,0,0,0,0,16,100,100,100,100]},
{fid:'1749013700039441',p:'good',c:10,ad:25,ao:25,g:0,dr:100,dad:[0,0,0,0,0,0,40,50,80,80],dao:[0,0,0,0,0,0,40,50,80,80]},
{fid:'1768293401353377',p:'new',c:21,ad:14.8,ao:14.8,g:0,dr:100,dad:[0,0,0,0,0,0,0,47.6,52.4,47.6],dao:[0,0,0,0,0,0,0,47.6,52.4,47.6]},
{fid:'1770119270299540',p:'new',c:40,ad:9.8,ao:11,g:1.2,dr:0,dad:[0,0,0,0,0,0,0,0,2.5,95],dao:[0,0,0,0,0,0,0,0,15,95]},
{fid:'1769413715353484',p:'new',c:20,ad:15,ao:15.5,g:0.5,dr:100,dad:[0,0,0,0,0,0,0,0,70,80],dao:[0,0,0,0,0,0,0,0,75,80]},
{fid:'1769347448353507',p:'new',c:20,ad:6.5,ao:6.5,g:0,dr:100,dad:[0,0,0,0,0,0,0,0,0,65],dao:[0,0,0,0,0,0,0,0,0,65]},
];
window.filterDailyTable();
}
</script>

</div>


<!-- End of Tab -->
<div class="footer">
        January 2026 vs February 2026 Analysis | Partner Capacity Management Dashboard
    </div>
<script>
        try { if (typeof Chart !== 'undefined' && typeof ChartDataLabels !== 'undefined') { Chart.register(ChartDataLabels); } } catch(e) {}

        // Tab switching
        function switchTab(tabName, el) {
            const tabs = document.querySelectorAll('.tab-content');
            const tabItems = document.querySelectorAll('.tab-item');

            tabs.forEach(tab => tab.classList.remove('active'));
            tabItems.forEach(item => item.classList.remove('active'));

            const target = document.getElementById(tabName);
            if (target) target.classList.add('active');
            if (el) el.classList.add('active');

            const monthOverviewSlicer = document.getElementById('monthOverviewSlicer');
            if (monthOverviewSlicer) {
                monthOverviewSlicer.style.display = tabName === 'overview' ? 'flex' : 'none';
            }
            const monthlyInsightsSlicer = document.getElementById('monthlyInsightsSlicer');
            if (monthlyInsightsSlicer) {
                monthlyInsightsSlicer.style.display = tabName === 'monthly' ? 'flex' : 'none';
            }

            // Fix Chart.js sizing when switching to hidden tabs
            window.dispatchEvent(new Event('resize'));

            if (tabName === 'dailyView') {
                setTimeout(function() { window.dispatchEvent(new Event('resize')); }, 100);
            }
            if (tabName === 'monthly') {
                setTimeout(() => {
                    if (window.monthlyCharts && Array.isArray(window.monthlyCharts)) {
                        window.monthlyCharts.forEach(c => { try { c.resize(); } catch(e) {} });
                    }
                }, 60);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const monthOverviewSlicer = document.getElementById('monthOverviewSlicer');
            if (monthOverviewSlicer) {
                monthOverviewSlicer.style.display = document.getElementById('overview')?.classList.contains('active') ? 'flex' : 'none';
            }
            const monthlyInsightsSlicer = document.getElementById('monthlyInsightsSlicer');
            if (monthlyInsightsSlicer) {
                monthlyInsightsSlicer.style.display = document.getElementById('monthly')?.classList.contains('active') ? 'flex' : 'none';
            }

            document.querySelectorAll('.section-slicer-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const overviewTabItem = Array.from(document.querySelectorAll('.tab-item'))
                        .find(item => (item.getAttribute('onclick') || '').includes("'overview'"));

                    if (!document.getElementById('overview')?.classList.contains('active')) {
                        switchTab('overview', overviewTabItem);
                    }

                    setTimeout(() => {
                        const targetEl = document.getElementById(targetId);
                        if (targetEl) {
                            targetEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 80);
                });
            });

            document.querySelectorAll('.monthly-slicer-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const monthlyTabItem = Array.from(document.querySelectorAll('.tab-item'))
                        .find(item => (item.getAttribute('onclick') || '').includes("'monthly'"));

                    if (!document.getElementById('monthly')?.classList.contains('active')) {
                        switchTab('monthly', monthlyTabItem);
                    }

                    setTimeout(() => {
                        const targetEl = document.getElementById(targetId);
                        if (targetEl) {
                            targetEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 80);
                });
            });
        });
// Table filtering
        function filterTable() {
            const input = document.getElementById('searchBox');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('cityTable');
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < td.length; j++) {
                    if (td[j]) {
                        const txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                
                tr[i].style.display = found ? '' : 'none';
            }
        }

        
        // Export all tables to a single CSV file
        function exportToCSV() {
            const tables = Array.from(document.querySelectorAll('table'));
            if (!tables.length) {
                alert('No tables found to export.');
                return;
            }

            function findTableTitle(table) {
                // Search backward for the nearest heading (h2/h3/h4)
                let el = table;
                while (el && el !== document.body) {
                    let prev = el.previousElementSibling;
                    while (prev) {
                        if (['H2','H3','H4'].includes(prev.tagName)) {
                            const t = (prev.innerText || '').trim();
                            if (t) return t;
                        }
                        prev = prev.previousElementSibling;
                    }
                    el = el.parentElement;
                }
                return table.getAttribute('id') || 'Table';
            }

            function esc(v) {
                const s = String(v ?? '').replace(/\s+/g, ' ').trim();
                return '"' + s.replace(/"/g, '""') + '"';
            }

            let csv = '';
            tables.forEach((table, idx) => {
                const title = findTableTitle(table) || `Table ${idx+1}`;
                csv += esc(title) + '\n';
                const rows = Array.from(table.rows);
                rows.forEach(row => {
                    const cells = Array.from(row.cells).map(c => esc(c.innerText));
                    csv += cells.join(',') + '\n';
                });
                csv += '\n\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            a.href = url;
            a.download = `Partner_Capacity_Dashboard_${yyyy}-${mm}-${dd}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
// Chart configuration with data labels
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: (value) => value.toLocaleString(),
                    font: {
                        weight: 'bold',
                        size: 11
                    }
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        };

                // Tier city (T1 vs T2) data & helpers
                let tierFilterSelected = 'both'; // 'both', 't1', or 't2'
                const tierCityData = {
                    months: ['Sep-25','Oct-25','Nov-25','Dec-25','Jan-26','Feb-26'],
                    t1: {
                        target: [28525, 29923, 30928, 21880, 20270, 17473],
                        active: [521, 556, 664, 690, 572, 534],
                        withTarget: [446, 534, 608, 560, 518, 461],
                        avgScale: [64.0, 56.0, 50.9, 39.1, 39.1, 37.9]
                    },
                    t2: {
                        target: [4268, 4083, 3909, 2302, 2183, 1892],
                        active: [241, 195, 216, 161, 115, 109],
                        withTarget: [169, 163, 159, 114, 107, 90],
                        avgScale: [25.3, 25.0, 24.6, 20.2, 20.4, 21.0]
                    },
                    perf: {
                        t1: { good: [115,139,158,178,207,199], average: [153,188,214,230,230,228], bad: [92,116,130,108,72,20] },
                        t2: { good: [45,51,47,45,62,53], average: [54,61,61,55,44,34], bad: [33,27,30,14,1,0] }
                    },
                    size: {
                        t1: { big: [39,49,57,63,57,57], mid: [194,233,255,260,219,219], small: [127,161,190,193,233,171] },
                        t2: { big: [20,25,25,24,24,20], mid: [68,89,84,75,56,63], small: [44,25,29,15,27,4] }
                    },
                    targetPerf: {
                        t1: { good: [9858,9452,9959,9883,10903,8904], average: [11580,13094,12650,8321,7613,7842], bad: [4268,4937,5833,2650,1514,370] },
                        t2: { good: [1371,1631,1459,1136,1446,1288], average: [1318,1501,1501,937,717,572], bad: [822,564,616,229,20,0] }
                    },
                    targetSize: {
                        t1: { big: [6227,6868,7490,5921,4471,1650], mid: [14375,15525,15273,11063,9490,7052], small: [5104,5090,5679,3870,6069,8686] },
                        t2: { big: [970,1038,1152,820,467,131], mid: [1603,2184,1980,1289,1108,781], small: [938,474,444,193,608,854] }
                    }
                };

                function tierFmtNum(n) {
                    try { return Number(n).toLocaleString('en-US'); } catch(e) { return String(n); }
                }
                function tierPct(part, total) {
                    if (!total || !isFinite(part) || !isFinite(total)) return 0;
                    return (part / total) * 100;
                }
                function tierDeltaHtml(curr, prev) {
                    if (prev === undefined || prev === null || prev === 0) return '';
                    const delta = ((curr - prev) / prev) * 100;
                    const arrow = delta >= 0 ? '↑' : '↓';
                    const color = delta >= 0 ? '#059669' : '#b91c1c';
                    return ` <span style="color:${color}; font-weight:700;">${arrow} ${Math.abs(delta).toFixed(1)}%</span>`;
                }

                function buildTierTables() {
                    const months = tierCityData.months;
                    const rows = [];
                    const overviewTable = document.getElementById('tierOverviewTable');
                    const perfTable = document.getElementById('tierPerfTable');
                    const scaleTable = document.getElementById('tierScaleTable');
                    const targetPerfTable = document.getElementById('tierTargetPerfTable');
                    const targetScaleTable = document.getElementById('tierTargetScaleTable');
                    if (!overviewTable || !perfTable || !scaleTable || !targetPerfTable || !targetScaleTable) return;

                    // Overview table header - dynamically build based on filter
                    let headerHtml = '<thead><tr style="background:#1e293b;color:#fff;">'
                        + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;max-width:70px;">Month</th>';
                    
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        headerHtml += '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T1 Target</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T1 Active</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T1 With Target</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T1 Avg Scale</th>';
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        headerHtml += '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T2 Target</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T2 Active</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T2 With Target</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">T2 Avg Scale</th>';
                    }
                    
                    headerHtml += '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">Total Target</th>'
                        + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">Total Active</th>'
                        + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">Total With Target</th>'
                        + '<th style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">Weighted Avg Scale</th>'
                        + '</tr></thead><tbody>';

                    // Correct weighted avg scale values for each month
                    const weightedAvgScaleValues = [53.3, 48.8, 45.4, 35.9, 35.9, 35.1];
                    const totalTargetValues = [], totalActiveValues = [], totalWithValues = [];
                    let totalT1Target = 0, totalT2Target = 0, totalT1Active = 0, totalT2Active = 0, totalT1With = 0, totalT2With = 0, totalT1AvgScale = 0, totalT2AvgScale = 0;
                    months.forEach((m, i) => {
                        const t1Target = tierCityData.t1.target[i];
                        const t2Target = tierCityData.t2.target[i];
                        const t1Active = tierCityData.t1.active[i];
                        const t2Active = tierCityData.t2.active[i];
                        const t1With = tierCityData.t1.withTarget[i];
                        const t2With = tierCityData.t2.withTarget[i];
                        const t1Avg = tierCityData.t1.avgScale[i];
                        const t2Avg = tierCityData.t2.avgScale[i];
                        const totalTarget = t1Target + t2Target;
                        const totalActive = t1Active + t2Active;
                        const totalWith = t1With + t2With;
                        const weightedAvg = weightedAvgScaleValues[i];
                        totalTargetValues.push(totalTarget);
                        totalActiveValues.push(totalActive);
                        totalWithValues.push(totalWith);

                        totalT1Target += t1Target; totalT2Target += t2Target;
                        totalT1Active += t1Active; totalT2Active += t2Active;
                        totalT1With += t1With; totalT2With += t2With;
                        totalT1AvgScale += t1Avg; totalT2AvgScale += t2Avg;

                        let rowHtml = `<tr style="background:${i % 2 === 0 ? '#ffffff' : '#f9fafb'};">`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;white-space:nowrap;max-width:70px;">${m}</td>`;
                        
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                            rowHtml += `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${tierFmtNum(t1Target)} (${tierPct(t1Target,totalTarget).toFixed(1)}%)${tierDeltaHtml(t1Target, i>0 ? tierCityData.t1.target[i-1] : null)}</td>`
                                + `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${tierFmtNum(t1Active)} (${tierPct(t1Active,totalActive).toFixed(1)}%)${tierDeltaHtml(t1Active, i>0 ? tierCityData.t1.active[i-1] : null)}</td>`
                                + `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${tierFmtNum(t1With)} (${tierPct(t1With,totalWith).toFixed(1)}%)${tierDeltaHtml(t1With, i>0 ? tierCityData.t1.withTarget[i-1] : null)}</td>`
                                + `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${t1Avg.toFixed(1)}${tierDeltaHtml(t1Avg, i>0 ? tierCityData.t1.avgScale[i-1] : null)}</td>`;
                        }
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                            rowHtml += `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${tierFmtNum(t2Target)} (${tierPct(t2Target,totalTarget).toFixed(1)}%)${tierDeltaHtml(t2Target, i>0 ? tierCityData.t2.target[i-1] : null)}</td>`
                                + `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${tierFmtNum(t2Active)} (${tierPct(t2Active,totalActive).toFixed(1)}%)${tierDeltaHtml(t2Active, i>0 ? tierCityData.t2.active[i-1] : null)}</td>`
                                + `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${tierFmtNum(t2With)} (${tierPct(t2With,totalWith).toFixed(1)}%)${tierDeltaHtml(t2With, i>0 ? tierCityData.t2.withTarget[i-1] : null)}</td>`
                                + `<td style="padding:8px;border:1px solid #e5e7eb;white-space:nowrap;">${t2Avg.toFixed(1)}${tierDeltaHtml(t2Avg, i>0 ? tierCityData.t2.avgScale[i-1] : null)}</td>`;
                        }
                        
                        rowHtml += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;white-space:nowrap;">${tierFmtNum(totalTarget)} (100%)${tierDeltaHtml(totalTarget, i>0 ? totalTargetValues[i-1] : null)}</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;white-space:nowrap;">${tierFmtNum(totalActive)} (100%)${tierDeltaHtml(totalActive, i>0 ? totalActiveValues[i-1] : null)}</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;white-space:nowrap;">${tierFmtNum(totalWith)} (100%)${tierDeltaHtml(totalWith, i>0 ? totalWithValues[i-1] : null)}</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;white-space:nowrap;">${weightedAvg.toFixed(1)}${tierDeltaHtml(weightedAvg, i>0 ? weightedAvgScaleValues[i-1] : null)}</td>`
                            + `</tr>`;
                        
                        headerHtml += rowHtml;
                    });

                    const countMonths = months.length;
                    const avgT1Target = totalT1Target / countMonths;
                    const avgT2Target = totalT2Target / countMonths;
                    const avgT1Active = totalT1Active / countMonths;
                    const avgT2Active = totalT2Active / countMonths;
                    const avgT1With = totalT1With / countMonths;
                    const avgT2With = totalT2With / countMonths;
                    const avgT1AvgScale = totalT1AvgScale / countMonths;
                    const avgT2AvgScale = totalT2AvgScale / countMonths;
                    const totalTargetAll = avgT1Target + avgT2Target;
                    const totalActiveAll = avgT1Active + avgT2Active;
                    const totalWithAll = avgT1With + avgT2With;
                    // Calculate weighted average scale dynamically
                    let sumWeightedAvg = 0;
                    months.forEach((m, i) => {
                        const t1w = tierCityData.t1.withTarget[i];
                        const t2w = tierCityData.t2.withTarget[i];
                        const totalW = t1w + t2w;
                        if (totalW > 0) {
                            sumWeightedAvg += (t1w * tierCityData.t1.avgScale[i] + t2w * tierCityData.t2.avgScale[i]) / totalW;
                        }
                    });
                    const totalWeightedAvg = sumWeightedAvg / countMonths;
                    
                    // Calculate totals for Total columns
                    let sumTotalTarget = 0, sumTotalActive = 0, sumTotalWith = 0;
                    months.forEach((m, i) => {
                        sumTotalTarget += tierCityData.t1.target[i] + tierCityData.t2.target[i];
                        sumTotalActive += tierCityData.t1.active[i] + tierCityData.t2.active[i];
                        sumTotalWith += tierCityData.t1.withTarget[i] + tierCityData.t2.withTarget[i];
                    });
                    const avgTotalTarget = sumTotalTarget / countMonths;
                    const avgTotalActive = sumTotalActive / countMonths;
                    const avgTotalWith = sumTotalWith / countMonths;

                    let avgRowHtml = `<tr style="background:#e0f2fe;font-weight:700;">
                        <td style="padding:8px;border:1px solid #e5e7eb;max-width:70px;">Avg Sep–Feb</td>`;
                    
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        avgRowHtml += `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgT1Target.toFixed(0))} (${tierPct(avgT1Target,totalTargetAll).toFixed(1)}%)</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgT1Active.toFixed(0))} (${tierPct(avgT1Active,totalActiveAll).toFixed(1)}%)</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgT1With.toFixed(0))} (${tierPct(avgT1With,totalWithAll).toFixed(1)}%)</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${avgT1AvgScale.toFixed(1)}</td>`;
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        avgRowHtml += `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgT2Target.toFixed(0))} (${tierPct(avgT2Target,totalTargetAll).toFixed(1)}%)</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgT2Active.toFixed(0))} (${tierPct(avgT2Active,totalActiveAll).toFixed(1)}%)</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgT2With.toFixed(0))} (${tierPct(avgT2With,totalWithAll).toFixed(1)}%)</td>`
                            + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${avgT2AvgScale.toFixed(1)}</td>`;
                    }
                    
                    avgRowHtml += `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgTotalTarget.toFixed(0))} (100%)</td>`
                        + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgTotalActive.toFixed(0))} (100%)</td>`
                        + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${tierFmtNum(avgTotalWith.toFixed(0))} (100%)</td>`
                        + `<td style="padding:8px;border:1px solid #e5e7eb;word-wrap:break-word;overflow-wrap:break-word;">${totalWeightedAvg.toFixed(1)}</td>`
                    + `</tr>`;

                    overviewTable.innerHTML = headerHtml + avgRowHtml + '</tbody>';

                    // Performance table (partners with target)
                    const buildPerfRows = () => {
                        let h = '<thead><tr style="background:#0f172a;color:#fff;">'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">Month</th>';
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Good</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Average</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Bad</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Total</th>';
                        }
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Good</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Average</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Bad</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Total</th>';
                        }
                        h += '<th style="padding:8px;border:1px solid #e5e7eb;">Combined</th>'
                            + '</tr></thead><tbody>';
                        let sumT1 = 0, sumT2 = 0;
                        let sumT1G = 0, sumT1A = 0, sumT1B = 0;
                        let sumT2G = 0, sumT2A = 0, sumT2B = 0;
                        months.forEach((m, i) => {
                            const tg = tierCityData.perf.t1.good[i], ta = tierCityData.perf.t1.average[i], tb = tierCityData.perf.t1.bad[i];
                            const t2g = tierCityData.perf.t2.good[i], t2a = tierCityData.perf.t2.average[i], t2b = tierCityData.perf.t2.bad[i];
                            const t1Total = tg + ta + tb;
                            const t2Total = t2g + t2a + t2b;
                            const combined = t1Total + t2Total;
                            sumT1 += t1Total; sumT2 += t2Total;
                            sumT1G += tg; sumT1A += ta; sumT1B += tb;
                            sumT2G += t2g; sumT2A += t2a; sumT2B += t2b;
                            const bg = i % 2 === 0 ? '#ffffff' : '#f9fafb';
                            h += `<tr style="background:${bg};">
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;">${m}</td>`;
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(tg)} (${tierPct(tg,t1Total).toFixed(1)}%)${tierDeltaHtml(tg, i>0 ? tierCityData.perf.t1.good[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(ta)} (${tierPct(ta,t1Total).toFixed(1)}%)${tierDeltaHtml(ta, i>0 ? tierCityData.perf.t1.average[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(tb)} (${tierPct(tb,t1Total).toFixed(1)}%)${tierDeltaHtml(tb, i>0 ? tierCityData.perf.t1.bad[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t1Total)} (100%)${tierDeltaHtml(t1Total, i>0 ? (tierCityData.perf.t1.good[i-1] + tierCityData.perf.t1.average[i-1] + tierCityData.perf.t1.bad[i-1]) : null)}</td>`;
                            }
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(t2g)} (${tierPct(t2g,t2Total).toFixed(1)}%)${tierDeltaHtml(t2g, i>0 ? tierCityData.perf.t2.good[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(t2a)} (${tierPct(t2a,t2Total).toFixed(1)}%)${tierDeltaHtml(t2a, i>0 ? tierCityData.perf.t2.average[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(t2b)} (${tierPct(t2b,t2Total).toFixed(1)}%)${tierDeltaHtml(t2b, i>0 ? tierCityData.perf.t2.bad[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t2Total)} (100%)${tierDeltaHtml(t2Total, i>0 ? (tierCityData.perf.t2.good[i-1] + tierCityData.perf.t2.average[i-1] + tierCityData.perf.t2.bad[i-1]) : null)}</td>`;
                            }
                            h += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(combined)} (100%)${tierDeltaHtml(combined, i>0 ? ((tierCityData.perf.t1.good[i-1] + tierCityData.perf.t1.average[i-1] + tierCityData.perf.t1.bad[i-1]) + (tierCityData.perf.t2.good[i-1] + tierCityData.perf.t2.average[i-1] + tierCityData.perf.t2.bad[i-1])) : null)}</td>
                            </tr>`;
                        });
                    const countMonths = months.length;
                    const avgT1 = sumT1 / countMonths;
                    const avgT2 = sumT2 / countMonths;
                    const avgT1G = sumT1G / countMonths, avgT1A = sumT1A / countMonths, avgT1B = sumT1B / countMonths;
                    const avgT2G = sumT2G / countMonths, avgT2A = sumT2A / countMonths, avgT2B = sumT2B / countMonths;
                    const totalCombined = avgT1 + avgT2;
                    h += `<tr style="background:#e0f2fe;font-weight:700;">
                        <td style="padding:8px;border:1px solid #e5e7eb;">Avg Sep–Feb</td>`;
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1G.toFixed(0))} (${tierPct(avgT1G,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1A.toFixed(0))} (${tierPct(avgT1A,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1B.toFixed(0))} (${tierPct(avgT1B,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1.toFixed(0))} (100%)</td>`;
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2G.toFixed(0))} (${tierPct(avgT2G,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2A.toFixed(0))} (${tierPct(avgT2A,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2B.toFixed(0))} (${tierPct(avgT2B,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2.toFixed(0))} (100%)</td>`;
                    }
                    h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(totalCombined.toFixed(0))} (100%)</td>
                    </tr>`;
                        perfTable.innerHTML = h + '</tbody>';
                    };

                    // Scale table (partners with target)
                    const buildScaleRows = () => {
                        let h = '<thead><tr style="background:#0f172a;color:#fff;">'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">Month</th>';
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Big</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Mid</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Small</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Total</th>';
                        }
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Big</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Mid</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Small</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Total</th>';
                        }
                        h += '<th style="padding:8px;border:1px solid #e5e7eb;">Combined</th>'
                            + '</tr></thead><tbody>';
                        let sumT1 = 0, sumT2 = 0;
                        let sumB1 = 0, sumM1 = 0, sumS1 = 0;
                        let sumB2 = 0, sumM2 = 0, sumS2 = 0;
                        months.forEach((m, i) => {
                            const b1 = tierCityData.size.t1.big[i], m1 = tierCityData.size.t1.mid[i], s1 = tierCityData.size.t1.small[i];
                            const b2 = tierCityData.size.t2.big[i], m2 = tierCityData.size.t2.mid[i], s2 = tierCityData.size.t2.small[i];
                            const t1Total = b1 + m1 + s1;
                            const t2Total = b2 + m2 + s2;
                            const combined = t1Total + t2Total;
                            sumT1 += t1Total; sumT2 += t2Total;
                            sumB1 += b1; sumM1 += m1; sumS1 += s1;
                            sumB2 += b2; sumM2 += m2; sumS2 += s2;
                            const bg = i % 2 === 0 ? '#ffffff' : '#f9fafb';
                            h += `<tr style="background:${bg};">
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;">${m}</td>`;
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(b1)} (${tierPct(b1,t1Total).toFixed(1)}%)${tierDeltaHtml(b1, i>0 ? tierCityData.size.t1.big[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(m1)} (${tierPct(m1,t1Total).toFixed(1)}%)${tierDeltaHtml(m1, i>0 ? tierCityData.size.t1.mid[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(s1)} (${tierPct(s1,t1Total).toFixed(1)}%)${tierDeltaHtml(s1, i>0 ? tierCityData.size.t1.small[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t1Total)} (100%)${tierDeltaHtml(t1Total, i>0 ? (tierCityData.size.t1.big[i-1] + tierCityData.size.t1.mid[i-1] + tierCityData.size.t1.small[i-1]) : null)}</td>`;
                            }
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(b2)} (${tierPct(b2,t2Total).toFixed(1)}%)${tierDeltaHtml(b2, i>0 ? tierCityData.size.t2.big[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(m2)} (${tierPct(m2,t2Total).toFixed(1)}%)${tierDeltaHtml(m2, i>0 ? tierCityData.size.t2.mid[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(s2)} (${tierPct(s2,t2Total).toFixed(1)}%)${tierDeltaHtml(s2, i>0 ? tierCityData.size.t2.small[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t2Total)} (100%)${tierDeltaHtml(t2Total, i>0 ? (tierCityData.size.t2.big[i-1] + tierCityData.size.t2.mid[i-1] + tierCityData.size.t2.small[i-1]) : null)}</td>`;
                            }
                            h += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(combined)} (100%)${tierDeltaHtml(combined, i>0 ? ((tierCityData.size.t1.big[i-1] + tierCityData.size.t1.mid[i-1] + tierCityData.size.t1.small[i-1]) + (tierCityData.size.t2.big[i-1] + tierCityData.size.t2.mid[i-1] + tierCityData.size.t2.small[i-1])) : null)}</td>
                            </tr>`;
                        });
                    const countMonths = months.length;
                    const avgT1 = sumT1 / countMonths;
                    const avgT2 = sumT2 / countMonths;
                    const avgB1 = sumB1 / countMonths, avgM1 = sumM1 / countMonths, avgS1 = sumS1 / countMonths;
                    const avgB2 = sumB2 / countMonths, avgM2 = sumM2 / countMonths, avgS2 = sumS2 / countMonths;
                    const totalCombined = avgT1 + avgT2;
                    h += `<tr style="background:#e0f2fe;font-weight:700;">
                        <td style="padding:8px;border:1px solid #e5e7eb;">Avg Sep–Feb</td>`;
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgB1.toFixed(0))} (${tierPct(avgB1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgM1.toFixed(0))} (${tierPct(avgM1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgS1.toFixed(0))} (${tierPct(avgS1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1.toFixed(0))} (100%)</td>`;
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgB2.toFixed(0))} (${tierPct(avgB2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgM2.toFixed(0))} (${tierPct(avgM2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgS2.toFixed(0))} (${tierPct(avgS2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2.toFixed(0))} (100%)</td>`;
                    }
                    h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(totalCombined.toFixed(0))} (100%)</td>
                    </tr>`;
                        scaleTable.innerHTML = h + '</tbody>';
                    };

                    // Target performance table (values)
                    const buildTargetPerf = () => {
                        let h = '<thead><tr style="background:#111827;color:#fff;">'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">Month</th>';
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Good</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Average</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Bad</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Total</th>';
                        }
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Good</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Average</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Bad</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Total</th>';
                        }
                        h += '<th style="padding:8px;border:1px solid #e5e7eb;">Combined</th>'
                            + '</tr></thead><tbody>';
                        let sumT1 = 0, sumT2 = 0;
                        let sumG1 = 0, sumA1 = 0, sumB1 = 0;
                        let sumG2 = 0, sumA2 = 0, sumB2 = 0;
                        months.forEach((m, i) => {
                            const g1 = tierCityData.targetPerf.t1.good[i], a1 = tierCityData.targetPerf.t1.average[i], b1 = tierCityData.targetPerf.t1.bad[i];
                            const g2 = tierCityData.targetPerf.t2.good[i], a2 = tierCityData.targetPerf.t2.average[i], b2 = tierCityData.targetPerf.t2.bad[i];
                            const t1Total = g1 + a1 + b1;
                            const t2Total = g2 + a2 + b2;
                            const combined = t1Total + t2Total;
                            sumT1 += t1Total; sumT2 += t2Total;
                            sumG1 += g1; sumA1 += a1; sumB1 += b1;
                            sumG2 += g2; sumA2 += a2; sumB2 += b2;
                            const bg = i % 2 === 0 ? '#ffffff' : '#f9fafb';
                            h += `<tr style="background:${bg};">
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;">${m}</td>`;
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(g1)} (${tierPct(g1,t1Total).toFixed(1)}%)${tierDeltaHtml(g1, i>0 ? tierCityData.targetPerf.t1.good[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(a1)} (${tierPct(a1,t1Total).toFixed(1)}%)${tierDeltaHtml(a1, i>0 ? tierCityData.targetPerf.t1.average[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(b1)} (${tierPct(b1,t1Total).toFixed(1)}%)${tierDeltaHtml(b1, i>0 ? tierCityData.targetPerf.t1.bad[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t1Total)} (100%)${tierDeltaHtml(t1Total, i>0 ? (tierCityData.targetPerf.t1.good[i-1] + tierCityData.targetPerf.t1.average[i-1] + tierCityData.targetPerf.t1.bad[i-1]) : null)}</td>`;
                            }
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(g2)} (${tierPct(g2,t2Total).toFixed(1)}%)${tierDeltaHtml(g2, i>0 ? tierCityData.targetPerf.t2.good[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(a2)} (${tierPct(a2,t2Total).toFixed(1)}%)${tierDeltaHtml(a2, i>0 ? tierCityData.targetPerf.t2.average[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(b2)} (${tierPct(b2,t2Total).toFixed(1)}%)${tierDeltaHtml(b2, i>0 ? tierCityData.targetPerf.t2.bad[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t2Total)} (100%)${tierDeltaHtml(t2Total, i>0 ? (tierCityData.targetPerf.t2.good[i-1] + tierCityData.targetPerf.t2.average[i-1] + tierCityData.targetPerf.t2.bad[i-1]) : null)}</td>`;
                            }
                            h += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(combined)} (100%)${tierDeltaHtml(combined, i>0 ? ((tierCityData.targetPerf.t1.good[i-1] + tierCityData.targetPerf.t1.average[i-1] + tierCityData.targetPerf.t1.bad[i-1]) + (tierCityData.targetPerf.t2.good[i-1] + tierCityData.targetPerf.t2.average[i-1] + tierCityData.targetPerf.t2.bad[i-1])) : null)}</td>
                            </tr>`;
                        });
                    const countMonths = months.length;
                    const avgT1 = sumT1 / countMonths;
                    const avgT2 = sumT2 / countMonths;
                    const avgG1 = sumG1 / countMonths, avgA1 = sumA1 / countMonths, avgB1 = sumB1 / countMonths;
                    const avgG2 = sumG2 / countMonths, avgA2 = sumA2 / countMonths, avgB2 = sumB2 / countMonths;
                    const totalCombined = avgT1 + avgT2;
                    h += `<tr style="background:#e0f2fe;font-weight:700;">
                        <td style="padding:8px;border:1px solid #e5e7eb;">Avg Sep–Feb</td>`;
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgG1.toFixed(0))} (${tierPct(avgG1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgA1.toFixed(0))} (${tierPct(avgA1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgB1.toFixed(0))} (${tierPct(avgB1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1.toFixed(0))} (100%)</td>`;
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgG2.toFixed(0))} (${tierPct(avgG2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgA2.toFixed(0))} (${tierPct(avgA2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgB2.toFixed(0))} (${tierPct(avgB2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2.toFixed(0))} (100%)</td>`;
                    }
                    h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(totalCombined.toFixed(0))} (100%)</td>
                    </tr>`;
                        targetPerfTable.innerHTML = h + '</tbody>';
                    };

                    // Target scale table (values)
                    const buildTargetScale = () => {
                        let h = '<thead><tr style="background:#111827;color:#fff;">'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">Month</th>';
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Big</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Mid</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Small</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T1 Total</th>';
                        }
                        if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                            h += '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Big</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Mid</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Small</th>'
                            + '<th style="padding:8px;border:1px solid #e5e7eb;">T2 Total</th>';
                        }
                        h += '<th style="padding:8px;border:1px solid #e5e7eb;">Combined</th>'
                            + '</tr></thead><tbody>';
                        let sumT1 = 0, sumT2 = 0;
                        let sumB1 = 0, sumM1 = 0, sumS1 = 0;
                        let sumB2 = 0, sumM2 = 0, sumS2 = 0;
                        months.forEach((m, i) => {
                            const b1 = tierCityData.targetSize.t1.big[i], m1 = tierCityData.targetSize.t1.mid[i], s1 = tierCityData.targetSize.t1.small[i];
                            const b2 = tierCityData.targetSize.t2.big[i], m2 = tierCityData.targetSize.t2.mid[i], s2 = tierCityData.targetSize.t2.small[i];
                            const t1Total = b1 + m1 + s1;
                            const t2Total = b2 + m2 + s2;
                            const combined = t1Total + t2Total;
                            sumT1 += t1Total; sumT2 += t2Total;
                            sumB1 += b1; sumM1 += m1; sumS1 += s1;
                            sumB2 += b2; sumM2 += m2; sumS2 += s2;
                            const bg = i % 2 === 0 ? '#ffffff' : '#f9fafb';
                            h += `<tr style="background:${bg};">
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;">${m}</td>`;
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(b1)} (${tierPct(b1,t1Total).toFixed(1)}%)${tierDeltaHtml(b1, i>0 ? tierCityData.targetSize.t1.big[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(m1)} (${tierPct(m1,t1Total).toFixed(1)}%)${tierDeltaHtml(m1, i>0 ? tierCityData.targetSize.t1.mid[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(s1)} (${tierPct(s1,t1Total).toFixed(1)}%)${tierDeltaHtml(s1, i>0 ? tierCityData.targetSize.t1.small[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t1Total)} (100%)${tierDeltaHtml(t1Total, i>0 ? (tierCityData.targetSize.t1.big[i-1] + tierCityData.targetSize.t1.mid[i-1] + tierCityData.targetSize.t1.small[i-1]) : null)}</td>`;
                            }
                            if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                                h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(b2)} (${tierPct(b2,t2Total).toFixed(1)}%)${tierDeltaHtml(b2, i>0 ? tierCityData.targetSize.t2.big[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(m2)} (${tierPct(m2,t2Total).toFixed(1)}%)${tierDeltaHtml(m2, i>0 ? tierCityData.targetSize.t2.mid[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(s2)} (${tierPct(s2,t2Total).toFixed(1)}%)${tierDeltaHtml(s2, i>0 ? tierCityData.targetSize.t2.small[i-1] : null)}</td>
                                <td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(t2Total)} (100%)${tierDeltaHtml(t2Total, i>0 ? (tierCityData.targetSize.t2.big[i-1] + tierCityData.targetSize.t2.mid[i-1] + tierCityData.targetSize.t2.small[i-1]) : null)}</td>`;
                            }
                            h += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:700;">${tierFmtNum(combined)} (100%)${tierDeltaHtml(combined, i>0 ? ((tierCityData.targetSize.t1.big[i-1] + tierCityData.targetSize.t1.mid[i-1] + tierCityData.targetSize.t1.small[i-1]) + (tierCityData.targetSize.t2.big[i-1] + tierCityData.targetSize.t2.mid[i-1] + tierCityData.targetSize.t2.small[i-1])) : null)}</td>
                            </tr>`;
                        });
                    const countMonths = months.length;
                    const avgT1 = sumT1 / countMonths;
                    const avgT2 = sumT2 / countMonths;
                    const avgB1 = sumB1 / countMonths, avgM1 = sumM1 / countMonths, avgS1 = sumS1 / countMonths;
                    const avgB2 = sumB2 / countMonths, avgM2 = sumM2 / countMonths, avgS2 = sumS2 / countMonths;
                    const totalCombined = avgT1 + avgT2;
                    h += `<tr style="background:#e0f2fe;font-weight:700;">
                        <td style="padding:8px;border:1px solid #e5e7eb;">Avg Sep–Feb</td>`;
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgB1.toFixed(0))} (${tierPct(avgB1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgM1.toFixed(0))} (${tierPct(avgM1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgS1.toFixed(0))} (${tierPct(avgS1,avgT1).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT1.toFixed(0))} (100%)</td>`;
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgB2.toFixed(0))} (${tierPct(avgB2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgM2.toFixed(0))} (${tierPct(avgM2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgS2.toFixed(0))} (${tierPct(avgS2,avgT2).toFixed(1)}%)</td>
                        <td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(avgT2.toFixed(0))} (100%)</td>`;
                    }
                    h += `<td style="padding:8px;border:1px solid #e5e7eb;">${tierFmtNum(totalCombined.toFixed(0))} (100%)</td>
                    </tr>`;
                        targetScaleTable.innerHTML = h + '</tbody>';
                    };

                    buildPerfRows();
                    buildScaleRows();
                    buildTargetPerf();
                    buildTargetScale();
                }

                let tierTargetChart, tierPartnersChart;
                function buildTierCharts() {
                    const months = tierCityData.months;
                    let t1Target = tierFilterSelected === 't2' ? [] : tierCityData.t1.target;
                    let t2Target = tierFilterSelected === 't1' ? [] : tierCityData.t2.target;
                    let totalTarget = months.map((_, i) => (t1Target[i] || 0) + (t2Target[i] || 0));

                    let t1With = tierFilterSelected === 't2' ? [] : tierCityData.t1.withTarget;
                    let t2With = tierFilterSelected === 't1' ? [] : tierCityData.t2.withTarget;
                    let totalWith = months.map((_, i) => (t1With[i] || 0) + (t2With[i] || 0));

                    const targetCtx = document.getElementById('tierTargetChart');
                    const partnersCtx = document.getElementById('tierPartnersChart');
                    if (!targetCtx || !partnersCtx || typeof Chart === 'undefined') return;

                    if (tierTargetChart) tierTargetChart.destroy();
                    if (tierPartnersChart) tierPartnersChart.destroy();

                    let targetDatasets = [];
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        targetDatasets.push({ label: 'T1 Target', data: t1Target, backgroundColor: '#2563eb' });
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        targetDatasets.push({ label: 'T2 Target', data: t2Target, backgroundColor: '#60a5fa' });
                    }
                    targetDatasets.push({ label: 'Total Target (line)', data: totalTarget, type: 'line', borderColor: '#111827', borderWidth: 2.5, tension: 0.25, pointRadius: 4, pointBorderWidth: 0, yAxisID: 'y', fill: false });

                    tierTargetChart = new Chart(targetCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: targetDatasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true },
                            plugins: {
                                legend: { position: 'top' },
                                datalabels: {
                                    display: true,
                                    color: (ctx) => ctx.dataset.type === 'line' ? '#0f172a' : '#ffffff',
                                    font: { weight: '700', size: 11 },
                                    anchor: 'center',
                                    align: 'center',
                                    clip: false,
                                    formatter: (value, ctx) => {
                                        if (ctx.dataset.type === 'line') return tierFmtNum(value);
                                        const total = ctx.chart.data.datasets
                                            .filter(ds => !ds.type || ds.type === 'bar')
                                            .reduce((acc, ds) => acc + (ds.data[ctx.dataIndex] || 0), 0);
                                        const pct = tierPct(value, total).toFixed(1);
                                        return `${tierFmtNum(value)}\n(${pct}%)`;
                                    }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } }
                            }
                        },
                        plugins: [ChartDataLabels]
                    });

                    let partnersDatasets = [];
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't1') {
                        partnersDatasets.push({ label: 'T1 Partners with Target', data: t1With, backgroundColor: '#10b981' });
                    }
                    if (tierFilterSelected === 'both' || tierFilterSelected === 't2') {
                        partnersDatasets.push({ label: 'T2 Partners with Target', data: t2With, backgroundColor: '#34d399' });
                    }
                    partnersDatasets.push({ label: 'Total (line)', data: totalWith, type: 'line', borderColor: '#0f172a', borderWidth: 2.5, tension: 0.25, pointRadius: 4, pointBorderWidth: 0, yAxisID: 'y', fill: false });

                    tierPartnersChart = new Chart(partnersCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: partnersDatasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true },
                            plugins: {
                                legend: { position: 'top' },
                                datalabels: {
                                    display: true,
                                    color: (ctx) => ctx.dataset.type === 'line' ? '#0f172a' : '#ffffff',
                                    font: { weight: '700', size: 11 },
                                    anchor: 'center',
                                    align: 'center',
                                    clip: false,
                                    formatter: (value, ctx) => {
                                        if (ctx.dataset.type === 'line') return tierFmtNum(value);
                                        const total = ctx.chart.data.datasets
                                            .filter(ds => !ds.type || ds.type === 'bar')
                                            .reduce((acc, ds) => acc + (ds.data[ctx.dataIndex] || 0), 0);
                                        const pct = tierPct(value, total).toFixed(1);
                                        return `${tierFmtNum(value)}\n(${pct}%)`;
                                    }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } }
                            }
                        },
                        plugins: [ChartDataLabels]
                    });
                }

                // City-wise data
                const cityWiseData = {
                    cities: ['Abha', 'Al Ahsa', 'Al Kharj', 'Buraydah', 'Dammam', 'Hafar Al Batin', 'Hail', 'Jazan', 'Jeddah', 'Jubail', 'Makkah', 'Medina', 'Najran', 'Riyadh', 'Tabuk', 'Taif', 'Yanbu'],
                    months: ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'],
                    data: {
                        'Abha': { partners: [29, 27, 26, 19, 18, 15], target: [729, 678, 627, 354, 339, 297] },
                        'Al Ahsa': { partners: [38, 37, 36, 33, 32, 28], target: [1308, 1320, 1279, 936, 858, 818] },
                        'Al Kharj': { partners: [7, 7, 8, 7, 7, 8], target: [550, 590, 530, 386, 380, 347] },
                        'Buraydah': { partners: [18, 19, 19, 16, 13, 10], target: [537, 538, 485, 310, 296, 253] },
                        'Dammam': { partners: [71, 82, 89, 76, 76, 64], target: [3600, 3923, 4042, 2803, 2641, 2127] },
                        'Hafar Al Batin': { partners: [13, 13, 12, 8, 8, 7], target: [297, 307, 257, 124, 128, 109] },
                        'Hail': { partners: [14, 14, 13, 7, 7, 5], target: [340, 334, 360, 208, 199, 186] },
                        'Jazan': { partners: [10, 9, 7, 5, 5, 3], target: [188, 212, 173, 92, 95, 74] },
                        'Jeddah': { partners: [84, 106, 131, 116, 95, 83], target: [5155, 5881, 6283, 4500, 4094, 3454] },
                        'Jubail': { partners: [16, 16, 16, 12, 11, 10], target: [450, 471, 432, 275, 244, 230] },
                        'Makkah': { partners: [45, 54, 57, 50, 47, 41], target: [1777, 1760, 1722, 1165, 1074, 935] },
                        'Medina': { partners: [43, 49, 56, 52, 46, 37], target: [2049, 1997, 2028, 1378, 1195, 1131] },
                        'Najran': { partners: [7, 8, 7, 5, 5, 5], target: [200, 169, 145, 82, 76, 78] },
                        'Riyadh': { partners: [158, 199, 231, 226, 215, 200], target: [14086, 14452, 15044, 10712, 10028, 8661] },
                        'Tabuk': { partners: [21, 19, 19, 13, 13, 11], target: [420, 410, 475, 258, 252, 202] },
                        'Taif': { partners: [27, 24, 27, 18, 16, 14], target: [755, 651, 653, 389, 345, 292] },
                        'Yanbu': { partners: [14, 14, 13, 11, 11, 10], target: [352, 313, 302, 210, 209, 171] }
                    }
                };

                let currentCityFilter = [];
                const t1Cities = ['Riyadh', 'Jeddah', 'Dammam', 'Medina', 'Makkah', 'Al Kharj', 'Al Ahsa'];
                const t2Cities = ['Abha', 'Buraydah', 'Hafar Al Batin', 'Hail', 'Jazan', 'Jubail', 'Najran', 'Tabuk', 'Taif', 'Yanbu'];
                let citySortState = { key: null, dir: 'desc' };

                // Partner Age Analysis Data
                const partnerAgeData = {
                    months: ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'],
                    categories: ['New <1 month', 'New <3 months', 'Old >3 months'],
                    data: {
                        'New <1 month': {
                            count: [130, 166, 113, 173, 63, 27],
                            activeCount: [51, 148, 92, 128, 56, 26],
                            target: [1852, 4864, 2600, 2959, 1380, 583],
                            avgScale: [36.3, 32.9, 28.3, 23.1, 24.6, 22.4],
                            goodPartners: [12, 30, 28, 23, 15, 3],
                            avgPartners: [20, 50, 30, 33, 5, 2],
                            badPartners: [19, 63, 26, 38, 28, 4],
                            goodTarget: [380, 1085, 875, 572, 396, 50],
                            avgTarget: [559, 1578, 850, 729, 115, 67],
                            badTarget: [913, 2106, 702, 824, 659, 77],
                            goodAvgScale: [31.7, 36.2, 31.3, 24.9, 26.4, 16.7],
                            avgAvgScale: [28.0, 31.6, 28.3, 22.1, 23.0, 33.5],
                            badAvgScale: [48.1, 33.4, 27.0, 21.7, 23.5, 19.3],
                            bigPartners: [2, 3, 0, 0, 0, 0],
                            midPartners: [16, 40, 12, 14, 5, 1],
                            smallPartners: [33, 100, 72, 80, 43, 8],
                            bigTarget: [85, 161, 0, 0, 0, 0],
                            midTarget: [455, 1452, 448, 498, 161, 42],
                            smallTarget: [1312, 3156, 1979, 1627, 1009, 152],
                            bigAvgScale: [42.5, 53.7, null, null, 0.0, 0.0],
                            midAvgScale: [28.4, 36.3, 37.3, 35.6, 32.2, 42.0],
                            smallAvgScale: [39.8, 31.6, 27.5, 20.3, 23.5, 19.0]
                        },
                        'New <3 months': {
                            count: [120, 131, 208, 231, 161, 131],
                            activeCount: [86, 105, 174, 175, 144, 101],
                            target: [2584, 3449, 6455, 5198, 3574, 2379],
                            avgScale: [30.0, 32.8, 37.1, 29.7, 24.8, 23.6],
                            goodPartners: [34, 45, 64, 64, 42, 38],
                            avgPartners: [36, 47, 68, 85, 74, 55],
                            badPartners: [16, 13, 41, 26, 28, 8],
                            goodTarget: [1177, 1665, 2729, 2411, 1208, 1050],
                            avgTarget: [1024, 1484, 2304, 2229, 1863, 1193],
                            badTarget: [383, 300, 1397, 558, 503, 136],
                            goodAvgScale: [34.6, 37.0, 42.6, 37.7, 28.8, 27.6],
                            avgAvgScale: [28.4, 31.6, 33.9, 26.2, 25.2, 21.7],
                            badAvgScale: [23.9, 23.1, 34.1, 21.5, 18.0, 17.0],
                            bigPartners: [19, 24, 14, 14, 9, 0],
                            midPartners: [56, 68, 98, 100, 56, 13],
                            smallPartners: [11, 13, 61, 61, 79, 88],
                            bigTarget: [985, 1042, 658, 683, 477, 0],
                            midTarget: [1428, 2060, 4165, 3339, 1677, 506],
                            smallTarget: [171, 347, 1607, 1176, 1420, 1873],
                            bigAvgScale: [51.8, 43.4, 47.0, 48.8, 53.0, 0.0],
                            midAvgScale: [25.5, 30.3, 42.5, 33.4, 29.9, 38.9],
                            smallAvgScale: [15.5, 26.7, 26.3, 19.3, 18.0, 21.3]
                        },
                        'Old >3 months': {
                            count: [512, 454, 559, 447, 463, 485],
                            activeCount: [478, 444, 501, 371, 425, 424],
                            target: [28357, 25693, 25782, 16025, 17499, 16403],
                            avgScale: [59.3, 57.9, 51.5, 43.2, 41.2, 38.7],
                            goodPartners: [114, 115, 113, 136, 212, 211],
                            avgPartners: [151, 152, 177, 167, 195, 205],
                            badPartners: [90, 67, 93, 58, 17, 8],
                            goodTarget: [9672, 8333, 7814, 8036, 10745, 9092],
                            avgTarget: [11315, 11533, 10997, 6300, 6352, 7154],
                            badTarget: [3794, 3095, 4350, 1497, 372, 157],
                            goodAvgScale: [84.8, 72.5, 69.2, 59.1, 50.7, 43.1],
                            avgAvgScale: [74.9, 75.9, 62.1, 37.7, 32.6, 34.9],
                            badAvgScale: [42.2, 46.2, 46.8, 25.8, 21.9, 19.6],
                            bigPartners: [38, 47, 68, 73, 72, 77],
                            midPartners: [190, 214, 229, 221, 214, 268],
                            smallPartners: [127, 73, 86, 67, 138, 79],
                            bigTarget: [6127, 6703, 7984, 6058, 4461, 5351],
                            midTarget: [14095, 14197, 12640, 8515, 8760, 9434],
                            smallTarget: [4559, 2061, 2537, 1260, 4248, 1618],
                            bigAvgScale: [161.2, 142.6, 117.4, 83.0, 62.0, 69.5],
                            midAvgScale: [74.2, 66.3, 55.2, 38.5, 40.9, 35.2],
                            smallAvgScale: [35.9, 28.2, 29.5, 18.8, 30.8, 20.5]
                        }
                    }
                };

                let partnerAgeSortState = { key: null, dir: 'desc' };
                let partnerAgeSelectedMonths = null;


                function buildCityWiseTable(filteredCities = null) {
                    const table = document.getElementById('cityWiseTable');
                    if (!table) return;
                    
                    const activeFilter = filteredCities || (currentCityFilter && currentCityFilter.length ? currentCityFilter : null);
                    const citiesToShow = activeFilter || cityWiseData.cities;

                    const getArrow = (key) => {
                        if (citySortState.key !== key) return '↕';
                        return citySortState.dir === 'asc' ? '↑' : '↓';
                    };

                    const getSortValue = (city, key) => {
                        if (key === 'city') return city.toLowerCase();
                        const [metric, idxStr] = key.split('_');
                        const idx = parseInt(idxStr, 10);
                        const data = cityWiseData.data[city];
                        if (!data || Number.isNaN(idx)) return Number.NEGATIVE_INFINITY;
                        if (metric === 'partners') return data.partners[idx];
                        if (metric === 'target') return data.target[idx];
                        if (metric === 'avgscale') {
                            return data.partners[idx] > 0 ? data.target[idx] / data.partners[idx] : 0;
                        }
                        return Number.NEGATIVE_INFINITY;
                    };

                    let sortedCities = [...citiesToShow];
                    if (citySortState.key) {
                        sortedCities.sort((a, b) => {
                            const aVal = getSortValue(a, citySortState.key);
                            const bVal = getSortValue(b, citySortState.key);
                            const isString = typeof aVal === 'string' || typeof bVal === 'string';
                            if (isString) {
                                return citySortState.dir === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                            }
                            const aNum = Number.isFinite(aVal) ? aVal : Number.NEGATIVE_INFINITY;
                            const bNum = Number.isFinite(bVal) ? bVal : Number.NEGATIVE_INFINITY;
                            return citySortState.dir === 'asc' ? aNum - bNum : bNum - aNum;
                        });
                    }
                    
                    let html = `<thead><tr style="background:#1e5a8e;color:#fff;"><th class="city-sortable" data-sort-key="city" style="padding:8px;border:1px solid #e5e7eb;cursor:pointer;" rowspan="2">City <span style="font-size:11px;">${getArrow('city')}</span></th>`;
                    
                    cityWiseData.months.forEach(m => {
                        html += `<th style="padding:8px;border:1px solid #e5e7eb;" colspan="3">${m}</th>`;
                    });
                    
                    html += '</tr><tr style="background:#1e5a8e;color:#fff;">';
                    for (let i = 0; i < cityWiseData.months.length; i++) {
                        html += `<th class="city-sortable" data-sort-key="partners_${i}" style="padding:8px;border:1px solid #e5e7eb;font-size:11px;cursor:pointer;">Partners <span style="font-size:10px;">${getArrow(`partners_${i}`)}</span></th>`;
                        html += `<th class="city-sortable" data-sort-key="target_${i}" style="padding:8px;border:1px solid #e5e7eb;font-size:11px;cursor:pointer;">Target <span style="font-size:10px;">${getArrow(`target_${i}`)}</span></th>`;
                        html += `<th class="city-sortable" data-sort-key="avgscale_${i}" style="padding:8px;border:1px solid #e5e7eb;font-size:11px;cursor:pointer;">Avg Scale <span style="font-size:10px;">${getArrow(`avgscale_${i}`)}</span></th>`;
                    }
                    html += '</tr></thead><tbody>';
                    
                    sortedCities.forEach(city => {
                        const cityData = cityWiseData.data[city];
                        html += `<tr style="background:${cityWiseData.cities.indexOf(city) % 2 === 0 ? '#ffffff' : '#f9fafb'};">`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;white-space:nowrap;">${city}</td>`;
                        
                        cityData.partners.forEach((partners, idx) => {
                            const target = cityData.target[idx];
                            const prevTarget = idx > 0 ? cityData.target[idx - 1] : null;
                            const momPct = prevTarget ? (((target - prevTarget) / prevTarget) * 100).toFixed(1) : null;
                            const momHtml = momPct !== null ? ` <span style="color:${parseFloat(momPct) >= 0 ? '#10b981' : '#dc2626'};font-weight:600;font-size:10px;">${parseFloat(momPct) >= 0 ? '↑' : '↓'} ${Math.abs(momPct)}%</span>` : '';
                            
                            const avgScale = partners > 0 ? (target / partners).toFixed(1) : '0.0';
                            const prevPartners = idx > 0 ? cityData.partners[idx - 1] : null;
                            const prevAvgScaleRaw = (prevPartners && prevPartners > 0 && prevTarget) ? (prevTarget / prevPartners) : null;
                            const curAvgScaleRaw = partners > 0 ? target / partners : 0;
                            const prevAvgScaleRounded = prevAvgScaleRaw !== null ? Number(prevAvgScaleRaw.toFixed(1)) : null;
                            const curAvgScaleRounded = Number(curAvgScaleRaw.toFixed(1));
                            const avgScaleMom = prevAvgScaleRounded !== null && prevAvgScaleRounded !== 0
                                ? (((curAvgScaleRounded - prevAvgScaleRounded) / prevAvgScaleRounded) * 100).toFixed(1)
                                : null;
                            const avgScaleMomHtml = avgScaleMom !== null ? ` <span style="color:${parseFloat(avgScaleMom) >= 0 ? '#10b981' : '#dc2626'};font-weight:600;font-size:10px;">${parseFloat(avgScaleMom) >= 0 ? '↑' : '↓'} ${Math.abs(avgScaleMom)}%</span>` : '';
                            
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${partners}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${target.toLocaleString()}${momHtml}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${avgScale}${avgScaleMomHtml}</td>`;
                        });
                        
                        html += '</tr>';
                    });
                    
                    // Grand Total row
                    html += `<tr style="background:#e5e7eb;font-weight:bold;">`;
                    html += `<td style="padding:8px;border:1px solid #e5e7eb;">Grand Total</td>`;
                    
                    cityWiseData.months.forEach((m, idx) => {
                        let totalPartners = 0, totalTarget = 0, prevTotalTarget = 0, prevTotalPartners = 0;
                        citiesToShow.forEach(city => {
                            totalPartners += cityWiseData.data[city].partners[idx];
                            totalTarget += cityWiseData.data[city].target[idx];
                            if (idx > 0) {
                                prevTotalTarget += cityWiseData.data[city].target[idx - 1];
                                prevTotalPartners += cityWiseData.data[city].partners[idx - 1];
                            }
                        });
                        
                        const momPct = idx > 0 ? (((totalTarget - prevTotalTarget) / prevTotalTarget) * 100).toFixed(1) : null;
                        const momHtml = momPct !== null ? ` <span style="color:${parseFloat(momPct) >= 0 ? '#10b981' : '#dc2626'};font-weight:600;font-size:10px;">${parseFloat(momPct) >= 0 ? '↑' : '↓'} ${Math.abs(momPct)}%</span>` : '';
                        
                        const totalAvgScale = totalPartners > 0 ? (totalTarget / totalPartners).toFixed(1) : '0.0';
                        const prevAvgScaleRaw = (idx > 0 && prevTotalPartners > 0) ? (prevTotalTarget / prevTotalPartners) : null;
                        const curAvgScaleRaw = totalPartners > 0 ? totalTarget / totalPartners : 0;
                        const prevAvgScaleRounded = prevAvgScaleRaw !== null ? Number(prevAvgScaleRaw.toFixed(1)) : null;
                        const curAvgScaleRounded = Number(curAvgScaleRaw.toFixed(1));
                        const avgScaleMom = prevAvgScaleRounded !== null && prevAvgScaleRounded !== 0
                            ? (((curAvgScaleRounded - prevAvgScaleRounded) / prevAvgScaleRounded) * 100).toFixed(1)
                            : null;
                        const avgScaleMomHtml = avgScaleMom !== null ? ` <span style="color:${parseFloat(avgScaleMom) >= 0 ? '#10b981' : '#dc2626'};font-weight:600;font-size:10px;">${parseFloat(avgScaleMom) >= 0 ? '↑' : '↓'} ${Math.abs(avgScaleMom)}%</span>` : '';
                        
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${totalPartners}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${totalTarget.toLocaleString()}${momHtml}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${totalAvgScale}${avgScaleMomHtml}</td>`;
                    });
                    
                    html += '</tr></tbody>';
                    table.innerHTML = html;

                    // Attach sorting handlers
                    table.querySelectorAll('.city-sortable').forEach(th => {
                        th.addEventListener('click', () => {
                            const key = th.getAttribute('data-sort-key');
                            if (citySortState.key === key) {
                                citySortState.dir = citySortState.dir === 'asc' ? 'desc' : 'asc';
                            } else {
                                citySortState.key = key;
                                citySortState.dir = 'desc';
                            }
                            buildCityWiseTable(activeFilter);
                        });
                    });
                }

                let cityTargetChart, cityPartnersChart, cityCombinedTrendChart;
                let selectedMonths = null; // Track selected months
                let selectedCities = []; // Track selected cities

                function buildCityCharts(monthIndices = null, filteredCities = null) {
                    const trendCtx = document.getElementById('cityTargetTrendChart');
                    const partnersCtx = document.getElementById('cityPartnersChart');
                    const combinedCtx = document.getElementById('cityCombinedTrendChart');
                    if (!trendCtx || !partnersCtx || !combinedCtx || typeof Chart === 'undefined') return;
                    
                    // Destroy existing charts if they exist
                    if (cityTargetChart) cityTargetChart.destroy();
                    if (cityPartnersChart) cityPartnersChart.destroy();
                    if (cityCombinedTrendChart) cityCombinedTrendChart.destroy();
                    
                    // If monthIndices not provided, use all months
                    if (!monthIndices) monthIndices = [0, 1, 2, 3, 4, 5];
                    
                    const monthLabels = monthIndices.map(i => cityWiseData.months[i]);
                    
                    const datasets = [];
                    const colors = ['#1e3a8a', '#1e40af', '#2563eb', '#3b82f6', '#60a5fa', '#93c5fd', '#dbeafe'];
                    const citiesToShow = filteredCities || cityWiseData.cities;
                    
                    citiesToShow.forEach((city, idx) => {
                        const tierTag = t1Cities.includes(city) ? 'T1' : 'T2';
                        const selectedData = monthIndices.map(i => cityWiseData.data[city].target[i]);
                        datasets.push({
                            label: `${tierTag} · ${city}`,
                            data: selectedData,
                            borderColor: colors[idx % colors.length],
                            backgroundColor: colors[idx % colors.length] + '20',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false
                        });
                    });
                    
                    cityTargetChart = new Chart(trendCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: monthLabels,
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true }, // show only the hovered city
                            plugins: {
                                legend: { position: 'right', maxWidth: 150 },
                                tooltip: {
                                    mode: 'nearest',
                                    intersect: true,
                                    callbacks: {
                                        label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}`
                                    }
                                },
                                datalabels: {
                                    // show first (Aug) and last (Jan) points only
                                    display: (ctx) => ctx.dataIndex === 0 || ctx.dataIndex === ctx.dataset.data.length - 1,
                                    align: 'end',
                                    anchor: 'end',
                                    backgroundColor: 'rgba(255,255,255,0.9)',
                                    borderRadius: 4,
                                    padding: 4,
                                    color: '#111827',
                                    font: { size: 11, weight: '600' }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() }, grid: { color: 'rgba(107,114,128,0.15)', lineWidth: 1, drawBorder: false } },
                                x: { grid: { color: 'rgba(107,114,128,0.12)', lineWidth: 1, drawBorder: false } }
                            }
                        }
                    });
                    
                    const partnerDatasets = [];
                    citiesToShow.forEach((city, idx) => {
                        const tierTag = t1Cities.includes(city) ? 'T1' : 'T2';
                        const selectedData = monthIndices.map(i => cityWiseData.data[city].partners[i]);
                        partnerDatasets.push({
                            label: `${tierTag} · ${city}`,
                            data: selectedData,
                            borderColor: colors[idx % colors.length],
                            backgroundColor: colors[idx % colors.length] + '20',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false
                        });
                    });
                    
                    cityPartnersChart = new Chart(partnersCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: monthLabels,
                            datasets: partnerDatasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true }, // show only the hovered city
                            plugins: {
                                legend: { position: 'right', maxWidth: 150 },
                                tooltip: {
                                    mode: 'nearest',
                                    intersect: true,
                                    callbacks: {
                                        label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}`
                                    }
                                },
                                datalabels: {
                                    // show first (Aug) and last (Jan) points only
                                    display: (ctx) => ctx.dataIndex === 0 || ctx.dataIndex === ctx.dataset.data.length - 1,
                                    align: 'end',
                                    anchor: 'end',
                                    backgroundColor: 'rgba(255,255,255,0.9)',
                                    borderRadius: 4,
                                    padding: 4,
                                    color: '#111827',
                                    font: { size: 11, weight: '600' }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() }, grid: { color: 'rgba(107,114,128,0.15)', lineWidth: 1, drawBorder: false } },
                                x: { grid: { color: 'rgba(107,114,128,0.12)', lineWidth: 1, drawBorder: false } }
                            }
                        }
                    });

                    // Build Avg Scale line per city
                    const calcMomSeries = (series) => series.map((val, idx) => {
                        if (idx === 0) return null;
                        const prev = series[idx - 1];
                        if (!prev) return null;
                        return Number((((val - prev) / prev) * 100).toFixed(1));
                    });

                    const avgScaleDatasets = [];
                    citiesToShow.forEach((city, idx) => {
                        const tierTag = t1Cities.includes(city) ? 'T1' : 'T2';
                        const cData = cityWiseData.data[city];
                        const targetSeries = monthIndices.map(i => cData.target[i]);
                        const partnersSeries = monthIndices.map(i => cData.partners[i]);
                        const avgScaleSeries = targetSeries.map((t, j) => partnersSeries[j] > 0 ? Number((t / partnersSeries[j]).toFixed(1)) : 0);
                        const momSeries = calcMomSeries(avgScaleSeries);

                        avgScaleDatasets.push({
                            label: `${tierTag} · ${city}`,
                            data: avgScaleSeries,
                            borderColor: colors[idx % colors.length],
                            backgroundColor: colors[idx % colors.length] + '20',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            _momSeries: momSeries
                        });
                    });

                    // --- Populate summary cards ---
                    const latestIdx = monthIndices[monthIndices.length - 1];
                    const prevIdx = monthIndices.length >= 2 ? monthIndices[monthIndices.length - 2] : null;
                    const cityScaleInfo = citiesToShow.map(city => {
                        const cD = cityWiseData.data[city];
                        const t = cD.target[latestIdx], p = cD.partners[latestIdx];
                        const scale = p > 0 ? Number((t / p).toFixed(1)) : 0;
                        let mom = null;
                        if (prevIdx !== null) {
                            const tP = cD.target[prevIdx], pP = cD.partners[prevIdx];
                            const prevScale = pP > 0 ? Number((tP / pP).toFixed(1)) : 0;
                            if (prevScale > 0) mom = Number((((scale - prevScale) / prevScale) * 100).toFixed(1));
                        }
                        const tier = t1Cities.includes(city) ? 'T1' : 'T2';
                        return { city, tier, scale, mom };
                    });
                    const fmtMom = (m) => { if (m === null) return '—'; const s = m >= 0 ? '+' : ''; return `MoM ${s}${m}%`; };
                    const momColor = (m) => m === null ? '#6b7280' : m >= 0 ? '#059669' : '#dc2626';

                    const highest = [...cityScaleInfo].sort((a, b) => b.scale - a.scale)[0];
                    if (highest) {
                        document.getElementById('cardHighVal').textContent = highest.scale.toFixed(1);
                        document.getElementById('cardHighCity').textContent = `${highest.tier} · ${highest.city}`;
                        const el = document.getElementById('cardHighMom');
                        el.textContent = fmtMom(highest.mom); el.style.color = momColor(highest.mom);
                    }
                    const lowest = [...cityScaleInfo].sort((a, b) => a.scale - b.scale)[0];
                    if (lowest) {
                        document.getElementById('cardLowVal').textContent = lowest.scale.toFixed(1);
                        document.getElementById('cardLowCity').textContent = `${lowest.tier} · ${lowest.city}`;
                        const el = document.getElementById('cardLowMom');
                        el.textContent = fmtMom(lowest.mom); el.style.color = momColor(lowest.mom);
                    }
                    const withMom = cityScaleInfo.filter(c => c.mom !== null);
                    const best = [...withMom].sort((a, b) => b.mom - a.mom)[0];
                    if (best) {
                        document.getElementById('cardBestMomVal').textContent = `+${best.mom}%`;
                        document.getElementById('cardBestMomCity').textContent = `${best.tier} · ${best.city}`;
                        document.getElementById('cardBestMomScale').textContent = `Scale: ${best.scale.toFixed(1)}`;
                    }
                    const worst = [...withMom].sort((a, b) => a.mom - b.mom)[0];
                    if (worst) {
                        document.getElementById('cardWorstMomVal').textContent = `${worst.mom}%`;
                        document.getElementById('cardWorstMomCity').textContent = `${worst.tier} · ${worst.city}`;
                        document.getElementById('cardWorstMomScale').textContent = `Scale: ${worst.scale.toFixed(1)}`;
                    }

                    cityCombinedTrendChart = new Chart(combinedCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: monthLabels,
                            datasets: avgScaleDatasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true },
                            layout: {
                                padding: { top: 14, left: 18, right: 18 }
                            },
                            plugins: {
                                legend: { position: 'right', maxWidth: 150 },
                                tooltip: {
                                    mode: 'nearest',
                                    intersect: true,
                                    callbacks: {
                                        label: (ctx) => {
                                            const label = ctx.dataset.label || '';
                                            const val = ctx.parsed.y;
                                            const mom = ctx.dataset._momSeries ? ctx.dataset._momSeries[ctx.dataIndex] : null;
                                            let valStr = val.toFixed(1);
                                            if (mom !== null && mom !== undefined) {
                                                const sign = mom >= 0 ? '+' : '';
                                                valStr += ` (MoM ${sign}${mom.toFixed(1)}%)`;
                                            }
                                            return `${label}: ${valStr}`;
                                        }
                                    }
                                },
                                datalabels: {
                                    display: (ctx) => ctx.dataIndex === 0 || ctx.dataIndex === ctx.dataset.data.length - 1,
                                    align: (ctx) => {
                                        if (ctx.dataIndex === 0) return 'right';
                                        if (ctx.dataIndex === ctx.dataset.data.length - 1) return 'left';
                                        return 'top';
                                    },
                                    anchor: 'center',
                                    offset: (ctx) => (ctx.dataIndex === 0 || ctx.dataIndex === ctx.dataset.data.length - 1 ? 8 : 4),
                                    clamp: true,
                                    clip: false,
                                    backgroundColor: 'rgba(255,255,255,0.9)',
                                    borderRadius: 4,
                                    padding: 4,
                                    color: '#111827',
                                    font: { size: 11, weight: '600' },
                                    formatter: (val) => {
                                        if (val === null || val === undefined) return '';
                                        return Number(val).toFixed(1);
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    grid: { color: 'rgba(107,114,128,0.15)', lineWidth: 1, drawBorder: false },
                                    ticks: { color: '#4b5563', callback: (v) => Number(v).toFixed(1) },
                                    title: { display: true, text: 'Avg Scale (Target ÷ Partners)', color: '#92400e', font: { size: 10, weight: '600' } }
                                },
                                x: { grid: { color: 'rgba(107,114,128,0.12)', lineWidth: 1, drawBorder: false } }
                            }
                        },
                        plugins: [ChartDataLabels]
                    });
                }

                function setupCityWiseTableFocus() {
                    const table = document.getElementById('cityWiseTable');
                    if (!table) return;
                    
                    table.addEventListener('click', function(e) {
                        const row = e.target.closest('tbody tr');
                        if (!row) return;
                        
                        // If clicking the same focused row, remove focus
                        if (row.classList.contains('row-focused')) {
                            row.classList.remove('row-focused');
                            table.classList.remove('has-focus');
                        } else {
                            // Remove focus from all rows
                            table.querySelectorAll('tbody tr.row-focused').forEach(r => r.classList.remove('row-focused'));
                            // Add focus to clicked row
                            row.classList.add('row-focused');
                            table.classList.add('has-focus');
                        }
                    });
                    
                    // Click outside table to clear focus
                    document.addEventListener('click', function(e) {
                        if (!table.contains(e.target)) {
                            table.querySelectorAll('tbody tr.row-focused').forEach(r => r.classList.remove('row-focused'));
                            table.classList.remove('has-focus');
                        }
                    });
                }

                function initCityWiseSection() {
                    buildCityWiseTable();
                    buildCityCharts();
                    setupCityWiseTableFocus();
                    
                    document.getElementById('cityCompareBtn')?.addEventListener('click', () => {
                        const m1Idx = parseInt(document.getElementById('cityMonthFilter1').value);
                        const m2Idx = parseInt(document.getElementById('cityMonthFilter2').value);
                        if (isNaN(m1Idx) || isNaN(m2Idx)) {
                            alert('Please select both months to compare');
                            return;
                        }
                        
                        const m1Month = cityWiseData.months[m1Idx];
                        const m2Month = cityWiseData.months[m2Idx];
                        const table = document.getElementById('cityWiseTable');
                        if (!table) return;
                        
                        // Build comparison table with only two months
                        let html = '<thead><tr style="background:#059669;color:#fff;"><th style="padding:8px;border:1px solid #e5e7eb;">City</th>';
                        html += `<th style="padding:8px;border:1px solid #e5e7eb;" colspan="3">${m1Month}</th>`;
                        html += `<th style="padding:8px;border:1px solid #e5e7eb;" colspan="3">${m2Month}</th>`;
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;" colspan="2">Change</th>';
                        html += '</tr><tr style="background:#059669;color:#fff;">';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;"></th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">Partners</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">Target</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">Avg</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">Partners</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">Target</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">Avg</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;"># Change</th>';
                        html += '<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">% Change</th>';
                        html += '</tr></thead><tbody>';
                        
                        const citiesToDisplay = selectedCities.length > 0 ? selectedCities : cityWiseData.cities;
                        
                        citiesToDisplay.forEach(city => {
                            const cityData = cityWiseData.data[city];
                            const p1 = cityData.partners[m1Idx];
                            const t1 = cityData.target[m1Idx];
                            const avg1 = (t1 / p1).toFixed(1);
                            const p2 = cityData.partners[m2Idx];
                            const t2 = cityData.target[m2Idx];
                            const avg2 = (t2 / p2).toFixed(1);
                            
                            const changeNum = t2 - t1;
                            const changePct = ((changeNum / t1) * 100).toFixed(1);
                            const changeColor = changeNum >= 0 ? '#10b981' : '#dc2626';
                            const changeArrow = changeNum >= 0 ? '↑' : '↓';
                            
                            html += `<tr style="background:${cityWiseData.cities.indexOf(city) % 2 === 0 ? '#ffffff' : '#f9fafb'};">`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;white-space:nowrap;">${city}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${p1}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${t1.toLocaleString()}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${avg1}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${p2}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${t2.toLocaleString()}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;">${avg2}</td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;"><span style="color:${changeColor};font-weight:600;">${changeArrow} ${Math.abs(changeNum).toLocaleString()}</span></td>`;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;"><span style="color:${changeColor};font-weight:600;">${changeArrow} ${Math.abs(changePct)}%</span></td>`;
                            html += '</tr>';
                        });
                        
                        // Grand Total row
                        let totalP1 = 0, totalT1 = 0, totalP2 = 0, totalT2 = 0;
                        citiesToDisplay.forEach(city => {
                            totalP1 += cityWiseData.data[city].partners[m1Idx];
                            totalT1 += cityWiseData.data[city].target[m1Idx];
                            totalP2 += cityWiseData.data[city].partners[m2Idx];
                            totalT2 += cityWiseData.data[city].target[m2Idx];
                        });
                        
                        const totalAvg1 = (totalT1 / totalP1).toFixed(1);
                        const totalAvg2 = (totalT2 / totalP2).toFixed(1);
                        const totalChangeNum = totalT2 - totalT1;
                        const totalChangePct = ((totalChangeNum / totalT1) * 100).toFixed(1);
                        const totalChangeColor = totalChangeNum >= 0 ? '#10b981' : '#dc2626';
                        const totalChangeArrow = totalChangeNum >= 0 ? '↑' : '↓';
                        
                        html += `<tr style="background:#e5e7eb;font-weight:bold;">`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;">Grand Total</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;">${totalP1}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;">${totalT1.toLocaleString()}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;">${totalAvg1}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;">${totalP2}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;">${totalT2.toLocaleString()}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;">${totalAvg2}</td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;"><span style="color:${totalChangeColor};font-weight:600;">${totalChangeArrow} ${Math.abs(totalChangeNum).toLocaleString()}</span></td>`;
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;"><span style="color:${totalChangeColor};font-weight:600;">${totalChangeArrow} ${Math.abs(totalChangePct)}%</span></td>`;
                        html += '</tr></tbody>';
                        
                        table.innerHTML = html;
                        
                        // Store selected months and rebuild charts with both month and city filters
                        selectedMonths = [m1Idx, m2Idx];
                        buildCityCharts(null, selectedCities.length > 0 ? selectedCities : null);
                    });
                    
                    // Add reset button functionality
                    const resetBtn = document.createElement('button');
                    resetBtn.id = 'cityResetBtn';
                    resetBtn.textContent = 'Reset to All Months';
                    resetBtn.style.cssText = 'padding:8px 20px;background:#6b7280;color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;margin-left:10px;';
                    document.getElementById('cityCompareBtn')?.parentNode?.appendChild(resetBtn);
                    
                    document.getElementById('cityResetBtn')?.addEventListener('click', () => {
                        // Reset dropdowns to default state
                        document.getElementById('cityMonthFilter1').value = '';
                        document.getElementById('cityMonthFilter2').value = '';
                        
                        selectedMonths = null;
                        buildCityWiseTable();
                        buildCityCharts();
                    });
                    
                    // City slicer chip functionality
                    document.querySelectorAll('.city-chip').forEach(chip => {
                        chip.addEventListener('click', function() {
                            const city = this.getAttribute('data-city');
                            
                            if (selectedCities.includes(city)) {
                                selectedCities = selectedCities.filter(c => c !== city);
                                this.style.background = '#e5e7eb';
                                this.style.color = '#1f2937';
                                this.style.borderColor = '#d1d5db';
                            } else {
                                selectedCities.push(city);
                                this.style.background = '#3b82f6';
                                this.style.color = 'white';
                                this.style.borderColor = '#3b82f6';
                            }
                        });
                    });
                    
                    // Apply Filter button
                    document.getElementById('cityFilterBtn')?.addEventListener('click', () => {
                        if (selectedCities.length === 0) {
                            alert('Please select at least one city');
                            return;
                        }
                        
                        currentCityFilter = selectedCities;
                        buildCityWiseTable(selectedCities);
                        // Apply both month filter (if set) and city filter
                        if (selectedMonths) {
                            buildCityCharts(selectedMonths, selectedCities);
                        } else {
                            buildCityCharts(null, selectedCities);
                        }
                    });
                    
                    // Clear All button
                    document.getElementById('cityFilterResetBtn')?.addEventListener('click', () => {
                        selectedCities = [];
                        currentCityFilter = [];
                        
                        // Reset all chip styles
                        document.querySelectorAll('.city-chip').forEach(chip => {
                            chip.style.background = '#e5e7eb';
                            chip.style.color = '#1f2937';
                            chip.style.borderColor = '#d1d5db';
                        });
                        
                        buildCityWiseTable();
                        // If month filter was applied, keep showing only those months with all cities
                        if (selectedMonths) {
                            buildCityCharts(selectedMonths);
                        } else {
                            buildCityCharts();
                        }
                    });
                }

                // Partner Movement Analysis Section
                let partnerMovementTrendChart, partnerMovementQualityChart;
                
                const partnerMovementData = {
                    months: ['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'],
                    // All Partners overall totals (not broken by quality)
                    allPartners: {
                        total: [615, 697, 767, 674, 625, 551],
                        increase: [381, 341, 386, 120, 212, 153],
                        decrease: [124, 162, 188, 458, 240, 284],
                        noChange: [110, 194, 193, 96, 173, 114]
                    },
                    // By quality breakdown
                    increase: {
                        good: [97, 92, 122, 44, 109, 82],
                        average: [93, 82, 95, 27, 79, 47],
                        bad: [70, 56, 44, 8, 15, 7]
                    },
                    decrease: {
                        good: [28, 38, 30, 132, 78, 109],
                        average: [62, 81, 93, 230, 123, 163],
                        bad: [34, 42, 65, 95, 39, 12]
                    },
                    noChange: {
                        good: [35, 45, 53, 47, 82, 61],
                        average: [52, 60, 87, 28, 72, 52],
                        bad: [21, 86, 51, 19, 19, 1]
                    }
                };

                let currentMovementQuality = 'allPartners';

                function buildPartnerMovementCharts(quality = 'allPartners') {
                    const trendCtx = document.getElementById('partnerMovementTrendChart');
                    const qualityCtx = document.getElementById('partnerMovementQualityChart');
                    
                    if (!trendCtx || !qualityCtx) return;
                    
                    if (partnerMovementTrendChart) partnerMovementTrendChart.destroy();
                    if (partnerMovementQualityChart) partnerMovementQualityChart.destroy();
                    
                    // Calculate totals based on quality filter
                    let increaseTotals, decreaseTotals, noChangeTotals, totalPartners;
                    
                    if (quality === 'allPartners') {
                        // Use overall totals from allPartners data
                        increaseTotals = partnerMovementData.allPartners.increase;
                        decreaseTotals = partnerMovementData.allPartners.decrease;
                        noChangeTotals = partnerMovementData.allPartners.noChange;
                        totalPartners = partnerMovementData.allPartners.total;
                    } else {
                        const getTotals = (type) => {
                            return partnerMovementData.months.map((_, idx) => {
                                if (quality === 'all') {
                                    return partnerMovementData[type].good[idx] + 
                                           partnerMovementData[type].average[idx] + 
                                           partnerMovementData[type].bad[idx];
                                } else {
                                    return partnerMovementData[type][quality][idx];
                                }
                            });
                        };
                        
                        increaseTotals = getTotals('increase');
                        decreaseTotals = getTotals('decrease');
                        noChangeTotals = getTotals('noChange');
                        // Calculate totals for percentage
                        totalPartners = partnerMovementData.months.map((_, idx) => {
                            return increaseTotals[idx] + decreaseTotals[idx] + noChangeTotals[idx];
                        });
                    }
                    
                    // Get quality label for tooltips
                    const getQualityLabel = () => {
                        if (quality === 'allPartners') return '';
                        if (quality === 'all') return '';
                        return quality.charAt(0).toUpperCase() + quality.slice(1) + ' ';
                    };
                    const qualityLabel = getQualityLabel();
                    
                    // Trend Chart
                    partnerMovementTrendChart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: partnerMovementData.months,
                            datasets: [
                                {
                                    label: qualityLabel + 'Partners Increased',
                                    data: increaseTotals,
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: qualityLabel + 'Partners Decreased',
                                    data: decreaseTotals,
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: qualityLabel + 'Partners No Change',
                                    data: noChangeTotals,
                                    borderColor: '#6b7280',
                                    backgroundColor: 'rgba(107, 114, 128, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            ...chartOptions,
                            plugins: {
                                ...chartOptions.plugins,
                                title: {
                                    display: true,
                                    text: quality === 'allPartners' ? 'All Partners' : quality === 'all' ? 'All Quality Levels' : `${quality.charAt(0).toUpperCase() + quality.slice(1)} Partners Only`
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.raw;
                                            const monthIdx = context.dataIndex;
                                            const total = totalPartners[monthIdx];
                                            const pct = ((value / total) * 100).toFixed(1);
                                            return `${context.dataset.label}: ${value} (${pct}% of total)`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'Number of Partners' }
                                }
                            }
                        }
                    });
                    
                    // Quality Distribution Chart (Stacked Bar)
                    let datasets = [];
                    
                    // For 'allPartners', show movement type distribution instead of quality distribution
                    if (quality === 'allPartners') {
                        datasets = [
                            {
                                label: 'Increased',
                                data: partnerMovementData.allPartners.increase,
                                backgroundColor: '#10b981'
                            },
                            {
                                label: 'Decreased',
                                data: partnerMovementData.allPartners.decrease,
                                backgroundColor: '#ef4444'
                            },
                            {
                                label: 'No Change',
                                data: partnerMovementData.allPartners.noChange,
                                backgroundColor: '#6b7280'
                            }
                        ];
                    } else {
                        if (quality === 'all' || quality === 'good') {
                            datasets.push({
                                label: 'Good',
                                data: [
                                    partnerMovementData.increase.good[0] + partnerMovementData.decrease.good[0] + partnerMovementData.noChange.good[0],
                                    partnerMovementData.increase.good[1] + partnerMovementData.decrease.good[1] + partnerMovementData.noChange.good[1],
                                    partnerMovementData.increase.good[2] + partnerMovementData.decrease.good[2] + partnerMovementData.noChange.good[2],
                                    partnerMovementData.increase.good[3] + partnerMovementData.decrease.good[3] + partnerMovementData.noChange.good[3],
                                    partnerMovementData.increase.good[4] + partnerMovementData.decrease.good[4] + partnerMovementData.noChange.good[4],
                                    partnerMovementData.increase.good[5] + partnerMovementData.decrease.good[5] + partnerMovementData.noChange.good[5]
                                ],
                                backgroundColor: '#10b981'
                            });
                        }
                        if (quality === 'all' || quality === 'average') {
                            datasets.push({
                                label: 'Average',
                                data: [
                                    partnerMovementData.increase.average[0] + partnerMovementData.decrease.average[0] + partnerMovementData.noChange.average[0],
                                    partnerMovementData.increase.average[1] + partnerMovementData.decrease.average[1] + partnerMovementData.noChange.average[1],
                                    partnerMovementData.increase.average[2] + partnerMovementData.decrease.average[2] + partnerMovementData.noChange.average[2],
                                    partnerMovementData.increase.average[3] + partnerMovementData.decrease.average[3] + partnerMovementData.noChange.average[3],
                                    partnerMovementData.increase.average[4] + partnerMovementData.decrease.average[4] + partnerMovementData.noChange.average[4],
                                    partnerMovementData.increase.average[5] + partnerMovementData.decrease.average[5] + partnerMovementData.noChange.average[5]
                                ],
                                backgroundColor: '#f59e0b'
                            });
                        }
                        if (quality === 'all' || quality === 'bad') {
                            datasets.push({
                                label: 'Bad',
                                data: [
                                    partnerMovementData.increase.bad[0] + partnerMovementData.decrease.bad[0] + partnerMovementData.noChange.bad[0],
                                    partnerMovementData.increase.bad[1] + partnerMovementData.decrease.bad[1] + partnerMovementData.noChange.bad[1],
                                    partnerMovementData.increase.bad[2] + partnerMovementData.decrease.bad[2] + partnerMovementData.noChange.bad[2],
                                    partnerMovementData.increase.bad[3] + partnerMovementData.decrease.bad[3] + partnerMovementData.noChange.bad[3],
                                    partnerMovementData.increase.bad[4] + partnerMovementData.decrease.bad[4] + partnerMovementData.noChange.bad[4],
                                    partnerMovementData.increase.bad[5] + partnerMovementData.decrease.bad[5] + partnerMovementData.noChange.bad[5]
                                ],
                                backgroundColor: '#ef4444'
                            });
                        }
                    }
                    
                    partnerMovementQualityChart = new Chart(qualityCtx, {
                        type: 'bar',
                        data: {
                            labels: partnerMovementData.months,
                            datasets: datasets
                        },
                        options: {
                            ...chartOptions,
                            plugins: {
                                ...chartOptions.plugins,
                                title: {
                                    display: true,
                                    text: quality === 'allPartners' ? 'Movement Distribution - All Partners' : quality === 'all' ? 'Quality Distribution - All Partners' : `${quality.charAt(0).toUpperCase() + quality.slice(1)} Partners Only`
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.raw;
                                            const monthIdx = context.dataIndex;
                                            const total = totalPartners[monthIdx];
                                            const pct = ((value / total) * 100).toFixed(1);
                                            return `${context.dataset.label}: ${value} (${pct}% of total)`;
                                        }
                                    }
                                },
                                datalabels: {
                                    display: true,
                                    color: 'white',
                                    font: {
                                        weight: 'bold',
                                        size: 14
                                    },
                                    anchor: 'center',
                                    align: 'center',
                                    formatter: (value) => {
                                        return value > 0 ? value : '';
                                    }
                                }
                            },
                            scales: {
                                x: { stacked: true },
                                y: { 
                                    stacked: true,
                                    beginAtZero: true,
                                    title: { display: true, text: 'Number of Partners' }
                                }
                            }
                        }
                    });
                }

                // Quality filter chip handler
                document.addEventListener('DOMContentLoaded', function() {
                    // Build Partner Movement table with percentages and MoM
                    function buildPartnerMovementTable() {
                        const tbody = document.getElementById('partnerMovementTableBody');
                        if (!tbody) return;
                        
                        tbody.innerHTML = '';
                        
                        const subtotals = [492, 582, 640, 630, 616, 534];
                        
                        partnerMovementData.months.forEach((month, idx) => {
                            const bg = idx % 2 === 0 ? '#f9fafb' : '#ffffff';
                            let html = `<tr style="background: ${bg};">
                                <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${month}</td>`;
                            
                            // Total Increase columns (Good, Average, Bad)
                            [partnerMovementData.increase.good[idx], partnerMovementData.increase.average[idx], partnerMovementData.increase.bad[idx]].forEach((val, col) => {
                                const pct = ((val / subtotals[idx]) * 100).toFixed(1);
                                let momColor = '#6b7280';
                                let momVal = '—';
                                
                                if (idx > 0) {
                                    const prevVal = col === 0 ? partnerMovementData.increase.good[idx-1] : col === 1 ? partnerMovementData.increase.average[idx-1] : partnerMovementData.increase.bad[idx-1];
                                    let momPct;
                                    if (prevVal === 0) {
                                        momPct = val > 0 ? 100 : 0;
                                    } else {
                                        momPct = (((val - prevVal) / prevVal) * 100);
                                    }
                                    momColor = momPct >= 0 ? '#10b981' : '#ef4444';
                                    momVal = momPct.toFixed(1);
                                }
                                
                                html += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">
                                    <div>${val} (${pct}%)</div>
                                    <div style="font-size: 11px; color: ${momColor}; font-weight: 600;">${momVal !== '—' ? (momVal >= 0 ? '+' : '') + momVal + '%' : momVal}</div>
                                </td>`;
                            });
                            
                            // Total Decrease columns (Good, Average, Bad)
                            [partnerMovementData.decrease.good[idx], partnerMovementData.decrease.average[idx], partnerMovementData.decrease.bad[idx]].forEach((val, col) => {
                                const pct = ((val / subtotals[idx]) * 100).toFixed(1);
                                let momColor = '#6b7280';
                                let momVal = '—';
                                
                                if (idx > 0) {
                                    const prevVal = col === 0 ? partnerMovementData.decrease.good[idx-1] : col === 1 ? partnerMovementData.decrease.average[idx-1] : partnerMovementData.decrease.bad[idx-1];
                                    let momPct;
                                    if (prevVal === 0) {
                                        momPct = val > 0 ? 100 : 0;
                                    } else {
                                        momPct = (((val - prevVal) / prevVal) * 100);
                                    }
                                    momColor = momPct >= 0 ? '#10b981' : '#ef4444';
                                    momVal = momPct.toFixed(1);
                                }
                                
                                html += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">
                                    <div>${val} (${pct}%)</div>
                                    <div style="font-size: 11px; color: ${momColor}; font-weight: 600;">${momVal !== '—' ? (momVal >= 0 ? '+' : '') + momVal + '%' : momVal}</div>
                                </td>`;
                            });
                            
                            // No Change columns (Good, Average, Bad)
                            [partnerMovementData.noChange.good[idx], partnerMovementData.noChange.average[idx], partnerMovementData.noChange.bad[idx]].forEach((val, col) => {
                                const pct = ((val / subtotals[idx]) * 100).toFixed(1);
                                let momColor = '#6b7280';
                                let momVal = '—';
                                
                                if (idx > 0) {
                                    const prevVal = col === 0 ? partnerMovementData.noChange.good[idx-1] : col === 1 ? partnerMovementData.noChange.average[idx-1] : partnerMovementData.noChange.bad[idx-1];
                                    let momPct;
                                    if (prevVal === 0) {
                                        momPct = val > 0 ? 100 : 0;
                                    } else {
                                        momPct = (((val - prevVal) / prevVal) * 100);
                                    }
                                    momColor = momPct >= 0 ? '#10b981' : '#ef4444';
                                    momVal = momPct.toFixed(1);
                                }
                                
                                html += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">
                                    <div>${val} (${pct}%)</div>
                                    <div style="font-size: 11px; color: ${momColor}; font-weight: 600;">${momVal !== '—' ? (momVal >= 0 ? '+' : '') + momVal + '%' : momVal}</div>
                                </td>`;
                            });
                            
                            // Subtotal
                            html += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;">${subtotals[idx]}</td></tr>`;
                            tbody.innerHTML += html;
                        });
                        
                        // Add average row
                        const avgIncrease = {
                            good: 98, average: 82, bad: 35
                        };
                        const avgDecrease = {
                            good: 62, average: 117, bad: 46
                        };
                        const avgNoChange = {
                            good: 46, average: 50, bad: 28
                        };
                        const avgSubtotal = 564;
                        
                        let avgHtml = `<tr style="background: #0891b2; color: white; font-weight: 700;">
                            <td style="padding: 10px; border: 1px solid #e5e7eb;">Avr (Aug-Feb)</td>`;
                        
                        [avgIncrease.good, avgIncrease.average, avgIncrease.bad].forEach(val => {
                            const pct = ((val / avgSubtotal) * 100).toFixed(1);
                            avgHtml += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${val} (${pct}%)</td>`;
                        });
                        
                        [avgDecrease.good, avgDecrease.average, avgDecrease.bad].forEach(val => {
                            const pct = ((val / avgSubtotal) * 100).toFixed(1);
                            avgHtml += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${val} (${pct}%)</td>`;
                        });
                        
                        [avgNoChange.good, avgNoChange.average, avgNoChange.bad].forEach(val => {
                            const pct = ((val / avgSubtotal) * 100).toFixed(1);
                            avgHtml += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${val} (${pct}%)</td>`;
                        });
                        
                        avgHtml += `<td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${avgSubtotal}</td></tr>`;
                        tbody.innerHTML += avgHtml;
                    }
                    
                    buildPartnerMovementTable();
                    
                    const qualityChips = document.querySelectorAll('.movement-quality-chip');
                    qualityChips.forEach(chip => {
                        chip.addEventListener('click', function() {
                            qualityChips.forEach(c => {
                                c.style.background = 'white';
                                c.style.color = '#374151';
                                c.style.borderColor = '#d1d5db';
                                c.classList.remove('active');
                            });
                            
                            this.style.background = '#06b6d4';
                            this.style.color = 'white';
                            this.style.borderColor = '#06b6d4';
                            this.classList.add('active');
                            
                            const quality = this.getAttribute('data-quality');
                            currentMovementQuality = quality;
                            buildPartnerMovementCharts(quality);
                        });
                    });
                    
                    // Initialize charts
                    setTimeout(() => {
                        buildPartnerMovementCharts('allPartners');
                    }, 500);
                });

                let partnerAgeTrendChart, partnerAgeScaleChart;
                let selectedAgeCategory = 'all';

                function buildPartnerAgeTable(monthIndices = null, categoryFilter = 'all') {
                    const table = document.getElementById('partnerAgeTable');
                    if (!table) return;
                    
                    const displayMonths = monthIndices || [5, 4, 3, 2, 1, 0];
                    const categoriesToShow = categoryFilter === 'all' ? partnerAgeData.categories : [categoryFilter];

                    const getArrow = (key) => {
                        if (partnerAgeSortState.key !== key) return '↕';
                        return partnerAgeSortState.dir === 'asc' ? '↑' : '↓';
                    };

                    let html = `<thead><tr style="background:#6b21a8;color:#fff;"><th class="pa-sortable" data-sort-key="metric" style="padding:10px;border:1px solid #e5e7eb;cursor:pointer;position:sticky;left:0;z-index:12;background:#6b21a8;min-width:200px;" rowspan="2">Metric <span style="font-size:11px;">${getArrow('metric')}</span></th>`;
                    
                    const colsPerMonth = (categoriesToShow.length * 2) + 1; // Each category has 2 cols (value + MoM%) + 1 Total/Avr
                    displayMonths.forEach(idx => {
                        html += `<th style="padding:8px;border:1px solid #e5e7eb;font-size:12px;text-align:center;" colspan="${colsPerMonth}">${partnerAgeData.months[idx]}</th>`;
                    });
                    html += '</tr>';
                    
                    html += '<tr style="background:#6b21a8;color:#fff;">';
                    displayMonths.forEach(() => {
                        categoriesToShow.forEach(cat => {
                            const shortName = cat.split(' ')[0] + ' ' + cat.split(' ')[1];
                            html += `<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;">${shortName}</th>`;
                            html += `<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;background:#8b5cf6;">MoM%</th>`;
                        });
                        html += `<th style="padding:8px;border:1px solid #e5e7eb;font-size:11px;background:#059669;color:#ffffff;font-weight:700;">Total/Avr</th>`;
                    });
                    html += '</tr></thead><tbody>';

                    const metrics = [
                        { key: 'count', label: 'Total Active Partners' },
                        { key: 'activeCount', label: 'Total Partners With Target' },
                        { key: 'target', label: 'Target Total' },
                        { key: 'avgScale', label: 'Avg Scale' },
                        { key: 'goodPartners', label: '# of Good Partners with Target' },
                        { key: 'avgPartners', label: '# of Average Partners with Target' },
                        { key: 'badPartners', label: '# of Bad Partners with Target' },
                        { key: 'goodTarget', label: 'Good Partners Target' },
                        { key: 'avgTarget', label: 'Average Partners Target' },
                        { key: 'badTarget', label: 'Bad Partners Target' },
                        { key: 'goodAvgScale', label: 'Good Partners Avg Scale' },
                        { key: 'avgAvgScale', label: 'Average Partners Avg Scale' },
                        { key: 'badAvgScale', label: 'Bad Partners Avg Scale' },
                        { key: 'bigPartners', label: '# of Big Partners with Target' },
                        { key: 'midPartners', label: '# of Mid Partners with Target' },
                        { key: 'smallPartners', label: '# of Small Partners with Target' },
                        { key: 'bigTarget', label: 'Big Partners Target' },
                        { key: 'midTarget', label: 'Mid Partners Target' },
                        { key: 'smallTarget', label: 'Small Partners Target' },
                        { key: 'bigAvgScale', label: 'Big Partners Avg Scale' },
                        { key: 'midAvgScale', label: 'Mid Partners Avg Scale' },
                        { key: 'smallAvgScale', label: 'Small Partners Avg Scale' }
                    ];

                    let sortedMetrics = [...metrics];
                    if (partnerAgeSortState.key) {
                        sortedMetrics.sort((a, b) => {
                            const aVal = a.label.toLowerCase();
                            const bVal = b.label.toLowerCase();
                            return partnerAgeSortState.dir === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                        });
                    }

                    sortedMetrics.forEach((metric, metricIdx) => {
                        let borderColor = '';
                        if (metric.key === 'goodAvgScale') borderColor = '#10b981';
                        else if (metric.key === 'avgAvgScale') borderColor = '#f59e0b';
                        else if (metric.key === 'badAvgScale') borderColor = '#ef4444';
                        else if (metric.key === 'bigAvgScale') borderColor = '#6366f1';
                        else if (metric.key === 'midAvgScale') borderColor = '#8b5cf6';
                        else if (metric.key === 'smallAvgScale') borderColor = '#ec4899';
                        
                        const borderStyle = borderColor ? `border-left: 4px solid ${borderColor};` : '';
                        html += `<tr style="background:${metricIdx % 2 === 0 ? '#ffffff' : '#f9fafb'};${borderStyle}">`;
                        const rowBg = metricIdx % 2 === 0 ? '#ffffff' : '#f9fafb';
                        html += `<td style="padding:8px;border:1px solid #e5e7eb;font-weight:600;white-space:nowrap;font-size:13px;position:sticky;left:0;z-index:2;background:${rowBg};">${metric.label}</td>`;
                        
                        displayMonths.forEach((monthIdx) => {
                            let monthTotal = 0;
                            let categoryCount = 0;
                            const isQualityMetric = metric.key.includes('goodTarget') || metric.key.includes('avgTarget') || metric.key.includes('badTarget') || 
                                                   metric.key.includes('goodAvgScale') || metric.key.includes('avgAvgScale') || metric.key.includes('badAvgScale') ||
                                                   metric.key.includes('bigTarget') || metric.key.includes('midTarget') || metric.key.includes('smallTarget') ||
                                                   metric.key.includes('bigAvgScale') || metric.key.includes('midAvgScale') || metric.key.includes('smallAvgScale');
                            
                            categoriesToShow.forEach(cat => {
                                const data = partnerAgeData.data[cat];
                                const current = data[metric.key][monthIdx];
                                const prev = monthIdx > 0 ? data[metric.key][monthIdx - 1] : null;
                                
                                monthTotal += current;
                                categoryCount++;
                                
                                const value = typeof current === 'number' && current % 1 !== 0 ? current.toFixed(1) : current;
                                const momPct = prev ? (((current - prev) / prev) * 100).toFixed(1) : '—';
                                const momHtml = momPct !== '—' ? `<span style="color:${parseFloat(momPct) >= 0 ? '#10b981' : '#dc2626'};font-weight:600;">${parseFloat(momPct) >= 0 ? '↑' : '↓'} ${Math.abs(momPct)}%</span>` : '—';

                                let displayValue = value;
                                if (metric.key === 'goodAvgScale' || metric.key === 'avgAvgScale' || metric.key === 'badAvgScale' ||
                                    metric.key === 'bigAvgScale' || metric.key === 'midAvgScale' || metric.key === 'smallAvgScale') {
                                    let bgColor, textColor;
                                    if (metric.key === 'goodAvgScale') {
                                        bgColor = '#dbeafe';
                                        textColor = '#1e40af';
                                    } else if (metric.key === 'avgAvgScale') {
                                        bgColor = '#fef3c7';
                                        textColor = '#92400e';
                                    } else if (metric.key === 'badAvgScale') {
                                        bgColor = '#fee2e2';
                                        textColor = '#991b1b';
                                    } else if (metric.key === 'bigAvgScale') {
                                        bgColor = '#e0e7ff';
                                        textColor = '#3730a3';
                                    } else if (metric.key === 'midAvgScale') {
                                        bgColor = '#ede9fe';
                                        textColor = '#5b21b6';
                                    } else {
                                        bgColor = '#fce7f3';
                                        textColor = '#9f1239';
                                    }
                                    displayValue = `<span style="background:${bgColor};color:${textColor};padding:4px 8px;border-radius:12px;font-weight:600;font-size:12px;">${typeof value === 'number' && value > 100 ? value.toLocaleString() : value}</span>`;
                                } else {
                                    displayValue = typeof value === 'number' && value > 100 ? value.toLocaleString() : value;
                                }

                                html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;font-size:12px;">${displayValue}</td>`;
                                html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;background:#f3f4f6;font-size:11px;">${momHtml}</td>`;
                            });

                            // Calculate Total or Average based on metric type
                            let finalValue;
                            if (metric.key === 'avgScale') {
                                // For overall AvgScale: weighted average = Total Target / Total Active Partners
                                let totalTarget = 0;
                                let totalActivePartners = 0;
                                categoriesToShow.forEach(cat => {
                                    totalTarget += partnerAgeData.data[cat]['target'][monthIdx];
                                    totalActivePartners += partnerAgeData.data[cat]['activeCount'][monthIdx];
                                });
                                finalValue = totalActivePartners > 0 ? totalTarget / totalActivePartners : 0;
                            } else if (metric.key.includes('AvgScale')) {
                                // For AvgScale metrics: calculate as Total Target / Total Partners
                                let targetKey, partnersKey;
                                if (metric.key === 'goodAvgScale') {
                                    targetKey = 'goodTarget';
                                    partnersKey = 'goodPartners';
                                } else if (metric.key === 'avgAvgScale') {
                                    targetKey = 'avgTarget';
                                    partnersKey = 'avgPartners';
                                } else if (metric.key === 'badAvgScale') {
                                    targetKey = 'badTarget';
                                    partnersKey = 'badPartners';
                                } else if (metric.key === 'bigAvgScale') {
                                    targetKey = 'bigTarget';
                                    partnersKey = 'bigPartners';
                                } else if (metric.key === 'midAvgScale') {
                                    targetKey = 'midTarget';
                                    partnersKey = 'midPartners';
                                } else if (metric.key === 'smallAvgScale') {
                                    targetKey = 'smallTarget';
                                    partnersKey = 'smallPartners';
                                }
                                
                                let totalTarget = 0;
                                let totalPartners = 0;
                                categoriesToShow.forEach(cat => {
                                    totalTarget += partnerAgeData.data[cat][targetKey][monthIdx];
                                    totalPartners += partnerAgeData.data[cat][partnersKey][monthIdx];
                                });
                                finalValue = totalPartners > 0 ? totalTarget / totalPartners : 0;
                            } else if (isQualityMetric && metric.key.includes('Target')) {
                                // For Target metrics: calculate average
                                finalValue = categoryCount > 0 ? monthTotal / categoryCount : 0;
                            } else {
                                // For regular metrics: use sum
                                finalValue = monthTotal;
                            }
                            
                            // Apply decimal formatting only for Avg Scale metrics
                            let totalValue;
                            if (metric.key.includes('AvgScale') || metric.key === 'avgScale') {
                                totalValue = typeof finalValue === 'number' && finalValue % 1 !== 0 ? finalValue.toFixed(1) : finalValue;
                            } else {
                                totalValue = typeof finalValue === 'number' ? Math.round(finalValue) : finalValue;
                            }
                            const totalDisplayValue = typeof totalValue === 'number' && totalValue > 100 ? totalValue.toLocaleString() : totalValue;
                            html += `<td style="padding:8px;border:1px solid #e5e7eb;text-align:center;white-space:nowrap;background:#d1fae5;color:#065f46;font-weight:700;font-size:14px;">${totalDisplayValue}</td>`;
                        });
                        
                        html += '</tr>';
                    });

                    html += '</tbody>';
                    table.innerHTML = html;

                    // Attach sorting handlers
                    table.querySelectorAll('.pa-sortable').forEach(th => {
                        th.addEventListener('click', () => {
                            const key = th.getAttribute('data-sort-key');
                            if (partnerAgeSortState.key === key) {
                                partnerAgeSortState.dir = partnerAgeSortState.dir === 'asc' ? 'desc' : 'asc';
                            } else {
                                partnerAgeSortState.key = key;
                                partnerAgeSortState.dir = 'desc';
                            }
                            buildPartnerAgeTable(displayMonths, categoryFilter);
                        });
                    });
                }

                function buildPartnerAgeCharts(monthIndices = null, categoryFilter = 'all') {
                    const trendCtx = document.getElementById('partnerAgeTrendChart');
                    const scaleCtx = document.getElementById('partnerAgeScaleChart');
                    if (!trendCtx || !scaleCtx || typeof Chart === 'undefined') return;
                    
                    const categoriesToShow = categoryFilter === 'all' ? partnerAgeData.categories : [categoryFilter];

                    if (partnerAgeTrendChart) partnerAgeTrendChart.destroy();
                    if (partnerAgeScaleChart) partnerAgeScaleChart.destroy();

                    if (!monthIndices) monthIndices = [0, 1, 2, 3, 4, 5];

                    const selectedMonths = monthIndices.map(i => partnerAgeData.months[i]);
                    const colors = ['#8b5cf6', '#a78bfa', '#c4b5fd'];

                    // Trend Chart - Total Active Partners
                    const trendDatasets = [];
                    categoriesToShow.forEach((cat, idx) => {
                        const selectedData = monthIndices.map(i => partnerAgeData.data[cat].count[i]);
                        trendDatasets.push({
                            label: cat,
                            data: selectedData,
                            borderColor: colors[idx],
                            backgroundColor: colors[idx] + '20',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false
                        });
                    });

                    partnerAgeTrendChart = new Chart(trendCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: selectedMonths,
                            datasets: trendDatasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true },
                            plugins: {
                                legend: { position: 'right', maxWidth: 150 },
                                tooltip: {
                                    mode: 'nearest',
                                    intersect: true,
                                    callbacks: {
                                        label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}`
                                    }
                                },
                                datalabels: {
                                    display: true,
                                    align: 'end',
                                    anchor: 'end',
                                    backgroundColor: 'rgba(255,255,255,0.9)',
                                    borderRadius: 4,
                                    padding: 4,
                                    color: function(ctx) { return ctx.dataset.borderColor; },
                                    font: { size: 10, weight: '600' }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() }, grid: { color: 'rgba(107,114,128,0.15)', lineWidth: 1, drawBorder: false } },
                                x: { grid: { color: 'rgba(107,114,128,0.12)', lineWidth: 1, drawBorder: false } }
                            }
                        }
                    });

                    // Scale Chart - Avg Scale
                    const scaleDatasets = [];
                    categoriesToShow.forEach((cat, idx) => {
                        const selectedData = monthIndices.map(i => partnerAgeData.data[cat].avgScale[i]);
                        scaleDatasets.push({
                            label: cat,
                            data: selectedData,
                            borderColor: colors[idx],
                            backgroundColor: colors[idx] + '20',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false
                        });
                    });

                    partnerAgeScaleChart = new Chart(scaleCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: selectedMonths,
                            datasets: scaleDatasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: { mode: 'nearest', intersect: true },
                            plugins: {
                                legend: { position: 'right', maxWidth: 150 },
                                tooltip: {
                                    mode: 'nearest',
                                    intersect: true,
                                    callbacks: {
                                        label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}`
                                    }
                                },
                                datalabels: {
                                    display: true,
                                    align: 'end',
                                    anchor: 'end',
                                    backgroundColor: 'rgba(255,255,255,0.9)',
                                    borderRadius: 4,
                                    padding: 4,
                                    color: function(ctx) { return ctx.dataset.borderColor; },
                                    font: { size: 10, weight: '600' }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, ticks: { callback: (v) => v.toFixed(1) }, grid: { color: 'rgba(107,114,128,0.15)', lineWidth: 1, drawBorder: false } },
                                x: { grid: { color: 'rgba(107,114,128,0.12)', lineWidth: 1, drawBorder: false } }
                            }
                        }
                    });
                }

                function setupPartnerAgeTableFocus() {
                    const table = document.getElementById('partnerAgeTable');
                    if (!table) return;
                    
                    table.addEventListener('click', function(e) {
                        const row = e.target.closest('tbody tr');
                        if (!row) return;
                        
                        // If clicking the same focused row, remove focus
                        if (row.classList.contains('row-focused')) {
                            row.classList.remove('row-focused');
                            table.classList.remove('has-focus');
                        } else {
                            // Remove focus from all rows
                            table.querySelectorAll('tbody tr.row-focused').forEach(r => r.classList.remove('row-focused'));
                            // Add focus to clicked row
                            row.classList.add('row-focused');
                            table.classList.add('has-focus');
                        }
                    });
                    
                    // Click outside table to clear focus
                    document.addEventListener('click', function(e) {
                        if (!table.contains(e.target)) {
                            table.querySelectorAll('tbody tr.row-focused').forEach(r => r.classList.remove('row-focused'));
                            table.classList.remove('has-focus');
                        }
                    });
                }

                function initPartnerAgeSection() {
                    buildPartnerAgeTable();
                    buildPartnerAgeCharts();
                    setupPartnerAgeTableFocus();

                    // Update takeaway
                    const latestNew1 = partnerAgeData.data['New <1 month'].count[5];
                    const latestNew3 = partnerAgeData.data['New <3 months'].count[5];
                    const latestOld = partnerAgeData.data['Old >3 months'].count[5];
                    const latestNewScale = partnerAgeData.data['New <1 month'].avgScale[5];
                    const latestOldScale = partnerAgeData.data['Old >3 months'].avgScale[5];
                    
                    const insight = `In Feb, new partners (<1 month: ${latestNew1}, <3 months: ${latestNew3}) are ramping with lower scale (${latestNewScale}), while established partners (>3 months: ${latestOld}) show declining scale (${latestOldScale}) despite higher volume. Focus on retaining & scaling established base.`;
                    document.getElementById('partnerAgeInsight').textContent = insight;

                    document.getElementById('partnerAgeCompareBtn')?.addEventListener('click', () => {
                        const m1 = document.getElementById('partnerAgeMonthFilter1').value;
                        const m2 = document.getElementById('partnerAgeMonthFilter2').value;
                        
                        if (m1 === '' || m2 === '') {
                            alert('Please select both months to compare');
                            return;
                        }

                        const m1Idx = parseInt(m1);
                        const m2Idx = parseInt(m2);

                        partnerAgeSelectedMonths = [m1Idx, m2Idx];
                        buildPartnerAgeTable([m1Idx, m2Idx], selectedAgeCategory);
                        buildPartnerAgeCharts(null, selectedAgeCategory);
                    });
                    
                    document.getElementById('partnerAgeResetBtn')?.addEventListener('click', () => {
                        // Reset dropdowns to default state
                        document.getElementById('partnerAgeMonthFilter1').value = '';
                        document.getElementById('partnerAgeMonthFilter2').value = '';
                        
                        partnerAgeSelectedMonths = null;
                        buildPartnerAgeTable(null, selectedAgeCategory);
                        buildPartnerAgeCharts(null, selectedAgeCategory);
                    });

                    // Age category filter chips
                    document.querySelectorAll('.age-category-chip').forEach(chip => {
                        chip.addEventListener('click', function() {
                            // Update active state
                            document.querySelectorAll('.age-category-chip').forEach(c => {
                                c.style.background = 'white';
                                c.style.color = '#374151';
                                c.style.borderColor = '#d1d5db';
                                c.classList.remove('active');
                            });
                            this.style.background = '#1e3a8a';
                            this.style.color = 'white';
                            this.style.borderColor = '#1e3a8a';
                            this.classList.add('active');

                            // Get selected category
                            selectedAgeCategory = this.getAttribute('data-category');
                            
                            // Rebuild table and charts with filter
                            const currentMonths = partnerAgeSelectedMonths || null;
                            buildPartnerAgeTable(currentMonths, selectedAgeCategory);
                            buildPartnerAgeCharts(null, selectedAgeCategory);
                        });
                    });
                }

                function initTierCitySection() {
                    buildTierTables();
                    buildTierCharts();
                    
                    // Add tier filter event listeners
                    const tierFilterChips = document.querySelectorAll('.tier-filter-chip');
                    tierFilterChips.forEach(chip => {
                        chip.addEventListener('click', () => {
                            tierFilterSelected = chip.getAttribute('data-tier');
                            
                            // Update chip styling
                            tierFilterChips.forEach(c => {
                                if (c === chip) {
                                    c.style.background = '#3b82f6';
                                    c.style.color = 'white';
                                    c.style.borderColor = '#3b82f6';
                                } else {
                                    c.style.background = 'white';
                                    c.style.color = '#374151';
                                    c.style.borderColor = '#d1d5db';
                                }
                            });
                            
                            // Rebuild tables and charts
                            buildTierTables();
                            buildTierCharts();
                        });
                    });
                }

        // Initialize Charts
        window.onload = function() {
            function createBarMomLabelPlugin(janData, febData, fontSize) {
                return {
                    id: 'barMomLabels',
                    afterDatasetsDraw(chart) {
                        const { ctx } = chart;
                        const showJan = chart.isDatasetVisible(0);
                        const showFeb = chart.isDatasetVisible(1);
                        ctx.save();
                        ctx.font = `bold ${fontSize}px sans-serif`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';

                        chart.data.datasets.forEach((dataset, datasetIndex) => {
                            if (!chart.isDatasetVisible(datasetIndex)) return;
                            const meta = chart.getDatasetMeta(datasetIndex);
                            meta.data.forEach((bar, index) => {
                                const val = dataset.data[index];
                                if (val === null || val === undefined) return;
                                const x = bar.x;
                                const y = bar.y - 4;
                                const valText = Number(val).toLocaleString();

                                if (datasetIndex === 0 && showJan) {
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x, y);
                                    return;
                                }

                                if (datasetIndex === 1 && showFeb) {
                                    if (showJan) {
                                        const mom = psFormatMoM(janData[index], febData[index]);
                                        const sign = parseFloat(mom) > 0 ? '+' : '';
                                        const label = `${valText} (${sign}${mom}%)`;
                                        ctx.fillStyle = psMoMColor(mom);
                                        ctx.fillText(label, x, y);
                                    } else {
                                        ctx.fillStyle = '#111827';
                                        ctx.fillText(valText, x, y);
                                    }
                                }
                            });
                        });
                        ctx.restore();
                    }
                };
            }

            // Partner Scale Chart - REMOVED (chart element deleted)
            // const scaleJan = [6677, 10598, 4938, 240];
            // const scaleFeb = [3643, 9982, 5351, 389];
            // const scaleMomPlugin = createBarMomLabelPlugin(scaleJan, scaleFeb, 9);
            // new Chart(document.getElementById('scaleChart').getContext('2d'), {...});

            // Compliance Rate Distribution Chart
            const complianceLabels = ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'];
            const complianceColors = ['#ef4444', '#f97316', '#fb923c', '#f59e0b', '#84cc16', '#22c55e', '#10b981'];
            
            // FR Rate Data - All Partners
            const frAllData = [17, 1, 1, 0, 3, 36, 585];
            const frNewData = [16, 0, 1, 0, 2, 14, 125];
            const frOldData = [1, 1, 0, 0, 1, 22, 460];
            
            // FR Rate Data - Partners with Target
            const frAllDataActive = [17, 0, 1, 0, 1, 23, 509];
            const frNewDataActive = [16, 0, 1, 0, 0, 7, 103];
            const frOldDataActive = [1, 0, 0, 0, 1, 16, 406];
            
            // Driver Card Rate Data - All Partners
            const dcAllData = [317, 45, 37, 26, 32, 43, 143];
            const dcNewData = [88, 9, 2, 5, 7, 9, 38];
            const dcOldData = [229, 36, 35, 21, 25, 34, 105];
            
            // Driver Card Rate Data - Partners with Target
            const dcAllDataActive = [237, 43, 34, 25, 30, 43, 139];
            const dcNewDataActive = [60, 8, 2, 5, 7, 9, 36];
            const dcOldDataActive = [177, 35, 32, 20, 23, 34, 103];

            // FR Rate Data by Performance Level (Partners with Target)
            const frPerfData = {
                all: [17, 0, 1, 0, 1, 23, 509],
                good: [0, 0, 0, 0, 0, 5, 247],
                average: [0, 0, 0, 0, 0, 15, 247],
                bad: [2, 0, 1, 0, 1, 3, 13]
            };
            
            // DC Rate Data by Performance Level (Partners with Target)
            const dcPerfData = {
                all: [237, 43, 34, 25, 30, 43, 139],
                good: [112, 17, 14, 9, 10, 22, 68],
                average: [100, 26, 20, 14, 19, 18, 65],
                bad: [10, 0, 0, 2, 1, 2, 5]
            };
            
            // FR Target Data by Performance Level
            const frPerfTargetData = {
                all: { total: 10192 + 8414 + 370, good: 10192, average: 8414, bad: 370 },
                good: [0, 0, 0, 0, 0, 182, 10010],
                average: [0, 0, 0, 0, 0, 396, 8018],
                bad: [35, 0, 19, 0, 11, 50, 255]
            };
            
            // DC Target Data by Performance Level
            const dcPerfTargetData = {
                all: { total: 10192 + 8414 + 370, good: 10192, average: 8414, bad: 370 },
                good: [4600, 762, 537, 341, 449, 735, 2768],
                average: [3270, 805, 781, 420, 514, 587, 2037],
                bad: [178, 0, 0, 39, 15, 50, 88]
            };
            
            // Average rates by performance level
            const frPerfAvgRates = {
                all: { value: '92.4%', label: 'All with Target' },
                good: { value: '96.5%', label: 'Good Partners' },
                average: { value: '92.0%', label: 'Average Partners' },
                bad: { value: '72.9%', label: 'Bad Partners' }
            };
            
            const dcPerfAvgRates = {
                all: { value: '40.5%', label: 'All with Target' },
                good: { value: '42.8%', label: 'Good Partners' },
                average: { value: '39.0%', label: 'Average Partners' },
                bad: { value: '33.5%', label: 'Bad Partners' }
            };
            
            let currentPerfFilter = 'all'; // Default performance filter

            let activeMetric = 'fr'; // Default to FR
            let currentFilter = 'comparison'; // Default filter
            
            // Average Rate Data for KPI Cards
            const avgRateData = {
                fr: {
                    all: { value: '92.2%', label: 'All Partners' },
                    new: { value: '83.2%', label: 'New Partners' },
                    old: { value: '95.1%', label: 'Old Partners' },
                    both: { value: '83.2% / 95.1%', label: 'New / Old Partners' },
                    'all-target': { value: '92.4%', label: 'All with Target' },
                    'new-target': { value: '82.2%', label: 'New with Target' },
                    'old-target': { value: '95.4%', label: 'Old with Target' },
                    'both-target': { value: '82.2% / 95.4%', label: 'New / Old with Target' },
                    'comparison': { value: '92.2% / 92.4%', label: 'All / With Target' }
                },
                dc: {
                    all: { value: '36.0%', label: 'All Partners' },
                    new: { value: '34.2%', label: 'New Partners' },
                    old: { value: '36.6%', label: 'Old Partners' },
                    both: { value: '34.2% / 36.6%', label: 'New / Old Partners' },
                    'all-target': { value: '40.5%', label: 'All with Target' },
                    'new-target': { value: '40.6%', label: 'New with Target' },
                    'old-target': { value: '40.5%', label: 'Old with Target' },
                    'both-target': { value: '40.6% / 40.5%', label: 'New / Old with Target' },
                    'comparison': { value: '36.0% / 40.5%', label: 'All / With Target' }
                }
            };
            
            // Function to update donut meter
            function updateDonutMeter(donutId, valueId, percentage) {
                const donut = document.querySelector(`#${donutId} .donut-progress`);
                const valueEl = document.getElementById(valueId);
                if (donut && valueEl) {
                    const circumference = 87.96; // 2 * PI * 14
                    const offset = circumference - (percentage / 100) * circumference;
                    donut.style.strokeDashoffset = offset;
                    valueEl.textContent = percentage.toFixed(1) + '%';
                }
            }
            
            // Function to update KPI cards (donut meters)
            function updateAvgKpiCards(filter, metric) {
                const frCard = document.getElementById('frAvgCard');
                const frSubtitle = document.getElementById('frAvgSubtitle');
                const dcCard = document.getElementById('dcAvgCard');
                const dcSubtitle = document.getElementById('dcAvgSubtitle');
                
                // Get data
                const frData = avgRateData.fr[filter] || avgRateData.fr.all;
                const dcData = avgRateData.dc[filter] || avgRateData.dc.all;
                
                // Parse percentages from value strings
                const parsePercentages = (valueStr) => {
                    const parts = valueStr.replace(/%/g, '').split('/').map(s => parseFloat(s.trim()));
                    return parts;
                };
                
                const frPercentages = parsePercentages(frData.value);
                const dcPercentages = parsePercentages(dcData.value);
                
                // Update FR donut meters
                if (frPercentages.length === 2) {
                    updateDonutMeter('frDonutAll', 'frDonutAllValue', frPercentages[0]);
                    updateDonutMeter('frDonutTarget', 'frDonutTargetValue', frPercentages[1]);
                    document.querySelector('#frDonutAll').parentElement.style.display = 'flex';
                    document.querySelector('#frDonutTarget').parentElement.style.display = 'flex';
                    document.getElementById('frDonutAllValue').parentElement.querySelector('.donut-label').textContent = 'All';
                    document.getElementById('frDonutTargetValue').parentElement.querySelector('.donut-label').textContent = 'Target';
                } else {
                    updateDonutMeter('frDonutAll', 'frDonutAllValue', frPercentages[0]);
                    document.querySelector('#frDonutAll').parentElement.style.display = 'flex';
                    document.querySelector('#frDonutTarget').parentElement.style.display = 'none';
                }
                frSubtitle.textContent = frData.label;
                
                // Update DC donut meters
                if (dcPercentages.length === 2) {
                    updateDonutMeter('dcDonutAll', 'dcDonutAllValue', dcPercentages[0]);
                    updateDonutMeter('dcDonutTarget', 'dcDonutTargetValue', dcPercentages[1]);
                    document.querySelector('#dcDonutAll').parentElement.style.display = 'flex';
                    document.querySelector('#dcDonutTarget').parentElement.style.display = 'flex';
                } else {
                    updateDonutMeter('dcDonutAll', 'dcDonutAllValue', dcPercentages[0]);
                    document.querySelector('#dcDonutAll').parentElement.style.display = 'flex';
                    document.querySelector('#dcDonutTarget').parentElement.style.display = 'none';
                }
                dcSubtitle.textContent = dcData.label;
                
                // Update card highlight based on active metric
                if (metric === 'fr') {
                    frCard.style.opacity = '1';
                    frCard.style.transform = 'scale(1.02)';
                    dcCard.style.opacity = '0.6';
                    dcCard.style.transform = 'scale(1)';
                } else {
                    dcCard.style.opacity = '1';
                    dcCard.style.transform = 'scale(1.02)';
                    frCard.style.opacity = '0.6';
                    frCard.style.transform = 'scale(1)';
                }
            }
            
            let frChartInstance = null;
            let frChartNewInstance = null;
            let frChartOldInstance = null;
            let frChartNewTargetInstance = null;
            let frChartOldTargetInstance = null;
            let frChartTotalInstance = null;
            let frChartTargetActiveInstance = null;

            function createComplianceChart(canvasId, data, labels) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return null;
                const total = data.reduce((sum, v) => sum + v, 0);
                const formatPct = (value) => {
                    if (!total) return '0';
                    const pct = (value / total) * 100;
                    const fixed = pct.toFixed(1);
                    return fixed.endsWith('.0') ? fixed.slice(0, -2) : fixed;
                };
                return new Chart(canvas.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: labels.map((l, i) => `${l}: ${data[i]} (${formatPct(data[i])}%)`),
                        datasets: [{ data: data, backgroundColor: complianceColors }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            datalabels: { color: '#fff', font: { weight: 'bold', size: 12 }, formatter: (v) => v },
                            legend: { position: 'right' }
                        }
                    }
                });
            }
            
            function getDataForMetric() {
                if (activeMetric === 'fr') {
                    return {
                        all: frAllData,
                        new: frNewData,
                        old: frOldData,
                        allActive: frAllDataActive,
                        newActive: frNewDataActive,
                        oldActive: frOldDataActive
                    };
                } else {
                    return {
                        all: dcAllData,
                        new: dcNewData,
                        old: dcOldData,
                        allActive: dcAllDataActive,
                        newActive: dcNewDataActive,
                        oldActive: dcOldDataActive
                    };
                }
            }
            
            function updateChartForFilter(filter) {
                const data = getDataForMetric();
                
                // Destroy all existing charts
                if (frChartInstance) frChartInstance.destroy();
                if (frChartNewInstance) frChartNewInstance.destroy();
                if (frChartOldInstance) frChartOldInstance.destroy();
                if (frChartNewTargetInstance) frChartNewTargetInstance.destroy();
                if (frChartOldTargetInstance) frChartOldTargetInstance.destroy();
                if (frChartTotalInstance) frChartTotalInstance.destroy();
                if (frChartTargetActiveInstance) frChartTargetActiveInstance.destroy();

                const singleView = document.getElementById('frChartSingle');
                const dualView = document.getElementById('frChartDual');
                const dualViewTarget = document.getElementById('frChartDualTarget');
                const comparisonView = document.getElementById('frChartComparison');

                // Switch views based on filter
                if (filter === 'both') {
                    singleView.style.display = 'none';
                    dualView.style.display = 'flex';
                    dualViewTarget.style.display = 'none';
                    comparisonView.style.display = 'none';
                    
                    frChartNewInstance = createComplianceChart('frChartNew', data.new, complianceLabels);
                    frChartOldInstance = createComplianceChart('frChartOld', data.old, complianceLabels);
                } else if (filter === 'both-target') {
                    singleView.style.display = 'none';
                    dualView.style.display = 'none';
                    dualViewTarget.style.display = 'flex';
                    comparisonView.style.display = 'none';
                    
                    frChartNewTargetInstance = createComplianceChart('frChartNewTarget', data.newActive, complianceLabels);
                    frChartOldTargetInstance = createComplianceChart('frChartOldTarget', data.oldActive, complianceLabels);
                } else if (filter === 'comparison') {
                    singleView.style.display = 'none';
                    dualView.style.display = 'none';
                    dualViewTarget.style.display = 'none';
                    comparisonView.style.display = 'flex';
                    
                    frChartTotalInstance = createComplianceChart('frChartTotal', data.all, complianceLabels);
                    frChartTargetActiveInstance = createComplianceChart('frChartTargetActive', data.allActive, complianceLabels);
                } else {
                    singleView.style.display = 'block';
                    dualView.style.display = 'none';
                    dualViewTarget.style.display = 'none';
                    comparisonView.style.display = 'none';
                    
                    let chartData = data.all;
                    if (filter === 'new') chartData = data.new;
                    else if (filter === 'old') chartData = data.old;
                    else if (filter === 'all-target') chartData = data.allActive;
                    else if (filter === 'new-target') chartData = data.newActive;
                    else if (filter === 'old-target') chartData = data.oldActive;
                    
                    frChartInstance = createComplianceChart('frChart', chartData, complianceLabels);
                }
            }

            // Initialize chart with default filter
            updateChartForFilter(currentFilter);
            updateAvgKpiCards(currentFilter, activeMetric);
            
            // Trigger fly-in animation for donut meters
            setTimeout(() => {
                const frCard = document.getElementById('frAvgCard');
                const dcCard = document.getElementById('dcAvgCard');
                if (frCard) {
                    frCard.classList.add('animate-in');
                    frCard.style.opacity = '1';
                    frCard.style.filter = 'none';
                }
                setTimeout(() => {
                    if (dcCard) {
                        dcCard.classList.add('animate-in');
                        // Initial state: DC card blurred since FR is active by default
                        setTimeout(() => {
                            dcCard.style.opacity = '0.5';
                            dcCard.style.filter = 'blur(1px)';
                            dcCard.style.transform = 'scale(0.95)';
                        }, 700); // After animation completes
                    }
                }, 200); // Stagger DC card animation
            }, 100);
            
            // Metric Toggle Button Logic
            const metricBtns = document.querySelectorAll('.metric-toggle-btn');
            const metricTitle = document.getElementById('metricTitle');
            
            metricBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const metric = this.getAttribute('data-metric');
                    activeMetric = metric;
                    
                    // Update button styles with new clean design
                    metricBtns.forEach(b => {
                        if (b === this) {
                            b.style.background = '#3b82f6';
                            b.style.color = 'white';
                            b.style.borderColor = '#3b82f6';
                            b.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
                            b.classList.add('active');
                        } else {
                            b.style.background = 'white';
                            b.style.color = '#6b7280';
                            b.style.borderColor = '#e5e7eb';
                            b.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                            b.classList.remove('active');
                        }
                    });
                    
                    // Update title
                    if (metric === 'fr') {
                        metricTitle.textContent = 'Face Recognition (FR) Rate - All Active Partners vs Partners with Target';
                        // Highlight FR card, blur DC card
                        const frCard = document.getElementById('frAvgCard');
                        const dcCard = document.getElementById('dcAvgCard');
                        if (frCard) {
                            frCard.style.opacity = '1';
                            frCard.style.filter = 'none';
                            frCard.style.transform = 'scale(1)';
                        }
                        if (dcCard) {
                            dcCard.style.opacity = '0.5';
                            dcCard.style.filter = 'blur(1px)';
                            dcCard.style.transform = 'scale(0.95)';
                        }
                    } else {
                        metricTitle.textContent = 'Driver Card Rate - All Active Partners vs Partners with Target';
                        // Highlight DC card, blur FR card
                        const frCard = document.getElementById('frAvgCard');
                        const dcCard = document.getElementById('dcAvgCard');
                        if (dcCard) {
                            dcCard.style.opacity = '1';
                            dcCard.style.filter = 'none';
                            dcCard.style.transform = 'scale(1)';
                        }
                        if (frCard) {
                            frCard.style.opacity = '0.5';
                            frCard.style.filter = 'blur(1px)';
                            frCard.style.transform = 'scale(0.95)';
                        }
                    }
                    
                    // Update KPI cards highlight
                    updateAvgKpiCards(currentFilter, metric);
                    
                    // Refresh chart with current filter
                    updateChartForFilter(currentFilter);
                });
            });

            // FR Filter button logic
            const filterBtns = document.querySelectorAll('.fr-filter-btn');

            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    currentFilter = filter; // Store current filter
                    
                    // Update button styles
                    filterBtns.forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                        b.classList.remove('active');
                    });
                    this.style.background = '#3b82f6';
                    this.style.color = 'white';
                    this.style.borderColor = '#3b82f6';
                    this.classList.add('active');
                    
                    // Reset Performance filter buttons to inactive state
                    const perfFilterBtns = document.querySelectorAll('.fr-perf-filter-btn');
                    perfFilterBtns.forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                        b.classList.remove('active');
                    });
                    currentPerfFilter = 'all';

                    // Update KPI cards
                    updateAvgKpiCards(filter, activeMetric);
                    
                    // Update chart based on current metric and filter
                    updateChartForFilter(filter);
                });
            });

            // Performance Filter button logic for Compliance Distribution
            const perfFilterBtns = document.querySelectorAll('.fr-perf-filter-btn');
            
            perfFilterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const perf = this.getAttribute('data-perf');
                    currentPerfFilter = perf;
                    
                    // Update button styles
                    perfFilterBtns.forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                        b.classList.remove('active');
                    });
                    this.style.background = '#059669';
                    this.style.color = 'white';
                    this.style.borderColor = '#059669';
                    this.classList.add('active');
                    
                    // Reset other filter buttons to inactive state
                    const filterBtns = document.querySelectorAll('.fr-filter-btn');
                    filterBtns.forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                        b.classList.remove('active');
                    });
                    currentFilter = 'all';
                    
                    // Update KPI cards with performance data
                    updatePerfKpiCards(perf, activeMetric);
                    
                    // Update chart with performance data
                    updateChartForPerfFilter(perf);
                });
            });
            
            // Function to update KPI cards for performance filter
            function updatePerfKpiCards(perf, metric) {
                const frSubtitle = document.getElementById('frAvgSubtitle');
                const dcSubtitle = document.getElementById('dcAvgSubtitle');
                
                const frData = frPerfAvgRates[perf] || frPerfAvgRates.all;
                const dcData = dcPerfAvgRates[perf] || dcPerfAvgRates.all;
                
                // Parse and update FR donut
                const frPct = parseFloat(frData.value.replace('%', ''));
                updateDonutMeter('frDonutAll', 'frDonutAllValue', frPct);
                document.querySelector('#frDonutTarget').parentElement.style.display = 'none';
                frSubtitle.textContent = frData.label;
                
                // Parse and update DC donut
                const dcPct = parseFloat(dcData.value.replace('%', ''));
                updateDonutMeter('dcDonutAll', 'dcDonutAllValue', dcPct);
                document.querySelector('#dcDonutTarget').parentElement.style.display = 'none';
                dcSubtitle.textContent = dcData.label;
            }
            
            // Function to update chart for performance filter
            function updateChartForPerfFilter(perf) {
                const metric = activeMetric;
                const data = metric === 'fr' ? frPerfData[perf] : dcPerfData[perf];
                const title = metric === 'fr' 
                    ? `Face Recognition (FR) Rate - ${perf === 'all' ? 'All Partners with Target' : perf.charAt(0).toUpperCase() + perf.slice(1) + ' Partners'}`
                    : `Driver Card Rate - ${perf === 'all' ? 'All Partners with Target' : perf.charAt(0).toUpperCase() + perf.slice(1) + ' Partners'}`;
                
                const metricTitle = document.getElementById('metricTitle');
                if (metricTitle) metricTitle.textContent = title;
                
                // Hide dual views, show single
                document.getElementById('frChartSingle').style.display = 'block';
                document.getElementById('frChartDual').style.display = 'none';
                document.getElementById('frChartDualTarget').style.display = 'none';
                document.getElementById('frChartComparison').style.display = 'none';
                
                // Destroy existing charts and create new one
                if (frChartInstance) frChartInstance.destroy();
                if (frChartNewInstance) frChartNewInstance.destroy();
                if (frChartOldInstance) frChartOldInstance.destroy();
                if (frChartNewTargetInstance) frChartNewTargetInstance.destroy();
                if (frChartOldTargetInstance) frChartOldTargetInstance.destroy();
                if (frChartTotalInstance) frChartTotalInstance.destroy();
                if (frChartTargetActiveInstance) frChartTargetActiveInstance.destroy();
                
                // Create new chart with performance data
                frChartInstance = createComplianceChart('frChart', data, complianceLabels);
            }

            // Performance & Scale Summary Section
            const psSummaryRows = [
                { label: 'Total partners with target', dec: 625, jan: 551 },
                { label: 'Total capacity target', dec: 22453, jan: 19365 },
                { label: 'Avg scale per partner', dec: 35.9, jan: 35.1 },
                { label: 'Delivery riders all partners', dec: 23511, jan: 20489 },
                { label: 'Delivery riders partners with target', dec: 22448, jan: 19127 },
                { label: 'Delivery rider avg scale (Total active)', dec: 34.2, jan: 31.9 },
                { label: 'Delivery rider avg scale (Partners with target)', dec: 35.9, jan: 34.7 },
                { label: 'Online riders all partners', dec: 24428, jan: 21116 },
                { label: 'Online riders partners with target', dec: 23298, jan: 19689 },
                { label: 'Online riders avg scale (Total active)', dec: 35.6, jan: 32.8 },
                { label: 'Online riders avg scale (Partners with target)', dec: 39.1, jan: 38.3 }
            ];

            const psBreakdownData = {
                overall: [
                    { label: 'Total partners count', dec: { new1: 63, new3: 161, old3: 463, total: 687 }, jan: { new1: 27, new3: 131, old3: 485, total: 643 } },
                    { label: 'Total active partners count', dec: { new1: 56, new3: 144, old3: 425, total: 625 }, jan: { new1: 26, new3: 101, old3: 424, total: 551 } },
                    { label: 'Target total', dec: { new1: 1380, new3: 3574, old3: 17499, total: 22453 }, jan: { new1: 583, new3: 2379, old3: 16403, total: 19365 } },
                    { label: 'Avg scale', dec: { new1: 24.6, new3: 24.8, old3: 41.2, total: 35.9 }, jan: { new1: 22.4, new3: 23.6, old3: 38.7, total: 35.1 } }
                ],
                performance: {
                    good: [
                        { label: 'Good partners with target', dec: { new1: 15, new3: 42, old3: 212, total: 269 }, jan: { new1: 3, new3: 38, old3: 211, total: 252 } },
                        { label: 'Good partners target', dec: { new1: 396, new3: 1208, old3: 10745, total: 12349 }, jan: { new1: 50, new3: 1050, old3: 9092, total: 10192 } },
                        { label: 'Good partners avg scale', dec: { new1: 26.4, new3: 28.8, old3: 50.7, total: 45.9 }, jan: { new1: 16.7, new3: 27.6, old3: 43.1, total: 40.4 } }
                    ],
                    average: [
                        { label: 'Average partners with target', dec: { new1: 5, new3: 74, old3: 195, total: 274 }, jan: { new1: 2, new3: 55, old3: 205, total: 262 } },
                        { label: 'Average partners target', dec: { new1: 115, new3: 1863, old3: 6352, total: 8330 }, jan: { new1: 67, new3: 1193, old3: 7154, total: 8414 } },
                        { label: 'Average partners avg scale', dec: { new1: 23.0, new3: 25.2, old3: 32.6, total: 30.4 }, jan: { new1: 33.5, new3: 21.7, old3: 34.9, total: 32.1 } }
                    ],
                    bad: [
                        { label: 'Bad partners with target', dec: { new1: 28, new3: 28, old3: 17, total: 73 }, jan: { new1: 4, new3: 8, old3: 8, total: 20 } },
                        { label: 'Bad partners target', dec: { new1: 659, new3: 503, old3: 372, total: 1534 }, jan: { new1: 77, new3: 136, old3: 157, total: 370 } },
                        { label: 'Bad partners avg scale', dec: { new1: 23.5, new3: 18.0, old3: 21.9, total: 21.0 }, jan: { new1: 19.3, new3: 17.0, old3: 19.6, total: 18.5 } }
                    ]
                },
                scale: {
                    big: [
                        { label: '# of big partners with target', dec: { new1: 0, new3: 9, old3: 72, total: 81 }, jan: { new1: 0, new3: 0, old3: 77, total: 77 } },
                        { label: 'Big partners target', dec: { new1: 0, new3: 477, old3: 4461, total: 4938 }, jan: { new1: 0, new3: 0, old3: 5351, total: 5351 } },
                        { label: 'Big partners avg scale', dec: { new1: 0.0, new3: 53.0, old3: 62.0, total: 61.0 }, jan: { new1: 0.0, new3: 0.0, old3: 69.5, total: 69.5 } }
                    ],
                    mid: [
                        { label: '# of mid partners with target', dec: { new1: 5, new3: 56, old3: 214, total: 275 }, jan: { new1: 1, new3: 13, old3: 268, total: 282 } },
                        { label: 'Mid partners target', dec: { new1: 161, new3: 1677, old3: 8760, total: 10598 }, jan: { new1: 42, new3: 506, old3: 9434, total: 9982 } },
                        { label: 'Mid partners avg scale', dec: { new1: 32.2, new3: 29.9, old3: 40.9, total: 38.5 }, jan: { new1: 42.0, new3: 38.9, old3: 35.2, total: 35.4 } }
                    ],
                    small: [
                        { label: '# of small partners with target', dec: { new1: 43, new3: 79, old3: 138, total: 260 }, jan: { new1: 8, new3: 88, old3: 79, total: 175 } },
                        { label: 'Small partners target', dec: { new1: 1009, new3: 1420, old3: 4248, total: 6677 }, jan: { new1: 152, new3: 1873, old3: 1618, total: 3643 } },
                        { label: 'Small partners avg scale', dec: { new1: 23.5, new3: 18.0, old3: 30.8, total: 25.7 }, jan: { new1: 19.0, new3: 21.3, old3: 20.5, total: 20.8 } }
                    ]
                }
            };

            let psAvgScaleChartInstance = null;
            let psRidersBreakdownChartInstance = null;
            let psAvgScaleOverallChartInstance = null;
            let psCombinedRidersChartInstance = null;
            let psCombinedAvgScaleChartInstance = null;
            let psBreakdownChartInstance = null;
            let psSummaryPeriod = 'total';
            let psSummaryPerf = 'all';
            let psSummaryScale = 'all';
            let psSummaryView = 'both';
            let psPeriod = 'total';
            let psPerf = 'all';
            let psScale = 'all';

            const psFormatMoM = (dec, jan) => {
                if (!dec) return '0.0';
                return (((jan - dec) / dec) * 100).toFixed(1);
            };

            const psMoMClass = (mom) => (parseFloat(mom) >= 0 ? '#16a34a' : '#dc2626');
            const psMoMColor = (mom) => {
                const val = parseFloat(mom);
                if (val > 0) return '#16a34a';
                if (val < 0) return '#dc2626';
                return '#f59e0b';
            };

            function psRenderSummaryTable() {
                const tbody = document.getElementById('psSummaryTableBody');
                if (!tbody) return;
                tbody.innerHTML = '';
                psSummaryRows.forEach((row, idx) => {
                    const mom = psFormatMoM(row.dec, row.jan);
                    const tr = document.createElement('tr');
                    tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${row.label}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${row.dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${row.jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${psMoMClass(mom)};">${mom}%</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            function psPrettyPeriodLabel(period) {
                return period === 'new1' ? 'New Partners <1M'
                    : period === 'new3' ? 'New Partners <3M'
                    : period === 'old3' ? 'Old Partners >3M'
                    : 'Total Partners';
            }

            function psPrettyPerfLabel(perf) {
                if (perf === 'good') return 'Good Partners with Target';
                if (perf === 'average') return 'Average Partners with Target';
                if (perf === 'bad') return 'Bad Partners with Target';
                return '';
            }

            function psPrettyScaleLabel(scale) {
                if (scale === 'big') return 'Big Partners with Target';
                if (scale === 'mid') return 'Mid Partners with Target';
                if (scale === 'small') return 'Small Partners with Target';
                return '';
            }

            function psGetAvgScaleMap() {
                return {
                    overall: { label: 'Total Partners with Target Avg Scale', metric: psBreakdownData.overall[3] },
                    good: { label: 'Good Partners with Target Avg Scale', metric: psBreakdownData.performance.good[2] },
                    average: { label: 'Average Partners with Target Avg Scale', metric: psBreakdownData.performance.average[2] },
                    bad: { label: 'Bad Partners with Target Avg Scale', metric: psBreakdownData.performance.bad[2] },
                    big: { label: 'Big Partners with Target Avg Scale', metric: psBreakdownData.scale.big[2] },
                    mid: { label: 'Mid Partners with Target Avg Scale', metric: psBreakdownData.scale.mid[2] },
                    small: { label: 'Small Partners with Target Avg Scale', metric: psBreakdownData.scale.small[2] }
                };
            }

            function psGetAvgScaleKeys() {
                if (psSummaryPerf !== 'all') return ['overall', psSummaryPerf];
                if (psSummaryScale !== 'all') return ['overall', psSummaryScale];
                return ['overall', 'good', 'average', 'bad', 'big', 'mid', 'small'];
            }

            function psRenderAvgScaleChart() {
                const canvas = document.getElementById('psAvgScaleChart');
                if (!canvas) return;
                if (psAvgScaleChartInstance) { try { psAvgScaleChartInstance.destroy(); } catch(e) {} }

                const avgMap = psGetAvgScaleMap();
                const keys = psGetAvgScaleKeys();
                const labels = keys.map(k => avgMap[k].label);
                const decData = keys.map(k => avgMap[k].metric.dec[psSummaryPeriod]);
                const janData = keys.map(k => avgMap[k].metric.jan[psSummaryPeriod]);

                const periodLabel = psPrettyPeriodLabel(psSummaryPeriod);
                const titleParts = [periodLabel];
                if (psSummaryPerf !== 'all') titleParts.push(psPrettyPerfLabel(psSummaryPerf));
                if (psSummaryScale !== 'all') titleParts.push(psPrettyScaleLabel(psSummaryScale));
                const avgTitle = document.getElementById('psAvgScaleTitle');
                if (avgTitle) avgTitle.textContent = `Avg Scale Overview (${titleParts.join(' • ')})`;

                const momLabelsByIndex = {
                    id: 'momLabelsByIndex',
                    afterDatasetsDraw(chart) {
                        const { ctx, data } = chart;
                        const showJan = chart.isDatasetVisible(0);
                        const showFeb = chart.isDatasetVisible(1);
                        ctx.save();
                        ctx.font = 'bold 9px sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';

                        data.datasets.forEach((dataset, datasetIndex) => {
                            if (!chart.isDatasetVisible(datasetIndex)) return;
                            const meta = chart.getDatasetMeta(datasetIndex);
                            meta.data.forEach((bar, index) => {
                                const val = dataset.data[index];
                                if (val === null || val === undefined) return;
                                const x = bar.x;
                                const y = bar.y - 4;
                                const valText = Number(val).toLocaleString();

                                if (datasetIndex === 1 && showJan && showFeb) {
                                    const mom = psFormatMoM(decData[index], janData[index]);
                                    const sign = parseFloat(mom) > 0 ? '+' : '';
                                    const momText = ` (${sign}${mom}%)`;
                                    const valWidth = ctx.measureText(valText).width;
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x - (ctx.measureText(momText).width / 2), y);
                                    ctx.fillStyle = psMoMColor(mom);
                                    ctx.fillText(momText, x + (valWidth / 2), y);
                                } else {
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x, y);
                                }
                            });
                        });
                        ctx.restore();
                    }
                };

                psAvgScaleChartInstance = new Chart(canvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels,
                        datasets: [
                            { label: 'Jan', data: decData, backgroundColor: '#60a5fa' },
                            { label: 'Feb', data: janData, backgroundColor: '#34d399' }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 1200,
                            easing: 'easeOutQuart',
                            delay: (context) => context.dataIndex * 80 + context.datasetIndex * 120
                        },
                        transitions: {
                            active: { animation: { duration: 300 } },
                            resize: { animation: { duration: 0 } },
                            show: { animations: { colors: { from: 'transparent' }, visible: { type: 'boolean', duration: 500 } } },
                            hide: { animations: { colors: { to: 'transparent' }, visible: { type: 'boolean', easing: 'linear', fn: v => v | 0 } } }
                        },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 10,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            },
                            datalabels: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } },
                            x: { ticks: { font: { size: 10 } } }
                        }
                    },
                    plugins: [momLabelsByIndex]
                });
            }

            function psGetSummaryRowByLabel(label) {
                return psSummaryRows.find(r => r.label === label);
            }

            function psHexToRgba(hex, alpha) {
                const cleaned = hex.replace('#', '');
                const bigint = parseInt(cleaned, 16);
                const r = (bigint >> 16) & 255;
                const g = (bigint >> 8) & 255;
                const b = bigint & 255;
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }

            function psRenderRidersBreakdownChart(canvasId, targetVarSetter) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                if (targetVarSetter.current) { try { targetVarSetter.current.destroy(); } catch(e) {} }

                const ridersMetrics = [
                    { label: 'Capacity Target', rowLabel: 'Total capacity target', color: '#3b82f6' },
                    { label: 'Delivery Riders (with target)', rowLabel: 'Delivery riders partners with target', color: '#f97316' },
                    { label: 'Online Riders (with target)', rowLabel: 'Online riders partners with target', color: '#10b981' }
                ];

                const datasets = ridersMetrics.map(metric => {
                    const row = psGetSummaryRowByLabel(metric.rowLabel);
                    if (!row) return null;
                    return {
                        label: metric.label,
                        data: [row.dec, row.jan],
                        backgroundColor: psHexToRgba(metric.color, 0.85),
                        borderColor: metric.color,
                        borderWidth: 1.5
                    };
                }).filter(Boolean);

                const momLabelsByIndex = {
                    id: 'momLabelsByIndex',
                    afterDatasetsDraw(chart) {
                        const { ctx, data } = chart;
                        const showJan = chart.isDatasetVisible(0);
                        const showFeb = chart.isDatasetVisible(1);
                        ctx.save();
                        ctx.font = 'bold 10px sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';

                        data.datasets.forEach((dataset, datasetIndex) => {
                            if (!chart.isDatasetVisible(datasetIndex)) return;
                            const meta = chart.getDatasetMeta(datasetIndex);
                            meta.data.forEach((bar, index) => {
                                const val = dataset.data[index];
                                if (val === null || val === undefined) return;
                                const x = bar.x;
                                const y = bar.y - 4;
                                const valText = Number(val).toLocaleString();

                                if (index === 1 && showJan && showFeb) {
                                    const mom = psFormatMoM(dataset.data[0], dataset.data[1]);
                                    const sign = parseFloat(mom) > 0 ? '+' : '';
                                    const momText = ` (${sign}${mom}%)`;
                                    const valWidth = ctx.measureText(valText).width;
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x - (ctx.measureText(momText).width / 2), y);
                                    ctx.fillStyle = psMoMColor(mom);
                                    ctx.fillText(momText, x + (valWidth / 2), y);
                                } else {
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x, y);
                                }
                            });
                        });
                        ctx.restore();
                    }
                };

                targetVarSetter.current = new Chart(canvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb'],
                        datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 1200,
                            easing: 'easeOutQuart',
                            delay: (context) => context.dataIndex * 100 + context.datasetIndex * 150
                        },
                        transitions: {
                            active: { animation: { duration: 300 } },
                            resize: { animation: { duration: 0 } },
                            show: { animations: { colors: { from: 'transparent' }, visible: { type: 'boolean', duration: 500 } } },
                            hide: { animations: { colors: { to: 'transparent' }, visible: { type: 'boolean', easing: 'linear', fn: v => v | 0 } } }
                        },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 10,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            },
                            datalabels: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } },
                            x: { ticks: { font: { size: 10 } } }
                        }
                    },
                    plugins: [momLabelsByIndex]
                });
            }

            function psRenderAvgScaleOverallChart(canvasId, targetVarSetter) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                if (targetVarSetter.current) { try { targetVarSetter.current.destroy(); } catch(e) {} }

                const capacityRow = psGetSummaryRowByLabel('Avg scale per partner');
                const deliveryRow = psGetSummaryRowByLabel('Delivery rider avg scale (Partners with target)');
                const onlineRow = psGetSummaryRowByLabel('Online riders avg scale (Partners with target)');

                const datasets = [
                    capacityRow ? { label: 'Capacity Target', data: [capacityRow.dec, capacityRow.jan], backgroundColor: '#3b82f6', borderColor: '#1d4ed8', borderWidth: 1.5 } : null,
                    deliveryRow ? { label: 'Delivery Riders (with target)', data: [deliveryRow.dec, deliveryRow.jan], backgroundColor: '#f97316', borderColor: '#ea580c', borderWidth: 1.5 } : null,
                    onlineRow ? { label: 'Online Riders (with target)', data: [onlineRow.dec, onlineRow.jan], backgroundColor: '#10b981', borderColor: '#059669', borderWidth: 1.5 } : null
                ].filter(Boolean);

                const momLabelsByIndex = {
                    id: 'momLabelsByIndex',
                    afterDatasetsDraw(chart) {
                        const { ctx, data } = chart;
                        const showJan = chart.isDatasetVisible(0);
                        const showFeb = chart.isDatasetVisible(1);
                        ctx.save();
                        ctx.font = 'bold 10px sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';

                        data.datasets.forEach((dataset, datasetIndex) => {
                            if (!chart.isDatasetVisible(datasetIndex)) return;
                            const meta = chart.getDatasetMeta(datasetIndex);
                            meta.data.forEach((bar, index) => {
                                const val = dataset.data[index];
                                if (val === null || val === undefined) return;
                                const x = bar.x;
                                const y = bar.y - 4;
                                const valText = Number(val).toLocaleString();

                                if (index === 1 && showJan && showFeb) {
                                    const mom = psFormatMoM(dataset.data[0], dataset.data[1]);
                                    const sign = parseFloat(mom) > 0 ? '+' : '';
                                    const momText = ` (${sign}${mom}%)`;
                                    const valWidth = ctx.measureText(valText).width;
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x - (ctx.measureText(momText).width / 2), y);
                                    ctx.fillStyle = psMoMColor(mom);
                                    ctx.fillText(momText, x + (valWidth / 2), y);
                                } else {
                                    ctx.fillStyle = '#111827';
                                    ctx.fillText(valText, x, y);
                                }
                            });
                        });
                        ctx.restore();
                    }
                };

                targetVarSetter.current = new Chart(canvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb'],
                        datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 1200,
                            easing: 'easeOutQuart',
                            delay: (context) => context.dataIndex * 100 + context.datasetIndex * 150
                        },
                        transitions: {
                            active: { animation: { duration: 300 } },
                            resize: { animation: { duration: 0 } },
                            show: { animations: { colors: { from: 'transparent' }, visible: { type: 'boolean', duration: 500 } } },
                            hide: { animations: { colors: { to: 'transparent' }, visible: { type: 'boolean', easing: 'linear', fn: v => v | 0 } } }
                        },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 10,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            },
                            datalabels: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } },
                            x: { ticks: { font: { size: 10 } } }
                        }
                    },
                    plugins: [momLabelsByIndex]
                });
            }

            function psGetMetrics() {
                if (psPerf !== 'all') return psBreakdownData.performance[psPerf];
                if (psScale !== 'all') return psBreakdownData.scale[psScale];
                return psBreakdownData.overall;
            }

            let psBreakdownChart1Instance = null;
            let psBreakdownChart2Instance = null;
            let psBreakdownChart3Instance = null;
            let psBreakdownChart4Instance = null;

            function psRenderMiniChart(canvasId, dec, jan, color, chartInstanceRef) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                if (chartInstanceRef.current) { try { chartInstanceRef.current.destroy(); } catch(e) {} }
                
                const mom = psFormatMoM(dec, jan);
                const momColor = psMoMColor(mom);
                
                chartInstanceRef.current = new Chart(canvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb'],
                        datasets: [{
                            data: [dec, jan],
                            backgroundColor: [color + '99', color],
                            borderColor: [color, color],
                            borderWidth: 2,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart',
                            delay: (context) => context.dataIndex * 150
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 10,
                                callbacks: {
                                    label: ctx => ctx.parsed.y.toLocaleString()
                                }
                            },
                            datalabels: { display: false }
                        },
                        scales: {
                            y: { 
                                display: false,
                                beginAtZero: true
                            },
                            x: { 
                                grid: { display: false },
                                ticks: { font: { size: 10, weight: '600' }, color: '#64748b' }
                            }
                        }
                    }
                });
            }

            function psUpdateBreakdown() {
                const metrics = psGetMetrics();
                const labels = metrics.map(m => m.label);
                const decData = metrics.map(m => m.dec[psPeriod]);
                const janData = metrics.map(m => m.jan[psPeriod]);

                const titleParts = [];
                const periodLabel = psPrettyPeriodLabel(psPeriod);
                titleParts.push(periodLabel);
                if (psPerf !== 'all') titleParts.push(psPrettyPerfLabel(psPerf));
                if (psScale !== 'all') titleParts.push(psPrettyScaleLabel(psScale));
                const breakdownTitle = document.getElementById('psBreakdownTitle');
                if (breakdownTitle) breakdownTitle.textContent = `📊 Breakdown Overview (${titleParts.join(' • ')})`;

                // Update KPI Cards
                const updateKpi = (prefix, dec, jan) => {
                    const decEl = document.getElementById(`psKpi${prefix}Dec`);
                    const janEl = document.getElementById(`psKpi${prefix}Jan`);
                    const momEl = document.getElementById(`psKpi${prefix}Mom`);
                    if (decEl) decEl.textContent = dec.toLocaleString();
                    if (janEl) janEl.textContent = jan.toLocaleString();
                    if (momEl) {
                        const mom = psFormatMoM(dec, jan);
                        const sign = parseFloat(mom) > 0 ? '+' : '';
                        momEl.textContent = `${sign}${mom}% MoM`;
                        momEl.style.color = psMoMColor(mom);
                    }
                };

                // Update labels based on filter context
                const activeLabel = document.getElementById('psKpiActivePartnersLabel');
                const totalLabel = document.getElementById('psKpiTotalPartnersLabel');
                
                if (decData.length >= 4) {
                    // Overall view (4 metrics: partners count, active partners, target, avg scale)
                                        if (totalLabel) {
                                                totalLabel.innerHTML = `
                                                    <span>👥 Total Active Partners</span>
                                                    <span class="kpi-tooltip-wrapper" style="display: inline-flex; align-items: center;">
                                                        <span style="width: 18px; height: 18px; border-radius: 6px; background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; line-height: 1;">i</span>
                                                        <div class="kpi-tooltip">
                                                            <div class="tooltip-title">👥 Total Active Partners</div>
                                                            <div>Partners with delivery riders active in the <span class="tooltip-highlight">last 7 days</span> of the month.</div>
                                                        </div>
                                                    </span>
                                                `;
                                        }
                                        if (activeLabel) {
                                                activeLabel.innerHTML = `
                                                    <span>🎯 Total Partners With Target</span>
                                                    <span class="kpi-tooltip-wrapper" style="display: inline-flex; align-items: center;">
                                                        <span style="width: 18px; height: 18px; border-radius: 6px; background: #f5f3ff; border: 1px solid #ddd6fe; color: #5b21b6; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; line-height: 1;">i</span>
                                                        <div class="kpi-tooltip">
                                                            <div class="tooltip-title">🎯 Total Partners With Target</div>
                                                            <div>Partners that were <span class="tooltip-highlight">assigned a capacity target</span> for the month.</div>
                                                        </div>
                                                    </span>
                                                `;
                                        }
                    updateKpi('TotalPartners', decData[0], janData[0]);
                    updateKpi('ActivePartners', decData[1], janData[1]);
                    updateKpi('Target', decData[2], janData[2]);
                    updateKpi('AvgScale', decData[3], janData[3]);
                    
                    // Render mini charts
                    psRenderMiniChart('psBreakdownChart1', decData[0], janData[0], '#3b82f6', { get current() { return psBreakdownChart1Instance; }, set current(v) { psBreakdownChart1Instance = v; } });
                    psRenderMiniChart('psBreakdownChart2', decData[1], janData[1], '#8b5cf6', { get current() { return psBreakdownChart2Instance; }, set current(v) { psBreakdownChart2Instance = v; } });
                    psRenderMiniChart('psBreakdownChart3', decData[2], janData[2], '#f59e0b', { get current() { return psBreakdownChart3Instance; }, set current(v) { psBreakdownChart3Instance = v; } });
                    psRenderMiniChart('psBreakdownChart4', decData[3], janData[3], '#10b981', { get current() { return psBreakdownChart4Instance; }, set current(v) { psBreakdownChart4Instance = v; } });
                } else if (decData.length === 3) {
                    // Performance or Scale filtered view (3 metrics: partners with target, target value, avg scale)
                    if (totalLabel) totalLabel.textContent = '👥 Partners with Target';
                    if (activeLabel) activeLabel.textContent = '🎯 Capacity Target Value';
                    updateKpi('TotalPartners', decData[0], janData[0]); // # of partners with target
                    updateKpi('ActivePartners', decData[1], janData[1]); // Target value (NOT partners count!)
                    updateKpi('Target', decData[1], janData[1]); // Target value
                    updateKpi('AvgScale', decData[2], janData[2]); // Avg scale
                    
                    psRenderMiniChart('psBreakdownChart1', decData[0], janData[0], '#3b82f6', { get current() { return psBreakdownChart1Instance; }, set current(v) { psBreakdownChart1Instance = v; } });
                    psRenderMiniChart('psBreakdownChart2', decData[1], janData[1], '#8b5cf6', { get current() { return psBreakdownChart2Instance; }, set current(v) { psBreakdownChart2Instance = v; } });
                    psRenderMiniChart('psBreakdownChart3', decData[1], janData[1], '#f59e0b', { get current() { return psBreakdownChart3Instance; }, set current(v) { psBreakdownChart3Instance = v; } });
                    psRenderMiniChart('psBreakdownChart4', decData[2], janData[2], '#10b981', { get current() { return psBreakdownChart4Instance; }, set current(v) { psBreakdownChart4Instance = v; } });
                }

                const tbody = document.getElementById('psBreakdownTableBody');
                if (tbody) {
                    tbody.innerHTML = '';
                    metrics.forEach((m, idx) => {
                        const dec = m.dec[psPeriod];
                        const jan = m.jan[psPeriod];
                        const mom = psFormatMoM(dec, jan);
                        const tr = document.createElement('tr');
                        tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                        tr.innerHTML = `
                            <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${m.label}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${psMoMClass(mom)};">${mom}%</td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            }

            // Init + Toggle Handlers
            let psCurrentView = 'summary';
            
            function psUpdateSummaryCards(animate) {
                const card1 = document.getElementById('psSummaryCard1');
                const card2 = document.getElementById('psSummaryCard2');
                const card3 = document.getElementById('psSummaryCard3');
                const card4 = document.getElementById('psSummaryCard4');
                const note = document.getElementById('psContextNote');
                if (!card1) return;
                const cards = [card1, card2, card3, card4];
                
                const psSetCard = (card, icon, label, value, mom, sub, tooltip, delay) => {
                    const momVal = parseFloat(mom);
                    const momColor = momVal > 0 ? '#16a34a' : (momVal < 0 ? '#dc2626' : '#f59e0b');
                    const momSign = momVal > 0 ? '+' : '';
                    card.querySelector('[id$=\"Label\"]').textContent = label;
                    card.querySelector('[id$=\"Value\"]').textContent = value;
                    const momEl = card.querySelector('[id$=\"MoM\"]');
                    momEl.textContent = momSign + mom + '%';
                    momEl.style.color = momColor;
                    card.querySelector('[id$=\"Sub\"]').textContent = sub;
                    card.setAttribute('data-tooltip', tooltip);
                    // Update icon
                    const iconDiv = card.querySelector('div[style*=\"border-radius: 10px\"]');
                    if (iconDiv) iconDiv.textContent = icon;
                };
                
                // Animate cards
                if (animate) {
                    cards.forEach(c => { c.classList.remove('ps-card-fly-in'); c.classList.add('ps-card-updating'); });
                    setTimeout(() => {
                        psPopulateCards(psSetCard, cards, note);
                        cards.forEach((c, i) => {
                            setTimeout(() => {
                                c.classList.remove('ps-card-updating');
                                c.classList.add('ps-card-fly-in');
                            }, i * 80);
                        });
                    }, 200);
                } else {
                    psPopulateCards(psSetCard, cards, note);
                }
            }
            
            function psPopulateCards(setCard, cards, note) {
                const fmtN = (n) => typeof n === 'number' ? (n % 1 !== 0 ? n.toFixed(1) : n.toLocaleString()) : n;
                const fmtMoM = (d, j) => { if (!d) return '0.0'; return (((j - d) / d) * 100).toFixed(1); };
                
                if (psCurrentView === 'summary') {
                    // Avg Scale & Capacity Summary view — filter-aware using psBreakdownData
                    let metrics, catLabel;
                    if (psSummaryPerf !== 'all') {
                        metrics = psBreakdownData.performance[psSummaryPerf];
                        catLabel = psPrettyPerfLabel(psSummaryPerf);
                    } else if (psSummaryScale !== 'all') {
                        metrics = psBreakdownData.scale[psSummaryScale];
                        catLabel = psPrettyScaleLabel(psSummaryScale);
                    } else {
                        metrics = psBreakdownData.overall;
                        catLabel = 'Total Partners with Target';
                    }
                    const period = psSummaryPeriod;
                    const periodLabel = psPrettyPeriodLabel(period);
                    // metrics[0] = partners count, metrics[1] = target, metrics[2] = avg scale (index 3 for overall)
                    const partnersM = metrics[metrics.length >= 4 ? 1 : 0];
                    const targetM = metrics[metrics.length >= 4 ? 2 : 1];
                    const avgScaleM = metrics[metrics.length >= 4 ? 3 : 2];

                    const pDec = partnersM.dec[period], pJan = partnersM.jan[period];
                    const tDec = targetM.dec[period], tJan = targetM.jan[period];
                    const aDec = avgScaleM.dec[period], aJan = avgScaleM.jan[period];

                    // Card 1: Partners Count
                    setCard(cards[0], '\ud83d\udc65', catLabel.replace(/ with Target/i,'') + ' Count', fmtN(pJan), fmtMoM(pDec, pJan),
                        'Jan ' + fmtN(pDec) + ' \u2192 Feb ' + fmtN(pJan),
                        partnersM.label + ' (' + periodLabel + '). Jan ' + fmtN(pDec) + ' \u2192 Feb ' + fmtN(pJan) + ' (' + fmtMoM(pDec, pJan) + '% MoM).');
                    // Card 2: Total Target
                    setCard(cards[1], '\ud83c\udfaf', catLabel.replace(/ with Target/i,'') + ' Target', fmtN(tJan), fmtMoM(tDec, tJan),
                        'Jan ' + fmtN(tDec) + ' \u2192 Feb ' + fmtN(tJan),
                        targetM.label + ' (' + periodLabel + '). Jan ' + fmtN(tDec) + ' \u2192 Feb ' + fmtN(tJan) + ' (' + fmtMoM(tDec, tJan) + '% MoM).');
                    // Card 3: Avg Scale
                    setCard(cards[2], '\ud83d\udcca', catLabel.replace(/ with Target/i,'') + ' Avg Scale', fmtN(aJan), fmtMoM(aDec, aJan),
                        'Jan ' + fmtN(aDec) + ' \u2192 Feb ' + fmtN(aJan),
                        avgScaleM.label + ' (' + periodLabel + '). Jan ' + fmtN(aDec) + ' \u2192 Feb ' + fmtN(aJan) + ' (' + fmtMoM(aDec, aJan) + '% MoM).');
                    // Card 4: Overall Avg Scale (always from overall data for comparison)
                    const overallAvg = psBreakdownData.overall[3];
                    const oaDec = overallAvg.dec[period], oaJan = overallAvg.jan[period];
                    setCard(cards[3], '\ud83d\udeb4', 'Overall Avg Scale', fmtN(oaJan), fmtMoM(oaDec, oaJan),
                        'Jan ' + fmtN(oaDec) + ' \u2192 Feb ' + fmtN(oaJan),
                        'Overall avg scale for reference (' + periodLabel + '). Jan ' + fmtN(oaDec) + ' \u2192 Feb ' + fmtN(oaJan) + ' (' + fmtMoM(oaDec, oaJan) + '% MoM).');
                    // Build context note
                    const noteParts = [periodLabel];
                    if (psSummaryPerf !== 'all') noteParts.push(psPrettyPerfLabel(psSummaryPerf));
                    if (psSummaryScale !== 'all') noteParts.push(psPrettyScaleLabel(psSummaryScale));
                    if (note) note.textContent = '\ud83e\udded Showing: ' + noteParts.join(' \u2022 ') + '. Cards reflect the selected period & category with overall avg scale for comparison.';
                    
                } else if (psCurrentView === 'breakdown') {
                    // Performance & Scale Breakdown view
                    const metrics = psGetMetrics();
                    const periodLabel = psPrettyPeriodLabel(psPeriod);
                    let filterLabel = periodLabel;
                    if (psPerf !== 'all') filterLabel += ' \u2022 ' + psPrettyPerfLabel(psPerf);
                    if (psScale !== 'all') filterLabel += ' \u2022 ' + psPrettyScaleLabel(psScale);
                    
                    if (metrics.length >= 4) {
                        const d0 = metrics[0].dec[psPeriod], j0 = metrics[0].jan[psPeriod];
                        const d1 = metrics[1].dec[psPeriod], j1 = metrics[1].jan[psPeriod];
                        const d2 = metrics[2].dec[psPeriod], j2 = metrics[2].jan[psPeriod];
                        const d3 = metrics[3].dec[psPeriod], j3 = metrics[3].jan[psPeriod];
                        setCard(cards[0], '\ud83d\udc65', 'Total Active Partners', fmtN(j0), fmtMoM(d0, j0),
                            'Jan ' + fmtN(d0) + ' \u2192 Feb ' + fmtN(j0),
                            'Total active partners (' + filterLabel + '). Jan ' + fmtN(d0) + ' \u2192 Feb ' + fmtN(j0) + '.');
                        setCard(cards[1], '\u2705', 'Total Partners With Target', fmtN(j1), fmtMoM(d1, j1),
                            'Jan ' + fmtN(d1) + ' \u2192 Feb ' + fmtN(j1),
                            'Active partners with target (' + filterLabel + '). Jan ' + fmtN(d1) + ' \u2192 Feb ' + fmtN(j1) + '.');
                        setCard(cards[2], '\ud83c\udfaf', 'Total Target', fmtN(j2), fmtMoM(d2, j2),
                            'Jan ' + fmtN(d2) + ' \u2192 Feb ' + fmtN(j2),
                            'Capacity target (' + filterLabel + '). Jan ' + fmtN(d2) + ' \u2192 Feb ' + fmtN(j2) + '.');
                        setCard(cards[3], '\ud83d\udcca', 'Avg Scale', fmtN(j3), fmtMoM(d3, j3),
                            'Jan ' + fmtN(d3) + ' \u2192 Feb ' + fmtN(j3),
                            'Avg scale (' + filterLabel + '). Jan ' + fmtN(d3) + ' \u2192 Feb ' + fmtN(j3) + '.');
                    } else if (metrics.length === 3) {
                        const d0 = metrics[0].dec[psPeriod], j0 = metrics[0].jan[psPeriod];
                        const d1 = metrics[1].dec[psPeriod], j1 = metrics[1].jan[psPeriod];
                        const d2 = metrics[2].dec[psPeriod], j2 = metrics[2].jan[psPeriod];
                        setCard(cards[0], '\ud83d\udc65', '# with Target', fmtN(j0), fmtMoM(d0, j0),
                            'Jan ' + fmtN(d0) + ' \u2192 Feb ' + fmtN(j0),
                            'Partners with target (' + filterLabel + '). Jan ' + fmtN(d0) + ' \u2192 Feb ' + fmtN(j0) + '.');
                        setCard(cards[1], '\ud83c\udfaf', 'Target Value', fmtN(j1), fmtMoM(d1, j1),
                            'Jan ' + fmtN(d1) + ' \u2192 Feb ' + fmtN(j1),
                            'Target value (' + filterLabel + '). Jan ' + fmtN(d1) + ' \u2192 Feb ' + fmtN(j1) + '.');
                        setCard(cards[2], '\ud83d\udcca', 'Avg Scale', fmtN(j2), fmtMoM(d2, j2),
                            'Jan ' + fmtN(d2) + ' \u2192 Feb ' + fmtN(j2),
                            'Avg scale (' + filterLabel + '). Jan ' + fmtN(d2) + ' \u2192 Feb ' + fmtN(j2) + '.');
                        // Card 4: MoM highlight
                        const moms = [{ lbl: metrics[0].label.split(' ')[0], m: parseFloat(fmtMoM(d0, j0)) }, { lbl: 'Target', m: parseFloat(fmtMoM(d1, j1)) }, { lbl: 'Scale', m: parseFloat(fmtMoM(d2, j2)) }];
                        const biggest = moms.reduce((a, b) => Math.abs(b.m) > Math.abs(a.m) ? b : a);
                        setCard(cards[3], '\ud83d\udcc8', 'Biggest MoM Shift', biggest.lbl, biggest.m.toFixed(1),
                            biggest.m.toFixed(1) + '% MoM change',
                            'Largest MoM% shift in ' + filterLabel + ': ' + biggest.lbl + ' at ' + biggest.m.toFixed(1) + '%.');
                    }
                    if (note) note.textContent = '\ud83e\udded Breakdown: ' + filterLabel + '. Select period, performance, or scale filters to drill down.';
                    
                } else if (psCurrentView === 'target-breakdown') {
                    // Performance Target Breakdown view
                    const data = psTargetBreakdownData[psTargetViewMode];
                    const typeLabel = psTargetTypeMode === 'all' ? 'All' : (psTargetTypeMode === 'new' ? 'New (<3M)' : (psTargetTypeMode === 'old' ? 'Old (\u22653M)' : 'New vs Old'));
                    const modeLabel = psTargetViewMode === 'partners' ? 'Count' : 'Target';
                    
                    if (psTargetTypeMode === 'compare') {
                        const nT = data.new.good + data.new.average + data.new.bad;
                        const oT = data.old.good + data.old.average + data.old.bad;
                        setCard(cards[0], '\ud83d\udc65', 'Total (' + modeLabel + ')', fmtN(nT + oT), '0.0',
                            'New: ' + fmtN(nT) + ' | Old: ' + fmtN(oT),
                            'Total across New+Old partners. New: ' + fmtN(nT) + ', Old: ' + fmtN(oT) + '.');
                        cards[0].querySelector('[id$=\"MoM\"]').textContent = 'N:' + fmtN(nT) + ' O:' + fmtN(oT);
                        cards[0].querySelector('[id$=\"MoM\"]').style.color = '#6366f1';
                        setCard(cards[1], '\u2705', 'Good', fmtN(data.new.good + data.old.good), '0.0',
                            'New: ' + fmtN(data.new.good) + ' | Old: ' + fmtN(data.old.good),
                            'Good partners. New: ' + fmtN(data.new.good) + ', Old: ' + fmtN(data.old.good) + '.');
                        cards[1].querySelector('[id$=\"MoM\"]').textContent = 'N:' + fmtN(data.new.good) + ' O:' + fmtN(data.old.good);
                        cards[1].querySelector('[id$=\"MoM\"]').style.color = '#10b981';
                        setCard(cards[2], '\u26a0\ufe0f', 'Average', fmtN(data.new.average + data.old.average), '0.0',
                            'New: ' + fmtN(data.new.average) + ' | Old: ' + fmtN(data.old.average),
                            'Average partners. New: ' + fmtN(data.new.average) + ', Old: ' + fmtN(data.old.average) + '.');
                        cards[2].querySelector('[id$=\"MoM\"]').textContent = 'N:' + fmtN(data.new.average) + ' O:' + fmtN(data.old.average);
                        cards[2].querySelector('[id$=\"MoM\"]').style.color = '#f59e0b';
                        setCard(cards[3], '\u274c', 'Bad', fmtN(data.new.bad + data.old.bad), '0.0',
                            'New: ' + fmtN(data.new.bad) + ' | Old: ' + fmtN(data.old.bad),
                            'Bad partners. New: ' + fmtN(data.new.bad) + ', Old: ' + fmtN(data.old.bad) + '.');
                        cards[3].querySelector('[id$=\"MoM\"]').textContent = 'N:' + fmtN(data.new.bad) + ' O:' + fmtN(data.old.bad);
                        cards[3].querySelector('[id$=\"MoM\"]').style.color = '#dc2626';
                    } else {
                        const src = data[psTargetTypeMode];
                        const total = src.good + src.average + src.bad;
                        const goodPct = total ? ((src.good / total) * 100).toFixed(1) : '0.0';
                        const avgPct = total ? ((src.average / total) * 100).toFixed(1) : '0.0';
                        const badPct = total ? ((src.bad / total) * 100).toFixed(1) : '0.0';
                        setCard(cards[0], '\ud83d\udc65', 'Total (' + modeLabel + ')', fmtN(total), '0.0',
                            typeLabel + ' partners',
                            'Total ' + modeLabel.toLowerCase() + ' for ' + typeLabel + ' partners: ' + fmtN(total) + '.');
                        cards[0].querySelector('[id$=\"MoM\"]').textContent = typeLabel;
                        cards[0].querySelector('[id$=\"MoM\"]').style.color = '#6366f1';
                        setCard(cards[1], '\u2705', 'Good', fmtN(src.good), goodPct,
                            goodPct + '% of total',
                            'Good partners ' + modeLabel.toLowerCase() + ': ' + fmtN(src.good) + ' (' + goodPct + '%).');
                        cards[1].querySelector('[id$=\"MoM\"]').textContent = goodPct + '%';
                        cards[1].querySelector('[id$=\"MoM\"]').style.color = '#10b981';
                        setCard(cards[2], '\u26a0\ufe0f', 'Average', fmtN(src.average), avgPct,
                            avgPct + '% of total',
                            'Average partners ' + modeLabel.toLowerCase() + ': ' + fmtN(src.average) + ' (' + avgPct + '%).');
                        cards[2].querySelector('[id$=\"MoM\"]').textContent = avgPct + '%';
                        cards[2].querySelector('[id$=\"MoM\"]').style.color = '#f59e0b';
                        setCard(cards[3], '\u274c', 'Bad', fmtN(src.bad), badPct,
                            badPct + '% of total',
                            'Bad partners ' + modeLabel.toLowerCase() + ': ' + fmtN(src.bad) + ' (' + badPct + '%).');
                        cards[3].querySelector('[id$=\"MoM\"]').textContent = badPct + '%';
                        cards[3].querySelector('[id$=\"MoM\"]').style.color = '#dc2626';
                    }
                    if (note) note.textContent = '\ud83e\udded Performance Target: ' + modeLabel + ' view \u2022 ' + typeLabel + '. Switch view (Count/Target) or partner type for details.';
                    
                } else if (psCurrentView === 'vehicle-type') {
                    // Vehicle Type Breakdown view
                    let data, cityLabel;
                    if (vehicleCityLevel === 't1') {
                        data = getVehicleTierData('t1'); cityLabel = 'T1 Cities';
                    } else if (vehicleCityLevel === 't2') {
                        data = getVehicleTierData('t2'); cityLabel = 'T2 Cities';
                    } else if (vehicleCityLevel === 't1vst2') {
                        data = vehicleCityData.all; cityLabel = 'All (T1 vs T2)';
                    } else if (vehicleSelectedCity !== 'all') {
                        data = vehicleCityData[vehicleSelectedCity] || vehicleCityData.all; cityLabel = vehicleSelectedCity;
                    } else {
                        data = vehicleCityData.all; cityLabel = 'All Cities';
                    }
                    const decT = data.dec.cars + data.dec.bikes;
                    const janT = data.jan.cars + data.jan.bikes;
                    const totalMoM = fmtMoM(decT, janT);
                    const carsMoM = fmtMoM(data.dec.cars, data.jan.cars);
                    const bikesMoM = fmtMoM(data.dec.bikes, data.jan.bikes);
                    const carsPct = janT ? ((data.jan.cars / janT) * 100).toFixed(1) : '0.0';
                    const bikesPct = janT ? ((data.jan.bikes / janT) * 100).toFixed(1) : '0.0';
                    
                    setCard(cards[0], '\ud83d\ude97', 'Total Target', fmtN(janT), totalMoM,
                        'Jan ' + fmtN(decT) + ' \u2192 Feb ' + fmtN(janT),
                        'Total target for ' + cityLabel + '. Jan ' + fmtN(decT) + ' \u2192 Feb ' + fmtN(janT) + ' (' + totalMoM + '% MoM).');
                    setCard(cards[1], '\ud83d\ude99', 'Cars Target', fmtN(data.jan.cars) + ' (' + carsPct + '%)', carsMoM,
                        'Jan ' + fmtN(data.dec.cars) + ' \u2192 Feb ' + fmtN(data.jan.cars),
                        'Cars target for ' + cityLabel + ': ' + fmtN(data.jan.cars) + ' (' + carsPct + '%). Jan ' + fmtN(data.dec.cars) + ' \u2192 Feb (' + carsMoM + '% MoM).');
                    setCard(cards[2], '\ud83c\udfcd\ufe0f', 'Bikes Target', fmtN(data.jan.bikes) + ' (' + bikesPct + '%)', bikesMoM,
                        'Jan ' + fmtN(data.dec.bikes) + ' \u2192 Feb ' + fmtN(data.jan.bikes),
                        'Bikes target for ' + cityLabel + ': ' + fmtN(data.jan.bikes) + ' (' + bikesPct + '%). Jan ' + fmtN(data.dec.bikes) + ' \u2192 Feb (' + bikesMoM + '% MoM).');
                    // Card 4: MoM Change summary
                    const totalChange = janT - decT;
                    const changeSign = totalChange >= 0 ? '+' : '';
                    setCard(cards[3], '\ud83d\udcc9', 'MoM Change', changeSign + fmtN(totalChange), totalMoM,
                        'Cars: ' + fmtN(data.jan.cars - data.dec.cars) + ' | Bikes: ' + fmtN(data.jan.bikes - data.dec.bikes),
                        'MoM change for ' + cityLabel + ': ' + changeSign + fmtN(totalChange) + ' (' + totalMoM + '%). Cars: ' + fmtN(data.jan.cars - data.dec.cars) + ', Bikes: ' + fmtN(data.jan.bikes - data.dec.bikes) + '.');
                    if (note) note.textContent = '\ud83e\udded Vehicle Type: ' + cityLabel + '. Filter by city tier or individual city to compare Cars vs Bikes distribution.';
                }
            }
            
            psRenderSummaryTable();
            psRenderAvgScaleChart();
            psRenderRidersBreakdownChart('psRidersBreakdownChart', { get current() { return psRidersBreakdownChartInstance; }, set current(v) { psRidersBreakdownChartInstance = v; } });
            psRenderAvgScaleOverallChart('psAvgScaleOverallChart', { get current() { return psAvgScaleOverallChartInstance; }, set current(v) { psAvgScaleOverallChartInstance = v; } });
            psRenderRidersBreakdownChart('psCombinedRidersChart', { get current() { return psCombinedRidersChartInstance; }, set current(v) { psCombinedRidersChartInstance = v; } });
            psRenderAvgScaleOverallChart('psCombinedAvgScaleChart', { get current() { return psCombinedAvgScaleChartInstance; }, set current(v) { psCombinedAvgScaleChartInstance = v; } });
            psUpdateBreakdown();

            document.querySelectorAll('.ps-view-toggle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const view = this.getAttribute('data-view');
                    document.querySelectorAll('.ps-view-toggle').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                        b.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                    });
                    this.style.background = '#0ea5e9';
                    this.style.color = 'white';
                    this.style.borderColor = '#0ea5e9';
                    this.style.boxShadow = '0 4px 10px rgba(14,165,233,0.25)';
                    document.getElementById('psSummaryView').style.display = view === 'summary' ? 'block' : 'none';
                    document.getElementById('psBreakdownView').style.display = view === 'breakdown' ? 'block' : 'none';
                    document.getElementById('psTargetBreakdownView').style.display = view === 'target-breakdown' ? 'block' : 'none';
                    document.getElementById('psVehicleTypeView').style.display = view === 'vehicle-type' ? 'block' : 'none';
                    if (view === 'target-breakdown') {
                        renderPsTargetBreakdownChart();
                    }
                    if (view === 'vehicle-type') {
                        initVehicleTypeCharts();
                    }
                    psCurrentView = view;
                    psUpdateSummaryCards(true);
                });
            });

            document.querySelectorAll('.ps-summary-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psSummaryPeriod = this.getAttribute('data-period');
                    document.querySelectorAll('.ps-summary-period-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#0ea5e9';
                    this.style.color = 'white';
                    this.style.borderColor = '#0ea5e9';
                    psRenderAvgScaleChart();
                    psUpdateSummaryCards(true);
                });
            });

            document.querySelectorAll('.ps-summary-perf-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psSummaryPerf = this.getAttribute('data-perf');
                    if (psSummaryPerf !== 'all') {
                        psSummaryScale = 'all';
                        document.querySelectorAll('.ps-summary-scale-btn').forEach(b => {
                            b.style.background = 'white';
                            b.style.color = '#6b7280';
                            b.style.borderColor = '#e5e7eb';
                        });
                        const scaleAll = document.querySelector('.ps-summary-scale-btn[data-scale="all"]');
                        if (scaleAll) {
                            scaleAll.style.background = '#0ea5e9';
                            scaleAll.style.color = 'white';
                            scaleAll.style.borderColor = '#0ea5e9';
                        }
                    }
                    document.querySelectorAll('.ps-summary-perf-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#0ea5e9';
                    this.style.color = 'white';
                    this.style.borderColor = '#0ea5e9';
                    psRenderAvgScaleChart();
                    psUpdateSummaryCards(true);
                });
            });

            document.querySelectorAll('.ps-summary-scale-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psSummaryScale = this.getAttribute('data-scale');
                    if (psSummaryScale !== 'all') {
                        psSummaryPerf = 'all';
                        document.querySelectorAll('.ps-summary-perf-btn').forEach(b => {
                            b.style.background = 'white';
                            b.style.color = '#6b7280';
                            b.style.borderColor = '#e5e7eb';
                        });
                        const perfAll = document.querySelector('.ps-summary-perf-btn[data-perf="all"]');
                        if (perfAll) {
                            perfAll.style.background = '#0ea5e9';
                            perfAll.style.color = 'white';
                            perfAll.style.borderColor = '#0ea5e9';
                        }
                    }
                    document.querySelectorAll('.ps-summary-scale-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#0ea5e9';
                    this.style.color = 'white';
                    this.style.borderColor = '#0ea5e9';
                    psRenderAvgScaleChart();
                    psUpdateSummaryCards(true);
                });
            });

            function psUpdateSummaryView() {
                const ridersView = document.getElementById('psRidersView');
                const avgView = document.getElementById('psAvgScaleView');
                const bothView = document.getElementById('psBothView');
                if (ridersView) ridersView.style.display = psSummaryView === 'riders' ? 'block' : 'none';
                if (avgView) avgView.style.display = psSummaryView === 'avgscale' ? 'block' : 'none';
                if (bothView) bothView.style.display = psSummaryView === 'both' ? 'block' : 'none';
                
                // Re-render charts to trigger animations on view switch
                if (psSummaryView === 'riders') {
                    psRenderRidersBreakdownChart('psRidersBreakdownChart', { get current() { return psRidersBreakdownChartInstance; }, set current(v) { psRidersBreakdownChartInstance = v; } });
                } else if (psSummaryView === 'avgscale') {
                    psRenderAvgScaleOverallChart('psAvgScaleOverallChart', { get current() { return psAvgScaleOverallChartInstance; }, set current(v) { psAvgScaleOverallChartInstance = v; } });
                } else if (psSummaryView === 'both') {
                    psRenderRidersBreakdownChart('psCombinedRidersChart', { get current() { return psCombinedRidersChartInstance; }, set current(v) { psCombinedRidersChartInstance = v; } });
                    psRenderAvgScaleOverallChart('psCombinedAvgScaleChart', { get current() { return psCombinedAvgScaleChartInstance; }, set current(v) { psCombinedAvgScaleChartInstance = v; } });
                }
            }

            document.querySelectorAll('.ps-summary-view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psSummaryView = this.getAttribute('data-view');
                    document.querySelectorAll('.ps-summary-view-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#0ea5e9';
                    this.style.color = 'white';
                    this.style.borderColor = '#0ea5e9';
                    psUpdateSummaryView();
                });
            });

            psUpdateSummaryView();

            document.querySelectorAll('.ps-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psPeriod = this.getAttribute('data-period');
                    document.querySelectorAll('.ps-period-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#3b82f6';
                    this.style.color = 'white';
                    this.style.borderColor = '#3b82f6';
                    psUpdateBreakdown();
                    psUpdateSummaryCards(true);
                });
            });

            document.querySelectorAll('.ps-perf-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psPerf = this.getAttribute('data-perf');
                    if (psPerf !== 'all') {
                        psScale = 'all';
                        document.querySelectorAll('.ps-scale-btn').forEach(b => {
                            b.style.background = 'white';
                            b.style.color = '#6b7280';
                            b.style.borderColor = '#e5e7eb';
                        });
                        document.querySelector('.ps-scale-btn[data-scale="all"]').style.background = '#3b82f6';
                        document.querySelector('.ps-scale-btn[data-scale="all"]').style.color = 'white';
                        document.querySelector('.ps-scale-btn[data-scale="all"]').style.borderColor = '#3b82f6';
                    }
                    document.querySelectorAll('.ps-perf-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#3b82f6';
                    this.style.color = 'white';
                    this.style.borderColor = '#3b82f6';
                    psUpdateBreakdown();
                    psUpdateSummaryCards(true);
                });
            });

            document.querySelectorAll('.ps-scale-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psScale = this.getAttribute('data-scale');
                    if (psScale !== 'all') {
                        psPerf = 'all';
                        document.querySelectorAll('.ps-perf-btn').forEach(b => {
                            b.style.background = 'white';
                            b.style.color = '#6b7280';
                            b.style.borderColor = '#e5e7eb';
                        });
                        document.querySelector('.ps-perf-btn[data-perf="all"]').style.background = '#3b82f6';
                        document.querySelector('.ps-perf-btn[data-perf="all"]').style.color = 'white';
                        document.querySelector('.ps-perf-btn[data-perf="all"]').style.borderColor = '#3b82f6';
                    }
                    document.querySelectorAll('.ps-scale-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#3b82f6';
                    this.style.color = 'white';
                    this.style.borderColor = '#3b82f6';
                    psUpdateBreakdown();
                    psUpdateSummaryCards(true);
                });
            });

            // Performance Target Breakdown Data
            const psTargetBreakdownData = {
                partners: {
                    new: { good: 41, average: 57, bad: 12, total: 110 },
                    old: { good: 211, average: 205, bad: 8, total: 424 },
                    all: { good: 252, average: 262, bad: 20, total: 534 }
                },
                target: {
                    new: { good: 1100, average: 1260, bad: 213, total: 2573 },
                    old: { good: 9092, average: 7154, bad: 157, total: 16403 },
                    all: { good: 10192, average: 8414, bad: 370, total: 18976 }
                }
            };
            
            let psTargetBreakdownChartInstance = null;
            let psTargetViewMode = 'partners';
            let psTargetTypeMode = 'all';
            
            function renderPsTargetBreakdownChart() {
                const canvas = document.getElementById('psTargetBreakdownChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                if (psTargetBreakdownChartInstance) {
                    try { psTargetBreakdownChartInstance.destroy(); } catch(e) {}
                }
                
                const dataSource = psTargetBreakdownData[psTargetViewMode];
                const labels = ['Good', 'Average', 'Bad'];
                const titlePrefix = psTargetViewMode === 'partners' ? 'Partner Count' : 'Target Value';
                
                let datasets = [];
                let title = '';
                
                // Color scheme
                const colors = {
                    new: { line: '#3b82f6', fill: 'rgba(59, 130, 246, 0.15)', point: '#2563eb' },
                    old: { line: '#10b981', fill: 'rgba(16, 185, 129, 0.15)', point: '#059669' },
                    all: { line: '#f59e0b', fill: 'rgba(245, 158, 11, 0.15)', point: '#d97706' }
                };
                
                if (psTargetTypeMode === 'compare') {
                    // New vs Old comparison
                    title = `Performance Target Breakdown - ${titlePrefix} (New vs Old Partners)`;
                    
                    const gradientNew = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradientNew.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
                    gradientNew.addColorStop(0.5, 'rgba(59, 130, 246, 0.2)');
                    gradientNew.addColorStop(1, 'rgba(59, 130, 246, 0.02)');
                    
                    const gradientOld = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradientOld.addColorStop(0, 'rgba(16, 185, 129, 0.4)');
                    gradientOld.addColorStop(0.5, 'rgba(16, 185, 129, 0.2)');
                    gradientOld.addColorStop(1, 'rgba(16, 185, 129, 0.02)');
                    
                    datasets = [{
                        label: 'New Partners (<3M)',
                        data: [dataSource.new.good, dataSource.new.average, dataSource.new.bad],
                        borderColor: colors.new.line,
                        backgroundColor: gradientNew,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: colors.new.point,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 9
                    }, {
                        label: 'Old Partners (≥3M)',
                        data: [dataSource.old.good, dataSource.old.average, dataSource.old.bad],
                        borderColor: colors.old.line,
                        backgroundColor: gradientOld,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: colors.old.point,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 9
                    }];
                } else {
                    // Single type view
                    const typeLabel = psTargetTypeMode === 'all' ? 'All Partners' : (psTargetTypeMode === 'new' ? 'New Partners (<3M)' : 'Old Partners (≥3M)');
                    title = `Performance Target Breakdown - ${titlePrefix} (${typeLabel})`;
                    
                    const colorSet = colors[psTargetTypeMode];
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, colorSet.fill.replace('0.15', '0.4'));
                    gradient.addColorStop(0.5, colorSet.fill.replace('0.15', '0.2'));
                    gradient.addColorStop(1, colorSet.fill.replace('0.15', '0.02'));
                    
                    datasets = [{
                        label: typeLabel,
                        data: [dataSource[psTargetTypeMode].good, dataSource[psTargetTypeMode].average, dataSource[psTargetTypeMode].bad],
                        borderColor: colorSet.line,
                        backgroundColor: gradient,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: colorSet.point,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 9,
                        pointHoverBackgroundColor: colorSet.point,
                        pointHoverBorderColor: '#fff',
                        pointHoverBorderWidth: 3
                    }];
                }
                
                document.getElementById('psTargetBreakdownTitle').textContent = title;
                
                psTargetBreakdownChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: { top: 50, right: 30, left: 10 } },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: { 
                                display: true, 
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 25,
                                    font: { size: 12, weight: '600' }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(31, 41, 55, 0.95)',
                                padding: 14,
                                titleFont: { size: 13, weight: 'bold' },
                                bodyFont: { size: 12 },
                                borderColor: '#f59e0b',
                                borderWidth: 1,
                                displayColors: true,
                                usePointStyle: true,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((sum, v) => sum + v, 0);
                                        const pct = total ? ((context.parsed.y / total) * 100).toFixed(1) : '0.0';
                                        const suffix = psTargetViewMode === 'partners' ? ' partners' : ' riders';
                                        return `  ${context.dataset.label}: ${context.parsed.y.toLocaleString()}${suffix} (${pct}%)`;
                                    }
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                offset: 8,
                                font: { size: 10, weight: 'bold' },
                                color: '#1f2937',
                                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                borderRadius: 4,
                                padding: { top: 2, bottom: 2, left: 5, right: 5 },
                                formatter: (value, context) => {
                                    const total = context.dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return value.toLocaleString() + ' (' + pct + '%)';
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grace: '15%',
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.06)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    callback: (value) => value.toLocaleString(), 
                                    font: { size: 11 },
                                    padding: 8
                                },
                                title: { 
                                    display: true, 
                                    text: psTargetViewMode === 'partners' ? 'Number of Partners' : 'Target Riders', 
                                    font: { size: 12, weight: 'bold' },
                                    padding: { bottom: 10 }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    font: { size: 12, weight: '600' },
                                    padding: 8
                                },
                                title: { 
                                    display: true, 
                                    text: 'Performance Level', 
                                    font: { size: 12, weight: 'bold' },
                                    padding: { top: 10 }
                                }
                            }
                        }
                    }
                });
            }
            
            // Performance Target View toggle (Partner Count / Target Value)
            document.querySelectorAll('.ps-target-view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psTargetViewMode = this.getAttribute('data-view');
                    document.querySelectorAll('.ps-target-view-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#f59e0b';
                    this.style.color = 'white';
                    this.style.borderColor = '#f59e0b';
                    renderPsTargetBreakdownChart();
                    psUpdateSummaryCards(true);
                });
            });
            
            // Performance Target Type toggle (All / New / Old / Compare)
            document.querySelectorAll('.ps-target-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    psTargetTypeMode = this.getAttribute('data-type');
                    document.querySelectorAll('.ps-target-type-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#f59e0b';
                    this.style.color = 'white';
                    this.style.borderColor = '#f59e0b';
                    renderPsTargetBreakdownChart();
                    psUpdateSummaryCards(true);
                });
            });

            // Vehicle Type Breakdown Data by City
            const vehicleCityData = {
                all: { dec: { cars: 17446, bikes: 5007 }, jan: { cars: 14443, bikes: 4922 } },
                Riyadh: { dec: { cars: 8103, bikes: 1925 }, jan: { cars: 6701, bikes: 1960 } },
                Jeddah: { dec: { cars: 2469, bikes: 1625 }, jan: { cars: 1900, bikes: 1554 } },
                Dammam: { dec: { cars: 2205, bikes: 436 }, jan: { cars: 1769, bikes: 358 } },
                Madinah: { dec: { cars: 929, bikes: 266 }, jan: { cars: 841, bikes: 290 } },
                Makkah: { dec: { cars: 738, bikes: 336 }, jan: { cars: 540, bikes: 395 } },
                'Al Ahsa': { dec: { cars: 712, bikes: 146 }, jan: { cars: 695, bikes: 123 } },
                'Al Kharj': { dec: { cars: 380, bikes: 0 }, jan: { cars: 347, bikes: 0 } },
                Abha: { dec: { cars: 316, bikes: 23 }, jan: { cars: 279, bikes: 18 } },
                Taif: { dec: { cars: 277, bikes: 68 }, jan: { cars: 204, bikes: 88 } },
                Buraydah: { dec: { cars: 232, bikes: 64 }, jan: { cars: 218, bikes: 35 } },
                Jubail: { dec: { cars: 224, bikes: 20 }, jan: { cars: 210, bikes: 20 } },
                Tabuk: { dec: { cars: 242, bikes: 10 }, jan: { cars: 186, bikes: 16 } },
                Hail: { dec: { cars: 199, bikes: 0 }, jan: { cars: 186, bikes: 0 } },
                Yanbu: { dec: { cars: 154, bikes: 55 }, jan: { cars: 128, bikes: 43 } },
                'Hafar Al Batin': { dec: { cars: 103, bikes: 25 }, jan: { cars: 97, bikes: 12 } },
                Jazan: { dec: { cars: 85, bikes: 10 }, jan: { cars: 64, bikes: 10 } },
                Najran: { dec: { cars: 76, bikes: 0 }, jan: { cars: 78, bikes: 0 } }
            };
            
            // T1 and T2 city mappings for Vehicle Type
            const vehicleT1Cities = ['Riyadh', 'Jeddah', 'Dammam', 'Madinah', 'Makkah', 'Al Ahsa', 'Al Kharj'];
            const vehicleT2Cities = ['Abha', 'Taif', 'Buraydah', 'Jubail', 'Tabuk', 'Hail', 'Yanbu', 'Hafar Al Batin', 'Jazan', 'Najran'];
            
            // Calculate aggregated data for T1 and T2
            function getVehicleTierData(tier) {
                const cities = tier === 't1' ? vehicleT1Cities : vehicleT2Cities;
                let decCars = 0, decBikes = 0, janCars = 0, janBikes = 0;
                cities.forEach(city => {
                    const d = vehicleCityData[city];
                    if (d) {
                        decCars += d.dec.cars;
                        decBikes += d.dec.bikes;
                        janCars += d.jan.cars;
                        janBikes += d.jan.bikes;
                    }
                });
                return { dec: { cars: decCars, bikes: decBikes }, jan: { cars: janCars, bikes: janBikes } };
            }
            
            let vehicleDonutDecChart = null;
            let vehicleDonutJanChart = null;
            let vehicleTypeChartInstance = null;
            let vehicleT1ChartInstance = null;
            let vehicleT2ChartInstance = null;
            let vehicleViewMode = 'comparison';
            let vehicleSelectedCity = 'all';
            let vehicleCityLevel = 'all';
            
            function initVehicleTypeCharts() {
                let data;
                let cityLabel;
                
                if (vehicleCityLevel === 't1') {
                    // Show city-level breakdown for T1 cities
                    renderVehicleTierCitiesChart('t1', 'T1 Cities (Major)');
                    return;
                } else if (vehicleCityLevel === 't2') {
                    // Show city-level breakdown for T2 cities
                    renderVehicleTierCitiesChart('t2', 'T2 Cities (Emerging)');
                    return;
                } else if (vehicleCityLevel === 't1vst2') {
                    // Handle T1 vs T2 separately
                    updateVehicleT1vsT2View();
                    return;
                } else if (vehicleSelectedCity !== 'all') {
                    data = vehicleCityData[vehicleSelectedCity] || vehicleCityData.all;
                    cityLabel = vehicleSelectedCity;
                } else {
                    data = vehicleCityData.all;
                    cityLabel = 'All Cities';
                }
                
                // Show single chart, hide dual
                document.getElementById('vehicleTypeChart').parentElement.style.display = 'block';
                document.getElementById('vehicleT1vsT2Container').style.display = 'none';
                
                const decTotal = data.dec.cars + data.dec.bikes;
                const janTotal = data.jan.cars + data.jan.bikes;
                const decCarsPct = decTotal ? ((data.dec.cars / decTotal) * 100).toFixed(1) : 0;
                const decBikesPct = decTotal ? ((data.dec.bikes / decTotal) * 100).toFixed(1) : 0;
                const janCarsPct = janTotal ? ((data.jan.cars / janTotal) * 100).toFixed(1) : 0;
                const janBikesPct = janTotal ? ((data.jan.bikes / janTotal) * 100).toFixed(1) : 0;
                
                // Update KPI values
                document.getElementById('vehicleDonutDecTotal').textContent = decTotal.toLocaleString();
                document.getElementById('vehicleDecCars').textContent = data.dec.cars.toLocaleString();
                document.getElementById('vehicleDecBikes').textContent = data.dec.bikes.toLocaleString();
                document.getElementById('vehicleDecCarsPct').textContent = decCarsPct + '%';
                document.getElementById('vehicleDecBikesPct').textContent = decBikesPct + '%';
                
                document.getElementById('vehicleDonutJanTotal').textContent = janTotal.toLocaleString();
                document.getElementById('vehicleJanCars').textContent = data.jan.cars.toLocaleString();
                document.getElementById('vehicleJanBikes').textContent = data.jan.bikes.toLocaleString();
                document.getElementById('vehicleJanCarsPct').textContent = janCarsPct + '%';
                document.getElementById('vehicleJanBikesPct').textContent = janBikesPct + '%';
                
                // Update change values with percentages
                const totalChange = janTotal - decTotal;
                const carsChange = data.jan.cars - data.dec.cars;
                const bikesChange = data.jan.bikes - data.dec.bikes;
                const totalChangePct = decTotal ? ((totalChange / decTotal) * 100).toFixed(1) : 0;
                const carsChangePct = data.dec.cars ? ((carsChange / data.dec.cars) * 100).toFixed(1) : 0;
                const bikesChangePct = data.dec.bikes ? ((bikesChange / data.dec.bikes) * 100).toFixed(1) : 0;
                
                document.getElementById('vehicleTotalChange').textContent = (totalChange >= 0 ? '+' : '') + totalChange.toLocaleString();
                document.getElementById('vehicleTotalChange').style.color = totalChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleTotalChangePct').textContent = (totalChange >= 0 ? '+' : '') + totalChangePct + '%';
                document.getElementById('vehicleCarsChange').textContent = (carsChange >= 0 ? '+' : '') + carsChange.toLocaleString();
                document.getElementById('vehicleCarsChange').style.color = carsChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleCarsChangePct').textContent = (carsChange >= 0 ? '+' : '') + carsChangePct + '%';
                document.getElementById('vehicleCarsChangePct').style.color = carsChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleBikesChange').textContent = (bikesChange >= 0 ? '+' : '') + bikesChange.toLocaleString();
                document.getElementById('vehicleBikesChange').style.color = bikesChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleBikesChangePct').textContent = (bikesChange >= 0 ? '+' : '') + bikesChangePct + '%';
                document.getElementById('vehicleBikesChangePct').style.color = bikesChange >= 0 ? '#10b981' : '#dc2626';
                
                // Render Donut charts
                renderVehicleDonut('vehicleDonutDec', data.dec.cars, data.dec.bikes);
                renderVehicleDonut('vehicleDonutJan', data.jan.cars, data.jan.bikes);
                
                // Render main chart
                renderVehicleTypeChart(data, cityLabel);
            }
            
            function updateVehicleT1vsT2View() {
                const t1Data = getVehicleTierData('t1');
                const t2Data = getVehicleTierData('t2');
                const allData = vehicleCityData.all;
                
                // Hide single chart, show dual
                document.getElementById('vehicleTypeChart').parentElement.style.display = 'none';
                document.getElementById('vehicleT1vsT2Container').style.display = 'flex';
                
                // Update KPIs with combined data
                const decTotal = allData.dec.cars + allData.dec.bikes;
                const janTotal = allData.jan.cars + allData.jan.bikes;
                const decCarsPct = decTotal ? ((allData.dec.cars / decTotal) * 100).toFixed(1) : 0;
                const decBikesPct = decTotal ? ((allData.dec.bikes / decTotal) * 100).toFixed(1) : 0;
                const janCarsPct = janTotal ? ((allData.jan.cars / janTotal) * 100).toFixed(1) : 0;
                const janBikesPct = janTotal ? ((allData.jan.bikes / janTotal) * 100).toFixed(1) : 0;
                
                document.getElementById('vehicleDonutDecTotal').textContent = decTotal.toLocaleString();
                document.getElementById('vehicleDecCars').textContent = allData.dec.cars.toLocaleString();
                document.getElementById('vehicleDecBikes').textContent = allData.dec.bikes.toLocaleString();
                document.getElementById('vehicleDecCarsPct').textContent = decCarsPct + '%';
                document.getElementById('vehicleDecBikesPct').textContent = decBikesPct + '%';
                
                document.getElementById('vehicleDonutJanTotal').textContent = janTotal.toLocaleString();
                document.getElementById('vehicleJanCars').textContent = allData.jan.cars.toLocaleString();
                document.getElementById('vehicleJanBikes').textContent = allData.jan.bikes.toLocaleString();
                document.getElementById('vehicleJanCarsPct').textContent = janCarsPct + '%';
                document.getElementById('vehicleJanBikesPct').textContent = janBikesPct + '%';
                
                // Update change values with percentages
                const totalChange = janTotal - decTotal;
                const carsChange = allData.jan.cars - allData.dec.cars;
                const bikesChange = allData.jan.bikes - allData.dec.bikes;
                const totalChangePct = decTotal ? ((totalChange / decTotal) * 100).toFixed(1) : 0;
                const carsChangePct = allData.dec.cars ? ((carsChange / allData.dec.cars) * 100).toFixed(1) : 0;
                const bikesChangePct = allData.dec.bikes ? ((bikesChange / allData.dec.bikes) * 100).toFixed(1) : 0;
                
                document.getElementById('vehicleTotalChange').textContent = (totalChange >= 0 ? '+' : '') + totalChange.toLocaleString();
                document.getElementById('vehicleTotalChange').style.color = totalChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleTotalChangePct').textContent = (totalChange >= 0 ? '+' : '') + totalChangePct + '%';
                document.getElementById('vehicleCarsChange').textContent = (carsChange >= 0 ? '+' : '') + carsChange.toLocaleString();
                document.getElementById('vehicleCarsChange').style.color = carsChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleCarsChangePct').textContent = (carsChange >= 0 ? '+' : '') + carsChangePct + '%';
                document.getElementById('vehicleCarsChangePct').style.color = carsChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleBikesChange').textContent = (bikesChange >= 0 ? '+' : '') + bikesChange.toLocaleString();
                document.getElementById('vehicleBikesChange').style.color = bikesChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleBikesChangePct').textContent = (bikesChange >= 0 ? '+' : '') + bikesChangePct + '%';
                document.getElementById('vehicleBikesChangePct').style.color = bikesChange >= 0 ? '#10b981' : '#dc2626';
                
                // Render Donut charts
                renderVehicleDonut('vehicleDonutDec', allData.dec.cars, allData.dec.bikes);
                renderVehicleDonut('vehicleDonutJan', allData.jan.cars, allData.jan.bikes);
                
                // Render T1 chart with city breakdown
                renderVehicleTierChart('vehicleT1Chart', 't1');
                // Render T2 chart with city breakdown
                renderVehicleTierChart('vehicleT2Chart', 't2');
            }
            
            function renderVehicleTierChart(canvasId, tier) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                // Destroy existing chart
                if (canvasId === 'vehicleT1Chart' && vehicleT1ChartInstance) {
                    try { vehicleT1ChartInstance.destroy(); } catch(e) {}
                }
                if (canvasId === 'vehicleT2Chart' && vehicleT2ChartInstance) {
                    try { vehicleT2ChartInstance.destroy(); } catch(e) {}
                }
                
                const cities = tier === 't1' ? vehicleT1Cities : vehicleT2Cities;
                
                // Build city data with totals for sorting
                const cityDataArray = cities.map(city => {
                    const d = vehicleCityData[city];
                    return { 
                        city, 
                        decCars: d ? d.dec.cars : 0,
                        decBikes: d ? d.dec.bikes : 0,
                        janCars: d ? d.jan.cars : 0,
                        janBikes: d ? d.jan.bikes : 0,
                        avgTotal: d ? ((d.dec.cars + d.dec.bikes + d.jan.cars + d.jan.bikes) / 2) : 0
                    };
                });
                
                // Sort by average total (highest to lowest)
                cityDataArray.sort((a, b) => b.avgTotal - a.avgTotal);
                
                const sortedCities = cityDataArray.map(c => c.city);
                const cityLabels = sortedCities.map(city => city.length > 8 ? city.substring(0, 6) + '..' : city);
                
                // Calculate totals for trend line
                const decTotals = cityDataArray.map(c => c.decCars + c.decBikes);
                const janTotals = cityDataArray.map(c => c.janCars + c.janBikes);
                
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: cityLabels,
                        datasets: [
                            {
                                label: '🚗 Cars (Jan)',
                                data: cityDataArray.map(c => c.decCars),
                                backgroundColor: 'rgba(59, 130, 246, 0.9)',
                                borderColor: '#2563eb',
                                borderWidth: 1,
                                stack: 'dec',
                                order: 2
                            },
                            {
                                label: '🏍️ Bikes (Jan)',
                                data: cityDataArray.map(c => c.decBikes),
                                backgroundColor: 'rgba(16, 185, 129, 0.9)',
                                borderColor: '#059669',
                                borderWidth: 1,
                                stack: 'dec',
                                order: 2
                            },
                            {
                                label: '🚗 Cars (Feb)',
                                data: cityDataArray.map(c => c.janCars),
                                backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                borderColor: '#3b82f6',
                                borderWidth: 1,
                                stack: 'jan',
                                order: 2
                            },
                            {
                                label: '🏍️ Bikes (Feb)',
                                data: cityDataArray.map(c => c.janBikes),
                                backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                borderColor: '#10b981',
                                borderWidth: 1,
                                stack: 'jan',
                                order: 2
                            },
                            {
                                label: '📈 Jan Total',
                                data: decTotals,
                                type: 'line',
                                borderColor: '#1f2937',
                                backgroundColor: '#1f2937',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointBackgroundColor: '#1f2937',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 1,
                                fill: false,
                                tension: 0.3,
                                order: 1
                            },
                            {
                                label: '📈 Feb Total',
                                data: janTotals,
                                type: 'line',
                                borderColor: '#6b7280',
                                backgroundColor: '#6b7280',
                                borderWidth: 2,
                                borderDash: [4, 4],
                                pointRadius: 4,
                                pointBackgroundColor: '#6b7280',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 1,
                                fill: false,
                                tension: 0.3,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: { top: 35 } },
                        plugins: {
                            legend: { 
                                display: true, 
                                position: 'top', 
                                labels: { font: { size: 8 }, boxWidth: 10, padding: 6 } 
                            },
                            tooltip: { 
                                backgroundColor: 'rgba(31, 41, 55, 0.95)', 
                                padding: 12,
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    title: (items) => sortedCities[items[0].dataIndex],
                                    afterTitle: (items) => {
                                        const idx = items[0].dataIndex;
                                        const city = cityDataArray[idx];
                                        return `Jan Total: ${(city.decCars + city.decBikes).toLocaleString()} | Feb Total: ${(city.janCars + city.janBikes).toLocaleString()}`;
                                    },
                                    label: (context) => {
                                        const label = context.dataset.label || '';
                                        return `${label}: ${context.raw.toLocaleString()}`;
                                    }
                                }
                            },
                            datalabels: {
                                display: (context) => context.datasetIndex <= 3,
                                anchor: 'center',
                                align: 'center',
                                font: { size: 6, weight: 'bold' },
                                color: '#111827',
                                textStrokeColor: 'rgba(255,255,255,0.8)',
                                textStrokeWidth: 2,
                                formatter: (value, context) => {
                                    const idx = context.dataIndex;
                                    const city = cityDataArray[idx];
                                    const total = context.datasetIndex < 2 ? 
                                        (city.decCars + city.decBikes) : (city.janCars + city.janBikes);
                                    const pct = total ? ((value / total) * 100).toFixed(0) : '0';
                                    return (value >= 1000 ? (value/1000).toFixed(1) + 'k' : value) + '\n(' + pct + '%)';
                                }
                            }
                        },
                        scales: {
                            x: {
                                stacked: true,
                                ticks: { font: { size: 8 }, maxRotation: 45, minRotation: 0 }
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                grace: '15%',
                                ticks: { 
                                    callback: (value) => value >= 1000 ? (value/1000) + 'k' : value,
                                    font: { size: 9 }
                                },
                                title: { display: true, text: 'Target Riders', font: { weight: 'bold', size: 9 } }
                            }
                        }
                    },
                    plugins: [{
                        id: 'trendLabels',
                        afterDatasetsDraw: function(chart) {
                            const ctx = chart.ctx;
                            const meta4 = chart.getDatasetMeta(4);
                            const meta5 = chart.getDatasetMeta(5);
                            
                            ctx.save();
                            ctx.font = 'bold 8px Arial';
                            ctx.textAlign = 'center';
                            
                            // Only draw Jan trend labels if dataset is visible
                            if (!meta4.hidden) {
                                meta4.data.forEach((point, i) => {
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText(decTotals[i] >= 1000 ? (decTotals[i]/1000).toFixed(1) + 'k' : decTotals[i], point.x - 8, point.y - 6);
                                });
                            }
                            
                            // Only draw Feb trend labels if dataset is visible
                            if (!meta5.hidden) {
                                meta5.data.forEach((point, i) => {
                                    ctx.fillStyle = '#6b7280';
                                    ctx.fillText(janTotals[i] >= 1000 ? (janTotals[i]/1000).toFixed(1) + 'k' : janTotals[i], point.x + 8, point.y - 6);
                                });
                            }
                            
                            ctx.restore();
                        }
                    }]
                });
                
                if (canvasId === 'vehicleT1Chart') vehicleT1ChartInstance = chart;
                if (canvasId === 'vehicleT2Chart') vehicleT2ChartInstance = chart;
            }
            
            function renderVehicleDonut(canvasId, cars, bikes) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                // Destroy existing chart
                if (canvasId === 'vehicleDonutDec' && vehicleDonutDecChart) {
                    try { vehicleDonutDecChart.destroy(); } catch(e) {}
                }
                if (canvasId === 'vehicleDonutJan' && vehicleDonutJanChart) {
                    try { vehicleDonutJanChart.destroy(); } catch(e) {}
                }
                
                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Cars', 'Bikes'],
                        datasets: [{
                            data: [cars, bikes],
                            backgroundColor: ['#3b82f6', '#10b981'],
                            borderColor: ['#2563eb', '#059669'],
                            borderWidth: 2,
                            hoverOffset: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        cutout: '70%',
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(31, 41, 55, 0.95)',
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const pct = total ? ((context.raw / total) * 100).toFixed(1) : 0;
                                        return `${context.label}: ${context.raw.toLocaleString()} (${pct}%)`;
                                    }
                                }
                            },
                            datalabels: { display: false }
                        }
                    }
                });
                
                if (canvasId === 'vehicleDonutDec') vehicleDonutDecChart = chart;
                if (canvasId === 'vehicleDonutJan') vehicleDonutJanChart = chart;
            }
            
            function renderVehicleTierCitiesChart(tier, tierLabel) {
                const cities = tier === 't1' ? vehicleT1Cities : vehicleT2Cities;
                const tierData = getVehicleTierData(tier);
                
                // Show single chart, hide dual
                document.getElementById('vehicleTypeChart').parentElement.style.display = 'block';
                document.getElementById('vehicleT1vsT2Container').style.display = 'none';
                
                // Update KPIs with tier totals
                const decTotal = tierData.dec.cars + tierData.dec.bikes;
                const janTotal = tierData.jan.cars + tierData.jan.bikes;
                const decCarsPct = decTotal ? ((tierData.dec.cars / decTotal) * 100).toFixed(1) : 0;
                const decBikesPct = decTotal ? ((tierData.dec.bikes / decTotal) * 100).toFixed(1) : 0;
                const janCarsPct = janTotal ? ((tierData.jan.cars / janTotal) * 100).toFixed(1) : 0;
                const janBikesPct = janTotal ? ((tierData.jan.bikes / janTotal) * 100).toFixed(1) : 0;
                
                document.getElementById('vehicleDonutDecTotal').textContent = decTotal.toLocaleString();
                document.getElementById('vehicleDecCars').textContent = tierData.dec.cars.toLocaleString();
                document.getElementById('vehicleDecBikes').textContent = tierData.dec.bikes.toLocaleString();
                document.getElementById('vehicleDecCarsPct').textContent = decCarsPct + '%';
                document.getElementById('vehicleDecBikesPct').textContent = decBikesPct + '%';
                
                document.getElementById('vehicleDonutJanTotal').textContent = janTotal.toLocaleString();
                document.getElementById('vehicleJanCars').textContent = tierData.jan.cars.toLocaleString();
                document.getElementById('vehicleJanBikes').textContent = tierData.jan.bikes.toLocaleString();
                document.getElementById('vehicleJanCarsPct').textContent = janCarsPct + '%';
                document.getElementById('vehicleJanBikesPct').textContent = janBikesPct + '%';
                
                // Update change values
                const totalChange = janTotal - decTotal;
                const carsChange = tierData.jan.cars - tierData.dec.cars;
                const bikesChange = tierData.jan.bikes - tierData.dec.bikes;
                const totalChangePct = decTotal ? ((totalChange / decTotal) * 100).toFixed(1) : 0;
                const carsChangePct = tierData.dec.cars ? ((carsChange / tierData.dec.cars) * 100).toFixed(1) : 0;
                const bikesChangePct = tierData.dec.bikes ? ((bikesChange / tierData.dec.bikes) * 100).toFixed(1) : 0;
                
                document.getElementById('vehicleTotalChange').textContent = (totalChange >= 0 ? '+' : '') + totalChange.toLocaleString();
                document.getElementById('vehicleTotalChange').style.color = totalChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleTotalChangePct').textContent = (totalChange >= 0 ? '+' : '') + totalChangePct + '%';
                document.getElementById('vehicleCarsChange').textContent = (carsChange >= 0 ? '+' : '') + carsChange.toLocaleString();
                document.getElementById('vehicleCarsChange').style.color = carsChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleCarsChangePct').textContent = (carsChange >= 0 ? '+' : '') + carsChangePct + '%';
                document.getElementById('vehicleCarsChangePct').style.color = carsChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleBikesChange').textContent = (bikesChange >= 0 ? '+' : '') + bikesChange.toLocaleString();
                document.getElementById('vehicleBikesChange').style.color = bikesChange >= 0 ? '#10b981' : '#dc2626';
                document.getElementById('vehicleBikesChangePct').textContent = (bikesChange >= 0 ? '+' : '') + bikesChangePct + '%';
                document.getElementById('vehicleBikesChangePct').style.color = bikesChange >= 0 ? '#10b981' : '#dc2626';
                
                // Render Donut charts
                renderVehicleDonut('vehicleDonutDec', tierData.dec.cars, tierData.dec.bikes);
                renderVehicleDonut('vehicleDonutJan', tierData.jan.cars, tierData.jan.bikes);
                
                // Build city-level data with sorting (highest to lowest)
                const cityDataArray = cities.map(city => {
                    const d = vehicleCityData[city];
                    return { 
                        city, 
                        decCars: d ? d.dec.cars : 0,
                        decBikes: d ? d.dec.bikes : 0,
                        janCars: d ? d.jan.cars : 0,
                        janBikes: d ? d.jan.bikes : 0,
                        avgTotal: d ? ((d.dec.cars + d.dec.bikes + d.jan.cars + d.jan.bikes) / 2) : 0
                    };
                });
                
                // Sort by average total (highest to lowest)
                cityDataArray.sort((a, b) => b.avgTotal - a.avgTotal);
                
                const sortedCities = cityDataArray.map(c => c.city);
                const cityLabels = sortedCities.map(city => city.length > 10 ? city.substring(0, 8) + '..' : city);
                
                // Destroy existing chart
                if (vehicleTypeChartInstance) {
                    try { vehicleTypeChartInstance.destroy(); } catch(e) {}
                    vehicleTypeChartInstance = null;
                }
                
                const canvas = document.getElementById('vehicleTypeChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                if (vehicleViewMode === 'comparison') {
                    // Stacked bar chart showing Cars and Bikes for each city with trend line
                    document.getElementById('vehicleChartTitle').textContent = `City & Vehicle Breakdown - ${tierLabel}`;
                    
                    // Calculate totals for trend line
                    const decTotals = cityDataArray.map(c => c.decCars + c.decBikes);
                    const janTotals = cityDataArray.map(c => c.janCars + c.janBikes);
                    
                    vehicleTypeChartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: cityLabels,
                            datasets: [
                                {
                                    label: '🚗 Cars (Jan)',
                                    data: cityDataArray.map(c => c.decCars),
                                    backgroundColor: 'rgba(59, 130, 246, 0.9)',
                                    borderColor: '#2563eb',
                                    borderWidth: 1,
                                    stack: 'dec',
                                    order: 2
                                },
                                {
                                    label: '🏍️ Bikes (Jan)',
                                    data: cityDataArray.map(c => c.decBikes),
                                    backgroundColor: 'rgba(16, 185, 129, 0.9)',
                                    borderColor: '#059669',
                                    borderWidth: 1,
                                    stack: 'dec',
                                    order: 2
                                },
                                {
                                    label: '🚗 Cars (Feb)',
                                    data: cityDataArray.map(c => c.janCars),
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    borderColor: '#3b82f6',
                                    borderWidth: 1,
                                    stack: 'jan',
                                    order: 2
                                },
                                {
                                    label: '🏍️ Bikes (Feb)',
                                    data: cityDataArray.map(c => c.janBikes),
                                    backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                    borderColor: '#10b981',
                                    borderWidth: 1,
                                    stack: 'jan',
                                    order: 2
                                },
                                {
                                    label: '📈 Jan Trend',
                                    data: decTotals,
                                    type: 'line',
                                    borderColor: '#1f2937',
                                    backgroundColor: '#1f2937',
                                    borderWidth: 2,
                                    pointRadius: 5,
                                    pointBackgroundColor: '#1f2937',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                    fill: false,
                                    tension: 0.3,
                                    order: 1
                                },
                                {
                                    label: '📈 Feb Trend',
                                    data: janTotals,
                                    type: 'line',
                                    borderColor: '#6b7280',
                                    backgroundColor: '#6b7280',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    pointRadius: 5,
                                    pointBackgroundColor: '#6b7280',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                    fill: false,
                                    tension: 0.3,
                                    order: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            layout: { padding: { top: 40 } },
                            plugins: {
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: { font: { size: 9 }, boxWidth: 12, padding: 8 }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(31, 41, 55, 0.95)',
                                    padding: 12,
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        title: (items) => sortedCities[items[0].dataIndex],
                                        afterTitle: (items) => {
                                            const idx = items[0].dataIndex;
                                            const city = cityDataArray[idx];
                                            return `Jan Total: ${(city.decCars + city.decBikes).toLocaleString()} | Feb Total: ${(city.janCars + city.janBikes).toLocaleString()}`;
                                        },
                                        label: (context) => {
                                            const label = context.dataset.label || '';
                                            return `${label}: ${context.raw.toLocaleString()}`;
                                        }
                                    }
                                },
                                datalabels: {
                                    display: (context) => context.datasetIndex <= 3,
                                    anchor: 'center',
                                    align: 'center',
                                    font: { size: 7, weight: 'bold' },
                                    color: '#111827',
                                    textStrokeColor: 'rgba(255,255,255,0.8)',
                                    textStrokeWidth: 2,
                                    formatter: (value, context) => {
                                        const idx = context.dataIndex;
                                        const city = cityDataArray[idx];
                                        const total = context.datasetIndex < 2 ? 
                                            (city.decCars + city.decBikes) : (city.janCars + city.janBikes);
                                        const pct = total ? ((value / total) * 100).toFixed(0) : '0';
                                        return value.toLocaleString() + '\n(' + pct + '%)';
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    stacked: true,
                                    ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 0 }
                                },
                                y: {
                                    stacked: true,
                                    beginAtZero: true,
                                    grace: '15%',
                                    ticks: { callback: (value) => value.toLocaleString() },
                                    title: { display: true, text: 'Target Riders', font: { weight: 'bold' } }
                                }
                            }
                        },
                        plugins: [{
                            id: 'trendLabels',
                            afterDatasetsDraw: function(chart) {
                                const ctx = chart.ctx;
                                const meta4 = chart.getDatasetMeta(4); // Jan trend
                                const meta5 = chart.getDatasetMeta(5); // Feb trend
                                
                                ctx.save();
                                ctx.font = 'bold 9px Arial';
                                ctx.textAlign = 'center';
                                
                                // Draw Jan trend labels only if dataset is visible
                                if (!meta4.hidden) {
                                    meta4.data.forEach((point, i) => {
                                        const total = decTotals[i];
                                        ctx.fillStyle = '#1f2937';
                                        ctx.fillText(total.toLocaleString(), point.x, point.y - 8);
                                    });
                                }
                                
                                // Draw Feb trend labels only if dataset is visible
                                if (!meta5.hidden) {
                                    meta5.data.forEach((point, i) => {
                                        const total = janTotals[i];
                                        ctx.fillStyle = '#6b7280';
                                        ctx.fillText(total.toLocaleString(), point.x + 15, point.y - 8);
                                    });
                                }
                                
                                ctx.restore();
                            }
                        }]
                    });
                } else {
                    // Trend line chart showing total Cars and Bikes for the tier
                    document.getElementById('vehicleChartTitle').textContent = `Vehicle Type Trends - ${tierLabel}`;
                    
                    // Calculate tier totals
                    const totalDecCars = cityDataArray.reduce((sum, c) => sum + c.decCars, 0);
                    const totalDecBikes = cityDataArray.reduce((sum, c) => sum + c.decBikes, 0);
                    const totalJanCars = cityDataArray.reduce((sum, c) => sum + c.janCars, 0);
                    const totalJanBikes = cityDataArray.reduce((sum, c) => sum + c.janBikes, 0);
                    
                    // Intermediate points for curved lines
                    const carsMid1 = Math.round(totalDecCars * 0.85 + totalJanCars * 0.15);
                    const carsMid2 = Math.round(totalDecCars * 0.5 + totalJanCars * 0.5);
                    const carsMid3 = Math.round(totalDecCars * 0.15 + totalJanCars * 0.85);
                    const bikesMid1 = Math.round(totalDecBikes * 0.85 + totalJanBikes * 0.15);
                    const bikesMid2 = Math.round(totalDecBikes * 0.5 + totalJanBikes * 0.5);
                    const bikesMid3 = Math.round(totalDecBikes * 0.15 + totalJanBikes * 0.85);
                    
                    const gradientCars = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradientCars.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
                    gradientCars.addColorStop(1, 'rgba(59, 130, 246, 0.02)');
                    
                    const gradientBikes = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradientBikes.addColorStop(0, 'rgba(16, 185, 129, 0.4)');
                    gradientBikes.addColorStop(1, 'rgba(16, 185, 129, 0.02)');
                    
                    vehicleTypeChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Jan 2026', '', 'Mid', '', 'Feb 2026'],
                            datasets: [{
                                label: '🚗 Cars',
                                data: [totalDecCars, carsMid1, carsMid2, carsMid3, totalJanCars],
                                borderColor: '#3b82f6',
                                backgroundColor: gradientCars,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: ['#2563eb', 'transparent', 'transparent', 'transparent', '#2563eb'],
                                pointBorderColor: ['#fff', 'transparent', 'transparent', 'transparent', '#fff'],
                                pointBorderWidth: [2, 0, 0, 0, 2],
                                pointRadius: [8, 0, 0, 0, 8],
                                pointHoverRadius: [12, 0, 0, 0, 12]
                            }, {
                                label: '🏍️ Bikes',
                                data: [totalDecBikes, bikesMid1, bikesMid2, bikesMid3, totalJanBikes],
                                borderColor: '#10b981',
                                backgroundColor: gradientBikes,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: ['#059669', 'transparent', 'transparent', 'transparent', '#059669'],
                                pointBorderColor: ['#fff', 'transparent', 'transparent', 'transparent', '#fff'],
                                pointBorderWidth: [2, 0, 0, 0, 2],
                                pointRadius: [8, 0, 0, 0, 8],
                                pointHoverRadius: [12, 0, 0, 0, 12]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            layout: { padding: { top: 40, right: 20 } },
                            plugins: {
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: { font: { size: 12, weight: 'bold' }, boxWidth: 16, padding: 15 }
                                },
                                tooltip: { 
                                    backgroundColor: 'rgba(31, 41, 55, 0.95)', 
                                    padding: 12,
                                    filter: (item) => item.dataIndex === 0 || item.dataIndex === 4
                                },
                                datalabels: {
                                    display: (context) => context.dataIndex === 0 || context.dataIndex === 4,
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 6,
                                    font: { size: 11, weight: 'bold' },
                                    color: (context) => context.dataset.borderColor,
                                    formatter: (value, context) => {
                                        const ds = context.dataset.data;
                                        const total = ds[0] + ds[4];
                                        const pct = total ? ((value / (ds[0] + context.chart.data.datasets[1].data[context.dataIndex === 0 ? 0 : 4])) * 100).toFixed(1) : '0';
                                        return value.toLocaleString();
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grace: '15%',
                                    ticks: { callback: (value) => value.toLocaleString() },
                                    title: { display: true, text: 'Target Riders', font: { weight: 'bold' } }
                                }
                            }
                        }
                    });
                }
            }
            
            function renderVehicleTypeChart(data, cityLabel) {
                const canvas = document.getElementById('vehicleTypeChart');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                if (vehicleTypeChartInstance) {
                    try { vehicleTypeChartInstance.destroy(); } catch(e) {}
                }
                
                if (!data) {
                    data = vehicleCityData[vehicleSelectedCity] || vehicleCityData.all;
                }
                if (!cityLabel) {
                    cityLabel = vehicleSelectedCity === 'all' ? 'All Cities' : vehicleSelectedCity;
                }
                
                const decTotal = data.dec.cars + data.dec.bikes;
                const janTotal = data.jan.cars + data.jan.bikes;
                
                if (vehicleViewMode === 'comparison') {
                    // Bar chart comparing Dec vs Jan for Cars and Bikes
                    document.getElementById('vehicleChartTitle').textContent = `Vehicle Type Target Comparison - ${cityLabel}`;
                    
                    vehicleTypeChartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['🚗 Cars', '🏍️ Bikes', '📊 Total'],
                            datasets: [{
                                label: 'Jan 2026',
                                data: [data.dec.cars, data.dec.bikes, decTotal],
                                backgroundColor: ['rgba(59, 130, 246, 0.8)', 'rgba(16, 185, 129, 0.8)', 'rgba(139, 92, 246, 0.8)'],
                                borderColor: ['#3b82f6', '#10b981', '#8b5cf6'],
                                borderWidth: 2
                            }, {
                                label: 'Feb 2026',
                                data: [data.jan.cars, data.jan.bikes, janTotal],
                                backgroundColor: ['rgba(59, 130, 246, 0.5)', 'rgba(16, 185, 129, 0.5)', 'rgba(139, 92, 246, 0.5)'],
                                borderColor: ['#3b82f6', '#10b981', '#8b5cf6'],
                                borderWidth: 2,
                                borderDash: [5, 5]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            layout: { padding: { top: 35 } },
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: {
                                    backgroundColor: 'rgba(31, 41, 55, 0.95)',
                                    padding: 12
                                },
                                datalabels: {
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 4,
                                    font: { size: 10, weight: 'bold' },
                                    color: '#1f2937',
                                    formatter: (value, context) => {
                                        const ds = context.dataset;
                                        const total = ds.data[2];
                                        const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                        return value.toLocaleString() + ' (' + pct + '%)';
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grace: '10%',
                                    ticks: { callback: (value) => value.toLocaleString() },
                                    title: { display: true, text: 'Target Riders', font: { weight: 'bold' } }
                                }
                            }
                        }
                    });
                } else {
                    // Trend line chart
                    document.getElementById('vehicleChartTitle').textContent = `Vehicle Type Target Trend - ${cityLabel}`;
                    
                    const gradientCars = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradientCars.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
                    gradientCars.addColorStop(1, 'rgba(59, 130, 246, 0.02)');
                    
                    const gradientBikes = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradientBikes.addColorStop(0, 'rgba(16, 185, 129, 0.4)');
                    gradientBikes.addColorStop(1, 'rgba(16, 185, 129, 0.02)');
                    
                    // Create intermediate points for curved line effect
                    const carsMid1 = Math.round(data.dec.cars * 0.85 + data.jan.cars * 0.15);
                    const carsMid2 = Math.round(data.dec.cars * 0.5 + data.jan.cars * 0.5);
                    const carsMid3 = Math.round(data.dec.cars * 0.15 + data.jan.cars * 0.85);
                    const bikesMid1 = Math.round(data.dec.bikes * 0.85 + data.jan.bikes * 0.15);
                    const bikesMid2 = Math.round(data.dec.bikes * 0.5 + data.jan.bikes * 0.5);
                    const bikesMid3 = Math.round(data.dec.bikes * 0.15 + data.jan.bikes * 0.85);
                    
                    vehicleTypeChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Jan 2026', '', 'Mid', '', 'Feb 2026'],
                            datasets: [{
                                label: '🚗 Cars',
                                data: [data.dec.cars, carsMid1, carsMid2, carsMid3, data.jan.cars],
                                borderColor: '#3b82f6',
                                backgroundColor: gradientCars,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: ['#2563eb', 'transparent', 'transparent', 'transparent', '#2563eb'],
                                pointBorderColor: ['#fff', 'transparent', 'transparent', 'transparent', '#fff'],
                                pointBorderWidth: [2, 0, 0, 0, 2],
                                pointRadius: [8, 0, 0, 0, 8],
                                pointHoverRadius: [12, 0, 0, 0, 12]
                            }, {
                                label: '🏍️ Bikes',
                                data: [data.dec.bikes, bikesMid1, bikesMid2, bikesMid3, data.jan.bikes],
                                borderColor: '#10b981',
                                backgroundColor: gradientBikes,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: ['#059669', 'transparent', 'transparent', 'transparent', '#059669'],
                                pointBorderColor: ['#fff', 'transparent', 'transparent', 'transparent', '#fff'],
                                pointBorderWidth: [2, 0, 0, 0, 2],
                                pointRadius: [8, 0, 0, 0, 8],
                                pointHoverRadius: [12, 0, 0, 0, 12]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            layout: { padding: { top: 50 } },
                            interaction: { intersect: false, mode: 'index' },
                            plugins: {
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: { usePointStyle: true, padding: 25 }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(31, 41, 55, 0.95)',
                                    padding: 14,
                                    borderWidth: 1,
                                    filter: function(tooltipItem) {
                                        return tooltipItem.dataIndex === 0 || tooltipItem.dataIndex === 4;
                                    }
                                },
                                datalabels: {
                                    display: function(context) {
                                        return context.dataIndex === 0 || context.dataIndex === 4;
                                    },
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 8,
                                    font: { size: 11, weight: 'bold' },
                                    color: '#1f2937',
                                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                    borderRadius: 4,
                                    padding: { top: 4, bottom: 4, left: 8, right: 8 },
                                    formatter: (value, context) => {
                                        const ds = context.dataset;
                                        const total = ds.data[0] + ds.data[4];
                                        const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                        return value.toLocaleString() + ' (' + pct + '%)';
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grace: '15%',
                                    grid: { color: 'rgba(0, 0, 0, 0.06)' },
                                    ticks: { callback: (value) => value.toLocaleString() },
                                    title: { display: true, text: 'Target Riders', font: { weight: 'bold' } }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: { 
                                        font: { size: 13, weight: '600' },
                                        callback: function(value, index) {
                                            if (index === 0) return 'Jan 2026';
                                            if (index === 4) return 'Feb 2026';
                                            return '';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            // City Level filter handler
            document.querySelectorAll('.vehicle-city-level-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    vehicleCityLevel = this.getAttribute('data-level');
                    vehicleSelectedCity = 'all';
                    
                    // Reset city level button styles
                    document.querySelectorAll('.vehicle-city-level-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#10b981';
                    this.style.color = 'white';
                    this.style.borderColor = '#10b981';
                    
                    // Reset individual city button styles
                    document.querySelectorAll('.vehicle-city-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    
                    initVehicleTypeCharts();
                    psUpdateSummaryCards(true);
                });
            });
            
            // Individual City filter handler
            document.querySelectorAll('.vehicle-city-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    vehicleSelectedCity = this.getAttribute('data-city');
                    vehicleCityLevel = 'single';
                    
                    // Reset city level button styles
                    document.querySelectorAll('.vehicle-city-level-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    
                    // Reset individual city button styles and highlight current
                    document.querySelectorAll('.vehicle-city-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#3b82f6';
                    this.style.color = 'white';
                    this.style.borderColor = '#3b82f6';
                    
                    initVehicleTypeCharts();
                    psUpdateSummaryCards(true);
                });
            });
            
            // View toggle handler
            document.querySelectorAll('.vehicle-view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    vehicleViewMode = this.getAttribute('data-view');
                    document.querySelectorAll('.vehicle-view-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#10b981';
                    this.style.color = 'white';
                    this.style.borderColor = '#10b981';
                    initVehicleTypeCharts();
                    psUpdateSummaryCards(true);
                });
            });

            // Performance Chart - REMOVED (chart element deleted)
            // const perfJan = [12349, 8330, 1534, 240];
            // const perfFeb = [10192, 8414, 370, 389];
            // const perfMomPlugin = createBarMomLabelPlugin(perfJan, perfFeb, 9);
            // new Chart(document.getElementById('performanceChart').getContext('2d'), {...});

            // Manual vs Automated Target Adjustment (Good/Average/Bad)
            const manualLabels = ['Good', 'Average', 'Bad', 'Total'];
            const janRule = [10664, 8434, 144, 19242];
            const afterManual = [10192, 8414, 370, 18976];
            const manualDelta = [-472, -20, 226, -266];
            const manualIncDec = [-4, 0, 157, -1];
            const manualVariance = afterManual.map((v, i) => v - janRule[i]);
            const isCompactOverview = window.innerWidth <= 1200;
            const isMobileOverview = window.innerWidth <= 768;
            const ovTickFont = isMobileOverview ? 9 : (isCompactOverview ? 10 : 11);
            const ovLabelFont = isMobileOverview ? 9 : (isCompactOverview ? 10 : 11);
            const ovLegendFont = isMobileOverview ? 10 : 12;
            const ovTooltipFont = isMobileOverview ? 11 : 12;

            const changeLabels = ['Partners with Increases', 'Partners with Same Target', 'Partners with Decreases'];
            const changeCounts = [153, 114, 284];
            const totalPartnersWithTarget = 551;
            const increasePct = ((changeCounts[0] / totalPartnersWithTarget) * 100).toFixed(1);
            const samePct = ((changeCounts[1] / totalPartnersWithTarget) * 100).toFixed(1);
            const decreasePct = ((changeCounts[2] / totalPartnersWithTarget) * 100).toFixed(1);

            document.getElementById('overviewInsightNet').textContent = `${manualDelta[3] > 0 ? '+' : ''}${manualDelta[3].toLocaleString()} riders`;
            document.getElementById('overviewInsightNetSub').textContent = `${manualIncDec[3] > 0 ? '+' : ''}${manualIncDec[3]}% vs rule target total`;
            document.getElementById('overviewInsightInc').textContent = `${changeCounts[0].toLocaleString()} (${increasePct}%)`;
            document.getElementById('overviewInsightIncSub').textContent = `of ${totalPartnersWithTarget.toLocaleString()} partners with target`;
            document.getElementById('overviewInsightDec').textContent = `${changeCounts[2].toLocaleString()} (${decreasePct}%)`;
            document.getElementById('overviewInsightDecSub').textContent = `${changeCounts[2] - changeCounts[0] >= 0 ? '+' : ''}${changeCounts[2] - changeCounts[0]} more than increases`;
            document.getElementById('overviewInsightShift').textContent = `Bad: +${manualDelta[2].toLocaleString()}`;
            document.getElementById('overviewInsightShiftSub').textContent = `${manualIncDec[2] > 0 ? '+' : ''}${manualIncDec[2]}% while Good fell ${Math.abs(manualIncDec[0])}%`;

            // Changes Chart (enhanced)
            new Chart(document.getElementById('changesChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: changeLabels,
                    datasets: [{
                        label: 'Active Partner Count',
                        data: changeCounts,
                        backgroundColor: ['#10b981', '#60a5fa', '#ef4444'],
                        borderColor: ['#059669', '#3b82f6', '#dc2626'],
                        borderWidth: 1.2,
                        borderRadius: 6,
                        barPercentage: 0.72,
                        categoryPercentage: 0.76
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    layout: {
                        padding: { top: isMobileOverview ? 14 : 26 }
                    },
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'center',
                            labels: {
                                font: { size: isMobileOverview ? 9 : (ovLegendFont - 1) },
                                boxWidth: isMobileOverview ? 12 : 16,
                                padding: isMobileOverview ? 8 : 10
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            titleFont: { size: ovTooltipFont, weight: 'bold' },
                            bodyFont: { size: ovTooltipFont },
                            callbacks: {
                                label: (context) => {
                                    const value = context.parsed.y;
                                    const pct = totalPartnersWithTarget ? ((value / totalPartnersWithTarget) * 100).toFixed(1) : '0.0';
                                    return `${context.label}: ${value.toLocaleString()} partners (${pct}%)`;
                                },
                                afterBody: () => [`Total partners with target: ${totalPartnersWithTarget.toLocaleString()}`, `Net skew to decreases: +${(changeCounts[2] - changeCounts[0]).toLocaleString()}`]
                            }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            offset: 2,
                            color: '#1f2937',
                            font: { size: ovLabelFont, weight: '700' },
                            formatter: (value) => {
                                const pct = totalPartnersWithTarget ? ((value / totalPartnersWithTarget) * 100).toFixed(1) : '0.0';
                                return `${value.toLocaleString()}\n(${pct}%)`;
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: (value) => value.toLocaleString(), font: { size: ovTickFont } },
                            title: { display: true, text: 'Partner Count', font: { size: isMobileOverview ? 10 : 12, weight: 'bold' } },
                            grid: { color: 'rgba(107,114,128,0.16)' }
                        },
                        x: {
                            ticks: { font: { size: ovTickFont, weight: '600' } },
                            grid: { display: false }
                        }
                    }
                }
            });

            new Chart(document.getElementById('manualAdjustChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: manualLabels,
                    datasets: [{
                        label: 'Feb target (our rule)',
                        data: janRule,
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1.5
                    }, {
                        label: 'Feb target (after manual adjustment)',
                        data: afterManual,
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 1.5
                    }, {
                        type: 'line',
                        label: 'Manual variance (After - Rule)',
                        data: manualVariance,
                        yAxisID: 'y1',
                        borderColor: '#f59e0b',
                        backgroundColor: '#f59e0b',
                        borderWidth: 2,
                        tension: 0.25,
                        pointRadius: 4,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    layout: {
                        padding: { top: isMobileOverview ? 14 : 26 }
                    },
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'center',
                            labels: {
                                font: { size: isMobileOverview ? 9 : (ovLegendFont - 1) },
                                boxWidth: isMobileOverview ? 12 : 16,
                                padding: isMobileOverview ? 8 : 10
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            titleFont: { size: ovTooltipFont, weight: 'bold' },
                            bodyFont: { size: ovTooltipFont },
                            callbacks: {
                                label: function(context) {
                                    const idx = context.dataIndex;
                                    if (context.datasetIndex === 0) {
                                        return `Feb target (our rule): ${janRule[idx].toLocaleString()}`;
                                    }
                                    if (context.datasetIndex === 1) {
                                        const inc = manualIncDec[idx];
                                        const signInc = inc > 0 ? '+' : '';
                                        return `After manual: ${afterManual[idx].toLocaleString()} (${signInc}${inc}%)`;
                                    }
                                    if (context.datasetIndex === 2) {
                                        const sign = manualVariance[idx] > 0 ? '+' : '';
                                        return `Manual variance line: ${sign}${manualVariance[idx].toLocaleString()} riders`;
                                    }
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            anchor: 'end',
                            align: function(context) {
                                return context.datasetIndex === 2 ? 'top' : 'end';
                            },
                            offset: 4,
                            color: function(context) {
                                if (context.datasetIndex === 2) {
                                    const delta = manualVariance[context.dataIndex];
                                    return delta > 0 ? '#16a34a' : (delta < 0 ? '#dc2626' : '#6b7280');
                                }
                                if (context.datasetIndex === 1) {
                                    const inc = manualIncDec[context.dataIndex];
                                    if (inc > 0) return '#16a34a';
                                    if (inc < 0) return '#dc2626';
                                    return '#6b7280';
                                }
                                return '#111827';
                            },
                            font: function(context) {
                                if (context.datasetIndex === 2) {
                                    return { size: ovLabelFont - 1, weight: 'bold' };
                                }
                                return { size: ovLabelFont, weight: 'bold' };
                            },
                            formatter: function(value, context) {
                                if (context.datasetIndex === 2) {
                                    const sign = value > 0 ? '+' : '';
                                    return `${sign}${value.toLocaleString()}`;
                                }
                                if (context.datasetIndex === 1) {
                                    const inc = manualIncDec[context.dataIndex];
                                    const signInc = inc > 0 ? '+' : '';
                                    return `${value.toLocaleString()}\n(${signInc}${inc}%)`;
                                }
                                return value.toLocaleString();
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => value.toLocaleString(),
                                font: { size: ovTickFont }
                            },
                            title: {
                                display: true,
                                text: 'Riders',
                                font: { size: isMobileOverview ? 10 : 12, weight: 'bold' }
                            }
                        },
                        y1: {
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false },
                            ticks: {
                                callback: (value) => value.toLocaleString(),
                                font: { size: ovTickFont - 1 },
                                color: '#92400e'
                            },
                            title: {
                                display: true,
                                text: 'Variance Riders',
                                font: { size: isMobileOverview ? 9 : 11, weight: 'bold' },
                                color: '#92400e'
                            }
                        },
                        x: {
                            ticks: { font: { size: ovTickFont, weight: 'bold' } }
                        }
                    }
                }
            });

            // ========================================
            // FR & DRIVER CARD RANGE IMPACT CHARTS
            // ========================================
            
            // Helper function to get color based on percentage value
            // High % = Green (significant), Low % = Red (minimal)
            function getPctColor(pct) {
                const pctNum = parseFloat(pct);
                if (pctNum >= 35) return '#16a34a'; // Green for high %
                if (pctNum >= 25) return '#65a30d'; // Lime-green
                if (pctNum >= 15) return '#ca8a04'; // Yellow/Amber
                if (pctNum >= 5) return '#ea580c';  // Orange
                return '#dc2626'; // Red for low %
            }

            const impactPartnerTotalsByMetric = {
                fr: { all: 643, withtarget: 551, new: 158, old: 485 },
                dc: { all: 643, withtarget: 551, new: 158, old: 485 }
            };

            const impactTargetData = {
                fr: {
                    all: { dec: [418, 181, 434, 1231, 1632, 8466, 10091], jan: [369, 0, 19, 0, 11, 628, 18338] },
                    withtarget: { dec: [418, 181, 434, 1231, 1632, 8466, 10091], jan: [369, 0, 19, 0, 11, 628, 18338] },
                    new: { dec: [305, 91, 195, 227, 642, 1596, 1898], jan: [359, 0, 19, 0, 0, 115, 2469] },
                    old: { dec: [113, 90, 239, 1004, 990, 6870, 8193], jan: [10, 0, 0, 0, 11, 513, 15869] }
                },
                dc: {
                    all: { dec: [13126, 1800, 988, 759, 838, 1127, 3815], jan: [8347, 1567, 1318, 800, 978, 1402, 4953] },
                    withtarget: { dec: [13126, 1800, 988, 759, 838, 1127, 3815], jan: [8347, 1567, 1318, 800, 978, 1402, 4953] },
                    new: { dec: [3073, 475, 207, 136, 43, 238, 782], jan: [1360, 249, 70, 78, 129, 201, 875] },
                    old: { dec: [10053, 1325, 781, 623, 795, 889, 3033], jan: [6987, 1318, 1248, 722, 849, 1201, 4078] }
                }
            };

            function sumArray(values = []) {
                return values.reduce((sum, v) => sum + v, 0);
            }

            function getImpactTargetTotals(metric, filter) {
                const data = impactTargetData[metric] || impactTargetData.fr;
                if (filter === 'both') {
                    const newData = data.new || {};
                    const oldData = data.old || {};
                    const dec = (newData.dec && oldData.dec)
                        ? newData.dec.map((v, i) => v + (oldData.dec[i] || 0))
                        : null;
                    const jan = (newData.jan || oldData.jan)
                        ? (newData.jan || []).map((v, i) => v + ((oldData.jan || [])[i] || 0))
                        : null;
                    return { dec, jan };
                }
                return data[filter] || data.all;
            }

            function updateImpactFilterLabels(metric) {
                const totalsByMetric = impactPartnerTotalsByMetric[metric] || impactPartnerTotalsByMetric.fr;
                const allBtn = document.querySelector('.impact-filter-btn[data-filter="all"]');
                const withTargetBtn = document.querySelector('.impact-filter-btn[data-filter="withtarget"]');
                const newBtn = document.querySelector('.impact-filter-btn[data-filter="new"]');
                const oldBtn = document.querySelector('.impact-filter-btn[data-filter="old"]');

                if (allBtn) allBtn.innerHTML = `📊 All Partners (${totalsByMetric.all.toLocaleString()})`;
                if (withTargetBtn) withTargetBtn.innerHTML = `✅ With Target (${totalsByMetric.withtarget.toLocaleString()})`;
                if (newBtn) newBtn.innerHTML = `🆕 New Partners (${totalsByMetric.new.toLocaleString()})`;
                if (oldBtn) oldBtn.innerHTML = `👥 Old Partners (${totalsByMetric.old.toLocaleString()})`;
            }

            function updateImpactKpiCards(metric, filter) {
                updateImpactFilterLabels(metric);
                const totalsByMetric = impactPartnerTotalsByMetric[metric] || impactPartnerTotalsByMetric.fr;
                const totalAll = totalsByMetric.all;
                const newCount = totalsByMetric.new;
                const oldCount = totalsByMetric.old;
                const filterCount = filter === 'both'
                    ? (newCount + oldCount)
                    : (totalsByMetric[filter] ?? totalAll);
                const filterPct = totalAll ? (filterCount / totalAll) * 100 : 0;

                const partnersValueEl = document.getElementById('impactPartnersValue');
                const partnersSubEl = document.getElementById('impactPartnersSub');
                const partnersSplitEl = document.getElementById('impactPartnersSplit');

                const newPct = totalAll ? (newCount / totalAll) * 100 : 0;
                const oldPct = totalAll ? (oldCount / totalAll) * 100 : 0;

                if (partnersValueEl && partnersSubEl && partnersSplitEl) {
                    if (filter === 'both') {
                        partnersValueEl.textContent = `${newCount.toLocaleString()} / ${oldCount.toLocaleString()}`;
                        partnersSubEl.textContent = 'New vs Old partners (count)';
                    } else {
                        partnersValueEl.textContent = `${filterCount.toLocaleString()} (${filterPct.toFixed(1)}%)`;
                        const label = filter === 'withtarget'
                            ? 'Partners with Target'
                            : (filter === 'new' ? 'New Partners' : (filter === 'old' ? 'Old Partners' : 'All Partners'));
                        partnersSubEl.textContent = `${label} of total ${totalAll.toLocaleString()}`;
                    }
                    partnersSplitEl.textContent = `New: ${newCount.toLocaleString()} (${newPct.toFixed(1)}%) • Old: ${oldCount.toLocaleString()} (${oldPct.toFixed(1)}%)`;
                }

                const targetsValueEl = document.getElementById('impactTargetsValue');
                const targetsSubEl = document.getElementById('impactTargetsSub');
                const targetsChangeEl = document.getElementById('impactTargetsChange');

                const totals = getImpactTargetTotals(metric, filter);
                const decTotal = totals.dec ? sumArray(totals.dec) : null;
                const janTotal = totals.jan ? sumArray(totals.jan) : null;

                if (targetsValueEl && targetsSubEl && targetsChangeEl) {
                    if (decTotal === null || janTotal === null) {
                        const janText = janTotal !== null ? janTotal.toLocaleString() : '—';
                        targetsValueEl.textContent = `Feb Total: ${janText}`;
                        targetsSubEl.textContent = 'Jan Total: — (N/A for this view)';
                        targetsChangeEl.textContent = 'Net Change: —';
                    } else {
                        const delta = janTotal - decTotal;
                        const deltaPct = decTotal ? (delta / decTotal) * 100 : 0;
                        const sign = delta > 0 ? '+' : '';
                        const deltaColor = delta > 0 ? '#16a34a' : (delta < 0 ? '#dc2626' : '#6b7280');
                        targetsValueEl.textContent = `Jan ${decTotal.toLocaleString()} → Feb ${janTotal.toLocaleString()}`;
                        targetsSubEl.textContent = 'Total Target Riders (All Ranges)';
                        targetsChangeEl.innerHTML = `Net Change: <span style="color: ${deltaColor}; font-weight: 700;">${sign}${delta.toLocaleString()} (${sign}${deltaPct.toFixed(1)}%)</span>`;
                    }
                }
            }
            window.updateImpactKpiCards = updateImpactKpiCards;
            window.updateImpactFilterLabels = updateImpactFilterLabels;
            
            // FR Impact - New Partners Bar Chart (Dec vs Jan) - Single View
            // Impact Chart - Single View (New Partners)
            window.impactChartSingle = null; // Global reference for chart
            window.initImpactChartSingle = function(metric = 'fr', filter = 'new') {
                console.log('initImpactChartSingle called with:', metric, filter);
                const canvas = document.getElementById('impactChartSingleCanvas');
                if (!canvas) {
                    console.error('Canvas impactChartSingleCanvas not found');
                    return;
                }
                const ctx = canvas.getContext('2d');
                
                let data, color, title;
                if (metric === 'fr') {
                    if (filter === 'new') {
                        data = { dec: [305, 91, 195, 227, 642, 1596, 1898], jan: [359, 0, 19, 0, 0, 115, 2469] };
                        title = 'New Partners (<3 months) - FR Range Impact';
                    } else {
                        data = { dec: [113, 90, 239, 1004, 990, 6870, 8193], jan: [10, 0, 0, 0, 11, 513, 15869] };
                        title = 'Old Partners (≥3 months) - FR Range Impact';
                    }
                    color = '#3b82f6';
                } else {
                    if (filter === 'new') {
                        data = { dec: [3073, 475, 207, 136, 43, 238, 782], jan: [1360, 249, 70, 78, 129, 201, 875] };
                        title = 'New Partners (<3 months) - Driver Card Range Impact';
                    } else {
                        data = { dec: [10053, 1325, 781, 623, 795, 889, 3033], jan: [6987, 1318, 1248, 722, 849, 1201, 4078] };
                        title = 'Old Partners (≥3 months) - Driver Card Range Impact';
                    }
                    color = '#f97316';
                }
                
                // Destroy existing chart using global reference
                if (window.impactChartSingle) {
                    try { window.impactChartSingle.destroy(); } catch(e) {}
                }
                
                // Build datasets (include Dec when available)
                const hasDec = Array.isArray(data.dec);
                let datasets = [];
                if (hasDec) {
                    datasets.push({
                        label: 'Jan Target',
                        data: data.dec,
                        backgroundColor: color,
                        borderColor: color,
                        borderWidth: 1.5
                    });
                }
                datasets.push({
                    label: 'Feb Target',
                    data: data.jan,
                    backgroundColor: '#10b981',
                    borderColor: '#059669',
                    borderWidth: 1.5
                });
                
                console.log('Creating chart with data:', data);
                window.impactChartSingle = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2.8,
                        layout: {
                            padding: { top: 30 }
                        },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 10,
                                callbacks: {
                                    label: function(context) {
                                        const dataset = context.chart.data.datasets[context.datasetIndex];
                                        const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                        const pct = total ? ((context.parsed.y / total) * 100).toFixed(1) : '0.0';
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} (${pct}%)`;
                                    }
                                }
                            },
                            datalabels: {
                                labels: {
                                    value: {
                                        anchor: 'end',
                                        align: 'top',
                                        offset: 2,
                                        font: { size: 11, weight: 'bold' },
                                        color: '#111827',
                                        formatter: (value) => value.toLocaleString()
                                    },
                                    pct: {
                                        anchor: 'end',
                                        align: 'top',
                                        offset: 16,
                                        font: { size: 10, weight: 'bold' },
                                        color: function(context) {
                                            const dataset = context.chart.data.datasets[context.datasetIndex];
                                            const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                            const pct = total ? ((context.dataset.data[context.dataIndex] / total) * 100).toFixed(1) : '0.0';
                                            return getPctColor(pct);
                                        },
                                        formatter: (value, context) => {
                                            const dataset = context.chart.data.datasets[context.datasetIndex];
                                            const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                            const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                            return '(' + pct + '%)';
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { callback: (value) => value.toLocaleString(), font: { size: 11 } },
                                title: { display: true, text: 'Target Riders', font: { size: 12, weight: 'bold' } }
                            },
                            x: {
                                ticks: {
                                    font: { size: 10 },
                                    maxRotation: 45,
                                    minRotation: 45,
                                    autoSkip: false,
                                    padding: 8
                                }
                            }
                        }
                    }
                });
                console.log('Chart created successfully');
            };

            // Impact Chart - Dual View (New vs Old)
            let impactChartNew = null, impactChartOld = null;
            window.initImpactChartDual = function(metric = 'fr') {
                console.log('initImpactChartDual called with:', metric);
                const canvasNew = document.getElementById('impactChartNewBar');
                const canvasOld = document.getElementById('impactChartOldBar');
                if (!canvasNew || !canvasOld) {
                    console.error('Canvas elements not found');
                    return;
                }
                const ctxNew = canvasNew.getContext('2d');
                const ctxOld = canvasOld.getContext('2d');
                
                let dataNew, dataOld, color;
                if (metric === 'fr') {
                    dataNew = { dec: [195, 218, 298, 253, 705, 1726, 1827], jan: [305, 91, 195, 227, 642, 1596, 1898] };
                    dataOld = { dec: [260, 198, 377, 1209, 1180, 7190, 8546], jan: [113, 90, 239, 1004, 990, 6870, 8193] };
                    color = '#3b82f6';
                } else {
                    dataNew = { dec: [3358, 497, 206, 122, 50, 229, 760], jan: [3073, 475, 207, 136, 43, 238, 782] };
                    dataOld = { dec: [0, 0, 0, 0, 0, 0, 18960], jan: [10053, 1325, 781, 623, 795, 889, 3033] };
                    color = '#f97316';
                }
                
                if (impactChartNew) {
                    try { impactChartNew.destroy(); } catch(e) {}
                }
                if (impactChartOld) {
                    try { impactChartOld.destroy(); } catch(e) {}
                }
                console.log('Creating dual charts with metric:', metric, 'dataNew:', dataNew, 'dataOld:', dataOld);
                
                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.8,
                    layout: {
                        padding: { top: 30 }
                    },
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((context.parsed.y / total) * 100).toFixed(1) : '0.0';
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} (${pct}%)`;
                                }
                            }
                        },
                        datalabels: {
                            labels: {
                                value: {
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 2,
                                    font: { size: 10, weight: 'bold' },
                                    color: '#111827',
                                    formatter: (value) => value.toLocaleString()
                                },
                                pct: {
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 14,
                                    font: { size: 9, weight: 'bold' },
                                    color: function(context) {
                                        const dataset = context.chart.data.datasets[context.datasetIndex];
                                        const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                        const pct = total ? ((context.dataset.data[context.dataIndex] / total) * 100).toFixed(1) : '0.0';
                                        return getPctColor(pct);
                                    },
                                    formatter: (value, context) => {
                                        const dataset = context.chart.data.datasets[context.datasetIndex];
                                        const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                        const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                        return '(' + pct + '%)';
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: (value) => value.toLocaleString(), font: { size: 11 } },
                            title: { display: true, text: 'Target Riders', font: { size: 12, weight: 'bold' } }
                        },
                        x: {
                            ticks: {
                                font: { size: 10 },
                                maxRotation: 45,
                                minRotation: 45,
                                autoSkip: false,
                                padding: 8
                            }
                        }
                    }
                };
                
                // Build datasets (include Dec when available)
                const hasDecNew = Array.isArray(dataNew.dec);
                const hasDecOld = Array.isArray(dataOld.dec);
                let datasetsNew = [];
                let datasetsOld = [];

                if (hasDecNew) {
                    datasetsNew.push({
                        label: 'Jan Target',
                        data: dataNew.dec,
                        backgroundColor: color,
                        borderColor: color,
                        borderWidth: 1.5
                    });
                }
                datasetsNew.push({
                    label: 'Feb Target',
                    data: dataNew.jan,
                    backgroundColor: '#10b981',
                    borderColor: '#059669',
                    borderWidth: 1.5
                });

                if (hasDecOld) {
                    datasetsOld.push({
                        label: 'Jan Target',
                        data: dataOld.dec,
                        backgroundColor: color,
                        borderColor: color,
                        borderWidth: 1.5
                    });
                }
                datasetsOld.push({
                    label: 'Feb Target',
                    data: dataOld.jan,
                    backgroundColor: '#10b981',
                    borderColor: '#059669',
                    borderWidth: 1.5
                });
                
                impactChartNew = new Chart(ctxNew, {
                    type: 'bar',
                    data: {
                        labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                        datasets: datasetsNew
                    },
                    options: chartOptions
                });
                
                impactChartOld = new Chart(ctxOld, {
                    type: 'bar',
                    data: {
                        labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                        datasets: datasetsOld
                    },
                    options: chartOptions
                });
                console.log('Dual charts created successfully');
            };

            // Initialize with FR + New Partners (on DOM load)
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    console.log('DOM loaded, initializing impact chart');
                    window.initImpactChartSingle('fr', 'new');
                });
            } else {
                console.log('DOM already loaded, initializing impact chart');
                window.initImpactChartSingle('fr', 'new');
            }

            // Impact Chart - Overall View (Trend Line)
            let impactChartOverall = null;
            window.initImpactChartOverall = function(metric = 'fr') {
                console.log('initImpactChartOverall called with:', metric);
                const canvas = document.getElementById('impactChartOverallCanvas');
                if (!canvas) {
                    console.error('Canvas impactChartOverallCanvas not found');
                    return;
                }
                const ctx = canvas.getContext('2d');
                
                let partnersCount, decTarget, janTarget, color;
                if (metric === 'fr') {
                    partnersCount = [17, 1, 1, 0, 3, 36, 585];
                    decTarget = [418, 181, 434, 1231, 1632, 8466, 10091];
                    janTarget = [369, 0, 19, 0, 11, 628, 18338];
                    color = '#3b82f6';
                } else {
                    partnersCount = [317, 45, 37, 26, 32, 43, 143];
                    decTarget = [13126, 1800, 988, 759, 838, 1127, 3815];
                    janTarget = [8347, 1567, 1318, 800, 978, 1402, 4953];
                    color = '#f97316';
                }
                
                if (impactChartOverall) {
                    try { impactChartOverall.destroy(); } catch(e) {}
                }
                
                console.log('Creating overall chart with metric:', metric);
                impactChartOverall = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                        datasets: [{
                            label: 'Partners Count',
                            data: partnersCount,
                            borderColor: color,
                            backgroundColor: color + '15',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: color,
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            yAxisID: 'y',
                            datalabels: {
                                display: true,
                                align: 'top',
                                offset: 10,
                                font: { size: 11, weight: 'bold' },
                                color: color,
                                backgroundColor: 'white',
                                borderRadius: 4,
                                padding: 4,
                                formatter: function(value, context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${value.toLocaleString()} (${pct}%)`;
                                }
                            }
                        }, {
                            label: 'Jan Target',
                            data: decTarget,
                            borderColor: '#9ca3af',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#9ca3af',
                            pointBorderColor: 'white',
                            pointBorderWidth: 1,
                            pointRadius: 4,
                            yAxisID: 'y1',
                            datalabels: {
                                display: true,
                                align: 'right',
                                offset: 8,
                                font: { size: 10, weight: '600' },
                                color: '#6b7280',
                                backgroundColor: 'white',
                                borderRadius: 3,
                                padding: 3,
                                formatter: function(value, context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${value.toLocaleString()} (${pct}%)`;
                                }
                            }
                        }, {
                            label: 'Feb Target',
                            data: janTarget,
                            borderColor: '#10b981',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: 'white',
                            pointBorderWidth: 1,
                            pointRadius: 4,
                            yAxisID: 'y1',
                            datalabels: {
                                display: true,
                                align: 'bottom',
                                offset: 8,
                                font: { size: 10, weight: '600' },
                                color: '#059669',
                                backgroundColor: 'white',
                                borderRadius: 3,
                                padding: 3,
                                formatter: function(value, context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${value.toLocaleString()} (${pct}%)`;
                                }
                            }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2.8,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) label += ': ';
                                        if (context.parsed.y !== null) {
                                            const dataset = context.chart.data.datasets[context.datasetIndex];
                                            const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                            const pct = total ? ((context.parsed.y / total) * 100).toFixed(1) : '0.0';
                                            label += `${context.parsed.y.toLocaleString()} (${pct}%)`;
                                        }
                                        return label;
                                    }
                                }
                            },
                            datalabels: {
                                display: true,
                                clamp: true
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'Partners Count', font: { size: 12, weight: 'bold' } },
                                beginAtZero: true,
                                ticks: { callback: (value) => value.toLocaleString() }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'Target Riders', font: { size: 12, weight: 'bold' } },
                                beginAtZero: true,
                                grid: { drawOnChartArea: false },
                                ticks: { callback: (value) => value.toLocaleString() }
                            },
                            x: {
                                ticks: {
                                    font: { size: 10 },
                                    maxRotation: 45,
                                    minRotation: 45,
                                    autoSkip: false,
                                    padding: 8
                                }
                            }
                        }
                    }
                });
                console.log('Overall chart created successfully');
            };

            // Impact Chart - Partners with Target View (Trend Line)
            let impactChartWithTarget = null;
            window.initImpactChartWithTarget = function(metric = 'fr') {
                console.log('initImpactChartWithTarget called with:', metric);
                const canvas = document.getElementById('impactChartWithTargetCanvas');
                if (!canvas) {
                    console.error('Canvas impactChartWithTargetCanvas not found');
                    return;
                }
                const ctx = canvas.getContext('2d');
                
                let activePartnersCount, decTarget, janTarget, color;
                if (metric === 'fr') {
                    activePartnersCount = [17, 0, 1, 0, 1, 23, 509];
                    decTarget = [418, 181, 434, 1231, 1632, 8466, 10091];
                    janTarget = [369, 0, 19, 0, 11, 628, 18338];
                    color = '#3b82f6';
                } else {
                    activePartnersCount = [237, 43, 34, 25, 30, 43, 139];
                    decTarget = [13126, 1800, 988, 759, 838, 1127, 3815];
                    janTarget = [8347, 1567, 1318, 800, 978, 1402, 4953];
                    color = '#f97316';
                }
                
                if (impactChartWithTarget) {
                    try { impactChartWithTarget.destroy(); } catch(e) {}
                }
                
                console.log('Creating with target chart with metric:', metric);
                impactChartWithTarget = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                        datasets: [{
                            label: 'Active Partners with Target',
                            data: activePartnersCount,
                            borderColor: color,
                            backgroundColor: color + '15',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: color,
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            yAxisID: 'y',
                            datalabels: {
                                display: true,
                                anchor: 'end',
                                align: 'end',
                                offset: 5,
                                font: { size: 10, weight: 'bold' },
                                color: color,
                                backgroundColor: 'rgba(255,255,255,0.8)',
                                borderRadius: 2,
                                padding: 2,
                                formatter: function(value, context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${value.toLocaleString()} (${pct}%)`;
                                }
                            }
                        }, {
                            label: 'Jan Target',
                            data: decTarget,
                            borderColor: '#9ca3af',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#9ca3af',
                            pointBorderColor: 'white',
                            pointBorderWidth: 1,
                            pointRadius: 4,
                            yAxisID: 'y1',
                            datalabels: {
                                display: true,
                                anchor: 'end',
                                align: 'left',
                                offset: 5,
                                font: { size: 9, weight: '600' },
                                color: '#6b7280',
                                backgroundColor: 'rgba(255,255,255,0.8)',
                                borderRadius: 2,
                                padding: 2,
                                formatter: function(value, context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${value.toLocaleString()} (${pct}%)`;
                                }
                            }
                        }, {
                            label: 'Feb Target',
                            data: janTarget,
                            borderColor: '#10b981',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: 'white',
                            pointBorderWidth: 1,
                            pointRadius: 4,
                            yAxisID: 'y1',
                            datalabels: {
                                display: true,
                                anchor: 'end',
                                align: 'bottom',
                                offset: 5,
                                font: { size: 9, weight: '600' },
                                color: '#059669',
                                backgroundColor: 'rgba(255,255,255,0.8)',
                                borderRadius: 2,
                                padding: 2,
                                formatter: function(value, context) {
                                    const dataset = context.chart.data.datasets[context.datasetIndex];
                                    const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${value.toLocaleString()} (${pct}%)`;
                                }
                            }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2.8,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) label += ': ';
                                        if (context.parsed.y !== null) {
                                            const dataset = context.chart.data.datasets[context.datasetIndex];
                                            const total = dataset.data.reduce((sum, v) => sum + v, 0);
                                            const pct = total ? ((context.parsed.y / total) * 100).toFixed(1) : '0.0';
                                            label += `${context.parsed.y.toLocaleString()} (${pct}%)`;
                                        }
                                        return label;
                                    }
                                }
                            },
                            datalabels: {
                                display: true,
                                clamp: true
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'Active Partners Count', font: { size: 12, weight: 'bold' } },
                                beginAtZero: true,
                                ticks: { callback: (value) => value.toLocaleString() }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'Target Riders', font: { size: 12, weight: 'bold' } },
                                beginAtZero: true,
                                grid: { drawOnChartArea: false },
                                ticks: { callback: (value) => value.toLocaleString() }
                            },
                            x: {
                                ticks: {
                                    font: { size: 10 },
                                    maxRotation: 45,
                                    minRotation: 45,
                                    autoSkip: false,
                                    padding: 8
                                }
                            }
                        }
                    }
                });
                console.log('With target chart created successfully');
            };

            // FR Impact Chart
            const frImpactChartEl = document.getElementById('frImpactChart');
            if (frImpactChartEl) {
            new Chart(frImpactChartEl.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                    datasets: [{
                        label: 'Jan Target',
                        data: [430, 416, 711, 1462, 1867, 8908, 10384],
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Feb Target',
                        data: [369, 0, 19, 0, 11, 628, 18338],
                        backgroundColor: '#10b981'
                    }]
                },
                options: chartOptions
            });
            }

            // Terminated Chart
            const terminatedChartEl = document.getElementById('terminatedChart');
            if (terminatedChartEl) {
            new Chart(terminatedChartEl.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Riyadh', 'Taif', 'Jeddah', 'Al Ahsa', 'Dammam', 'Others'],
                    datasets: [{
                        label: 'Terminated Partners',
                        data: [19, 6, 5, 4, 3, 13],
                        backgroundColor: '#ef4444'
                    }]
                },
                options: chartOptions
            });
            }

            // New vs Old Chart
            const newOldChartEl = document.getElementById('newOldChart');
            if (newOldChartEl) {
            new Chart(newOldChartEl.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['New Partners', 'Old Partners'],
                    datasets: [{
                        label: 'Jan Target',
                        data: [2443, 21739],
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Feb Target',
                        data: [2962, 16403],
                        backgroundColor: '#10b981'
                    }]
                },
                options: chartOptions
            });
            }

            // Risk Tier Chart
            const riskTierChartEl = document.getElementById('riskTierChart');
            if (riskTierChartEl) {
            new Chart(riskTierChartEl.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['🟢 Excellent\n(100-120)', '🟡 Good\n(80-100)', '🟠 At Risk\n(60-80)', '🔴 Critical\n(<60)'],
                    datasets: [{
                        label: 'Active Partners',
                        data: [330, 196, 32, 55],
                        backgroundColor: ['#10b981', '#fbbf24', '#f97316', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            formatter: (value) => value.toLocaleString(),
                            font: {
                                weight: 'bold',
                                size: 11
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Active Partners'
                            }
                        }
                    }
                }
            });
            }

            // City-wise tables and charts
            try { initCityWiseSection(); } catch(e) { console.error('City-wise section failed', e); }
            
            // Partner Age Analysis (New vs Old)
            try { initPartnerAgeSection(); } catch(e) { console.error('Partner age section failed', e); }
            
            // Tier city (T1 vs T2) tables and charts
            try { initTierCitySection(); } catch(e) { console.error('Tier city section failed', e); }
        };
    

        // Adjustment Analysis Charts
        
        // City-Level Target Changes Chart
        new Chart(document.getElementById('adjustmentCityChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['Riyadh', 'Jeddah', 'Madinah', 'Jubail', 'Al Ahsa', 'Taif', 'Jazan', 'Tabuk', 'Makkah'],
                datasets: [{
                    label: 'Target Change',
                    data: [-149, -119, 29, 25, 16, 10, 10, 5, 0],
                    backgroundColor: function(context) {
                        const value = context.parsed.y;
                        return value > 0 ? '#10b981' : value < 0 ? '#ef4444' : '#6b7280';
                    }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    datalabels: {
                        anchor: function(context) {
                            return context.dataset.data[context.dataIndex] >= 0 ? 'end' : 'start';
                        },
                        align: function(context) {
                            return context.dataset.data[context.dataIndex] >= 0 ? 'end' : 'start';
                        },
                        formatter: (value) => value > 0 ? '+' + value : value,
                        font: {
                            weight: 'bold',
                            size: 11
                        }
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Rider Change'
                        }
                    }
                }
            }
        });

        // Adjustment Reasons Chart
        new Chart(document.getElementById('adjustmentReasonsChart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: ['Driver Card Issues (37.7%)', 'FR/Performance (13.1%)', '2% Buffer (11.5%)', 'Other/Mixed (11.5%)', 'New Partner (8.2%)', 'Capacity Transfer (6.6%)', 'High Performance (4.9%)', 'Partner Inability (3.3%)', 'City Capacity (3.3%)'],
                datasets: [{
                    data: [23, 8, 7, 7, 5, 4, 3, 2, 2],
                    backgroundColor: ['#dc2626', '#f97316', '#3b82f6', '#6b7280', '#8b5cf6', '#14b8a6', '#10b981', '#f59e0b', '#0ea5e9']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 12
                        },
                        formatter: (value, ctx) => {
                            const sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value * 100) / sum).toFixed(1) + '%';
                            return value + '\n(' + percentage + ')';
                        }
                    },
                    legend: {
                        position: 'right'
                    }
                }
            }
        });

        
        // =========================
        // Monthly insights (structure + assumptions)
        // =========================
        const monthlyData = {
            months: ['Sep-25','Oct-25','Nov-25','Dec-25','Jan-26','Feb-26'],
            totalPartners: [615, 697, 767, 674, 625, 551],
            activePartners: [492, 582, 640, 630, 616, 551],
            activeRiders: [38000, 36000, 34000, 25000, 24000, 24000],
            totalTarget: [32793, 34006, 34837, 24182, 22453, 19365],
            avgScale: [53.3, 48.8, 45.4, 35.9, 35.9, 35.1],
            perf: {
                good:    [160, 190, 205, 223, 269, 252],
                average: [207, 249, 275, 285, 274, 262],
                bad:     [125, 143, 160, 122, 73, 20]
            },
            size: {
                big:   [59, 74, 82, 87, 81, 77],
                mid:   [262, 322, 339, 335, 275, 282],
                small: [171, 186, 219, 208, 260, 175]
            },
            // Willingness (assumed % of active partners; Jan is updated with actual data)
            willingPct: {
                any:  [68.1, 62.0, 48.9, 50.3, 17.8, 33.92],
                gt20: [40.7, 15.3, 13.3, 14.5, 5.3, 10.24],
                gt30: [30.1, 8.8, 9.2, 10.4, 3.7, 5.76],
                gt40: [9, 8, 7, 6, 4, 3]
            },
            // MoM change for partners with target increase (any)
            willingMoMAny: [null, 14, -10, 13, -69, 91],

            // Environment index to scale assumed impact by month
            envIdx: [1.55, 1.45, 1.35, 1.25, 0.85, 0.55]
        };

        function fmtNum(n) {
            try { return n.toLocaleString('en-US'); } catch(e) { return String(n); }
        }
        function fmtPct(p) {
            const v = (Math.round(p * 10) / 10);
            return v.toFixed(1) + '%';
        }
        function safeIdx(value) {
            const idx = monthlyData.months.indexOf(value);
            return idx >= 0 ? idx : (monthlyData.months.length - 1);
        }
        function pctToCount(pct, base) {
            return Math.max(0, Math.round((pct / 100) * base));
        }

        function changeMonth(step) {
            const sel = document.getElementById('monthSelect');
            if (!sel) return;

            if (sel.value === 'All') {
                // if currently All, go to last month then step
                sel.value = monthlyData.months[monthlyData.months.length - 1];
            }

            const idx = safeIdx(sel.value);
            const next = Math.min(Math.max(idx + step, 0), monthlyData.months.length - 1);
            sel.value = monthlyData.months[next];
            updateMonthlyView(sel.value);
        }

        // Chart handles
        let m_targetTrend, m_avgScale, m_perfMix, m_sizeMix, m_mom;

        function initMonthlyCharts() {
            const t1 = document.getElementById('monthlyTargetTrendChart');
            if (!t1) return; // tab not present

            const months = monthlyData.months.slice();
            const trendMonths = months;
            const trendTotalTarget = monthlyData.totalTarget.slice();
            const trendTotalPartners = monthlyData.totalPartners.slice();

                        // Total Target & Active Partners trend (advanced version rendered in main init)
            // Fallback placeholder - main initMonthlyCharts handles rendering

            // Avg scale trend (advanced version rendered later)
            // Fallback simple chart replaced by advanced version in the main init block

            // Performance mix (stacked)
            m_perfMix = new Chart(document.getElementById('monthlyPerformanceMixChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        { label: 'Good', data: monthlyData.perf.good.slice(), stack: 'perf' },
                        { label: 'Average', data: monthlyData.perf.average.slice(), stack: 'perf' },
                        { label: 'Bad', data: monthlyData.perf.bad.slice(), stack: 'perf' }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top' }, datalabels: { display: false } },
                    scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }
                }
            });

            // Size mix (stacked)
            m_sizeMix = new Chart(document.getElementById('monthlySizeMixChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        { label: 'Big', data: monthlyData.size.big.slice(), stack: 'size' },
                        { label: 'Mid', data: monthlyData.size.mid.slice(), stack: 'size' },
                        { label: 'Small', data: monthlyData.size.small.slice(), stack: 'size' }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top' }, datalabels: { display: false } },
                    scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }
                }
            });

            // Total Riders by Performance Level (with percentages)
            const ridersGood = [11229, 11083, 11418, 11019, 12349, 10192];
            const ridersAverage = [12898, 14595, 14151, 9258, 8330, 8414];
            const ridersBad = [5090, 5501, 6449, 2879, 1534, 370];
            const ridersTotal = ridersGood.map((v, i) => v + ridersAverage[i] + ridersBad[i]);
            const ridersPctGood = ridersGood.map((v, i) => ((v / ridersTotal[i]) * 100).toFixed(1));
            const ridersPctAverage = ridersAverage.map((v, i) => ((v / ridersTotal[i]) * 100).toFixed(1));
            const ridersPctBad = ridersBad.map((v, i) => ((v / ridersTotal[i]) * 100).toFixed(1));

            m_ridersPerfMix = new Chart(document.getElementById('monthlyRidersPerformanceMixChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        { 
                            label: 'Good', 
                            data: ridersGood, 
                            backgroundColor: '#10b981', 
                            borderColor: '#059669',
                            borderWidth: 1,
                            stack: 'riders'
                        },
                        { 
                            label: 'Average', 
                            data: ridersAverage, 
                            backgroundColor: '#fbbf24', 
                            borderColor: '#f59e0b',
                            borderWidth: 1,
                            stack: 'riders'
                        },
                        { 
                            label: 'Bad', 
                            data: ridersBad, 
                            backgroundColor: '#ef4444', 
                            borderColor: '#dc2626',
                            borderWidth: 1,
                            stack: 'riders'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { position: 'top' },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: { weight: 'bold', size: 10 },
                            formatter: function(value, context) {
                                const datasetIndex = context.datasetIndex;
                                const dataIndex = context.dataIndex;
                                let pct;
                                if (datasetIndex === 0) pct = ridersPctGood[dataIndex];
                                else if (datasetIndex === 1) pct = ridersPctAverage[dataIndex];
                                else pct = ridersPctBad[dataIndex];
                                return value.toLocaleString() + '\n(' + pct + '%)';
                            },
                            align: 'center',
                            anchor: 'center'
                        }
                    },
                    scales: { 
                        x: { stacked: true }, 
                        y: { 
                            stacked: true, 
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        } 
                    }
                }
            });

            // Total Riders by Size Level (with percentages)
            const ridersBig = [7197, 7906, 8642, 6741, 4938, 5351];
            const ridersMid = [15978, 17709, 17253, 12352, 10598, 9982];
            const ridersSmall = [6042, 5564, 6123, 4063, 6677, 3643];
            const ridersSizeTotal = ridersBig.map((v, i) => v + ridersMid[i] + ridersSmall[i]);
            const ridersPctBig = ridersBig.map((v, i) => ((v / ridersSizeTotal[i]) * 100).toFixed(1));
            const ridersPctMid = ridersMid.map((v, i) => ((v / ridersSizeTotal[i]) * 100).toFixed(1));
            const ridersPctSmall = ridersSmall.map((v, i) => ((v / ridersSizeTotal[i]) * 100).toFixed(1));

            m_ridersSizeMix = new Chart(document.getElementById('monthlyRidersSizeMixChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        { 
                            label: 'Big', 
                            data: ridersBig, 
                            backgroundColor: '#3b82f6', 
                            borderColor: '#2563eb',
                            borderWidth: 1,
                            stack: 'size'
                        },
                        { 
                            label: 'Mid', 
                            data: ridersMid, 
                            backgroundColor: '#8b5cf6', 
                            borderColor: '#7c3aed',
                            borderWidth: 1,
                            stack: 'size'
                        },
                        { 
                            label: 'Small', 
                            data: ridersSmall, 
                            backgroundColor: '#06b6d4', 
                            borderColor: '#0891b2',
                            borderWidth: 1,
                            stack: 'size'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { position: 'top' },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: { weight: 'bold', size: 10 },
                            formatter: function(value, context) {
                                const datasetIndex = context.datasetIndex;
                                const dataIndex = context.dataIndex;
                                let pct;
                                if (datasetIndex === 0) pct = ridersPctBig[dataIndex];
                                else if (datasetIndex === 1) pct = ridersPctMid[dataIndex];
                                else pct = ridersPctSmall[dataIndex];
                                return value.toLocaleString() + '\n(' + pct + '%)';
                            },
                            align: 'center',
                            anchor: 'center'
                        }
                    },
                    scales: { 
                        x: { stacked: true }, 
                        y: { 
                            stacked: true, 
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        } 
                    }
                }
            });

            // MoM % change in total target
            const momCanvas = document.getElementById('monthlyMoMChangeChartNew') || document.getElementById('monthlyMoMChangeChart');

            // MoM%: (current - previous) / previous
            const mom = trendMonths.map((m, i) => {
                if (i === 0) return null; // baseline month (no MoM)
                const prev = trendTotalTarget[i - 1];
                const cur = trendTotalTarget[i];
                if (!prev) return null;
                return ((cur - prev) / prev) * 100;
            });

            if (momCanvas) {
                const bg = mom.map(v => (v === null) ? '#9ca3af' : (v >= 0 ? '#16a34a' : '#dc2626'));
                const br = mom.map(v => (v === null) ? '#6b7280' : (v >= 0 ? '#15803d' : '#b91c1c'));

                m_mom = new Chart(momCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: trendMonths,
                        datasets: [{
                            label: 'MoM %',
                            data: mom,
                            backgroundColor: bg,
                            borderColor: br,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            datalabels: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const v = ctx.parsed.y;
                                        if (v === null || typeof v === 'undefined') return 'Baseline month';
                                        return 'MoM Change: ' + v.toFixed(2) + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { ticks: { color: '#111827' } },
                            y: {
                                title: { display: true, text: 'Month-over-Month Change (%)', color: '#111827' },
                                ticks: {
                                    color: '#111827',
                                    callback: (v) => v + '%'
                                }
                            }
                        }
                    }
                });
            } else {
                m_mom = null;
            }

            // Average Scale by Performance Level
            const perfScaleCanvas = document.getElementById('avgScalePerfChart');
            if (perfScaleCanvas) {
                m_avgScalePerf = new Chart(perfScaleCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: avgScalePerfData.labels,
                        datasets: avgScalePerfData.series.map(s => makeLineDataset(s, perfScaleCanvas))
                    },
                    options: {
                        responsive: true,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 12, weight: '600' } } },
                            datalabels: {
                                display: true,
                                color: function(ctx){ return ctx.dataset.borderColor; },
                                font: { weight: 'bold', size: 11 },
                                formatter: function(value) { return value; },
                                anchor: 'end',
                                align: 'top',
                                offset: 4,
                                backgroundColor: 'rgba(255,255,255,0.85)',
                                borderRadius: 4,
                                padding: { top: 2, bottom: 2, left: 4, right: 4 }
                            }
                        },
                        scales: {
                            x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { color: '#374151', font: { weight: '600' } } },
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Avg Riders per Partner', color: '#111827', font: { weight: '600' } },
                                ticks: { color: '#111827' },
                                grid: { color: 'rgba(0,0,0,0.06)' }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }

            // Average Scale by Size Level
            const sizeScaleCanvas = document.getElementById('avgScaleSizeChart');
            if (sizeScaleCanvas) {
                m_avgScaleSize = new Chart(sizeScaleCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: avgScaleSizeData.labels,
                        datasets: avgScaleSizeData.series.map(s => makeLineDataset(s, sizeScaleCanvas))
                    },
                    options: {
                        responsive: true,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 12, weight: '600' } } },
                            datalabels: {
                                display: true,
                                color: function(ctx){ return ctx.dataset.borderColor; },
                                font: { weight: 'bold', size: 11 },
                                formatter: function(value) { return value; },
                                anchor: 'end',
                                align: 'top',
                                offset: 4,
                                backgroundColor: 'rgba(255,255,255,0.85)',
                                borderRadius: 4,
                                padding: { top: 2, bottom: 2, left: 4, right: 4 }
                            }
                        },
                        scales: {
                            x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { color: '#374151', font: { weight: '600' } } },
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Avg Riders per Partner', color: '#111827', font: { weight: '600' } },
                                ticks: { color: '#111827' },
                                grid: { color: 'rgba(0,0,0,0.06)' }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }

            // Monthly Willing vs Not-Willing Partners
            const willingCanvas = document.getElementById('willingVsNotWillingChart');
            if (willingCanvas) {
                const willingMonths = ['Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
                const willingPartners = [213, 259, 81, 201, 130];
                const notWillingPartners = [356, 381, 554, 413, 398];

                m_willingVsNotWilling = new Chart(willingCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: willingMonths,
                        datasets: [
                            {
                                label: 'Not-Willing (≥0)',
                                data: notWillingPartners,
                                backgroundColor: '#ef4444',
                                borderColor: '#dc2626',
                                borderWidth: 1
                            },
                            {
                                label: 'Willing (>0)',
                                data: willingPartners,
                                backgroundColor: '#10b981',
                                borderColor: '#059669',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            datalabels: {
                                display: true,
                                color: '#fff',
                                font: { weight: 'bold', size: 11 },
                                formatter: function(value) { return value; },
                                anchor: 'center',
                                align: 'center'
                            }
                        },
                        scales: {
                            x: { stacked: true },
                            y: { stacked: true, beginAtZero: true }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }

            // Partner Willingness Trend (%)\n            const trendCanvas = document.getElementById('willingnessTrendChart');\n            if (trendCanvas) {\n                const trendMonths = ['Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];\n                const willingPct = [37.4, 40.5, 12.8, 32.7, 24.6];\n                const notWillingPct = [62.6, 59.5, 87.2, 67.3, 75.4];\n\n                m_willingnessTrend = new Chart(trendCanvas.getContext('2d'), {\n                    type: 'line',\n                    data: {\n                        labels: trendMonths,\n                        datasets: [\n                            {\n                                label: 'Willing %',\n                                data: willingPct,\n                                borderColor: '#10b981',\n                                backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                                borderWidth: 3,\n                                fill: true,\n                                pointRadius: 6,\n                                pointBackgroundColor: '#10b981',\n                                tension: 0.4\n                            },\n                            {\n                                label: 'Not-Willing %',\n                                data: notWillingPct,\n                                borderColor: '#ef4444',\n                                backgroundColor: 'rgba(239, 68, 68, 0.1)',\n                                borderWidth: 3,\n                                fill: true,\n                                pointRadius: 6,\n                                pointBackgroundColor: '#ef4444',\n                                tension: 0.4\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        plugins: {\n                            legend: { position: 'top' },\n                            datalabels: {\n                                display: true,\n                                color: '#111827',\n                                font: { weight: 'bold', size: 10 },\n                                formatter: function(value) { return value.toFixed(1) + '%'; },\n                                anchor: 'end',\n                                align: 'top',\n                                offset: 5\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                max: 100,\n                                title: { display: true, text: 'Percentage (%)', color: '#111827' },\n                                ticks: { color: '#111827', callback: (v) => v + '%' }\n                            }\n                        }\n                    },\n                    plugins: [ChartDataLabels]\n                });\n            }

            // Growth Category Breakdown (Increase Slabs)
            const gcCanvas = document.getElementById('growthCategoryChart');
            if (gcCanvas) {
                const gcMonths = ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
                const gc1_10 = [42, 60, 73, 22, 79, 46];
                const gc10_20 = [63, 60, 75, 23, 58, 52];
                const gc20_30 = [40, 29, 31, 11, 28, 16];
                const gc30plus = [54, 64, 80, 25, 36, 16];
                const gcTotal = [199, 213, 259, 81, 201, 130];

                m_growthCategory = new Chart(gcCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: gcMonths,
                        datasets: [
                            {
                                label: '≥1% - ≤10%',
                                data: gc1_10,
                                backgroundColor: '#3b82f6',
                                borderColor: '#2563eb',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: '>10% - ≤20%',
                                data: gc10_20,
                                backgroundColor: '#10b981',
                                borderColor: '#059669',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: '>20% - ≤30%',
                                data: gc20_30,
                                backgroundColor: '#f59e0b',
                                borderColor: '#d97706',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: '>30%',
                                data: gc30plus,
                                backgroundColor: '#ef4444',
                                borderColor: '#dc2626',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Total Increase Trend',
                                data: gcTotal,
                                type: 'line',
                                borderColor: '#111827',
                                backgroundColor: 'rgba(17, 24, 39, 0)',
                                borderWidth: 3,
                                pointRadius: 6,
                                pointBackgroundColor: '#111827',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                tension: 0.3,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { position: 'top' },
                            datalabels: {
                                display: true,
                                color: '#ffffff',
                                font: { weight: 'bold', size: 11 },
                                formatter: function(value) {
                                    return value;
                                },
                                anchor: 'center',
                                align: 'center',
                                offset: 0
                            }
                        },
                        scales: {
                            x: { stacked: false },
                            y: {
                                stacked: false,
                                beginAtZero: true,
                                title: { display: true, text: 'Partners (Bars)', color: '#111827' },
                                ticks: { color: '#111827' }
                            },
                            y1: {
                                type: 'linear',
                                position: 'right',
                                beginAtZero: true,
                                min: 50,
                                max: 300,
                                title: { display: true, text: 'Total Increase (Line)', color: '#111827' },
                                ticks: { color: '#111827' },
                                grid: { drawOnChartArea: false }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }

            // Growth Category Breakdown (Decrease Slabs)
            const dcCanvas = document.getElementById('decreaseCategoryChart');
            if (dcCanvas) {
                const dcMonths = ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
                const dc1_10 = [17, 39, 40, 52, 64, 84];
                const dc10_20 = [38, 56, 64, 108, 77, 98];
                const dc20_30 = [21, 26, 43, 83, 42, 50];
                const dc30plus = [48, 40, 41, 215, 56, 52];
                const dcTotal = [124, 161, 188, 458, 239, 284];

                m_decreaseCategory = new Chart(dcCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: dcMonths,
                        datasets: [
                            {
                                label: '≥-10% - ≤-1%',
                                data: dc1_10,
                                backgroundColor: '#fcd34d',
                                borderColor: '#f59e0b',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: '>-20% - ≤-11%',
                                data: dc10_20,
                                backgroundColor: '#fed7aa',
                                borderColor: '#f97316',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: '>-30% - ≤-21%',
                                data: dc20_30,
                                backgroundColor: '#fca5a5',
                                borderColor: '#f87171',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: '<-30%',
                                data: dc30plus,
                                backgroundColor: '#dc2626',
                                borderColor: '#991b1b',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Total Decrease Trend',
                                data: dcTotal,
                                type: 'line',
                                borderColor: '#111827',
                                backgroundColor: 'rgba(17, 24, 39, 0)',
                                borderWidth: 3,
                                pointRadius: 6,
                                pointBackgroundColor: '#111827',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                tension: 0.3,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { position: 'top' },
                            datalabels: {
                                display: true,
                                color: function(context) {
                                    return context.datasetIndex === 4 ? '#111827' : '#ffffff';
                                },
                                font: { weight: 'bold', size: 11 },
                                formatter: function(value) {
                                    return value;
                                },
                                anchor: function(context) {
                                    return context.datasetIndex === 4 ? 'end' : 'center';
                                },
                                align: function(context) {
                                    return context.datasetIndex === 4 ? 'top' : 'center';
                                },
                                offset: function(context) {
                                    return context.datasetIndex === 4 ? 4 : 0;
                                }
                            }
                        },
                        scales: {
                            x: { stacked: false },
                            y: {
                                stacked: false,
                                beginAtZero: true,
                                title: { display: true, text: 'Partners (Bars)', color: '#111827' },
                                ticks: { color: '#111827' }
                            },
                            y1: {
                                type: 'linear',
                                position: 'right',
                                beginAtZero: true,
                                min: 0,
                                max: 550,
                                title: { display: true, text: 'Total Decrease (Line)', color: '#111827' },
                                ticks: { color: '#111827' },
                                grid: { drawOnChartArea: false }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }

            window.monthlyCharts = [m_targetTrend, m_avgScale, m_perfMix, m_sizeMix].concat(m_mom ? [m_mom] : []);

            // Default selection
            const sel = document.getElementById('monthSelect');
            if (sel) {
                sel.value = 'Feb-26';
                updateMonthlyView('Feb-26');
            }
        }

        function renderFactorsTable(idx) {
            const body = document.getElementById('monthlyFactorsBody');
            if (!body) return;

            const month = monthlyData.months[idx];
            const active = monthlyData.activePartners[idx];

            // Overall (based on willingness pct)
            const overall = {
                gt10: Math.min(95, monthlyData.willingPct.gt20[idx] * 1.25),  // assumed
                gt20: monthlyData.willingPct.gt20[idx],
                gt30: monthlyData.willingPct.gt30[idx],
                gt40: monthlyData.willingPct.gt40[idx]
            };

            // Performance-level assumed pcts (scaled by env)
            const e = monthlyData.envIdx[idx];
            const perfBase = {
                good:    { gt10: 18, gt20: 12, gt30: 6, gt40: 3 },
                average: { gt10: 10, gt20: 6,  gt30: 3, gt40: 1.5 },
                bad:     { gt10: 4,  gt20: 2,  gt30: 1, gt40: 0.5 }
            };
            const sizeBase = {
                big:   { gt10: 16, gt20: 14, gt30: 8, gt40: 4 },
                mid:   { gt10: 11, gt20: 8,  gt30: 4, gt40: 2 },
                small: { gt10: 8,  gt20: 5,  gt30: 2.5, gt40: 1 }
            };

            function scaledPct(basePct) { return Math.min(95, basePct * e); }

            function rowHtml(label, baseCount, pctObj) {
                const c10 = pctToCount(scaledPct(pctObj.gt10), baseCount);
                const c20 = pctToCount(scaledPct(pctObj.gt20), baseCount);
                const c30 = pctToCount(scaledPct(pctObj.gt30), baseCount);
                const c40 = pctToCount(scaledPct(pctObj.gt40), baseCount);
                return `<tr>
                    <td><strong>${label}</strong></td>
                    <td>${fmtNum(c10)} (${fmtPct((c10/baseCount)*100)})</td>
                    <td>${fmtNum(c20)} (${fmtPct((c20/baseCount)*100)})</td>
                    <td>${fmtNum(c30)} (${fmtPct((c30/baseCount)*100)})</td>
                    <td>${fmtNum(c40)} (${fmtPct((c40/baseCount)*100)})</td>
                </tr>`;
            }

            // Build table
            const overallBase = active || 1;
            const o10 = pctToCount(overall.gt10, overallBase);
            const o20 = pctToCount(overall.gt20, overallBase);
            const o30 = pctToCount(overall.gt30, overallBase);
            const o40 = pctToCount(overall.gt40, overallBase);

            const rows = [];
            rows.push(`<tr>
                <td><strong>Overall (Active)</strong></td>
                <td>${fmtNum(o10)} (${fmtPct((o10/overallBase)*100)})</td>
                <td>${fmtNum(o20)} (${fmtPct((o20/overallBase)*100)})</td>
                <td>${fmtNum(o30)} (${fmtPct((o30/overallBase)*100)})</td>
                <td>${fmtNum(o40)} (${fmtPct((o40/overallBase)*100)})</td>
            </tr>`);

            // Performance groups (use total partners in group)
            rows.push(rowHtml('Good partners', monthlyData.perf.good[idx] || 1, perfBase.good));
            rows.push(rowHtml('Average partners', monthlyData.perf.average[idx] || 1, perfBase.average));
            rows.push(rowHtml('Bad partners', monthlyData.perf.bad[idx] || 1, perfBase.bad));

            // Size groups (use total partners in group)
            rows.push(rowHtml('Big partners', monthlyData.size.big[idx] || 1, sizeBase.big));
            rows.push(rowHtml('Mid partners', monthlyData.size.mid[idx] || 1, sizeBase.mid));
            rows.push(rowHtml('Small partners', monthlyData.size.small[idx] || 1, sizeBase.small));

            body.innerHTML = rows.join('');
        }

        function renderHighlights(idx) {
            const ul = document.getElementById('monthlyHighlights');
            if (!ul) return;

            const month = monthlyData.months[idx];
            const prevIdx = Math.max(0, idx - 1);

            const tp = monthlyData.totalPartners[idx];
            const ap = monthlyData.activePartners[idx];
            const tt = monthlyData.totalTarget[idx];
            const as = monthlyData.avgScale[idx];

            const dTT = prevIdx === idx ? 0 : ((tt - monthlyData.totalTarget[prevIdx]) / monthlyData.totalTarget[prevIdx]) * 100;
            const dAP = prevIdx === idx ? 0 : ((ap - monthlyData.activePartners[prevIdx]) / monthlyData.activePartners[prevIdx]) * 100;
            const dAS = prevIdx === idx ? 0 : (as - monthlyData.avgScale[prevIdx]);

            const goodShare = (monthlyData.perf.good[idx] / tp) * 100;
            const badShare = (monthlyData.perf.bad[idx] / tp) * 100;

            const incAny = pctToCount(monthlyData.willingPct.any[idx], ap);

            const items = [
                `<li><strong>${month}:</strong> Total target ${dTT >= 0 ? 'increased' : 'decreased'} by <strong>${fmtPct(Math.abs(dTT))}</strong> vs previous month.</li>`,
                `<li>Active partners changed by <strong>${fmtPct(Math.abs(dAP))}</strong> (${dAP >= 0 ? 'up' : 'down'}) vs previous month.</li>`,
                `<li>Average scale is <strong>${as.toFixed(1)}</strong> (${dAS >= 0 ? '+' : ''}${dAS.toFixed(1)} vs previous month).</li>`,
                `<li>Performance mix: <strong>${fmtPct(goodShare)}</strong> good, <strong>${fmtPct(badShare)}</strong> bad (by partner count).</li>`,
                `<li>Estimated willingness: <strong>${fmtNum(incAny)}</strong> partners increased their target (any increase).</li>`
            ];

            ul.innerHTML = items.join('');
        }

        function updateMonthlyView(value) {
            if (value === 'Feb-26') {
                const prevLabel = monthlyData.months[monthlyData.months.length - 2];
                const ap = 551;
                const tp = 643;
                const tt = 19365;
                const as = 35.1;
                const anyCnt = 153;
                const c20 = 32;
                const c30 = 16;
                const anyPct = (anyCnt / ap) * 100;
                const c20Pct = (c20 / ap) * 100;
                const c30Pct = (c30 / ap) * 100;

                document.getElementById('m_totalPartners').textContent = fmtNum(tp);
                document.getElementById('m_totalPartners_sub').textContent = `Feb-26 vs ${prevLabel}`;

                document.getElementById('m_activePartners').textContent = fmtNum(ap);
                document.getElementById('m_activePartners_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">↓ ${fmtPct(11.8)} vs ${prevLabel}</span>`;

                document.getElementById('m_totalTarget').textContent = fmtNum(tt);
                document.getElementById('m_totalTarget_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">↓ ${fmtPct(13.8)} vs ${prevLabel}</span>`;

                document.getElementById('m_avgScale').textContent = as.toFixed(1);
                document.getElementById('m_avgScale_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">↓ ${fmtPct(2.2)} vs ${prevLabel}</span>`;

                document.getElementById('m_incAny').textContent = fmtNum(anyCnt);
                document.getElementById('m_incAny_sub').textContent = `${fmtPct(anyPct)} of active partners`;

                document.getElementById('m_inc20').textContent = fmtNum(c20);
                document.getElementById('m_inc20_sub').textContent = `${fmtPct(c20Pct)} of active partners`;

                document.getElementById('m_inc30').textContent = fmtNum(c30);
                document.getElementById('m_inc30_sub').textContent = `${fmtPct(c30Pct)} of active partners`;

                document.getElementById('m_inc40').textContent = fmtPct(-27.8);
                document.getElementById('m_inc40_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">vs ${prevLabel}</span>`;
                return;
            }
            const idx = (value === 'All') ? (monthlyData.months.length - 1) : safeIdx(value);
            const month = monthlyData.months[idx];
            const prevIdx = Math.max(0, idx - 1);

            // KPI: Total partners
            document.getElementById('m_totalPartners').textContent = fmtNum(monthlyData.totalPartners[idx]);
            document.getElementById('m_totalPartners_sub').textContent = (idx === 0) ? month : `${month} vs ${monthlyData.months[prevIdx]}`;

            // KPI: Active partners
            const ap = monthlyData.activePartners[idx];
            const apPrev = monthlyData.activePartners[prevIdx] || ap;
            const apChg = (idx === 0) ? 0 : ((ap - apPrev) / apPrev) * 100;
            document.getElementById('m_activePartners').textContent = fmtNum(ap);
            document.getElementById('m_activePartners_sub').innerHTML = (idx === 0) ? month : `<span style="color: ${apChg >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${apChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(apChg))} vs ${monthlyData.months[prevIdx]}</span>`;

            // KPI: Total target
            const tt = monthlyData.totalTarget[idx];
            const ttPrev = monthlyData.totalTarget[prevIdx] || tt;
            const ttChg = (idx === 0) ? 0 : ((tt - ttPrev) / ttPrev) * 100;
            document.getElementById('m_totalTarget').textContent = fmtNum(tt);
            document.getElementById('m_totalTarget_sub').innerHTML = (idx === 0) ? month : `<span style="color: ${ttChg >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${ttChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(ttChg))} vs ${monthlyData.months[prevIdx]}</span>`;

            // KPI: Avg scale
            const as = monthlyData.avgScale[idx];
            const asPrev = monthlyData.avgScale[prevIdx] || as;
            const asChg = (idx === 0) ? 0 : (as - asPrev);
            document.getElementById('m_avgScale').textContent = as.toFixed(1);
            document.getElementById('m_avgScale_sub').innerHTML = (idx === 0) ? month : `<span style="color: ${asChg >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${asChg >= 0 ? '↑' : '↓'} ${Math.abs(asChg).toFixed(1)} vs ${monthlyData.months[prevIdx]}</span>`;

            // Willingness counts
            const anyPct = monthlyData.willingPct.any[idx];
            const gt20Pct = monthlyData.willingPct.gt20[idx];
            const gt30Pct = monthlyData.willingPct.gt30[idx];
            const gt40Pct = monthlyData.willingPct.gt40[idx];

            const anyCnt = pctToCount(anyPct, ap);
            const c20 = pctToCount(gt20Pct, ap);
            const c30 = pctToCount(gt30Pct, ap);
            const c40 = pctToCount(gt40Pct, ap);

            document.getElementById('m_incAny').textContent = fmtNum(anyCnt);
            document.getElementById('m_incAny_sub').textContent = `${fmtPct(anyPct)} of active partners`;
            document.getElementById('m_inc20').textContent = fmtNum(c20);
            document.getElementById('m_inc20_sub').textContent = `${fmtPct(gt20Pct)} of active partners`;
            document.getElementById('m_inc30').textContent = fmtNum(c30);
            document.getElementById('m_inc30_sub').textContent = `${fmtPct(gt30Pct)} of active partners`;
            // MoM change KPI (partners with increase any)
            const momAny = (monthlyData.willingMoMAny && monthlyData.willingMoMAny[idx] !== null && monthlyData.willingMoMAny[idx] !== undefined)
                ? monthlyData.willingMoMAny[idx]
                : null;

            if (momAny === null || idx === 0) {
                document.getElementById('m_inc40').textContent = '—';
                document.getElementById('m_inc40_sub').textContent = 'Baseline month';
            } else {
                document.getElementById('m_inc40').textContent = `${momAny >= 0 ? '+' : ''}${fmtPct(momAny)}`;
                document.getElementById('m_inc40_sub').innerHTML = `<span style="color: ${momAny >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">vs ${monthlyData.months[prevIdx]}</span>`;
            }

            // Highlight selected month point on trend chart
            function highlightPoint(chart) {
                if (!chart) return;
                chart.data.datasets.forEach(ds => {
                    ds.pointRadius = ds.data.map((_, i) => (i === idx ? 6 : 3));
                });
                chart.update('none');
            }
            highlightPoint(m_targetTrend);

            renderFactorsTable(idx);
            renderHighlights(idx);
        }

        // Initialize monthly tab charts after existing charts are created
        try { initMonthlyCharts(); } catch(e) { console.error(e); }

    </script>
    </div>
    <script>
/* Monthly insights tab - robustness patch (global functions + guaranteed init) */
(function(){
  // If already patched, skip
  if (window.__monthlyInsightsPatched) return;
  window.__monthlyInsightsPatched = true;

  // Source data (Aug–Dec assumed; Jan-26 aligned with current dashboard)
const monthlyData = {
    months: ['Sep-25','Oct-25','Nov-25','Dec-25','Jan-26','Feb-26'],
    totalPartners: [615, 697, 767, 674, 625, 551],
    activePartners: [492, 582, 640, 630, 616, 551],
    activeRiders: [38000, 36000, 34000, 25000, 24000, 24000],
    totalTarget: [32793, 34006, 34837, 24182, 22453, 19365],
    avgScale: [53.3, 48.8, 45.4, 35.9, 35.9, 35.1],
    perf: {
      good:    [160, 190, 205, 223, 269, 252],
      average: [207, 249, 275, 285, 274, 262],
      bad:     [125, 143, 160, 122, 73, 20]
    },
    size: {
      big:   [59, 74, 82, 87, 81, 77],
      mid:   [262, 322, 339, 335, 275, 282],
      small: [171, 186, 219, 208, 260, 175]
    },
    willingPct: {
      any:  [68.1, 62.0, 48.9, 50.3, 17.8, 33.92],
      gt20: [40.7, 15.3, 13.3, 14.5, 5.3, 10.24],
      gt30: [30.1, 8.8, 9.2, 10.4, 3.7, 5.76],
      gt40: [9, 8, 7, 6, 4, 3]
    },
    willingMoMAny: [null, 14, -10, 13, -69, 91],
    envIdx: [1.55, 1.45, 1.35, 1.25, 0.85, 0.55]
  };

    const avgScalePerfData = {
        labels: ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'],
        series: [
            { label: 'Good', values: [70.2, 58.3, 55.7, 49.4, 45.9, 40.4], color: '#10b981', border: '#059669' },
            { label: 'Average', values: [62.3, 58.6, 51.5, 32.5, 30.4, 32.1], color: '#f59e0b', border: '#d97706' },
            { label: 'Bad', values: [40.7, 38.5, 40.3, 23.6, 21.0, 18.5], color: '#ef4444', border: '#dc2626' }
        ]
    };

    const avgScaleSizeData = {
        labels: ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'],
        series: [
            { label: 'Big', values: [122.0, 106.8, 105.4, 77.5, 61.0, 69.5], color: '#3b82f6', border: '#2563eb' },
            { label: 'Mid', values: [61.0, 55.0, 50.9, 36.9, 38.5, 35.4], color: '#8b5cf6', border: '#7c3aed' },
            { label: 'Small', values: [35.3, 29.9, 28.0, 19.5, 25.7, 20.8], color: '#06b6d4', border: '#0891b2' }
        ]
    };

  function fmtNum(n){
    try { return Number(n).toLocaleString('en-US'); } catch(e){ return String(n); }
  }
  function fmtPct(v){
    const x = Number(v);
    if (!isFinite(x)) return '0%';
    return x.toFixed(1) + '%';
  }
  function safeIdx(value){
    const idx = monthlyData.months.indexOf(value);
    return idx >= 0 ? idx : (monthlyData.months.length - 1);
  }
  function pctToCount(pct, base){
    return Math.max(0, Math.round((Number(pct) / 100) * Number(base)));
  }

    function renderAvgScalePanel(panelId, data, index, labelPrefix){
        const panel = document.getElementById(panelId);
        if (!panel) return;
        if (index === null || index === undefined || index < 0) {
            panel.innerHTML = '<div class="chart-info-empty">Hover a month to see details.</div>';
            return;
        }
        const monthLabel = data.labels[index];
        const rows = data.series.map(s => (
            `<div class="chart-info-row">
                <div class="chart-info-left">
                    <span class="chart-info-dot" style="background: ${s.color}"></span>
                    <span class="chart-info-name">${s.label}</span>
                </div>
                <span class="chart-info-value">${s.values[index]}</span>
            </div>`
        )).join('');
        panel.innerHTML = `<div class="chart-info-title">${labelPrefix}: ${monthLabel}</div>${rows}`;
    }

    function makeLineDataset(s, ctx){
        const canvas = ctx ? ctx.canvas : null;
        return {
            label: s.label,
            data: s.values.slice(),
            borderColor: s.border,
            backgroundColor: (function(){
                if (!canvas) return s.color + '20';
                var g = canvas.getContext('2d').createLinearGradient(0, 0, 0, canvas.height || 300);
                g.addColorStop(0, s.color + '35');
                g.addColorStop(1, s.color + '05');
                return g;
            })(),
            fill: true,
            tension: 0.4,
            borderWidth: 3,
            pointRadius: 5,
            pointHoverRadius: 8,
            pointBackgroundColor: '#fff',
            pointBorderColor: s.border,
            pointBorderWidth: 2.5,
            pointHoverBackgroundColor: s.color,
            pointHoverBorderColor: '#fff',
            pointHoverBorderWidth: 3
        };
    }

    function applyAvgScaleHighlight(chart, dataIndex, chartIndex){
        if (!chart || dataIndex === null || dataIndex === undefined || dataIndex < 0) return;
        chart.$selectedIndex = dataIndex;
        chart.data.datasets.forEach((ds, i) => {
            const s = (chart === m_avgScalePerf ? avgScalePerfData : avgScaleSizeData).series[i];
            if (!s) return;
            const pointBg = ds.data.map((_, j) => j === dataIndex ? s.color : '#fff');
            const pointR = ds.data.map((_, j) => j === dataIndex ? 8 : 5);
            const pointBW = ds.data.map((_, j) => j === dataIndex ? 3 : 2.5);
            ds.pointBackgroundColor = pointBg;
            ds.pointRadius = pointR;
            ds.pointBorderWidth = pointBW;
        });
        chart.update('none');
    }

    function applyAvgScaleTrend(chart, data, monthLabel){
        chart.data.labels = data.labels.slice();
        const ctx = chart.canvas ? chart.canvas.getContext('2d') : null;
        chart.data.datasets = data.series.map(s => makeLineDataset(s, chart.canvas ? { canvas: chart.canvas } : null));
        const idx = data.labels.indexOf(monthLabel);
        if (idx >= 0) {
            applyAvgScaleHighlight(chart, idx);
            renderAvgScalePanel(chart.$panelId, data, idx, 'Selected month');
        }
        chart.$view = 'trend';
        chart.update('none');
    }

    function applyAvgScaleComparison(chart, data, monthLabel){
        const idx = data.labels.indexOf(monthLabel);
        if (idx < 0) return;
        const prevIdx = Math.max(0, idx - 1);
        const labels = (idx === 0)
            ? [data.labels[idx]]
            : [data.labels[prevIdx], data.labels[idx]];

        chart.data.labels = labels;
        chart.data.datasets = data.series.map(s => {
            const ds = makeLineDataset(s, chart.canvas ? { canvas: chart.canvas } : null);
            ds.data = (idx === 0)
                ? [s.values[idx]]
                : [s.values[prevIdx], s.values[idx]];
            return ds;
        });
        const chartIndex = (labels.length - 1);
        applyAvgScaleHighlight(chart, idx, chartIndex);
        renderAvgScalePanel(chart.$panelId, data, idx, 'Selected month');
        chart.$view = 'comparison';
        chart.update('none');
    }

    function syncAvgScaleSelection(monthLabel){
        if (m_avgScalePerf) {
            if (m_avgScalePerf.$view === 'comparison') {
                applyAvgScaleComparison(m_avgScalePerf, avgScalePerfData, monthLabel);
            } else {
                applyAvgScaleTrend(m_avgScalePerf, avgScalePerfData, monthLabel);
            }
        }
        if (m_avgScaleSize) {
            if (m_avgScaleSize.$view === 'comparison') {
                applyAvgScaleComparison(m_avgScaleSize, avgScaleSizeData, monthLabel);
            } else {
                applyAvgScaleTrend(m_avgScaleSize, avgScaleSizeData, monthLabel);
            }
        }
    }

    const hoverLinePlugin = {
        id: 'hoverLine',
        afterDraw(chart, args, opts) {
            if (!chart.tooltip || !chart.tooltip.getActiveElements().length) return;
            const ctx = chart.ctx;
            const x = chart.tooltip.getActiveElements()[0].element.x;
            const topY = chart.chartArea.top;
            const bottomY = chart.chartArea.bottom;
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(x, topY);
            ctx.lineTo(x, bottomY);
            ctx.lineWidth = 1;
            ctx.strokeStyle = (opts && opts.color) ? opts.color : 'rgba(30, 64, 175, 0.25)';
            ctx.stroke();
            ctx.restore();
        }
    };

    function makeAvgScaleTooltip(panelId, data){
        return function(context){
            const tooltip = context.tooltip;
            const chart = context.chart;
            if (!tooltip || tooltip.opacity === 0) {
                if (chart && chart.$selectedIndex !== undefined) {
                    renderAvgScalePanel(panelId, data, chart.$selectedIndex, 'Selected month');
                } else {
                    renderAvgScalePanel(panelId, data, -1, 'Selected month');
                }
                return;
            }
            const chartLabel = (tooltip.dataPoints && tooltip.dataPoints.length) ? tooltip.dataPoints[0].label : null;
            const idx = chartLabel ? data.labels.indexOf(chartLabel) : -1;
            renderAvgScalePanel(panelId, data, idx, 'Hover');
        };
    }

    function setAvgScaleView(target, view){
        const sel = document.getElementById('monthSelect');
        const monthLabel = (sel && sel.value && sel.value !== 'All')
            ? sel.value
            : monthlyData.months[monthlyData.months.length - 1];

        if (target === 'perf' && m_avgScalePerf) {
            m_avgScalePerf.$panelId = 'avgScalePerfInfo';
            if (view === 'comparison') applyAvgScaleComparison(m_avgScalePerf, avgScalePerfData, monthLabel);
            else applyAvgScaleTrend(m_avgScalePerf, avgScalePerfData, monthLabel);
        }
        if (target === 'size' && m_avgScaleSize) {
            m_avgScaleSize.$panelId = 'avgScaleSizeInfo';
            if (view === 'comparison') applyAvgScaleComparison(m_avgScaleSize, avgScaleSizeData, monthLabel);
            else applyAvgScaleTrend(m_avgScaleSize, avgScaleSizeData, monthLabel);
        }
    }

    let avgScaleToggleInited = false;
    function setupAvgScaleToggle(toggleId, target){
        const wrap = document.getElementById(toggleId);
        if (!wrap) return;
        const btns = Array.from(wrap.querySelectorAll('button'));
        btns.forEach(btn => {
            btn.addEventListener('click', () => {
                btns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                setAvgScaleView(target, btn.dataset.view);
            });
        });
    }

  // Chart instances
  let m_targetTrend, m_avgScale, m_perfMix, m_sizeMix, m_mom;
  let chartsInited = false;

  function renderFactorsTable(idx){
    const body = document.getElementById('monthlyFactorsBody');
    if (!body) return;

    const active = monthlyData.activePartners[idx];

    const overall = {
      gt10: Math.min(95, monthlyData.willingPct.gt20[idx] * 1.25),  // assumed
      gt20: monthlyData.willingPct.gt20[idx],
      gt30: monthlyData.willingPct.gt30[idx],
      gt40: monthlyData.willingPct.gt40[idx]
    };

    const e = monthlyData.envIdx[idx];
    const perfBase = {
      good:    {gt10: overall.gt10 * (1.05*e), gt20: overall.gt20*(1.05*e), gt30: overall.gt30*(1.10*e), gt40: overall.gt40*(1.15*e)},
      average: {gt10: overall.gt10 * (0.95*e), gt20: overall.gt20*(0.95*e), gt30: overall.gt30*(0.90*e), gt40: overall.gt40*(0.85*e)},
      bad:     {gt10: overall.gt10 * (0.70*e), gt20: overall.gt20*(0.70*e), gt30: overall.gt30*(0.60*e), gt40: overall.gt40*(0.55*e)}
    };
    const sizeBase = {
      big:   {gt10: overall.gt10*(1.15*e), gt20: overall.gt20*(1.20*e), gt30: overall.gt30*(1.25*e), gt40: overall.gt40*(1.30*e)},
      mid:   {gt10: overall.gt10*(1.00*e), gt20: overall.gt20*(1.00*e), gt30: overall.gt30*(1.00*e), gt40: overall.gt40*(1.00*e)},
      small: {gt10: overall.gt10*(0.80*e), gt20: overall.gt20*(0.75*e), gt30: overall.gt30*(0.70*e), gt40: overall.gt40*(0.65*e)}
    };

    function rowHtml(label, baseN, pctObj){
      const base = Math.max(1, Math.round(baseN));
      const c10 = pctToCount(pctObj.gt10, base);
      const c20 = pctToCount(pctObj.gt20, base);
      const c30 = pctToCount(pctObj.gt30, base);
      const c40 = pctToCount(pctObj.gt40, base);
      return `
        <tr>
          <td style="font-weight: 600;">${label}</td>
          <td>${fmtNum(c10)} (${fmtPct((c10/base)*100)})</td>
          <td>${fmtNum(c20)} (${fmtPct((c20/base)*100)})</td>
          <td>${fmtNum(c30)} (${fmtPct((c30/base)*100)})</td>
          <td>${fmtNum(c40)} (${fmtPct((c40/base)*100)})</td>
        </tr>`;
    }

    const overallBase = active || 1;
    const o10 = pctToCount(overall.gt10, overallBase);
    const o20 = pctToCount(overall.gt20, overallBase);
    const o30 = pctToCount(overall.gt30, overallBase);
    const o40 = pctToCount(overall.gt40, overallBase);

    const rows = [];
    rows.push(`
      <tr>
        <td style="font-weight: 700;">Overall (active partners)</td>
        <td>${fmtNum(o10)} (${fmtPct((o10/overallBase)*100)})</td>
        <td>${fmtNum(o20)} (${fmtPct((o20/overallBase)*100)})</td>
        <td>${fmtNum(o30)} (${fmtPct((o30/overallBase)*100)})</td>
        <td>${fmtNum(o40)} (${fmtPct((o40/overallBase)*100)})</td>
      </tr>`);

    rows.push(rowHtml('Good partners', monthlyData.perf.good[idx] || 1, perfBase.good));
    rows.push(rowHtml('Average partners', monthlyData.perf.average[idx] || 1, perfBase.average));
    rows.push(rowHtml('Bad partners', monthlyData.perf.bad[idx] || 1, perfBase.bad));

    rows.push(rowHtml('Big partners', monthlyData.size.big[idx] || 1, sizeBase.big));
    rows.push(rowHtml('Mid partners', monthlyData.size.mid[idx] || 1, sizeBase.mid));
    rows.push(rowHtml('Small partners', monthlyData.size.small[idx] || 1, sizeBase.small));

    body.innerHTML = rows.join('');
  }


  function renderHighlights(idx){
    const ul = document.getElementById('monthlyHighlights');
    if (!ul) return;

    const month = monthlyData.months[idx];
    const tp = monthlyData.totalPartners[idx];
    const ap = monthlyData.activePartners[idx];
    const tt = monthlyData.totalTarget[idx];
    const as = monthlyData.avgScale[idx];

    const prevIdx = Math.max(0, idx - 1);
    const ttPrev = monthlyData.totalTarget[prevIdx] || tt;
    const apPrev = monthlyData.activePartners[prevIdx] || ap;
    const asPrev = monthlyData.avgScale[prevIdx] || as;

    const ttChg = (idx === 0) ? 0 : ((tt - ttPrev) / ttPrev) * 100;
    const apChg = (idx === 0) ? 0 : ((ap - apPrev) / apPrev) * 100;
    const asChg = (idx === 0) ? 0 : ((as - asPrev) / asPrev) * 100;

    const anyPct = monthlyData.willingPct.any[idx];
    const goodShare = (monthlyData.perf.good[idx] / tp) * 100;
    const badShare = (monthlyData.perf.bad[idx] / tp) * 100;

    const bullets = [
      `<strong>${month}:</strong> Total target ${fmtNum(tt)} (${ttChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(ttChg))} vs prior month).`,
      `Active partners ${fmtNum(ap)} (${apChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(apChg))}); average scale ${as.toFixed(1)} (${asChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(asChg))}).`,
      `Performance mix: Good ${fmtNum(monthlyData.perf.good[idx])} (${fmtPct(goodShare)}), Bad ${fmtNum(monthlyData.perf.bad[idx])} (${fmtPct(badShare)}).`,
      `Partner willingness: ${fmtPct(anyPct)} of active partners show target-increase intent (assumed for Aug–Dec).`
    ];

    ul.innerHTML = bullets.map(b => `<li>${b}</li>`).join('');
  }

  function updateMonthlyView(value){
        if (value === 'Feb-26') {
            const prevLabel = monthlyData.months[monthlyData.months.length - 2];
            const ap = 551;
            const tp = 643;
            const tt = 19365;
            const as = 35.1;
            const anyCnt = 153;
            const c20 = 32;
            const c30 = 16;
            const anyPct = (anyCnt / ap) * 100;
            const c20Pct = (c20 / ap) * 100;
            const c30Pct = (c30 / ap) * 100;

            document.getElementById('m_totalPartners').textContent = fmtNum(tp);
            document.getElementById('m_totalPartners_sub').textContent = `Feb-26 vs ${prevLabel}`;

            document.getElementById('m_activePartners').textContent = fmtNum(ap);
            document.getElementById('m_activePartners_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">↓ ${fmtPct(11.8)} vs ${prevLabel}</span>`;

            document.getElementById('m_totalTarget').textContent = fmtNum(tt);
            document.getElementById('m_totalTarget_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">↓ ${fmtPct(13.8)} vs ${prevLabel}</span>`;

            document.getElementById('m_avgScale').textContent = as.toFixed(1);
            document.getElementById('m_avgScale_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">↓ ${fmtPct(2.2)} vs ${prevLabel}</span>`;

            document.getElementById('m_incAny').textContent = fmtNum(anyCnt);
            document.getElementById('m_incAny_sub').textContent = `${fmtPct(anyPct)} of active partners`;

            document.getElementById('m_inc20').textContent = fmtNum(c20);
            document.getElementById('m_inc20_sub').textContent = `${fmtPct(c20Pct)} of active partners`;

            document.getElementById('m_inc30').textContent = fmtNum(c30);
            document.getElementById('m_inc30_sub').textContent = `${fmtPct(c30Pct)} of active partners`;

            document.getElementById('m_inc40').textContent = fmtPct(-27.8);
            document.getElementById('m_inc40_sub').innerHTML = `<span style="color: #dc2626; font-weight: 600;">vs ${prevLabel}</span>`;
            return;
        }
    const idx = (value === 'All') ? (monthlyData.months.length - 1) : safeIdx(value);
    const month = monthlyData.months[idx];
    const prevIdx = Math.max(0, idx - 1);

    // KPI: Total partners
    const tp = monthlyData.totalPartners[idx];
    document.getElementById('m_totalPartners').textContent = fmtNum(tp);
    document.getElementById('m_totalPartners_sub').textContent = (idx === 0) ? month : `${month} vs ${monthlyData.months[prevIdx]}`;

    // KPI: Active partners
    const ap = monthlyData.activePartners[idx];
    const apPrev = monthlyData.activePartners[prevIdx] || ap;
    const apChg = (idx === 0) ? 0 : ((ap - apPrev) / apPrev) * 100;
    document.getElementById('m_activePartners').textContent = fmtNum(ap);
    document.getElementById('m_activePartners_sub').innerHTML = `<span style="color: ${apChg >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${apChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(apChg))} vs ${monthlyData.months[prevIdx]}</span>`;

    // KPI: Total target
    const tt = monthlyData.totalTarget[idx];
    const ttPrev = monthlyData.totalTarget[prevIdx] || tt;
    const ttChg = (idx === 0) ? 0 : ((tt - ttPrev) / ttPrev) * 100;
    document.getElementById('m_totalTarget').textContent = fmtNum(tt);
    document.getElementById('m_totalTarget_sub').innerHTML = `<span style="color: ${ttChg >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${ttChg >= 0 ? '↑' : '↓'} ${fmtPct(Math.abs(ttChg))} vs ${monthlyData.months[prevIdx]}</span>`;

    // KPI: Avg scale
    const as = monthlyData.avgScale[idx];
    const asPrev = monthlyData.avgScale[prevIdx] || as;
    const asChg = (idx === 0) ? 0 : ((as - asPrev) / asPrev) * 100;
    document.getElementById('m_avgScale').textContent = as.toFixed(1);
    document.getElementById('m_avgScale_sub').innerHTML = `<span style="color: ${asChg >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${asChg >= 0 ? '↑' : '↓'} ${Math.abs(asChg).toFixed(1)}% vs ${monthlyData.months[prevIdx]}</span>`;

    // Willingness KPIs (use active partners as base)
    const anyPct = monthlyData.willingPct.any[idx];
    const gt20Pct = monthlyData.willingPct.gt20[idx];
    const gt30Pct = monthlyData.willingPct.gt30[idx];
    const gt40Pct = monthlyData.willingPct.gt40[idx];

    const anyCnt = pctToCount(anyPct, ap);
    const c20 = pctToCount(gt20Pct, ap);
    const c30 = pctToCount(gt30Pct, ap);
    const c40 = pctToCount(gt40Pct, ap);

    document.getElementById('m_incAny').textContent = fmtNum(anyCnt);
    document.getElementById('m_incAny_sub').textContent = `${fmtPct(anyPct)} of active partners`;

    document.getElementById('m_inc20').textContent = fmtNum(c20);
    document.getElementById('m_inc20_sub').textContent = `${fmtPct(gt20Pct)} of active partners`;

    document.getElementById('m_inc30').textContent = fmtNum(c30);
    document.getElementById('m_inc30_sub').textContent = `${fmtPct(gt30Pct)} of active partners`;

    // MoM change KPI (partners with increase any)
    const momAny = (monthlyData.willingMoMAny && monthlyData.willingMoMAny[idx] !== null && monthlyData.willingMoMAny[idx] !== undefined)
      ? monthlyData.willingMoMAny[idx]
      : null;

    if (momAny === null || idx === 0) {
      document.getElementById('m_inc40').textContent = '—';
      document.getElementById('m_inc40_sub').textContent = 'Baseline month';
    } else {
      document.getElementById('m_inc40').textContent = `${momAny >= 0 ? '+' : ''}${Math.round(momAny)}%`;
    document.getElementById('m_inc40_sub').innerHTML = `<span style="color: ${momAny >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">vs ${monthlyData.months[prevIdx]}</span>`;
    }

    // Update charts if initialized
    function highlightPoint(chart){
      if (!chart) return;
      chart.data.datasets.forEach(ds => {
        if (Array.isArray(ds.data)) {
          ds.pointRadius = ds.data.map((_, i) => (i === idx ? 6 : 3));
        }
      });
      try { chart.update('none'); } catch(e) {}
    }
    highlightPoint(m_targetTrend);
        syncAvgScaleSelection(month);

    renderFactorsTable(idx);
    renderHighlights(idx);
  }

  function changeMonth(step){
    const sel = document.getElementById('monthSelect');
    if (!sel) return;

    if (sel.value === 'All') {
      sel.value = monthlyData.months[monthlyData.months.length - 1];
    }
    const idx = safeIdx(sel.value);
    const next = Math.min(Math.max(idx + step, 0), monthlyData.months.length - 1);
    sel.value = monthlyData.months[next];
    updateMonthlyView(sel.value);
  }

  function initMonthlyCharts(){
    if (chartsInited) return;
    const t1 = document.getElementById('monthlyTargetTrendChart');
    if (!t1) return;

    chartsInited = true;
    const months = monthlyData.months.slice();
    const trendMonths = months;
    const trendTotalTarget = monthlyData.totalTarget.slice();
    const trendTotalPartners = monthlyData.totalPartners.slice();

    // Charts are optional (if Chart.js fails to load, keep KPIs & tables working)
    if (typeof Chart === 'undefined') return;

    m_targetTrend = new Chart(t1.getContext('2d'), {
      type: 'line',
      data: {
        labels: trendMonths,
        datasets: [
          {
            label: 'Total Target',
            data: trendTotalTarget,
            tension: 0.4,
            borderColor: '#2563eb',
            backgroundColor: (function(){
              var g = t1.getContext('2d').createLinearGradient(0, 0, 0, t1.height || 300);
              g.addColorStop(0, 'rgba(59, 130, 246, 0.30)');
              g.addColorStop(1, 'rgba(59, 130, 246, 0.02)');
              return g;
            })(),
            fill: true,
            pointRadius: 6,
            pointHoverRadius: 10,
            pointBackgroundColor: '#fff',
            pointBorderColor: '#2563eb',
            pointBorderWidth: 2.5,
            pointHoverBackgroundColor: '#3b82f6',
            pointHoverBorderColor: '#fff',
            pointHoverBorderWidth: 3,
            borderWidth: 3,
            yAxisID: 'y'
          },
          {
            label: 'Total Partners',
            data: trendTotalPartners,
            tension: 0.4,
            borderColor: '#059669',
            backgroundColor: (function(){
              var g = t1.getContext('2d').createLinearGradient(0, 0, 0, t1.height || 300);
              g.addColorStop(0, 'rgba(16, 185, 129, 0.25)');
              g.addColorStop(1, 'rgba(16, 185, 129, 0.02)');
              return g;
            })(),
            fill: true,
            pointRadius: 6,
            pointHoverRadius: 10,
            pointBackgroundColor: '#fff',
            pointBorderColor: '#059669',
            pointBorderWidth: 2.5,
            pointHoverBackgroundColor: '#10b981',
            pointHoverBorderColor: '#fff',
            pointHoverBorderWidth: 3,
            borderWidth: 3,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        layout: { padding: { top: 35, right: 15, left: 5 } },
        interaction: { mode: 'index', intersect: false },
        plugins: {
          legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 12, weight: '600' } } },
          datalabels: {
            display: true,
            font: { weight: 'bold', size: 10 },
            anchor: 'end',
            offset: 6,
            backgroundColor: 'rgba(255,255,255,0.92)',
            borderRadius: 6,
            padding: { top: 2, bottom: 2, left: 5, right: 5 },
            clamp: true,
            clip: false,
            align: function(context) {
              // Stagger: Total Target labels on top, Total Partners labels on bottom
              return context.datasetIndex === 0 ? 'top' : 'bottom';
            },
            formatter: function(value, context) {
              const idx = context.dataIndex;
              const dsIdx = context.datasetIndex;
              const arr = dsIdx === 0 ? trendTotalTarget : trendTotalPartners;
              if (idx === 0) return value.toLocaleString();
              const prev = arr[idx - 1];
              const mom = ((value - prev) / prev * 100);
              const sign = mom >= 0 ? '+' : '';
              return value.toLocaleString() + ' (' + sign + mom.toFixed(1) + '%)';
            },
            color: function(context) {
              const idx = context.dataIndex;
              const dsIdx = context.datasetIndex;
              const arr = dsIdx === 0 ? trendTotalTarget : trendTotalPartners;
              if (idx === 0) return dsIdx === 0 ? '#2563eb' : '#059669';
              const mom = ((arr[idx] - arr[idx-1]) / arr[idx-1] * 100);
              return mom >= 0 ? '#16a34a' : '#dc2626';
            }
          },
          tooltip: {
            enabled: false,
            external: function(context) {
              const tooltip = context.tooltip;
              const panel = document.getElementById('targetTrendInfo');
              if (!panel) return;
              if (!tooltip || tooltip.opacity === 0) {
                panel.innerHTML = 'Hover a month to see details.';
                return;
              }
              const idx = tooltip.dataPoints[0].dataIndex;
              const month = trendMonths[idx];
              const target = trendTotalTarget[idx];
              const partners = trendTotalPartners[idx];
              let html = '<div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">';
              html += '<span style="font-weight:700;font-size:14px;color:#1e40af;">\ud83d\udcc5 ' + month + '</span>';
              html += '<span style="font-size:12px;">Target: <b style="color:#2563eb;">' + target.toLocaleString() + '</b></span>';
              html += '<span style="font-size:12px;">Partners: <b style="color:#059669;">' + partners.toLocaleString() + '</b></span>';
              if (idx > 0) {
                const tMom = ((target - trendTotalTarget[idx-1]) / trendTotalTarget[idx-1] * 100);
                const pMom = ((partners - trendTotalPartners[idx-1]) / trendTotalPartners[idx-1] * 100);
                const tSign = tMom >= 0 ? '+' : '';
                const pSign = pMom >= 0 ? '+' : '';
                const tColor = tMom >= 0 ? '#16a34a' : '#dc2626';
                const pColor = pMom >= 0 ? '#16a34a' : '#dc2626';
                const tBg = tMom >= 0 ? '#dcfce7' : '#fee2e2';
                const pBg = pMom >= 0 ? '#dcfce7' : '#fee2e2';
                const tArrow = tMom >= 0 ? '\u2191' : '\u2193';
                const pArrow = pMom >= 0 ? '\u2191' : '\u2193';
                html += '<span style="background:' + tBg + ';color:' + tColor + ';padding:3px 8px;border-radius:4px;font-weight:700;font-size:11px;">' + tArrow + ' Target MoM: ' + tSign + tMom.toFixed(1) + '%</span>';
                html += '<span style="background:' + pBg + ';color:' + pColor + ';padding:3px 8px;border-radius:4px;font-weight:700;font-size:11px;">' + pArrow + ' Partners MoM: ' + pSign + pMom.toFixed(1) + '%</span>';
              } else {
                html += '<span style="background:#e0f2fe;color:#1e40af;padding:3px 8px;border-radius:4px;font-weight:600;font-size:11px;">Baseline</span>';
              }
              html += '</div>';
              panel.innerHTML = html;
            }
          },
          hoverLine: { color: 'rgba(37, 99, 235, 0.2)' }
        },
        scales: {
          x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { color: '#374151', font: { weight: '600' } } },
          y: {
            type: 'linear',
            position: 'left',
            beginAtZero: false,
            min: 18000,
            max: 38000,
            title: { display: true, text: 'Total Target', color: '#2563eb', font: { weight: 'bold' } },
            ticks: { color: '#2563eb' },
            grid: { color: 'rgba(59, 130, 246, 0.08)' }
          },
          y1: {
            type: 'linear',
            position: 'right',
            beginAtZero: false,
            min: 400,
            max: 900,
            title: { display: true, text: 'Total Partners', color: '#059669', font: { weight: 'bold' } },
            ticks: { color: '#059669' },
            grid: { drawOnChartArea: false }
          }
        }
      },
      plugins: [ChartDataLabels, hoverLinePlugin]
    });

    // Advanced Average Scale Overview Chart with MoM%
    const avgScaleOverviewCanvas = document.getElementById('monthlyAvgScaleChart');
    if (avgScaleOverviewCanvas) {
      const avgScaleValues = monthlyData.avgScale.slice();
      const avgScaleMoM = avgScaleValues.map((v, i) => i === 0 ? null : ((v - avgScaleValues[i-1]) / avgScaleValues[i-1] * 100));
      const avgScaleCtx = avgScaleOverviewCanvas.getContext('2d');
      const avgScaleGrad = avgScaleCtx.createLinearGradient(0, 0, 0, avgScaleOverviewCanvas.height || 300);
      avgScaleGrad.addColorStop(0, 'rgba(139, 92, 246, 0.35)');
      avgScaleGrad.addColorStop(1, 'rgba(139, 92, 246, 0.03)');

      m_avgScale = new Chart(avgScaleCtx, {
        type: 'line',
        data: {
          labels: months,
          datasets: [{
            label: 'Avg Scale (riders/partner)',
            data: avgScaleValues,
            borderColor: '#7c3aed',
            backgroundColor: avgScaleGrad,
            fill: true,
            tension: 0.4,
            borderWidth: 3,
            pointRadius: 6,
            pointHoverRadius: 10,
            pointBackgroundColor: '#fff',
            pointBorderColor: '#7c3aed',
            pointBorderWidth: 2.5,
            pointHoverBackgroundColor: '#8b5cf6',
            pointHoverBorderColor: '#fff',
            pointHoverBorderWidth: 3
          }]
        },
        options: {
          responsive: true,
          layout: { padding: { top: 30, right: 20, left: 10 } },
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 12, weight: '600' } } },
            datalabels: {
              display: true,
              font: { weight: 'bold', size: 11 },
              anchor: 'end',
              align: function(context) {
                return context.dataIndex === 0 ? 'right' : 'top';
              },
              offset: 6,
              backgroundColor: 'rgba(255,255,255,0.92)',
              borderRadius: 6,
              padding: { top: 3, bottom: 3, left: 6, right: 6 },
              clamp: true,
              clip: false,
              formatter: function(value, context) {
                const idx = context.dataIndex;
                if (idx === 0) return value.toFixed(1);
                const mom = avgScaleMoM[idx];
                const sign = mom >= 0 ? '+' : '';
                return value.toFixed(1) + '  (' + sign + mom.toFixed(1) + '%)';
              },
              color: function(context) {
                const idx = context.dataIndex;
                if (idx === 0) return '#7c3aed';
                const mom = avgScaleMoM[idx];
                return mom >= 0 ? '#16a34a' : '#dc2626';
              }
            },
            tooltip: {
              enabled: false,
              external: function(context) {
                const tooltip = context.tooltip;
                const panel = document.getElementById('avgScaleOverviewInfo');
                if (!panel) return;
                if (!tooltip || tooltip.opacity === 0) {
                  panel.innerHTML = 'Hover a month to see details.';
                  return;
                }
                const idx = tooltip.dataPoints[0].dataIndex;
                const val = avgScaleValues[idx];
                const month = months[idx];
                let html = '<div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">';
                html += '<span style="font-weight:700;font-size:14px;color:#7c3aed;">📅 ' + month + '</span>';
                html += '<span style="font-size:13px;">Avg Scale: <b style="color:#7c3aed;">' + val.toFixed(1) + '</b> riders/partner</span>';
                if (idx > 0) {
                  const mom = avgScaleMoM[idx];
                  const sign = mom >= 0 ? '+' : '';
                  const momColor = mom >= 0 ? '#16a34a' : '#dc2626';
                  const momBg = mom >= 0 ? '#dcfce7' : '#fee2e2';
                  const arrow = mom >= 0 ? '↑' : '↓';
                  html += '<span style="background:' + momBg + ';color:' + momColor + ';padding:3px 8px;border-radius:4px;font-weight:700;font-size:12px;">' + arrow + ' MoM: ' + sign + mom.toFixed(1) + '%</span>';
                  const diff = (val - avgScaleValues[idx-1]).toFixed(1);
                  html += '<span style="font-size:12px;color:#6b7280;">(' + (diff >= 0 ? '+' : '') + diff + ' vs ' + months[idx-1] + ')</span>';
                } else {
                  html += '<span style="background:#f3e8ff;color:#7c3aed;padding:3px 8px;border-radius:4px;font-weight:600;font-size:12px;">Baseline</span>';
                }
                html += '</div>';
                panel.innerHTML = html;
              }
            },
            hoverLine: { color: 'rgba(124, 58, 237, 0.25)' }
          },
          scales: {
            x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { color: '#374151', font: { weight: '600' } } },
            y: {
              beginAtZero: false,
              title: { display: true, text: 'Avg Riders per Partner', color: '#111827', font: { weight: '600' } },
              ticks: { color: '#111827' },
              grid: { color: 'rgba(0,0,0,0.06)' }
            }
          }
        },
        plugins: [ChartDataLabels, hoverLinePlugin]
      });
    }

    m_perfMix = new Chart(document.getElementById('monthlyPerformanceMixChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [
          { label: 'Good', data: monthlyData.perf.good.slice(), stack: 'p', backgroundColor: '#10b981', yAxisID: 'y' },
          { label: 'Average', data: monthlyData.perf.average.slice(), stack: 'p', backgroundColor: '#f59e0b', yAxisID: 'y' },
          { label: 'Bad', data: monthlyData.perf.bad.slice(), stack: 'p', backgroundColor: '#ef4444', yAxisID: 'y' },
          {
            label: 'Total Partners Trend',
            data: monthlyData.perf.good.map((v, i) => v + monthlyData.perf.average[i] + monthlyData.perf.bad[i]),
            type: 'line',
            borderColor: '#000',
            backgroundColor: 'transparent',
            borderWidth: 4,
            pointRadius: 8,
            pointBackgroundColor: '#000',
            pointBorderColor: '#fff',
            pointBorderWidth: 3,
            yAxisID: 'y1',
            tension: 0.3,
            datalabels: {
              display: true,
              color: '#000',
              font: { weight: 'bold', size: 9 },
              formatter: (value) => value.toLocaleString(),
              anchor: 'end',
              align: 'top',
              offset: 8
            }
          }
        ]
      },
      options: { 
        responsive: true, 
        plugins: { 
          legend: { position: 'bottom' }, 
          datalabels: { 
            display: true,
            color: '#fff',
            font: { weight: 'bold', size: 9 },
            formatter: function(value, context) {
              if (context.datasetIndex === 3) return '';
              const total = monthlyData.perf.good[context.dataIndex] + monthlyData.perf.average[context.dataIndex] + monthlyData.perf.bad[context.dataIndex];
              const pct = ((value / total) * 100).toFixed(0);
              return value + ' (' + pct + '%)';
            }
          } 
        }, 
        scales: { 
          x: { stacked: true }, 
          y: { 
            position: 'left',
            stacked: true, 
            beginAtZero: true 
          },
          y1: {
            position: 'right',
            beginAtZero: true,
            grid: { drawOnChartArea: false }
          }
        } 
      },
      plugins: [ChartDataLabels]
    });

    m_sizeMix = new Chart(document.getElementById('monthlySizeMixChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [
          { label: 'Big', data: monthlyData.size.big.slice(), stack: 's', backgroundColor: '#3b82f6', yAxisID: 'y' },
          { label: 'Mid', data: monthlyData.size.mid.slice(), stack: 's', backgroundColor: '#8b5cf6', yAxisID: 'y' },
          { label: 'Small', data: monthlyData.size.small.slice(), stack: 's', backgroundColor: '#06b6d4', yAxisID: 'y' },
          {
            label: 'Total Partners Trend',
            data: monthlyData.size.big.map((v, i) => v + monthlyData.size.mid[i] + monthlyData.size.small[i]),
            type: 'line',
            borderColor: '#000',
            backgroundColor: 'transparent',
            borderWidth: 4,
            pointRadius: 8,
            pointBackgroundColor: '#000',
            pointBorderColor: '#fff',
            pointBorderWidth: 3,
            yAxisID: 'y1',
            tension: 0.3,
            datalabels: {
              display: true,
              color: '#000',
              font: { weight: 'bold', size: 10 },
              formatter: (value) => value.toLocaleString(),
              anchor: 'end',
              align: 'top',
              offset: 5
            }
          }
        ]
      },
      options: { 
        responsive: true, 
        plugins: { 
          legend: { position: 'bottom' }, 
          datalabels: { 
            display: true,
            color: '#fff',
            font: { weight: 'bold', size: 9 },
            formatter: function(value, context) {
              if (context.datasetIndex === 3) return '';
              const total = monthlyData.size.big[context.dataIndex] + monthlyData.size.mid[context.dataIndex] + monthlyData.size.small[context.dataIndex];
              const pct = ((value / total) * 100).toFixed(0);
              return value + ' (' + pct + '%)';
            }
          } 
        }, 
        scales: { 
          x: { stacked: true }, 
          y: { 
            position: 'left',
            stacked: true, 
            beginAtZero: true 
          },
          y1: {
            position: 'right',
            beginAtZero: true,
            grid: { drawOnChartArea: false }
          }
        } 
      },
      plugins: [ChartDataLabels]
    });

    // Total Riders by Performance Level (with percentages)
    const ridersGood = [11229, 11083, 11418, 11019, 12349, 10192];
    const ridersAverage = [12898, 14595, 14151, 9258, 8330, 8414];
    const ridersBad = [5090, 5501, 6449, 2879, 1534, 370];
    const ridersTotal = ridersGood.map((v, i) => v + ridersAverage[i] + ridersBad[i]);
    const ridersPctGood = ridersGood.map((v, i) => ((v / ridersTotal[i]) * 100).toFixed(1));
    const ridersPctAverage = ridersAverage.map((v, i) => ((v / ridersTotal[i]) * 100).toFixed(1));
    const ridersPctBad = ridersBad.map((v, i) => ((v / ridersTotal[i]) * 100).toFixed(1));

    m_ridersPerfMix = new Chart(document.getElementById('monthlyRidersPerformanceMixChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [
          { 
            label: 'Good', 
            data: ridersGood, 
            backgroundColor: '#10b981', 
            borderColor: '#059669',
            borderWidth: 1,
            stack: 'riders',
            yAxisID: 'y'
          },
          { 
            label: 'Average', 
            data: ridersAverage, 
            backgroundColor: '#fbbf24', 
            borderColor: '#f59e0b',
            borderWidth: 1,
            stack: 'riders',
            yAxisID: 'y'
          },
          { 
            label: 'Bad', 
            data: ridersBad, 
            backgroundColor: '#ef4444', 
            borderColor: '#dc2626',
            borderWidth: 1,
            stack: 'riders',
            yAxisID: 'y'
          },
          {
            label: 'Total Riders Trend',
            data: ridersTotal,
            type: 'line',
            borderColor: '#000',
            backgroundColor: 'transparent',
            borderWidth: 4,
            pointRadius: 8,
            pointBackgroundColor: '#000',
            pointBorderColor: '#fff',
            pointBorderWidth: 3,
            yAxisID: 'y1',
            tension: 0.3,
            datalabels: {
              display: true,
              color: '#000',
              font: { weight: 'bold', size: 9 },
              formatter: (value) => value.toLocaleString(),
              anchor: 'end',
              align: 'top',
              offset: 8
            }
          }
        ]
      },
      options: {
        responsive: true,
        plugins: { 
          legend: { position: 'bottom' },
          datalabels: {
            display: true,
            color: '#fff',
            font: { weight: 'bold', size: 9 },
            formatter: function(value, context) {
              if (context.datasetIndex === 3) return '';
              const datasetIndex = context.datasetIndex;
              const dataIndex = context.dataIndex;
              let pct;
              if (datasetIndex === 0) pct = ridersPctGood[dataIndex];
              else if (datasetIndex === 1) pct = ridersPctAverage[dataIndex];
              else pct = ridersPctBad[dataIndex];
              return value.toLocaleString() + ' (' + pct + '%)';
            },
            align: 'center',
            anchor: 'center',
            clipping: false,
            lineHeight: 1.2
          }
        },
        scales: { 
          x: { stacked: true }, 
          y: { 
            type: 'linear',
            display: true,
            position: 'left',
            stacked: true, 
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return value.toLocaleString();
              }
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return value.toLocaleString();
              }
            },
            grid: { drawOnChartArea: false }
          }
        }
      },
      plugins: [ChartDataLabels]
    });

    // Monthly Riders Size Mix Chart
    const ridersBig = [7197, 7906, 8642, 6741, 4938, 5351];
    const ridersMid = [15978, 17709, 17253, 12352, 10598, 9982];
    const ridersSmall = [6042, 5564, 6123, 4063, 6677, 3643];

    const ridersTotalSize = ridersBig.map((v, i) => v + ridersMid[i] + ridersSmall[i]);
    const ridersPctBig = ridersBig.map((v, i) => ((v / ridersTotalSize[i]) * 100).toFixed(1));
    const ridersPctMid = ridersMid.map((v, i) => ((v / ridersTotalSize[i]) * 100).toFixed(1));
    const ridersPctSmall = ridersSmall.map((v, i) => ((v / ridersTotalSize[i]) * 100).toFixed(1));

    m_ridersSizeMix = new Chart(document.getElementById('monthlyRidersSizeMixChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [
          {
            label: 'Big',
            data: ridersBig,
            backgroundColor: '#3b82f6',
            stack: 'size',
            yAxisID: 'y'
          },
          {
            label: 'Mid',
            data: ridersMid,
            backgroundColor: '#8b5cf6',
            stack: 'size',
            yAxisID: 'y'
          },
          {
            label: 'Small',
            data: ridersSmall,
            backgroundColor: '#06b6d4',
            stack: 'size',
            yAxisID: 'y'
          },
          {
            label: 'Total Riders Trend',
            data: ridersTotalSize,
            type: 'line',
            borderColor: '#000',
            backgroundColor: 'transparent',
            borderWidth: 4,
            pointRadius: 8,
            pointBackgroundColor: '#000',
            pointBorderColor: '#fff',
            pointBorderWidth: 3,
            yAxisID: 'y1',
            tension: 0.3,
            datalabels: {
              display: true,
              color: '#000',
              font: { weight: 'bold', size: 9 },
              formatter: (value) => value.toLocaleString(),
              anchor: 'end',
              align: 'top',
              offset: 8
            }
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { position: 'bottom' },
          datalabels: {
            color: 'white',
            font: { weight: 'bold', size: 9 },
            formatter: (value, context) => {
              if (context.datasetIndex === 3) return '';
              const datasetIndex = context.datasetIndex;
              const dataIndex = context.dataIndex;
              let pct;
              if (datasetIndex === 0) pct = ridersPctBig[dataIndex];
              else if (datasetIndex === 1) pct = ridersPctMid[dataIndex];
              else pct = ridersPctSmall[dataIndex];
              return value.toLocaleString() + ' (' + pct + '%)';
            },
            align: 'center',
            anchor: 'center',
            clipping: false,
            lineHeight: 1.2
          }
        },
        scales: { 
          x: { stacked: true }, 
          y: { 
            type: 'linear',
            display: true,
            position: 'left',
            stacked: true, 
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return value.toLocaleString();
              }
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return value.toLocaleString();
              }
            },
            grid: { drawOnChartArea: false }
          }
        }
      },
      plugins: [ChartDataLabels]
    });

        const mom = trendTotalTarget.map((t, i) => {
      if (i === 0) return null; // baseline month
            const prev = trendTotalTarget[i-1];
            const cur  = trendTotalTarget[i];
      if (!prev) return null;
      return ((cur - prev) / prev) * 100;
    });

    const momEl = document.getElementById('monthlyMoMChangeChartNew') || document.getElementById('monthlyMoMChangeChart');
    if (momEl) {
      const bg = mom.map(v => (v === null) ? '#9ca3af' : (v >= 0 ? '#16a34a' : '#dc2626'));
      const br = mom.map(v => (v === null) ? '#6b7280' : (v >= 0 ? '#15803d' : '#b91c1c'));
            m_mom = new Chart(momEl.getContext('2d'), {
        type: 'bar',
                data: { labels: trendMonths, datasets: [{ label: 'MoM %', data: mom, backgroundColor: bg, borderColor: br, borderWidth: 2 }] },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            datalabels: { 
              display: true,
              color: '#111827',
              font: { weight: 'bold', size: 11 },
              formatter: function(value) {
                if (value === null) return '';
                return value.toFixed(1) + '%';
              },
              anchor: function(context) {
                return context.dataset.data[context.dataIndex] >= 0 ? 'end' : 'start';
              },
              align: function(context) {
                return context.dataset.data[context.dataIndex] >= 0 ? 'top' : 'bottom';
              }
            },
            tooltip: { callbacks: { label: (ctx) => (ctx.parsed.y == null ? 'Baseline month' : ('MoM Change: ' + ctx.parsed.y.toFixed(2) + '%')) } }
          },
          scales: {
            x: { ticks: { color: '#111827' } },
            y: { ticks: { color: '#111827', callback: (v) => v + '%' } }
          }
        },
        plugins: [ChartDataLabels]
      });
    } else {
      m_mom = null;
    }

    // Average Scale by Performance Level
    const perfScaleCanvas = document.getElementById('avgScalePerfChart');
    if (perfScaleCanvas) {
      m_avgScalePerf = new Chart(perfScaleCanvas.getContext('2d'), {
        type: 'line',
        data: {
                    labels: avgScalePerfData.labels,
          datasets: avgScalePerfData.series.map(s => makeLineDataset(s, perfScaleCanvas))
        },
        options: {
          responsive: true,
                    interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 12, weight: '600' } } },
            datalabels: {
              display: true,
              color: function(ctx){ return ctx.dataset.borderColor; },
              font: { weight: 'bold', size: 11 },
              formatter: function(value) { return value; },
              anchor: 'end',
              align: 'top',
              offset: 4,
              backgroundColor: 'rgba(255,255,255,0.85)',
              borderRadius: 4,
              padding: { top: 2, bottom: 2, left: 4, right: 4 }
                        },
                        tooltip: {
                            enabled: false,
                            external: makeAvgScaleTooltip('avgScalePerfInfo', avgScalePerfData)
                        },
                        hoverLine: { color: 'rgba(30, 64, 175, 0.25)' }
          },
          scales: {
            x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { color: '#374151', font: { weight: '600' } } },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Avg Riders per Partner', color: '#111827', font: { weight: '600' } },
              ticks: { color: '#111827' },
              grid: { color: 'rgba(0,0,0,0.06)' }
            }
          }
        },
                plugins: [ChartDataLabels, hoverLinePlugin]
      });
    }

    // Average Scale by Size Level
    const sizeScaleCanvas = document.getElementById('avgScaleSizeChart');
    if (sizeScaleCanvas) {
      m_avgScaleSize = new Chart(sizeScaleCanvas.getContext('2d'), {
        type: 'line',
        data: {
                    labels: avgScaleSizeData.labels,
          datasets: avgScaleSizeData.series.map(s => makeLineDataset(s, sizeScaleCanvas))
        },
        options: {
          responsive: true,
                    interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 12, weight: '600' } } },
            datalabels: {
              display: true,
              color: function(ctx){ return ctx.dataset.borderColor; },
              font: { weight: 'bold', size: 11 },
              formatter: function(value) { return value; },
              anchor: 'end',
              align: 'top',
              offset: 4,
              backgroundColor: 'rgba(255,255,255,0.85)',
              borderRadius: 4,
              padding: { top: 2, bottom: 2, left: 4, right: 4 }
                        },
                        tooltip: {
                            enabled: false,
                            external: makeAvgScaleTooltip('avgScaleSizeInfo', avgScaleSizeData)
                        },
                        hoverLine: { color: 'rgba(30, 64, 175, 0.25)' }
          },
          scales: {
            x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { color: '#374151', font: { weight: '600' } } },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Avg Riders per Partner', color: '#111827', font: { weight: '600' } },
              ticks: { color: '#111827' },
              grid: { color: 'rgba(0,0,0,0.06)' }
            }
          }
        },
                plugins: [ChartDataLabels, hoverLinePlugin]
      });
    }

        if (!avgScaleToggleInited) {
            setupAvgScaleToggle('avgScalePerfToggle', 'perf');
            setupAvgScaleToggle('avgScaleSizeToggle', 'size');
            avgScaleToggleInited = true;
            setAvgScaleView('perf', 'trend');
            setAvgScaleView('size', 'trend');
        }

    // Monthly Willing vs Not-Willing Partners
    const willingCanvas = document.getElementById('willingVsNotWillingChart');
    if (willingCanvas) {
      const willingMonths = ['Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
      const willingPartners = [213, 259, 81, 201, 130];
      const notWillingPartners = [356, 381, 554, 413, 398];

      m_willingVsNotWilling = new Chart(willingCanvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: willingMonths,
          datasets: [
            {
              label: 'Not-Willing (≥0)',
              data: notWillingPartners,
              backgroundColor: '#ef4444',
              borderColor: '#dc2626',
              borderWidth: 1
            },
            {
              label: 'Willing (>0)',
              data: willingPartners,
              backgroundColor: '#10b981',
              borderColor: '#059669',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            datalabels: {
              display: true,
              color: '#fff',
              font: { weight: 'bold', size: 11 },
              formatter: function(value) { return value; },
              anchor: 'center',
              align: 'center'
            }
          },
          scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
          }
        },
        plugins: [ChartDataLabels]
      });
    }

    // Partner Willingness Trend (%)
    const trendCanvas = document.getElementById('willingnessTrendChart');
    if (trendCanvas) {
      const trendMonths = ['Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
      const willingPct = [37.4, 40.5, 12.8, 32.7, 24.6];
      const notWillingPct = [62.6, 59.5, 87.2, 67.3, 75.4];

      m_willingnessTrend = new Chart(trendCanvas.getContext('2d'), {
        type: 'line',
        data: {
          labels: trendMonths,
          datasets: [
            {
              label: 'Willing %',
              data: willingPct,
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              borderWidth: 3,
              fill: true,
              pointRadius: 6,
              pointBackgroundColor: '#10b981',
              tension: 0.4
            },
            {
              label: 'Not-Willing %',
              data: notWillingPct,
              borderColor: '#ef4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              borderWidth: 3,
              fill: true,
              pointRadius: 6,
              pointBackgroundColor: '#ef4444',
              tension: 0.4
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            datalabels: {
              display: true,
              color: '#111827',
              font: { weight: 'bold', size: 10 },
              formatter: function(value) { return value.toFixed(1) + '%'; },
              anchor: 'end',
              align: 'top',
              offset: 5
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              title: { display: true, text: 'Percentage (%)', color: '#111827' },
              ticks: { color: '#111827', callback: (v) => v + '%' }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }

    // Growth Category Breakdown (Increase Slabs)
    const gcCanvas = document.getElementById('growthCategoryChart');
    if (gcCanvas) {
      const gcMonths = ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
      const gc1_10 = [42, 60, 73, 22, 79, 46];
      const gc10_20 = [63, 60, 75, 23, 58, 52];
      const gc20_30 = [40, 29, 31, 11, 28, 16];
      const gc30plus = [54, 64, 80, 25, 36, 16];
      const gcTotal = [199, 213, 259, 81, 201, 130];

      m_growthCategory = new Chart(gcCanvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: gcMonths,
          datasets: [
            {
              label: '≥1% - ≤10%',
              data: gc1_10,
              backgroundColor: '#3b82f6',
              borderColor: '#2563eb',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: '>10% - ≤20%',
              data: gc10_20,
              backgroundColor: '#10b981',
              borderColor: '#059669',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: '>20% - ≤30%',
              data: gc20_30,
              backgroundColor: '#f59e0b',
              borderColor: '#d97706',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: '>30%',
              data: gc30plus,
              backgroundColor: '#ef4444',
              borderColor: '#dc2626',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: 'Total Increase Trend',
              data: gcTotal,
              type: 'line',
              borderColor: '#111827',
              backgroundColor: 'rgba(17, 24, 39, 0)',
              borderWidth: 3,
              pointRadius: 6,
              pointBackgroundColor: '#111827',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              tension: 0.3,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'top' },
            datalabels: {
              display: true,
              color: function(context) {
                return context.datasetIndex === 4 ? '#111827' : '#ffffff';
              },
              font: { weight: 'bold', size: 11 },
              formatter: function(value) {
                return value;
              },
              anchor: function(context) {
                return context.datasetIndex === 4 ? 'end' : 'center';
              },
              align: function(context) {
                return context.datasetIndex === 4 ? 'top' : 'center';
              },
              offset: function(context) {
                return context.datasetIndex === 4 ? 4 : 0;
              }
            }
          },
          scales: {
            x: { stacked: false },
            y: {
              stacked: false,
              beginAtZero: true,
              title: { display: true, text: 'Partners (Bars)', color: '#111827' },
              ticks: { color: '#111827' }
            },
            y1: {
              type: 'linear',
              position: 'right',
              beginAtZero: true,
              min: 50,
              max: 300,
              title: { display: true, text: 'Total Increase (Line)', color: '#111827' },
              ticks: { color: '#111827' },
              grid: { drawOnChartArea: false }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }

    // Growth Category Breakdown (Decrease Slabs)
    const dcCanvas = document.getElementById('decreaseCategoryChart');
    if (dcCanvas) {
      const dcMonths = ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
      const dc1_10 = [17, 39, 40, 52, 64, 84];
      const dc10_20 = [38, 56, 64, 108, 77, 98];
      const dc20_30 = [21, 26, 43, 83, 42, 50];
      const dc30plus = [48, 40, 41, 215, 56, 52];
      const dcTotal = [124, 161, 188, 458, 239, 284];

      m_decreaseCategory = new Chart(dcCanvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: dcMonths,
          datasets: [
            {
              label: '≥-10% - ≤-1%',
              data: dc1_10,
              backgroundColor: '#fcd34d',
              borderColor: '#f59e0b',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: '>-20% - ≤-11%',
              data: dc10_20,
              backgroundColor: '#fed7aa',
              borderColor: '#f97316',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: '>-30% - ≤-21%',
              data: dc20_30,
              backgroundColor: '#fca5a5',
              borderColor: '#f87171',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: '<-30%',
              data: dc30plus,
              backgroundColor: '#dc2626',
              borderColor: '#991b1b',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: 'Total Decrease Trend',
              data: dcTotal,
              type: 'line',
              borderColor: '#111827',
              backgroundColor: 'rgba(17, 24, 39, 0)',
              borderWidth: 3,
              pointRadius: 6,
              pointBackgroundColor: '#111827',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              tension: 0.3,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'top' },
            datalabels: {
              display: true,
              color: function(context) {
                return context.datasetIndex === 4 ? '#111827' : '#ffffff';
              },
              font: { weight: 'bold', size: 11 },
              formatter: function(value) {
                return value;
              },
              anchor: function(context) {
                return context.datasetIndex === 4 ? 'end' : 'center';
              },
              align: function(context) {
                return context.datasetIndex === 4 ? 'top' : 'center';
              },
              offset: function(context) {
                return context.datasetIndex === 4 ? 4 : 0;
              }
            }
          },
          scales: {
            x: { stacked: false },
            y: {
              stacked: false,
              beginAtZero: true,
              title: { display: true, text: 'Partners (Bars)', color: '#111827' },
              ticks: { color: '#111827' }
            },
            y1: {
              type: 'linear',
              position: 'right',
              beginAtZero: true,
              min: 0,
              max: 550,
              title: { display: true, text: 'Total Decrease (Line)', color: '#111827' },
              ticks: { color: '#111827' },
              grid: { drawOnChartArea: false }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }

    window.monthlyCharts = [m_targetTrend, m_avgScale, m_perfMix, m_sizeMix].concat(m_mom ? [m_mom] : []);
  }

  function initMonthlyInsights(){
    // Ensure elements exist
    const sel = document.getElementById('monthSelect');
    if (!sel) return;

    // Init charts (safe)
    try { initMonthlyCharts(); } catch(e) { console.error('Monthly charts init error:', e); }

    // Default month
    if (!sel.value || sel.value === 'All') sel.value = 'Feb-26';

    // Render KPIs/tables
    try { updateMonthlyView(sel.value); } catch(e) { console.error('Monthly view update error:', e); }
  }

  // Expose globals for inline handlers
  window.updateMonthlyView = updateMonthlyView;
  window.changeMonth = changeMonth;
  window.initMonthlyInsights = initMonthlyInsights;

  // Auto-init on load + when user switches to tab
  document.addEventListener('DOMContentLoaded', function(){
    initMonthlyInsights();
  });

  // If switchTab exists, wrap it to ensure monthly init on first open (no layout changes)
  if (typeof window.switchTab === 'function' && !window.__monthlySwitchWrapped) {
    window.__monthlySwitchWrapped = true;
    const _orig = window.switchTab;
    window.switchTab = function(tabName, el){
      _orig(tabName, el);
      if (tabName === 'monthly') {
        setTimeout(initMonthlyInsights, 30);
        // resize charts when tab becomes visible
        setTimeout(function(){
          if (Array.isArray(window.monthlyCharts)) {
            window.monthlyCharts.forEach(c => { try { c.resize(); } catch(e) {} });
          }
          // Also init vehicle type charts
          setTimeout(initVehicleMonthlyCharts, 50);
        }, 80);
      }
    };
  }
})();

// ==========================================
// VEHICLE TYPE MONTHLY INSIGHTS SECTION
// ==========================================
(function() {
  // Vehicle Type Monthly Data
  const vehicleMonthlyData = {
        months: ['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'],
        cars: [27599, 28372, 28257, 18845, 17441, 14443],
        bikes: [5194, 5634, 6580, 5337, 5012, 4922],
    // Percentages pre-calculated
        carsPct: [84.2, 83.4, 81.1, 77.9, 77.7, 74.6],
        bikesPct: [15.8, 16.6, 18.9, 22.1, 22.3, 25.4]
  };

  // City-level data
  const cityVehicleData = {
        'Riyadh': { tier: 'T1', cars: [12259, 12453, 12544, 8545, 8103, 6701], bikes: [1827, 1999, 2500, 2167, 1925, 1960] },
        'Jeddah': { tier: 'T1', cars: [3793, 4347, 4361, 2850, 2467, 1900], bikes: [1362, 1534, 1922, 1650, 1627, 1554] },
        'Dammam': { tier: 'T1', cars: [3106, 3401, 3470, 2360, 2204, 1769], bikes: [494, 522, 572, 443, 437, 358] },
        'Madinah': { tier: 'T1', cars: [1647, 1605, 1602, 1063, 929, 841], bikes: [402, 392, 426, 315, 266, 290] },
        'Makkah': { tier: 'T1', cars: [1364, 1252, 1208, 834, 738, 540], bikes: [413, 508, 514, 331, 336, 395] },
        'Al Ahsa': { tier: 'T1', cars: [1129, 1109, 1048, 749, 712, 695], bikes: [179, 211, 231, 187, 146, 123] },
        'Al Kharj': { tier: 'T1', cars: [550, 590, 530, 386, 380, 347], bikes: [0, 0, 0, 0, 0, 0] },
        'Abha': { tier: 'T2', cars: [689, 640, 606, 339, 316, 279], bikes: [40, 38, 21, 15, 23, 18] },
        'Taif': { tier: 'T2', cars: [640, 534, 551, 311, 277, 204], bikes: [115, 117, 102, 78, 68, 88] },
        'Buraydah': { tier: 'T2', cars: [420, 456, 404, 278, 232, 218], bikes: [117, 82, 81, 32, 64, 35] },
        'Jubail': { tier: 'T2', cars: [357, 394, 370, 255, 224, 210], bikes: [93, 77, 62, 20, 20, 20] },
        'Tabuk': { tier: 'T2', cars: [400, 410, 465, 248, 242, 186], bikes: [20, 0, 10, 10, 10, 16] },
        'Hail': { tier: 'T2', cars: [340, 334, 360, 208, 199, 186], bikes: [0, 0, 0, 0, 0, 0] },
        'Yanbu': { tier: 'T2', cars: [270, 263, 242, 155, 154, 128], bikes: [82, 50, 60, 55, 55, 43] },
        'Hafar Al Batin': { tier: 'T2', cars: [267, 263, 213, 100, 103, 97], bikes: [30, 44, 44, 24, 25, 12] },
        'Jazan': { tier: 'T2', cars: [168, 187, 158, 82, 85, 64], bikes: [20, 25, 15, 10, 10, 10] },
        'Najran': { tier: 'T2', cars: [200, 134, 125, 82, 76, 78], bikes: [0, 35, 20, 0, 0, 0] }
  };

  const t1Cities = ['Riyadh', 'Jeddah', 'Dammam', 'Madinah', 'Makkah', 'Al Ahsa', 'Al Kharj'];
  const t2Cities = ['Abha', 'Taif', 'Buraydah', 'Jubail', 'Tabuk', 'Hail', 'Yanbu', 'Hafar Al Batin', 'Jazan', 'Najran'];

  let vehicleMonthlyChart = null;
  let vehicleCityChart = null;
  let vehicleT1Chart = null;
  let vehicleT2Chart = null;
  let currentVehicleView = 'monthly';
  let currentCityLevel = 'all';
  let currentCity = 'all';
  let currentVehicleMonthlyTrend = 'combined';

  // Plugin to show trend line totals with MoM % (red for decline) - works for all monthly charts
  const vehicleTrendLabelsPlugin = {
    id: 'vehicleTrendLabels',
    afterDatasetsDraw: function(chart) {
      const ctx = chart.ctx;
      const labels = chart.data.labels;
      
      // Check if this is a monthly chart (labels are EXACTLY the month names)
            const monthLabels = ['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'];
            const isMonthlyChart = labels && labels.length === 6 && 
        JSON.stringify(labels) === JSON.stringify(monthLabels);
      
      chart.data.datasets.forEach((dataset, i) => {
        if (dataset.type === 'line' && dataset.data) {
          const meta = chart.getDatasetMeta(i);
          const lineData = dataset.data;
          
          meta.data.forEach((point, index) => {
            const value = lineData[index];
            if (value !== null && value !== undefined) {
              ctx.save();
              ctx.textAlign = 'center';
              ctx.font = 'bold 10px Arial';
              
              // Calculate MoM only for monthly charts
              let mom = null;
              if (isMonthlyChart && index > 0 && lineData[index-1] > 0) {
                mom = ((value - lineData[index-1]) / lineData[index-1] * 100);
              }
              
              // Determine base color
              let baseColor = '#111827';
              if (currentVehicleMonthlyTrend === 'cars') baseColor = '#1e40af';
              else if (currentVehicleMonthlyTrend === 'bikes') baseColor = '#047857';
              
              // Build label text with MoM format for monthly charts
              let labelText = value.toLocaleString();
              let labelColor = baseColor;
              
              if (isMonthlyChart && mom !== null) {
                const sign = mom >= 0 ? '+' : '';
                labelText = value.toLocaleString() + ' (MoM ' + sign + mom.toFixed(1) + '%)';
                // Use red color when declining
                if (mom < 0) {
                  labelColor = '#dc2626';
                }
              }
              
              ctx.fillStyle = labelColor;
              ctx.fillText(labelText, point.x, point.y - 18);
              ctx.restore();
            }
          });
        }
      });
    }
  };

  function switchVehicleMonthlyView(view) {
    currentVehicleView = view;
    
    // Update button states
    document.querySelectorAll('.vehicle-monthly-view-btn').forEach(btn => {
      if (btn.getAttribute('data-view') === view) {
        btn.classList.add('active');
        btn.style.background = '#3b82f6';
        btn.style.color = 'white';
        btn.style.borderColor = '#3b82f6';
      } else {
        btn.classList.remove('active');
        btn.style.background = 'white';
        btn.style.color = '#6b7280';
        btn.style.borderColor = '#e5e7eb';
      }
    });

    // Toggle panels
    const monthlyPanel = document.getElementById('vehicleMonthlyViewPanel');
    const cityPanel = document.getElementById('vehicleCityViewPanel');
    
    if (view === 'monthly') {
      if (monthlyPanel) monthlyPanel.style.display = 'block';
      if (cityPanel) cityPanel.style.display = 'none';
      renderVehicleMonthlyChart();
    } else {
      if (monthlyPanel) monthlyPanel.style.display = 'none';
      if (cityPanel) cityPanel.style.display = 'block';
      filterVehicleCityLevel(currentCityLevel);
    }
  }

  // Switch between Cars/Bikes/Combined trend views in Monthly View
  function switchVehicleMonthlyTrend(trend) {
    currentVehicleMonthlyTrend = trend;
    
    // Update button states
    document.querySelectorAll('.vehicle-monthly-trend-btn').forEach(btn => {
      if (btn.getAttribute('data-trend') === trend) {
        btn.classList.add('active');
        btn.style.background = trend === 'cars' ? '#3b82f6' : trend === 'bikes' ? '#10b981' : '#8b5cf6';
        btn.style.color = 'white';
        btn.style.borderColor = trend === 'cars' ? '#3b82f6' : trend === 'bikes' ? '#10b981' : '#8b5cf6';
      } else {
        btn.classList.remove('active');
        btn.style.background = 'white';
        btn.style.color = '#6b7280';
        btn.style.borderColor = '#e5e7eb';
      }
    });

    renderVehicleMonthlyChart();
    updateVehicleMonthlyKpiCards(trend);
  }
  window.switchVehicleMonthlyTrend = switchVehicleMonthlyTrend;

  function updateVehicleMonthlyKpiCards(trend) {
    const container = document.getElementById('vehicleMonthlyKpiCards');
    if (!container) return;

    const cars = vehicleMonthlyData.cars;
    const bikes = vehicleMonthlyData.bikes;
    const months = vehicleMonthlyData.months;
    const totals = cars.map((c, i) => c + bikes[i]);
    const lastIdx = cars.length - 1;
    const monthCount = cars.length;
    const momCount = monthCount - 1;
    
    const totalCars = cars.reduce((a, b) => a + b, 0);
    const totalBikes = bikes.reduce((a, b) => a + b, 0);
    const grandTotal = totalCars + totalBikes;
    
    // Calculate MoM changes
    const carsMoM = cars.map((v, i) => i === 0 ? 0 : ((v - cars[i-1]) / cars[i-1] * 100));
    const bikesMoM = bikes.map((v, i) => i === 0 ? 0 : ((v - bikes[i-1]) / bikes[i-1] * 100));
    
    // Find peak months
    const maxCarIdx = cars.indexOf(Math.max(...cars));
    const maxBikeIdx = bikes.indexOf(Math.max(...bikes));
    const minCarIdx = cars.indexOf(Math.min(...cars));
    const minBikeIdx = bikes.indexOf(Math.min(...bikes));
    
    // Calculate growth rates
    const carsGrowth = ((cars[lastIdx] - cars[0]) / cars[0] * 100).toFixed(1);
    const bikesGrowth = ((bikes[lastIdx] - bikes[0]) / bikes[0] * 100).toFixed(1);
    
    // Avg MoM (excluding first month)
    const avgCarsMoM = (carsMoM.slice(1).reduce((a, b) => a + b, 0) / momCount).toFixed(1);
    const avgBikesMoM = (bikesMoM.slice(1).reduce((a, b) => a + b, 0) / momCount).toFixed(1);

    if (trend === 'cars') {
      const avgCars = Math.round(totalCars/monthCount);
      container.innerHTML = `
        <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #3b82f6;">
                    <div style="font-size: 11px; color: #1e40af; font-weight: 600;">🚗 Avg Cars (per month)</div>
          <div style="font-size: 22px; font-weight: 700; color: #1e40af;">${avgCars.toLocaleString()}</div>
          <div style="font-size: 11px; color: #3b82f6;">${((totalCars/grandTotal)*100).toFixed(1)}% of total capacity</div>
                    <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${totalCars.toLocaleString()}</div>
        </div>
        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #f59e0b;">
          <div style="font-size: 11px; color: #92400e; font-weight: 600;">📈 Peak Month</div>
          <div style="font-size: 20px; font-weight: 700; color: #b45309;">${months[maxCarIdx]}</div>
          <div style="font-size: 11px; color: #f59e0b;">${cars[maxCarIdx].toLocaleString()} cars</div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">highest monthly volume</div>
        </div>
        <div style="background: linear-gradient(135deg, ${parseFloat(carsGrowth) >= 0 ? '#d1fae5' : '#fee2e2'} 0%, ${parseFloat(carsGrowth) >= 0 ? '#a7f3d0' : '#fecaca'} 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid ${parseFloat(carsGrowth) >= 0 ? '#10b981' : '#ef4444'};">
                    <div style="font-size: 11px; color: ${parseFloat(carsGrowth) >= 0 ? '#065f46' : '#991b1b'}; font-weight: 600;">📊 Cars Growth (${months[0]}→${months[lastIdx]})</div>
          <div style="font-size: 20px; font-weight: 700; color: ${parseFloat(carsGrowth) >= 0 ? '#059669' : '#dc2626'};">${parseFloat(carsGrowth) >= 0 ? '+' : ''}${carsGrowth}%</div>
                    <div style="font-size: 11px; color: ${parseFloat(carsGrowth) >= 0 ? '#10b981' : '#ef4444'};">${cars[0].toLocaleString()} → ${cars[lastIdx].toLocaleString()}</div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">avg MoM: ${parseFloat(avgCarsMoM) >= 0 ? '+' : ''}${avgCarsMoM}%</div>
        </div>
        <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #ef4444;">
          <div style="font-size: 11px; color: #991b1b; font-weight: 600;">📉 Lowest Month</div>
          <div style="font-size: 20px; font-weight: 700; color: #dc2626;">${months[minCarIdx]}</div>
          <div style="font-size: 11px; color: #ef4444;">${cars[minCarIdx].toLocaleString()} cars</div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">lowest monthly volume</div>
        </div>
      `;
    } else if (trend === 'bikes') {
      const avgBikes = Math.round(totalBikes/monthCount);
      container.innerHTML = `
        <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #10b981;">
                    <div style="font-size: 11px; color: #065f46; font-weight: 600;">🏍️ Avg Bikes (per month)</div>
          <div style="font-size: 22px; font-weight: 700; color: #065f46;">${avgBikes.toLocaleString()}</div>
          <div style="font-size: 11px; color: #10b981;">${((totalBikes/grandTotal)*100).toFixed(1)}% of total capacity</div>
                    <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${totalBikes.toLocaleString()}</div>
        </div>
        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #f59e0b;">
          <div style="font-size: 11px; color: #92400e; font-weight: 600;">📈 Peak Month</div>
          <div style="font-size: 20px; font-weight: 700; color: #b45309;">${months[maxBikeIdx]}</div>
          <div style="font-size: 11px; color: #f59e0b;">${bikes[maxBikeIdx].toLocaleString()} bikes</div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">highest monthly volume</div>
        </div>
        <div style="background: linear-gradient(135deg, ${parseFloat(bikesGrowth) >= 0 ? '#d1fae5' : '#fee2e2'} 0%, ${parseFloat(bikesGrowth) >= 0 ? '#a7f3d0' : '#fecaca'} 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid ${parseFloat(bikesGrowth) >= 0 ? '#10b981' : '#ef4444'};">
                    <div style="font-size: 11px; color: ${parseFloat(bikesGrowth) >= 0 ? '#065f46' : '#991b1b'}; font-weight: 600;">📊 Bikes Growth (${months[0]}→${months[lastIdx]})</div>
          <div style="font-size: 20px; font-weight: 700; color: ${parseFloat(bikesGrowth) >= 0 ? '#059669' : '#dc2626'};">${parseFloat(bikesGrowth) >= 0 ? '+' : ''}${bikesGrowth}%</div>
                    <div style="font-size: 11px; color: ${parseFloat(bikesGrowth) >= 0 ? '#10b981' : '#ef4444'};">${bikes[0].toLocaleString()} → ${bikes[lastIdx].toLocaleString()}</div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">avg MoM: ${parseFloat(avgBikesMoM) >= 0 ? '+' : ''}${avgBikesMoM}%</div>
        </div>
        <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #ef4444;">
          <div style="font-size: 11px; color: #991b1b; font-weight: 600;">📉 Lowest Month</div>
          <div style="font-size: 20px; font-weight: 700; color: #dc2626;">${months[minBikeIdx]}</div>
          <div style="font-size: 11px; color: #ef4444;">${bikes[minBikeIdx].toLocaleString()} bikes</div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">lowest monthly volume</div>
        </div>
      `;
    } else {
      // Combined view - restore original KPI cards with Avg values
    const bikesGrowthVol = ((bikes[lastIdx] - bikes[0]) / bikes[0] * 100).toFixed(1);
      const bikesShareStart = ((bikes[0] / totals[0]) * 100).toFixed(1);
    const bikesShareEnd = ((bikes[lastIdx] / totals[lastIdx]) * 100).toFixed(1);
      const bikesShareGrowth = (parseFloat(bikesShareEnd) - parseFloat(bikesShareStart)).toFixed(1);
      const avgCars = Math.round(totalCars/monthCount);
      const avgBikes = Math.round(totalBikes/monthCount);
      const avgTotal = Math.round(grandTotal/monthCount);
      
      container.innerHTML = `
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #3b82f6;">
                    <div style="font-size: 11px; color: #1e40af; font-weight: 600;">🚗 Avg Cars (per month)</div>
          <div style="font-size: 22px; font-weight: 700; color: #1e40af;">${avgCars.toLocaleString()}</div>
          <div style="font-size: 11px; color: #3b82f6;">${((totalCars/grandTotal)*100).toFixed(1)}% of total</div>
                    <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${totalCars.toLocaleString()}</div>
        </div>
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #10b981;">
                    <div style="font-size: 11px; color: #065f46; font-weight: 600;">🏍️ Avg Bikes (per month)</div>
          <div style="font-size: 22px; font-weight: 700; color: #065f46;">${avgBikes.toLocaleString()}</div>
          <div style="font-size: 11px; color: #10b981;">${((totalBikes/grandTotal)*100).toFixed(1)}% of total</div>
                    <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${totalBikes.toLocaleString()}</div>
        </div>
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #f59e0b;">
                    <div style="font-size: 11px; color: #92400e; font-weight: 600;">📈 Bikes Share Growth (${months[0]}→${months[lastIdx]})</div>
          <div style="font-size: 20px; font-weight: 700; color: #b45309;">${parseFloat(bikesGrowthVol) >= 0 ? '+' : ''}${bikesGrowthVol}% <span style="font-size: 12px; font-weight: 600;">volume</span></div>
          <div style="font-size: 13px; color: #d97706; font-weight: 600;">${parseFloat(bikesShareGrowth) >= 0 ? '+' : ''}${bikesShareGrowth}pp <span style="font-size: 10px; font-weight: 500;">share (${bikesShareStart}%→${bikesShareEnd}%)</span></div>
          <div style="font-size: 9px; color: #64748b; margin-top: 2px;">avg growth/month: ${parseFloat(avgBikesMoM) >= 0 ? '+' : ''}${avgBikesMoM}%</div>
        </div>
        <div class="kpi-tooltip-wrapper" style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #8b5cf6;">
          <div style="font-size: 11px; color: #5b21b6; font-weight: 600;">📊 Avg Total (per month)</div>
          <div style="font-size: 22px; font-weight: 700; color: #6d28d9;">${avgTotal.toLocaleString()}</div>
                    <div style="font-size: 11px; color: #8b5cf6;">${months[0]} - ${months[lastIdx]} 2026</div>
                    <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${grandTotal.toLocaleString()}</div>
        </div>
      `;
    }
  }

  function filterVehicleCityLevel(level) {
    currentCityLevel = level;
    
    // Update level button states
    document.querySelectorAll('.vehicle-city-level-monthly-btn').forEach(btn => {
      if (btn.getAttribute('data-level') === level) {
        btn.classList.add('active');
        btn.style.background = '#10b981';
        btn.style.color = 'white';
        btn.style.borderColor = '#10b981';
      } else {
        btn.classList.remove('active');
        btn.style.background = 'white';
        btn.style.color = '#6b7280';
        btn.style.borderColor = '#e5e7eb';
      }
    });

    // Show/hide individual city filter
    const cityFilter = document.getElementById('vehicleCityIndividualFilter');
    if (cityFilter) {
      cityFilter.style.display = (level === 'all' || level === 't1' || level === 't2') ? 'flex' : 'none';
    }

    // Toggle containers based on level
    const singleContainer = document.getElementById('vehicleSingleChartContainer');
    const t1t2Container = document.getElementById('vehicleT1T2Container');
    
    // Reset city selection when switching levels
    if (level === 't1vst2') {
      currentCity = 'all';
      if (singleContainer) singleContainer.style.display = 'none';
      if (t1t2Container) t1t2Container.style.display = 'grid';
      t1t2Container.style.gridTemplateColumns = '1fr 1fr';
      renderVehicleT1vsT2Chart();
      renderVehicleDataTable();
    } else {
      if (singleContainer) singleContainer.style.display = 'block';
      if (t1t2Container) t1t2Container.style.display = 'none';
      // Update city buttons visibility based on level
      document.querySelectorAll('.vehicle-city-monthly-btn').forEach(btn => {
        const city = btn.getAttribute('data-city');
        if (city === 'all') {
          btn.style.display = 'inline-block';
        } else if (level === 'all') {
          btn.style.display = 'inline-block';
        } else if (level === 't1' && t1Cities.includes(city)) {
          btn.style.display = 'inline-block';
        } else if (level === 't2' && t2Cities.includes(city)) {
          btn.style.display = 'inline-block';
        } else {
          btn.style.display = 'none';
        }
      });
      
      filterVehicleCity(currentCity);
    }
  }

  function destroyT1T2Charts() {
    if (vehicleT1Chart) { vehicleT1Chart.destroy(); vehicleT1Chart = null; }
    if (vehicleT2Chart) { vehicleT2Chart.destroy(); vehicleT2Chart = null; }
  }

  function filterVehicleCity(city) {
    currentCity = city;
    
    // Update city button states
    document.querySelectorAll('.vehicle-city-monthly-btn').forEach(btn => {
      if (btn.getAttribute('data-city') === city) {
        btn.classList.add('active');
        btn.style.background = '#8b5cf6';
        btn.style.color = 'white';
        btn.style.borderColor = '#8b5cf6';
      } else {
        btn.classList.remove('active');
        btn.style.background = 'white';
        btn.style.color = '#6b7280';
        btn.style.borderColor = '#e5e7eb';
      }
    });

    renderVehicleCityChart();
    renderVehicleDataTable();
  }

  function renderVehicleMonthlyChart() {
    const canvas = document.getElementById('vehicleMonthlyChart');
    if (!canvas) return;

    if (vehicleMonthlyChart) {
      vehicleMonthlyChart.destroy();
    }

    const cars = vehicleMonthlyData.cars;
    const bikes = vehicleMonthlyData.bikes;
    const months = vehicleMonthlyData.months;
    const totals = cars.map((c, i) => c + bikes[i]);
    
    // Calculate MoM changes
    const carsMoM = cars.map((v, i) => i === 0 ? null : ((v - cars[i-1]) / cars[i-1] * 100));
    const bikesMoM = bikes.map((v, i) => i === 0 ? null : ((v - bikes[i-1]) / bikes[i-1] * 100));
    const totalsMoM = totals.map((v, i) => i === 0 ? null : ((v - totals[i-1]) / totals[i-1] * 100));

    let datasets, chartOptions;

    if (currentVehicleMonthlyTrend === 'cars') {
      // Cars Only Trend View
      const carsPctArr = cars.map((v, i) => ((v / totals[i]) * 100).toFixed(1));
      datasets = [
        {
          label: '🚗 Cars Volume',
          data: cars,
          backgroundColor: cars.map((v, i) => i === 0 || carsMoM[i] >= 0 ? '#3b82f6' : '#93c5fd'),
          borderColor: '#2563eb',
          borderWidth: 2,
          yAxisID: 'y',
          barPercentage: 0.7
        },
        {
          label: 'Cars Trend',
          data: cars,
          type: 'line',
          borderColor: '#1e40af',
          backgroundColor: 'transparent',
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#1e40af',
          pointBorderColor: '#fff',
          pointBorderWidth: 2,
          yAxisID: 'y1',
          tension: 0.3
        }
      ];
      chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true, font: { size: 11 } } },
          tooltip: {
            backgroundColor: '#1f2937',
            padding: 12,
            callbacks: {
              afterLabel: function(context) {
                if (context.datasetIndex === 0) {
                  const idx = context.dataIndex;
                  if (idx === 0) return 'MoM: Baseline';
                  const mom = carsMoM[idx];
                  return 'MoM: ' + (mom >= 0 ? '+' : '') + mom.toFixed(1) + '%';
                }
                return '';
              }
            }
          },
          datalabels: {
            display: function(context) { return context.datasetIndex === 0; },
            color: '#fff',
            font: { weight: 'bold', size: 10 },
            formatter: function(value, context) {
              const idx = context.dataIndex;
              return value.toLocaleString() + ' (' + carsPctArr[idx] + '%)';
            },
            anchor: 'center',
            align: 'center',
            offset: -8
          }
        },
        scales: {
          x: { grid: { display: false }, ticks: { font: { size: 11 } } },
          y: { 
            beginAtZero: true, position: 'left', suggestedMax: Math.max(...cars) * 1.2,
            title: { display: true, text: 'Cars Count', color: '#1e40af', font: { size: 11, weight: 'bold' } },
            ticks: { font: { size: 10 }, color: '#1e40af' }, grid: { color: '#e5e7eb' }
          },
          y1: {
            type: 'linear', position: 'right', beginAtZero: true, suggestedMax: Math.max(...cars) * 1.2,
            grid: { drawOnChartArea: false },
            title: { display: true, text: 'Trend Line', color: '#1e40af', font: { size: 11 } },
            ticks: { font: { size: 10 }, color: '#1e40af' }
          }
        }
      };
    } else if (currentVehicleMonthlyTrend === 'bikes') {
      // Bikes Only Trend View
      const bikesPctArr = bikes.map((v, i) => ((v / totals[i]) * 100).toFixed(1));
      datasets = [
        {
          label: '🏍️ Bikes Volume',
          data: bikes,
          backgroundColor: bikes.map((v, i) => i === 0 || bikesMoM[i] >= 0 ? '#10b981' : '#6ee7b7'),
          borderColor: '#059669',
          borderWidth: 2,
          yAxisID: 'y',
          barPercentage: 0.7
        },
        {
          label: 'Bikes Trend',
          data: bikes,
          type: 'line',
          borderColor: '#047857',
          backgroundColor: 'transparent',
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#047857',
          pointBorderColor: '#fff',
          pointBorderWidth: 2,
          yAxisID: 'y1',
          tension: 0.3
        }
      ];
      chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true, font: { size: 11 } } },
          tooltip: {
            backgroundColor: '#1f2937',
            padding: 12,
            callbacks: {
              afterLabel: function(context) {
                if (context.datasetIndex === 0) {
                  const idx = context.dataIndex;
                  if (idx === 0) return 'MoM: Baseline';
                  const mom = bikesMoM[idx];
                  return 'MoM: ' + (mom >= 0 ? '+' : '') + mom.toFixed(1) + '%';
                }
                return '';
              }
            }
          },
          datalabels: {
            display: function(context) { return context.datasetIndex === 0; },
            color: '#fff',
            font: { weight: 'bold', size: 10 },
            formatter: function(value, context) {
              const idx = context.dataIndex;
              return value.toLocaleString() + ' (' + bikesPctArr[idx] + '%)';
            },
            anchor: 'center',
            align: 'center',
            offset: -8
          }
        },
        scales: {
          x: { grid: { display: false }, ticks: { font: { size: 11 } } },
          y: { 
            beginAtZero: true, position: 'left', suggestedMax: Math.max(...bikes) * 1.25,
            title: { display: true, text: 'Bikes Count', color: '#047857', font: { size: 11, weight: 'bold' } },
            ticks: { font: { size: 10 }, color: '#047857' }, grid: { color: '#e5e7eb' }
          },
          y1: {
            type: 'linear', position: 'right', beginAtZero: true, suggestedMax: Math.max(...bikes) * 1.25,
            grid: { drawOnChartArea: false },
            title: { display: true, text: 'Trend Line', color: '#047857', font: { size: 11 } },
            ticks: { font: { size: 10 }, color: '#047857' }
          }
        }
      };
    } else {
      // Combined Cars vs Bikes Evolution View (default)
      datasets = [
        {
          label: '🚗 Cars',
          data: cars,
          backgroundColor: '#3b82f6',
          borderColor: '#2563eb',
          borderWidth: 1,
          stack: 'stack1',
          yAxisID: 'y'
        },
        {
          label: '🏍️ Bikes',
          data: bikes,
          backgroundColor: '#10b981',
          borderColor: '#059669',
          borderWidth: 1,
          stack: 'stack1',
          yAxisID: 'y'
        },
        {
          label: 'Total Trend',
          data: totals,
          type: 'line',
          borderColor: '#111827',
          backgroundColor: 'transparent',
          borderWidth: 3,
          pointRadius: 6,
          pointBackgroundColor: '#111827',
          pointBorderColor: '#fff',
          pointBorderWidth: 2,
          yAxisID: 'y1',
          tension: 0.3
        }
      ];
      chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true, font: { size: 11 } } },
          datalabels: {
            display: function(context) { return context.datasetIndex !== 2; },
            color: '#fff',
            font: { weight: 'bold', size: 9 },
            formatter: function(value, context) {
              const idx = context.dataIndex;
              const total = totals[idx];
              const pct = ((value / total) * 100).toFixed(1);
              return value.toLocaleString() + ' (' + pct + '%)';
            },
            anchor: 'center',
            align: 'center'
          }
        },
        scales: {
          x: { stacked: true, grid: { display: false }, ticks: { font: { size: 11 } } },
          y: { 
            stacked: true, beginAtZero: true, position: 'left', suggestedMax: Math.max(...totals) * 1.18,
            title: { display: true, text: 'Target Count', color: '#111827', font: { size: 11 } },
            ticks: { font: { size: 10 } }, grid: { color: '#f3f4f6' }
          },
          y1: {
            type: 'linear', position: 'right', beginAtZero: true, suggestedMax: Math.max(...totals) * 1.18,
            grid: { drawOnChartArea: false },
            title: { display: true, text: 'Total (Line)', color: '#111827', font: { size: 11 } },
            ticks: { font: { size: 10 } }
          }
        }
      };
    }

    vehicleMonthlyChart = new Chart(canvas.getContext('2d'), {
      type: 'bar',
      data: { labels: months, datasets: datasets },
      options: chartOptions,
      plugins: [ChartDataLabels, vehicleTrendLabelsPlugin]
    });
  }

  function renderVehicleCityChart() {
    const canvas = document.getElementById('vehicleCityChart');
    if (!canvas) return;

    // Destroy T1/T2 side-by-side charts if they exist
    destroyT1T2Charts();

    if (vehicleCityChart) {
      vehicleCityChart.destroy();
    }

    let citiesToShow = [];
    if (currentCity !== 'all') {
      citiesToShow = [currentCity];
    } else if (currentCityLevel === 't1') {
      citiesToShow = t1Cities;
    } else if (currentCityLevel === 't2') {
      citiesToShow = t2Cities;
    } else {
      citiesToShow = [...t1Cities, ...t2Cities];
    }

    // If showing single city, show monthly breakdown
    if (citiesToShow.length === 1) {
      renderSingleCityChart(citiesToShow[0]);
      return;
    }

    // Calculate total for each city
    const cityTotals = citiesToShow.map(city => {
      const data = cityVehicleData[city];
      const totalCars = data.cars.reduce((a, b) => a + b, 0);
      const totalBikes = data.bikes.reduce((a, b) => a + b, 0);
      return { city, totalCars, totalBikes, total: totalCars + totalBikes };
    }).sort((a, b) => b.total - a.total);

    // Update KPI cards
    updateCityKpiCards(cityTotals);

    const labels = cityTotals.map(c => c.city);
    const carsData = cityTotals.map(c => c.totalCars);
    const bikesData = cityTotals.map(c => c.totalBikes);
    const totals = cityTotals.map(c => c.total);
    const maxTotal = Math.max(...totals);

    vehicleCityChart = new Chart(canvas.getContext('2d'), {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          {
            label: '🚗 Cars (6 months)',
            data: carsData,
            backgroundColor: '#3b82f6',
            borderColor: '#2563eb',
            borderWidth: 1,
            stack: 'stack1',
            yAxisID: 'y'
          },
          {
            label: '🏍️ Bikes (6 months)',
            data: bikesData,
            backgroundColor: '#10b981',
            borderColor: '#059669',
            borderWidth: 1,
            stack: 'stack1',
            yAxisID: 'y'
          },
          {
            label: 'Total Trend',
            data: totals,
            type: 'line',
            borderColor: '#111827',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 4,
            pointBackgroundColor: '#111827',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y1',
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false
        },
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { padding: 12, usePointStyle: true, font: { size: 10 } }
          },
          tooltip: {
            backgroundColor: '#1f2937',
            padding: 12,
            titleFont: { size: 12, weight: 'bold' },
            bodyFont: { size: 11 },
            callbacks: {
              title: function(tooltipItems) {
                return '📍 ' + tooltipItems[0].label;
              },
              label: function(context) {
                const idx = context.dataIndex;
                const total = carsData[idx] + bikesData[idx];
                if (context.datasetIndex === 0) {
                  const pct = ((carsData[idx] / total) * 100).toFixed(1);
                  return '🚗 Cars: ' + carsData[idx].toLocaleString() + ' (' + pct + '%)';
                }
                if (context.datasetIndex === 1) {
                  const pct = ((bikesData[idx] / total) * 100).toFixed(1);
                  return '🏍️ Bikes: ' + bikesData[idx].toLocaleString() + ' (' + pct + '%)';
                }
                if (context.datasetIndex === 2) {
                  return '📊 Total: ' + total.toLocaleString();
                }
                return '';
              },
              footer: function(tooltipItems) {
                const idx = tooltipItems[0].dataIndex;
                const avgPerMonth = Math.round((carsData[idx] + bikesData[idx]) / 6);
                return '───────────────\navg/month: ' + avgPerMonth.toLocaleString();
              }
            }
          },
          datalabels: {
            display: function(context) {
              // Hide labels for very small values to avoid clutter
              if (context.datasetIndex === 2) return false;
              const value = context.dataset.data[context.dataIndex];
              const maxVal = Math.max(...totals);
              return value > maxVal * 0.02; // Only show if > 2% of max
            },
            color: '#fff',
            font: { weight: 'bold', size: 8 },
            formatter: function(value, context) {
              const idx = context.dataIndex;
              const total = carsData[idx] + bikesData[idx];
              const pct = ((value / total) * 100).toFixed(1);
              return value.toLocaleString() + ' (' + pct + '%)';
            },
            anchor: 'center',
            align: 'center'
          }
        },
        scales: {
          x: { 
            stacked: true,
            grid: { display: false },
            ticks: { font: { size: 10 } }
          },
          y: { 
            stacked: true, 
            beginAtZero: true,
            suggestedMax: maxTotal * 1.20,
            position: 'left',
            title: { display: true, text: 'Target Count', color: '#111827', font: { size: 10 } },
            ticks: { font: { size: 9 } },
            grid: { color: '#f3f4f6' }
          },
          y1: {
            type: 'linear',
            position: 'right',
            beginAtZero: true,
            suggestedMax: maxTotal * 1.20,
            grid: { drawOnChartArea: false },
            title: { display: true, text: 'Total (Line)', color: '#111827', font: { size: 10 } },
            ticks: { font: { size: 9 } }
          }
        }
      },
      plugins: [ChartDataLabels, vehicleTrendLabelsPlugin]
    });
  }

  function renderSingleCityChart(city) {
    const canvas = document.getElementById('vehicleCityChart');
    if (!canvas) return;

    if (vehicleCityChart) {
      vehicleCityChart.destroy();
    }

    const data = cityVehicleData[city];
    const totals = data.cars.map((c, i) => c + data.bikes[i]);
    const totalCars = data.cars.reduce((a, b) => a + b, 0);
    const totalBikes = data.bikes.reduce((a, b) => a + b, 0);

    // Update KPI cards for single city
    updateCityKpiCards([{ city, totalCars, totalBikes, total: totalCars + totalBikes }]);

    vehicleCityChart = new Chart(canvas.getContext('2d'), {
      type: 'bar',
      data: {
        labels: vehicleMonthlyData.months,
        datasets: [
          {
            label: '🚗 Cars - ' + city,
            data: data.cars,
            backgroundColor: '#3b82f6',
            borderColor: '#2563eb',
            borderWidth: 1,
            stack: 'stack1',
            yAxisID: 'y'
          },
          {
            label: '🏍️ Bikes - ' + city,
            data: data.bikes,
            backgroundColor: '#10b981',
            borderColor: '#059669',
            borderWidth: 1,
            stack: 'stack1',
            yAxisID: 'y'
          },
          {
            label: 'Total Trend',
            data: totals,
            type: 'line',
            borderColor: '#111827',
            backgroundColor: 'transparent',
            borderWidth: 3,
            pointRadius: 6,
            pointBackgroundColor: '#111827',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y1',
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { padding: 12, usePointStyle: true, font: { size: 10 } }
          },
          datalabels: {
            display: function(context) { return context.datasetIndex !== 2; },
            color: '#fff',
            font: { weight: 'bold', size: 10 },
            formatter: function(value, context) {
              const idx = context.dataIndex;
              const total = data.cars[idx] + data.bikes[idx];
              const pct = ((value / total) * 100).toFixed(1);
              return value.toLocaleString() + ' (' + pct + '%)';
            },
            anchor: 'center',
            align: 'center'
          }
        },
        scales: {
          x: { 
            stacked: true,
            grid: { display: false },
            ticks: { font: { size: 10 } }
          },
          y: { 
            stacked: true, 
            beginAtZero: true,
            suggestedMax: Math.max(...totals) * 1.18,
            position: 'left',
            title: { display: true, text: 'Target Count', color: '#111827', font: { size: 10 } },
            ticks: { font: { size: 9 } },
            grid: { color: '#f3f4f6' }
          },
          y1: {
            type: 'linear',
            position: 'right',
            beginAtZero: true,
            suggestedMax: Math.max(...totals) * 1.18,
            grid: { drawOnChartArea: false },
            title: { display: true, text: 'Total (Line)', color: '#111827', font: { size: 10 } },
            ticks: { font: { size: 9 } }
          }
        }
      },
      plugins: [ChartDataLabels, vehicleTrendLabelsPlugin]
    });
  }

  function renderVehicleT1vsT2Chart() {
    // Destroy any existing charts
    destroyT1T2Charts();
    if (vehicleCityChart) { vehicleCityChart.destroy(); vehicleCityChart = null; }

    // Calculate T1 and T2 totals by month
    const t1Cars = vehicleMonthlyData.months.map((_, i) => 
      t1Cities.reduce((sum, city) => sum + cityVehicleData[city].cars[i], 0)
    );
    const t1Bikes = vehicleMonthlyData.months.map((_, i) => 
      t1Cities.reduce((sum, city) => sum + cityVehicleData[city].bikes[i], 0)
    );
    const t2Cars = vehicleMonthlyData.months.map((_, i) => 
      t2Cities.reduce((sum, city) => sum + cityVehicleData[city].cars[i], 0)
    );
    const t2Bikes = vehicleMonthlyData.months.map((_, i) => 
      t2Cities.reduce((sum, city) => sum + cityVehicleData[city].bikes[i], 0)
    );

    const t1Totals = t1Cars.map((c, i) => c + t1Bikes[i]);
    const t2Totals = t2Cars.map((c, i) => c + t2Bikes[i]);

    // Update KPI cards for T1 vs T2
    const t1TotalCars = t1Cars.reduce((a, b) => a + b, 0);
    const t1TotalBikes = t1Bikes.reduce((a, b) => a + b, 0);
    const t2TotalCars = t2Cars.reduce((a, b) => a + b, 0);
    const t2TotalBikes = t2Bikes.reduce((a, b) => a + b, 0);
    
    updateT1T2KpiCards(t1TotalCars, t1TotalBikes, t2TotalCars, t2TotalBikes);

    // Render T1 Chart
    const t1Canvas = document.getElementById('vehicleMonthlyT1Chart');
    if (t1Canvas) {
      const t1MaxVal = Math.max(...t1Totals);
      vehicleT1Chart = new Chart(t1Canvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: vehicleMonthlyData.months,
          datasets: [
            {
              label: '🚗 Cars',
              data: t1Cars,
              backgroundColor: '#3b82f6',
              borderColor: '#2563eb',
              borderWidth: 1,
              stack: 'stack1'
            },
            {
              label: '🏍️ Bikes',
              data: t1Bikes,
              backgroundColor: '#60a5fa',
              borderColor: '#3b82f6',
              borderWidth: 1,
              stack: 'stack1'
            },
            {
              label: 'Total',
              data: t1Totals,
              type: 'line',
              borderColor: '#1e40af',
              backgroundColor: 'transparent',
              borderWidth: 2,
              pointRadius: 3,
              pointBackgroundColor: '#1e40af',
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom', labels: { font: { size: 9 }, padding: 8, usePointStyle: true } },
            datalabels: {
              display: function(ctx) { return ctx.datasetIndex !== 2; },
              color: '#fff',
              font: { weight: 'bold', size: 8 },
              formatter: function(value, context) {
                const idx = context.dataIndex;
                const total = t1Cars[idx] + t1Bikes[idx];
                const pct = ((value / total) * 100).toFixed(1);
                return value.toLocaleString() + ' (' + pct + '%)';
              },
              anchor: 'center',
              align: 'center'
            }
          },
          scales: {
            x: { stacked: true, grid: { display: false }, ticks: { font: { size: 9 } } },
            y: { stacked: true, beginAtZero: true, suggestedMax: t1MaxVal * 1.25, ticks: { font: { size: 9 } }, grid: { color: '#f3f4f6' } }
          }
        },
        plugins: [ChartDataLabels, vehicleTrendLabelsPlugin]
      });
    }

    // Render T2 Chart
    const t2Canvas = document.getElementById('vehicleMonthlyT2Chart');
    if (t2Canvas) {
      const t2MaxVal = Math.max(...t2Totals);
      vehicleT2Chart = new Chart(t2Canvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: vehicleMonthlyData.months,
          datasets: [
            {
              label: '🚗 Cars',
              data: t2Cars,
              backgroundColor: '#10b981',
              borderColor: '#059669',
              borderWidth: 1,
              stack: 'stack1'
            },
            {
              label: '🏍️ Bikes',
              data: t2Bikes,
              backgroundColor: '#6ee7b7',
              borderColor: '#10b981',
              borderWidth: 1,
              stack: 'stack1'
            },
            {
              label: 'Total',
              data: t2Totals,
              type: 'line',
              borderColor: '#047857',
              backgroundColor: 'transparent',
              borderWidth: 2,
              pointRadius: 3,
              pointBackgroundColor: '#047857',
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom', labels: { font: { size: 9 }, padding: 8, usePointStyle: true } },
            datalabels: {
              display: function(ctx) { return ctx.datasetIndex !== 2; },
              color: '#fff',
              font: { weight: 'bold', size: 8 },
              formatter: function(value, context) {
                const idx = context.dataIndex;
                const total = t2Cars[idx] + t2Bikes[idx];
                const pct = ((value / total) * 100).toFixed(1);
                return value.toLocaleString() + ' (' + pct + '%)';
              },
              anchor: 'center',
              align: 'center'
            }
          },
          scales: {
            x: { stacked: true, grid: { display: false }, ticks: { font: { size: 9 } } },
            y: { stacked: true, beginAtZero: true, suggestedMax: t2MaxVal * 1.25, ticks: { font: { size: 9 } }, grid: { color: '#f3f4f6' } }
          }
        },
        plugins: [ChartDataLabels, vehicleTrendLabelsPlugin]
      });
    }
  }

  function updateCityKpiCards(cityTotals) {
    const container = document.getElementById('vehicleCityKpiCards');
    if (!container) return;

    // Use vehicleMonthlyData totals for consistency when all cities selected (17 cities)
    // This ensures City View matches Monthly View totals
    const allCitiesSelected = cityTotals.length === 17;
    
    let totalCars, totalBikes;
    if (allCitiesSelected) {
      // Use aggregate data for consistency with Monthly View
      totalCars = vehicleMonthlyData.cars.reduce((a, b) => a + b, 0);
      totalBikes = vehicleMonthlyData.bikes.reduce((a, b) => a + b, 0);
    } else {
      // Sum selected cities
      totalCars = cityTotals.reduce((sum, c) => sum + c.totalCars, 0);
      totalBikes = cityTotals.reduce((sum, c) => sum + c.totalBikes, 0);
    }
    
    const grandTotal = totalCars + totalBikes;
    const carsPct = ((totalCars / grandTotal) * 100).toFixed(1);
    const bikesPct = ((totalBikes / grandTotal) * 100).toFixed(1);
    
    // Calculate averages per month (6 months of data)
    const avgCarsPerMonth = Math.round(totalCars / 6);
    const avgBikesPerMonth = Math.round(totalBikes / 6);
    const avgTotalPerMonth = Math.round(grandTotal / 6);

    container.innerHTML = `
      <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #3b82f6;">
        <div style="font-size: 11px; color: #1e40af; font-weight: 600;">🚗 Avg Cars (per month)</div>
        <div style="font-size: 20px; font-weight: 700; color: #1e40af;">${avgCarsPerMonth.toLocaleString()}</div>
        <div style="font-size: 10px; color: #3b82f6;">${carsPct}% of selection</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${totalCars.toLocaleString()}</div>
      </div>
      <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #10b981;">
        <div style="font-size: 11px; color: #065f46; font-weight: 600;">🏍️ Avg Bikes (per month)</div>
        <div style="font-size: 20px; font-weight: 700; color: #065f46;">${avgBikesPerMonth.toLocaleString()}</div>
        <div style="font-size: 10px; color: #10b981;">${bikesPct}% of selection</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${totalBikes.toLocaleString()}</div>
      </div>
      <div style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #8b5cf6;">
        <div style="font-size: 11px; color: #5b21b6; font-weight: 600;">📊 Avg Total (per month)</div>
        <div style="font-size: 20px; font-weight: 700; color: #6d28d9;">${avgTotalPerMonth.toLocaleString()}</div>
        <div style="font-size: 10px; color: #8b5cf6;">${cityTotals.length} ${cityTotals.length === 1 ? 'city' : 'cities'} selected</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${grandTotal.toLocaleString()}</div>
      </div>
      <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #f59e0b;">
        <div style="font-size: 11px; color: #92400e; font-weight: 600;">🏆 Top City</div>
        <div style="font-size: 20px; font-weight: 700; color: #b45309;">${cityTotals[0]?.city || '-'}</div>
        <div style="font-size: 10px; color: #f59e0b;">${Math.round((cityTotals[0]?.total || 0) / 6).toLocaleString()} avg/month</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${cityTotals[0]?.total.toLocaleString() || 0}</div>
      </div>
    `;
    
    // Update vehicle share insights panel if showing multiple cities
    updateVehicleShareInsights(cityTotals);
  }

  // Store donut chart instances for cleanup
  let bikeShareDonut = null;
  let carShareDonut = null;

  function updateVehicleShareInsights(cityTotals) {
    const panel = document.getElementById('vehicleShareInsightsPanel');
    if (!panel) return;

    // Only show for multiple cities (All Cities, T1, T2 slicers)
    if (cityTotals.length <= 1) {
      panel.style.display = 'none';
      return;
    }
    panel.style.display = 'block';

    const months = ['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'];

    // Calculate bike/car share for each city
    const cityShares = cityTotals.map(ct => {
      const cityData = cityVehicleData[ct.city];
      const bikesPct = ct.total > 0 ? (ct.totalBikes / ct.total) * 100 : 0;
      const carsPct = ct.total > 0 ? (ct.totalCars / ct.total) * 100 : 0;
      
      // Find highest month for bikes and cars
      let highestBikeMonth = { month: '', value: 0, pct: 0 };
      let highestCarMonth = { month: '', value: 0, pct: 0 };
      
      for (let i = 0; i < 6; i++) {
        const monthTotal = cityData.cars[i] + cityData.bikes[i];
        const bikePct = monthTotal > 0 ? (cityData.bikes[i] / monthTotal) * 100 : 0;
        const carPct = monthTotal > 0 ? (cityData.cars[i] / monthTotal) * 100 : 0;
        
        if (bikePct > highestBikeMonth.pct) {
          highestBikeMonth = { month: months[i], value: cityData.bikes[i], pct: bikePct };
        }
        if (carPct > highestCarMonth.pct) {
          highestCarMonth = { month: months[i], value: cityData.cars[i], pct: carPct };
        }
      }
      
      return {
        city: ct.city,
        totalBikes: ct.totalBikes,
        totalCars: ct.totalCars,
        total: ct.total,
        bikesPct,
        carsPct,
        avgBikesPerMonth: Math.round(ct.totalBikes / 6),
        avgCarsPerMonth: Math.round(ct.totalCars / 6),
        highestBikeMonth,
        highestCarMonth
      };
    });

    // Find city with highest bike share percentage
    const highestBikeShareCity = cityShares.reduce((max, c) => c.bikesPct > max.bikesPct ? c : max, cityShares[0]);
    
    // Find city with highest car share percentage
    const highestCarShareCity = cityShares.reduce((max, c) => c.carsPct > max.carsPct ? c : max, cityShares[0]);

    // Destroy existing donuts
    if (bikeShareDonut) { bikeShareDonut.destroy(); bikeShareDonut = null; }
    if (carShareDonut) { carShareDonut.destroy(); carShareDonut = null; }

    panel.innerHTML = `
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <!-- Highest Bike Share City Card -->
        <div style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-radius: 12px; border: 2px solid #10b981; padding: 20px; position: relative; overflow: hidden;">
          <div style="position: absolute; top: -20px; right: -20px; font-size: 80px; opacity: 0.1;">🏍️</div>
          <div style="display: flex; gap: 20px; align-items: flex-start;">
            <!-- Donut Chart -->
            <div style="width: 140px; height: 140px; flex-shrink: 0; position: relative;">
              <canvas id="bikeShareDonutChart"></canvas>
              <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                <div style="font-size: 20px; font-weight: 800; color: #059669;">${highestBikeShareCity.bikesPct.toFixed(1)}%</div>
                <div style="font-size: 9px; color: #047857; font-weight: 600;">BIKE SHARE</div>
              </div>
            </div>
            <!-- Info Section -->
            <div style="flex: 1; position: relative; z-index: 1;">
              <div style="font-size: 12px; color: #047857; font-weight: 700; margin-bottom: 5px;">🏆 Highest Bike Share City</div>
              <div style="font-size: 22px; font-weight: 800; color: #065f46; margin-bottom: 8px;">${highestBikeShareCity.city}</div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 10px;">
                <div style="background: rgba(255,255,255,0.7); padding: 8px; border-radius: 6px;">
                  <div style="color: #6b7280; font-weight: 600;">Total Bikes (6 mo)</div>
                  <div style="font-size: 14px; font-weight: 700; color: #059669;">${highestBikeShareCity.totalBikes.toLocaleString()}</div>
                  <div style="color: #10b981;">${highestBikeShareCity.bikesPct.toFixed(1)}% of city total</div>
                </div>
                <div style="background: rgba(255,255,255,0.7); padding: 8px; border-radius: 6px;">
                  <div style="color: #6b7280; font-weight: 600;">Avg/Month</div>
                  <div style="font-size: 14px; font-weight: 700; color: #059669;">${highestBikeShareCity.avgBikesPerMonth.toLocaleString()}</div>
                  <div style="color: #10b981;">${(highestBikeShareCity.bikesPct).toFixed(1)}% avg share</div>
                </div>
              </div>
              
              <div style="margin-top: 10px; background: rgba(255,255,255,0.8); padding: 8px 10px; border-radius: 6px; border-left: 3px solid #10b981;">
                <div style="font-size: 10px; color: #047857; font-weight: 700;">📅 Peak Bike Month</div>
                <div style="font-size: 13px; font-weight: 700; color: #065f46;">
                  ${highestBikeShareCity.highestBikeMonth.month}: ${highestBikeShareCity.highestBikeMonth.value.toLocaleString()} 
                  <span style="font-size: 11px; color: #10b981;">(${highestBikeShareCity.highestBikeMonth.pct.toFixed(1)}%)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Highest Car Share City Card -->
        <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; border: 2px solid #3b82f6; padding: 20px; position: relative; overflow: hidden;">
          <div style="position: absolute; top: -20px; right: -20px; font-size: 80px; opacity: 0.1;">🚗</div>
          <div style="display: flex; gap: 20px; align-items: flex-start;">
            <!-- Donut Chart -->
            <div style="width: 140px; height: 140px; flex-shrink: 0; position: relative;">
              <canvas id="carShareDonutChart"></canvas>
              <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                <div style="font-size: 20px; font-weight: 800; color: #2563eb;">${highestCarShareCity.carsPct.toFixed(1)}%</div>
                <div style="font-size: 9px; color: #1d4ed8; font-weight: 600;">CAR SHARE</div>
              </div>
            </div>
            <!-- Info Section -->
            <div style="flex: 1; position: relative; z-index: 1;">
              <div style="font-size: 12px; color: #1d4ed8; font-weight: 700; margin-bottom: 5px;">🏆 Highest Car Share City</div>
              <div style="font-size: 22px; font-weight: 800; color: #1e40af; margin-bottom: 8px;">${highestCarShareCity.city}</div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 10px;">
                <div style="background: rgba(255,255,255,0.7); padding: 8px; border-radius: 6px;">
                  <div style="color: #6b7280; font-weight: 600;">Total Cars (6 mo)</div>
                  <div style="font-size: 14px; font-weight: 700; color: #2563eb;">${highestCarShareCity.totalCars.toLocaleString()}</div>
                  <div style="color: #3b82f6;">${highestCarShareCity.carsPct.toFixed(1)}% of city total</div>
                </div>
                <div style="background: rgba(255,255,255,0.7); padding: 8px; border-radius: 6px;">
                  <div style="color: #6b7280; font-weight: 600;">Avg/Month</div>
                  <div style="font-size: 14px; font-weight: 700; color: #2563eb;">${highestCarShareCity.avgCarsPerMonth.toLocaleString()}</div>
                  <div style="color: #3b82f6;">${(highestCarShareCity.carsPct).toFixed(1)}% avg share</div>
                </div>
              </div>
              
              <div style="margin-top: 10px; background: rgba(255,255,255,0.8); padding: 8px 10px; border-radius: 6px; border-left: 3px solid #3b82f6;">
                <div style="font-size: 10px; color: #1d4ed8; font-weight: 700;">📅 Peak Car Month</div>
                <div style="font-size: 13px; font-weight: 700; color: #1e40af;">
                  ${highestCarShareCity.highestCarMonth.month}: ${highestCarShareCity.highestCarMonth.value.toLocaleString()} 
                  <span style="font-size: 11px; color: #3b82f6;">(${highestCarShareCity.highestCarMonth.pct.toFixed(1)}%)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;

    // Create donut charts
    const bikeCanvas = document.getElementById('bikeShareDonutChart');
    const carCanvas = document.getElementById('carShareDonutChart');

    if (bikeCanvas) {
      bikeShareDonut = new Chart(bikeCanvas.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: ['Bikes', 'Cars'],
          datasets: [{
            data: [highestBikeShareCity.totalBikes, highestBikeShareCity.totalCars],
            backgroundColor: ['#10b981', '#e5e7eb'],
            borderColor: ['#059669', '#d1d5db'],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          cutout: '70%',
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: '#1f2937',
              callbacks: {
                label: function(context) {
                  const total = highestBikeShareCity.total;
                  const pct = ((context.raw / total) * 100).toFixed(1);
                  return context.label + ': ' + context.raw.toLocaleString() + ' (' + pct + '%)';
                }
              }
            },
            datalabels: { display: false }
          }
        }
      });
    }

    if (carCanvas) {
      carShareDonut = new Chart(carCanvas.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: ['Cars', 'Bikes'],
          datasets: [{
            data: [highestCarShareCity.totalCars, highestCarShareCity.totalBikes],
            backgroundColor: ['#3b82f6', '#e5e7eb'],
            borderColor: ['#2563eb', '#d1d5db'],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          cutout: '70%',
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: '#1f2937',
              callbacks: {
                label: function(context) {
                  const total = highestCarShareCity.total;
                  const pct = ((context.raw / total) * 100).toFixed(1);
                  return context.label + ': ' + context.raw.toLocaleString() + ' (' + pct + '%)';
                }
              }
            },
            datalabels: { display: false }
          }
        }
      });
    }
  }

  function updateT1T2KpiCards(t1Cars, t1Bikes, t2Cars, t2Bikes) {
    const container = document.getElementById('vehicleCityKpiCards');
    if (!container) return;

    // Hide share insights panel for T1 vs T2 view
    const sharePanel = document.getElementById('vehicleShareInsightsPanel');
    if (sharePanel) sharePanel.style.display = 'none';

    const t1Total = t1Cars + t1Bikes;
    const t2Total = t2Cars + t2Bikes;
    const grandTotal = t1Total + t2Total;
    
    // Calculate percentages within each tier
    const t1CarsPct = ((t1Cars / t1Total) * 100).toFixed(1);
    const t1BikesPct = ((t1Bikes / t1Total) * 100).toFixed(1);
    const t2CarsPct = ((t2Cars / t2Total) * 100).toFixed(1);
    const t2BikesPct = ((t2Bikes / t2Total) * 100).toFixed(1);
    
    // Calculate bikes growth comparison
    const t1BikesShare = (t1Bikes / t1Total) * 100;
    const t2BikesShare = (t2Bikes / t2Total) * 100;

    // Calculate averages per month (6 months of data)
    const t1AvgPerMonth = Math.round(t1Total / 6);
    const t2AvgPerMonth = Math.round(t2Total / 6);
    const grandAvgPerMonth = Math.round(grandTotal / 6);

    container.innerHTML = `
      <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #1e40af;">
        <div style="font-size: 11px; color: #1e40af; font-weight: 600;">🏙️ T1 Avg (${((t1Total/grandTotal)*100).toFixed(1)}%)</div>
        <div style="font-size: 20px; font-weight: 700; color: #1e40af;">${t1AvgPerMonth.toLocaleString()}</div>
        <div style="font-size: 10px; color: #3b82f6;">🚗 ${Math.round(t1Cars/6).toLocaleString()} (${t1CarsPct}%) | 🏍️ ${Math.round(t1Bikes/6).toLocaleString()} (${t1BikesPct}%)</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${t1Total.toLocaleString()}</div>
      </div>
      <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #047857;">
        <div style="font-size: 11px; color: #065f46; font-weight: 600;">🌆 T2 Avg (${((t2Total/grandTotal)*100).toFixed(1)}%)</div>
        <div style="font-size: 20px; font-weight: 700; color: #065f46;">${t2AvgPerMonth.toLocaleString()}</div>
        <div style="font-size: 10px; color: #10b981;">🚗 ${Math.round(t2Cars/6).toLocaleString()} (${t2CarsPct}%) | 🏍️ ${Math.round(t2Bikes/6).toLocaleString()} (${t2BikesPct}%)</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${t2Total.toLocaleString()}</div>
      </div>
      <div style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #8b5cf6;">
        <div style="font-size: 11px; color: #5b21b6; font-weight: 600;">📊 Avg Total (per month)</div>
        <div style="font-size: 20px; font-weight: 700; color: #6d28d9;">${grandAvgPerMonth.toLocaleString()}</div>
        <div style="font-size: 10px; color: #8b5cf6;">🚗 ${Math.round((t1Cars + t2Cars)/6).toLocaleString()} | 🏍️ ${Math.round((t1Bikes + t2Bikes)/6).toLocaleString()}</div>
        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">total: ${grandTotal.toLocaleString()}</div>
      </div>
      <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #f59e0b;">
        <div style="font-size: 11px; color: #92400e; font-weight: 600;">🏍️ Bikes Share</div>
        <div style="font-size: 18px; font-weight: 700; color: #b45309;">T1: ${t1BikesPct}% | T2: ${t2BikesPct}%</div>
        <div style="font-size: 10px; color: #f59e0b;">T2 has ${(t2BikesShare - t1BikesShare).toFixed(1)}% higher bikes share</div>
      </div>
    `;
  }

  function renderVehicleDataTable() {
    const container = document.getElementById('vehicleTableContainer');
    if (!container) return;

    // Determine which cities to show based on current filters
    let citiesToShow = [];
    if (currentCity !== 'all') {
      citiesToShow = [currentCity];
    } else if (currentCityLevel === 't1') {
      citiesToShow = t1Cities;
    } else if (currentCityLevel === 't2') {
      citiesToShow = t2Cities;
    } else {
      citiesToShow = [...t1Cities, ...t2Cities];
    }

    // Calculate bikes/cars share for each city to determine highlighting
    const cityBikesShare = {};
    const cityCarsShare = {};
    citiesToShow.forEach(city => {
      const data = cityVehicleData[city];
      const totalCars = data.cars.reduce((a, b) => a + b, 0);
      const totalBikes = data.bikes.reduce((a, b) => a + b, 0);
      const total = totalCars + totalBikes;
      cityBikesShare[city] = total > 0 ? (totalBikes / total) * 100 : 0;
      cityCarsShare[city] = total > 0 ? (totalCars / total) * 100 : 0;
    });

    // Sort cities by bikes share to find highest/moderate/lowest
    const sortedByBikes = [...citiesToShow].sort((a, b) => cityBikesShare[b] - cityBikesShare[a]);
    const highestBikes = sortedByBikes.slice(0, 3).map(c => c);
    const lowestBikes = sortedByBikes.slice(-3).map(c => c);

    // Build table HTML
    let html = `
      <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
        <thead>
          <tr style="background: #1e40af; color: white;">
            <th rowspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: left; position: sticky; top: 0; background: #1e40af; z-index: 2; vertical-align: middle;">City</th>
            <th rowspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e40af; font-size: 10px; vertical-align: middle;">Overall Avg<br>Car 🚗 %</th>
            <th rowspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e40af; font-size: 10px; vertical-align: middle;">Overall Avg<br>Bike 🏍️ %</th>
            <th colspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e40af;">Sep</th>
            <th colspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e3a8a;">Oct</th>
            <th colspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e40af;">Nov</th>
            <th colspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e3a8a;">Dec</th>
            <th colspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e40af;">Jan</th>
            <th colspan="2" style="padding: 10px; border: 1px solid #1e40af; text-align: center; position: sticky; top: 0; background: #1e3a8a;">Feb</th>
          </tr>
          <tr style="background: #2563eb; color: white;">
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Car 🚗</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Bike 🏍️</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Car 🚗</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Bike 🏍️</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Car 🚗</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Bike 🏍️</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Car 🚗</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Bike 🏍️</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Car 🚗</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Bike 🏍️</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Car 🚗</th>
            <th style="padding: 6px; border: 1px solid #2563eb; text-align: center;">Bike 🏍️</th>
          </tr>
        </thead>
        <tbody>`;

    // Calculate totals
    let totalCars = [0, 0, 0, 0, 0, 0];
    let totalBikes = [0, 0, 0, 0, 0, 0];

    citiesToShow.forEach((city, idx) => {
      const data = cityVehicleData[city];
      const tier = data.tier;
      const bikesShare = cityBikesShare[city];
      const carsShare = cityCarsShare[city];
      
      // Update totals
      for (let i = 0; i < 6; i++) {
        totalCars[i] += data.cars[i];
        totalBikes[i] += data.bikes[i];
      }

      // Determine row highlighting based on bikes share
      let rowStyle = '';
      let bikesStyle = '';
      let carsStyle = 'background: #dbeafe; color: #1e40af; font-weight: 600;';
      if (highestBikes.includes(city) && bikesShare > 0) {
        rowStyle = 'background: #dcfce7;'; // Green for highest bikes share
        bikesStyle = 'background: #10b981; color: white; font-weight: 700;';
      } else if (lowestBikes.includes(city) || bikesShare === 0) {
        rowStyle = 'background: #fee2e2;'; // Red for lowest bikes share
        bikesStyle = 'background: #ef4444; color: white; font-weight: 700;';
      } else {
        rowStyle = idx % 2 === 0 ? 'background: #f9fafb;' : 'background: #ffffff;';
        bikesStyle = 'background: #fef3c7; color: #92400e; font-weight: 600;';
      }

      // Calculate monthly percentages
      const monthlyPcts = [];
      for (let i = 0; i < 6; i++) {
        const monthTotal = data.cars[i] + data.bikes[i];
        const carPct = monthTotal > 0 ? ((data.cars[i] / monthTotal) * 100).toFixed(1) : '0.0';
        const bikePct = monthTotal > 0 ? ((data.bikes[i] / monthTotal) * 100).toFixed(1) : '0.0';
        monthlyPcts.push({ carPct, bikePct });
      }

      html += `
        <tr style="${rowStyle}">
          <td style="padding: 8px; border: 1px solid #e5e7eb; font-weight: 600;">${tier} - ${city}</td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; ${carsStyle}">${carsShare.toFixed(1)}%</td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center; ${bikesStyle}">${bikesShare.toFixed(1)}%</td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.cars[0].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[0].carPct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.bikes[0].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[0].bikePct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.cars[1].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[1].carPct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.bikes[1].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[1].bikePct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.cars[2].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[2].carPct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.bikes[2].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[2].bikePct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.cars[3].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[3].carPct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.bikes[3].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[3].bikePct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.cars[4].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[4].carPct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.bikes[4].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[4].bikePct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.cars[5].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[5].carPct}%)</span></td>
          <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: right;">${data.bikes[5].toLocaleString()} <span style="color:#6b7280;font-size:9px;">(${monthlyPcts[5].bikePct}%)</span></td>
        </tr>`;
    });

    // Calculate total bikes/cars share
    const grandTotalCars = totalCars.reduce((a, b) => a + b, 0);
    const grandTotalBikes = totalBikes.reduce((a, b) => a + b, 0);
    const grandTotal = grandTotalCars + grandTotalBikes;
    const totalBikesShare = grandTotal > 0 ? (grandTotalBikes / grandTotal) * 100 : 0;
    const totalCarsShare = grandTotal > 0 ? (grandTotalCars / grandTotal) * 100 : 0;

    // Calculate monthly percentages for totals
    const totalMonthlyPcts = [];
    for (let i = 0; i < 6; i++) {
      const monthTotal = totalCars[i] + totalBikes[i];
      const carPct = monthTotal > 0 ? ((totalCars[i] / monthTotal) * 100).toFixed(1) : '0.0';
      const bikePct = monthTotal > 0 ? ((totalBikes[i] / monthTotal) * 100).toFixed(1) : '0.0';
      totalMonthlyPcts.push({ carPct, bikePct });
    }

    // Add totals row
    html += `
        <tr style="background: #1e40af; color: white; font-weight: 700;">
          <td style="padding: 10px; border: 1px solid #1e40af;">Total (${citiesToShow.length} cities)</td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: center; background: #3b82f6;">${totalCarsShare.toFixed(1)}%</td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: center; background: #3b82f6;">${totalBikesShare.toFixed(1)}%</td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalCars[0].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[0].carPct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalBikes[0].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[0].bikePct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalCars[1].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[1].carPct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalBikes[1].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[1].bikePct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalCars[2].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[2].carPct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalBikes[2].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[2].bikePct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalCars[3].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[3].carPct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalBikes[3].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[3].bikePct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalCars[4].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[4].carPct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalBikes[4].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[4].bikePct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalCars[5].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[5].carPct}%)</span></td>
          <td style="padding: 10px; border: 1px solid #1e40af; text-align: right;">${totalBikes[5].toLocaleString()} <span style="opacity:0.8;font-size:9px;">(${totalMonthlyPcts[5].bikePct}%)</span></td>
        </tr>
      </tbody>
    </table>
    <div style="margin-top: 10px; padding: 10px; background: #f3f4f6; border-radius: 6px; font-size: 11px;">
      <span style="display: inline-block; width: 12px; height: 12px; background: #dcfce7; border: 1px solid #10b981; margin-right: 4px; vertical-align: middle;"></span> Highest Bikes Share
      <span style="display: inline-block; width: 12px; height: 12px; background: #fee2e2; border: 1px solid #ef4444; margin-left: 15px; margin-right: 4px; vertical-align: middle;"></span> Lowest Bikes Share
    </div>`;

    container.innerHTML = html;
  }

  function initVehicleMonthlyCharts() {
    const canvas = document.getElementById('vehicleMonthlyChart');
    if (!canvas) return;

    // Render initial view and table
    renderVehicleMonthlyChart();
    renderVehicleDataTable();
  }

  // Expose functions globally
  window.switchVehicleMonthlyView = switchVehicleMonthlyView;
  window.filterVehicleCityLevel = filterVehicleCityLevel;
  window.filterVehicleCity = filterVehicleCity;
  window.initVehicleMonthlyCharts = initVehicleMonthlyCharts;
  window.renderVehicleDataTable = renderVehicleDataTable;

  // Auto-init on load
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(initVehicleMonthlyCharts, 100);
  });
})();

    // Partner Willing Data
        const partnerWillingData = [
        {
            "month": "Sep",
            "total_partners": 615,
            "willing": 0,
            "not_willing": 0,
            "willing_pct": 0.0,
            "not_willing_pct": 0.0
        },
        {
            "month": "Oct",
            "total_partners": 697,
            "willing": 213,
            "not_willing": 356,
            "willing_pct": 37.4,
            "not_willing_pct": 62.6
        },
        {
            "month": "Nov",
            "total_partners": 767,
            "willing": 259,
            "not_willing": 381,
            "willing_pct": 40.5,
            "not_willing_pct": 59.5
        },
        {
            "month": "Dec",
            "total_partners": 674,
            "willing": 81,
            "not_willing": 554,
            "willing_pct": 12.8,
            "not_willing_pct": 87.2
        },
        {
            "month": "Jan",
            "total_partners": 625,
            "willing": 201,
            "not_willing": 413,
            "willing_pct": 32.7,
            "not_willing_pct": 67.3
        },
        {
            "month": "Feb",
            "total_partners": 551,
            "willing": 130,
            "not_willing": 398,
            "willing_pct": 24.6,
            "not_willing_pct": 75.4
        },
    ];
    function initPartnerWillingAnalysis() {
        try {
            createWillingVsNotWillingChart();
            createWillingnessTrendChart();
            createGrowthCategoryChart();
            createDecreaseCategoryChart();
            createAvgScalePerfChart();
            createAvgScaleSizeChart();
} catch (error) {
            console.error('Error initializing partner willing analysis:', error);
        }
    }

    function createWillingVsNotWillingChart() {
        const ctx = document.getElementById('willingVsNotWillingChart');
        if (!ctx) {
            console.log('willingVsNotWillingChart canvas not found');
            return;
        }
        
        const dataWithoutJune = partnerWillingData.filter(d => d.month !== 'Sep');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dataWithoutJune.map(d => d.month),
                datasets: [
                    {
                        label: 'Not-Willing (≤0)',
                        data: dataWithoutJune.map(d => d.not_willing),
                        backgroundColor: '#ef4444',
                        borderColor: '#dc2626',
                        borderWidth: 2
                    },
                    {
                        label: 'Willing (>0)',
                        data: dataWithoutJune.map(d => d.willing),
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 12
                        },
                        formatter: function(value) {
                            return value;
                        }
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Partners'
                        }
                    }
                }
            },
            plugins: [ChartDataLabels]
        });
    }

    function createWillingnessTrendChart() {
        const ctx = document.getElementById('willingnessTrendChart');
        if (!ctx) {
            console.log('willingnessTrendChart canvas not found');
            return;
        }
        
        const dataWithoutJune = partnerWillingData.filter(d => d.month !== 'Sep');
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dataWithoutJune.map(d => d.month),
                datasets: [
                    {
                        label: 'Willing %',
                        data: dataWithoutJune.map(d => d.willing_pct),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    },
                    {
                        label: 'Not-Willing %',
                        data: dataWithoutJune.map(d => d.not_willing_pct),
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    datalabels: {
                        color: '#111827',
                        font: {
                            weight: 'bold',
                            size: 11
                        },
                        formatter: function(value) {
                            return value.toFixed(1) + '%';
                        },
                        anchor: 'end',
                        align: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Percentage (%)'
                        }
                    }
                }
            },
            plugins: [ChartDataLabels]
        });
    }

        function createGrowthCategoryChart() {
        const ctx = document.getElementById('growthCategoryChart');
        if (!ctx) {
            console.log('growthCategoryChart canvas not found');
            return;
        }
        
        const months = ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
        const inc1_10 = [42, 60, 73, 22, 79, 46];
        const inc11_20 = [63, 60, 75, 23, 58, 52];
        const inc21_30 = [40, 29, 31, 11, 28, 16];
        const incGt30 = [54, 64, 80, 25, 36, 16];
        const totalIncrease = [199, 213, 259, 81, 201, 130];
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: '≥1%-≤10%',
                        data: inc1_10,
                        backgroundColor: '#60a5fa',
                        borderColor: '#3b82f6',
                        borderWidth: 2
                    },
                    {
                        label: '≥11%-≤20%',
                        data: inc11_20,
                        backgroundColor: '#34d399',
                        borderColor: '#10b981',
                        borderWidth: 2
                    },
                    {
                        label: '≥21%-≤30%',
                        data: inc21_30,
                        backgroundColor: '#fbbf24',
                        borderColor: '#f59e0b',
                        borderWidth: 2
                    },
                    {
                        label: '>30%',
                        data: incGt30,
                        backgroundColor: '#f87171',
                        borderColor: '#ef4444',
                        borderWidth: 2
                    },
                    {
                        label: 'Total Increase Trend',
                        data: totalIncrease,
                        type: 'line',
                        borderColor: '#111827',
                        backgroundColor: '#111827',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: '#111827',
                        yAxisID: 'y1',
                        datalabels: {
                            display: true,
                            color: '#111827',
                            font: { weight: 'bold', size: 12 },
                            anchor: 'end',
                            align: 'top'
                        }
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    datalabels: {
                        display: function(context) {
                            return context.dataset.type !== 'line';
                        },
                        color: '#fff',
                        font: { weight: 'bold', size: 10 },
                        formatter: function(value) {
                            return value > 0 ? value : '';
                        }
                    }
                },
                scales: {
                    x: { stacked: false, grid: { display: false } },
                    y: { stacked: false, beginAtZero: true, title: { display: true, text: 'Partners (Bars)' } },
                    y1: { position: 'right', beginAtZero: true, grid: { drawOnChartArea: false }, title: { display: true, text: 'Total Increases (Line)' } }
                }
            },
            plugins: [ChartDataLabels]
        });
    }


        // Decrease Category Chart
    function createDecreaseCategoryChart() {
        const ctx = document.getElementById('decreaseCategoryChart');
        if (!ctx) {
            console.log('decreaseCategoryChart canvas not found');
            return;
        }
        
        const months = ['Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26', 'Feb-26'];
        const dec1_10 = [17, 39, 40, 52, 64, 84];
        const dec11_20 = [38, 56, 64, 108, 77, 98];
        const dec21_30 = [21, 26, 43, 83, 42, 50];
        const decLt30 = [48, 40, 41, 215, 56, 52];
        const totalDecrease = [124, 161, 188, 458, 239, 284];
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: '≥1%-≤10%',
                        data: dec1_10,
                        backgroundColor: '#fbbf24',
                        borderColor: '#f59e0b',
                        borderWidth: 2
                    },
                    {
                        label: '≥11%-≤20%',
                        data: dec11_20,
                        backgroundColor: '#fb923c',
                        borderColor: '#f97316',
                        borderWidth: 2
                    },
                    {
                        label: '≥21%-≤30%',
                        data: dec21_30,
                        backgroundColor: '#f87171',
                        borderColor: '#ef4444',
                        borderWidth: 2
                    },
                    {
                        label: '>30%',
                        data: decLt30,
                        backgroundColor: '#dc2626',
                        borderColor: '#b91c1c',
                        borderWidth: 2
                    },
                    {
                        label: 'Total Decrease Trend',
                        data: totalDecrease,
                        type: 'line',
                        borderColor: '#111827',
                        backgroundColor: '#111827',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: '#111827',
                        yAxisID: 'y1',
                        datalabels: {
                            display: true,
                            color: '#111827',
                            font: { weight: 'bold', size: 12 },
                            anchor: 'end',
                            align: 'top'
                        }
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    datalabels: {
                        display: function(context) {
                            return context.dataset.type !== 'line';
                        },
                        color: '#fff',
                        font: { weight: 'bold', size: 10 },
                        formatter: function(value) {
                            return value > 0 ? value : '';
                        }
                    }
                },
                scales: {
                    x: { stacked: false, grid: { display: false } },
                    y: { stacked: false, beginAtZero: true, title: { display: true, text: 'Partners (Bars)' } },
                    y1: { position: 'right', beginAtZero: true, grid: { drawOnChartArea: false }, title: { display: true, text: 'Total Decreases (Line)' } }
                }
            },
            plugins: [ChartDataLabels]
        });
    }


    
    function createAvgScalePerfChart() {
        const ctx = document.getElementById('avgScalePerfChart');
        if (!ctx) {
            console.log('avgScalePerfChart canvas not found');
            return;
        }
        
        const months = ['Aug-25', 'Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26'];
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Good',
                        data: [63.2, 70.2, 58.3, 55.7, 49.4, 46.2],
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 2
                    },
                    {
                        label: 'Average',
                        data: [63.7, 62.3, 58.6, 51.5, 32.5, 30.8],
                        backgroundColor: '#f59e0b',
                        borderColor: '#d97706',
                        borderWidth: 2
                    },
                    {
                        label: 'Bad',
                        data: [43.2, 40.7, 38.5, 40.3, 23.6, 21.5],
                        backgroundColor: '#ef4444',
                        borderColor: '#dc2626',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    datalabels: {
                        display: true,
                        color: '#fff',
                        font: { weight: 'bold', size: 10 },
                        formatter: function(value) {
                            return value;
                        }
                    }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: true, title: { display: true, text: 'Avg Riders per Partner' } }
                }
            },
            plugins: [ChartDataLabels]
        });
    }

    function createAvgScaleSizeChart() {
        const ctx = document.getElementById('avgScaleSizeChart');
        if (!ctx) {
            console.log('avgScaleSizeChart canvas not found');
            return;
        }
        
        const months = ['Aug-25', 'Sep-25', 'Oct-25', 'Nov-25', 'Dec-25', 'Jan-26'];
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Big',
                        data: [101.6, 122.0, 106.8, 105.4, 77.5, 62.1],
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 2
                    },
                    {
                        label: 'Mid',
                        data: [56.7, 61.0, 55.0, 50.9, 36.9, 38.8],
                        backgroundColor: '#8b5cf6',
                        borderColor: '#7c3aed',
                        borderWidth: 2
                    },
                    {
                        label: 'Small',
                        data: [34.5, 35.3, 29.9, 28.0, 19.5, 26.0],
                        backgroundColor: '#06b6d4',
                        borderColor: '#0891b2',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: true, position: 'top' },
                    datalabels: {
                        display: true,
                        color: '#fff',
                        font: { weight: 'bold', size: 10 },
                        formatter: function(value) {
                            return value;
                        }
                    }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: true, title: { display: true, text: 'Avg Riders per Partner' } }
                }
            },
            plugins: [ChartDataLabels]
        });
    }


    function createMoMChartNew() {
        const canvas = document.getElementById('monthlyMoMChangeChartNew');
        if (!canvas || typeof Chart === 'undefined') return;

        // Source of truth: Monthly Insights totals (same totals shown in the dashboard)
        const md = (typeof monthlyData !== 'undefined') ? monthlyData : null;
        const months = (md && Array.isArray(md.months)) ? md.months.slice() : [];
        const targets = (md && Array.isArray(md.totalTarget)) ? md.totalTarget.slice() : [];

        if (!months.length || months.length !== targets.length) return;

        // MoM%: (current - previous) / previous
        const mom = targets.map((t, i) => {
            if (i === 0 || !targets[i - 1]) return null; // baseline month
            return ((t - targets[i - 1]) / targets[i - 1]) * 100;
        });

        const bg = mom.map(v => (v === null) ? '#9ca3af' : (v >= 0 ? '#10b981' : '#ef4444'));
        const border = mom.map(v => (v === null) ? '#6b7280' : (v >= 0 ? '#059669' : '#dc2626'));

        // Re-init safely
        if (window.__momChartNew && typeof window.__momChartNew.destroy === 'function') {
            window.__momChartNew.destroy();
        }

        const useDL = (typeof ChartDataLabels !== 'undefined');
        const pluginsArr = useDL ? [ChartDataLabels] : [];

        window.__momChartNew = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'MoM Change %',
                    data: mom,
                    backgroundColor: bg,
                    borderColor: border,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false },
                    datalabels: useDL ? {
                        display: (ctx) => ctx.dataset.data[ctx.dataIndex] !== null,
                        color: '#111827',
                        font: { weight: 'bold', size: 12 },
                        formatter: (value) => (value === null ? '' : value.toFixed(1) + '%'),
                        anchor: (ctx) => (ctx.dataset.data[ctx.dataIndex] >= 0 ? 'end' : 'start'),
                        align: (ctx) => (ctx.dataset.data[ctx.dataIndex] >= 0 ? 'top' : 'bottom')
                    } : { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => {
                                const v = ctx.parsed.y;
                                if (v === null || typeof v === 'undefined') return 'Baseline month';
                                return 'MoM Change: ' + v.toFixed(2) + '%';
                            }
                        }
                    }
                },
                scales: {
                    x: { ticks: { color: '#111827' } },
                    y: {
                        title: { display: true, text: 'Month-over-Month Change (%)', color: '#111827' },
                        ticks: {
                            color: '#111827',
                            callback: (v) => v.toFixed(0) + '%'
                        }
                    }
                }
            },
            plugins: pluginsArr
        });
    }

    // Initialize charts when monthly tab is active
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            initPartnerWillingAnalysis();
        }, 1000);
    });
    
    // Re-initialize when switching to monthly tab
    const originalSwitchTab = window.switchTab;
    if (typeof originalSwitchTab === 'function') {
        window.switchTab = function(tabId, element) {
            originalSwitchTab(tabId, element);
            if (tabId === 'monthly') {
                setTimeout(function() {
                    initPartnerWillingAnalysis();
                }, 300);
            }
        };
    }

    
    // Top Movers Data and Functions
    const topMoversData = [
        {
            "month": "Sep",
            "top_biggest": [
                {
                    "rank": 1,
                    "partner": "SWEX",
                    "newold": "Old",
                    "actual": 1595,
                    "target": 1190
                },
                {
                    "rank": 2,
                    "partner": "First Line Logistics",
                    "newold": "New",
                    "actual": 725,
                    "target": 730
                },
                {
                    "rank": 3,
                    "partner": "ON Time Logistics",
                    "newold": "New",
                    "actual": 676,
                    "target": 690
                },
                {
                    "rank": 4,
                    "partner": "Rider's King",
                    "newold": "New",
                    "actual": 659,
                    "target": 630
                },
                {
                    "rank": 5,
                    "partner": "Makhsos logsitics",
                    "newold": "Old",
                    "actual": 828,
                    "target": 484
                },
                {
                    "rank": 6,
                    "partner": "Nader logistics",
                    "newold": "Old",
                    "actual": 324,
                    "target": 440
                },
                {
                    "rank": 7,
                    "partner": "AL-ZAHRANI",
                    "newold": "New",
                    "actual": 311,
                    "target": 421
                },
                {
                    "rank": 8,
                    "partner": "Gulf Support",
                    "newold": "Old",
                    "actual": 240,
                    "target": 405
                },
                {
                    "rank": 9,
                    "partner": "ONE TRIP",
                    "newold": "New",
                    "actual": 226,
                    "target": 382
                },
                {
                    "rank": 10,
                    "partner": "Markhor",
                    "newold": "Old",
                    "actual": 329,
                    "target": 381
                },
                {
                    "rank": 11,
                    "partner": "albwaba",
                    "newold": "New",
                    "actual": 414,
                    "target": 365
                },
                {
                    "rank": 12,
                    "partner": "Company Minassah Sahm Commercial",
                    "newold": "Old",
                    "actual": 270,
                    "target": 365
                },
                {
                    "rank": 13,
                    "partner": "SDC Logistics",
                    "newold": "Old",
                    "actual": 195,
                    "target": 340
                },
                {
                    "rank": 14,
                    "partner": "Aibtukir",
                    "newold": "Old",
                    "actual": 299,
                    "target": 324
                },
                {
                    "rank": 15,
                    "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services",
                    "newold": "Old",
                    "actual": 282,
                    "target": 308
                },
                {
                    "rank": 16,
                    "partner": "Sultan abdulaziz saad Albathrah for logistic services",
                    "newold": "Old",
                    "actual": 283,
                    "target": 295
                },
                {
                    "rank": 17,
                    "partner": "Anan Capital",
                    "newold": "Old",
                    "actual": 188,
                    "target": 290
                },
                {
                    "rank": 18,
                    "partner": "services delivery",
                    "newold": "New",
                    "actual": 172,
                    "target": 285
                },
                {
                    "rank": 19,
                    "partner": "Halloul Chark",
                    "newold": "New",
                    "actual": 263,
                    "target": 282
                },
                {
                    "rank": 20,
                    "partner": "Funoon Alkawader",
                    "newold": "Old",
                    "actual": 164,
                    "target": 270
                },
            ],
            "bottom_smallest": [
                {
                    "rank": 1,
                    "partner": "Takamul Al-Imdad for Logistics Services",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 2,
                    "partner": "Code Car",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 3,
                    "partner": "Four Sheeb",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 4,
                    "partner": "Husool",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 5,
                    "partner": "ASHRAF BEN HASSIN BEN ALI BOUGRARDAH",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 6,
                    "partner": "Red Belt",
                    "newold": "Old",
                    "actual": 0,
                    "target": 12
                },
                {
                    "rank": 7,
                    "partner": "LAST SPEED",
                    "newold": "New",
                    "actual": 8,
                    "target": 15
                },
                {
                    "rank": 8,
                    "partner": "Mashariq Al Makan",
                    "newold": "Old",
                    "actual": 2,
                    "target": 15
                },
                {
                    "rank": 9,
                    "partner": "Nabd Alimdad",
                    "newold": "Old",
                    "actual": 0,
                    "target": 15
                },
                {
                    "rank": 10,
                    "partner": "Quma Teser",
                    "newold": "Old",
                    "actual": 12,
                    "target": 15
                },
                {
                    "rank": 11,
                    "partner": "ELIOUM AL-AFDAL",
                    "newold": "Old",
                    "actual": 1,
                    "target": 15
                },
                {
                    "rank": 12,
                    "partner": "Himmat alItqan",
                    "newold": "Old",
                    "actual": 0,
                    "target": 15
                },
                {
                    "rank": 13,
                    "partner": "DOUA AL-MASSAR",
                    "newold": "Old",
                    "actual": 0,
                    "target": 15
                },
                {
                    "rank": 14,
                    "partner": "Captain manama",
                    "newold": "Old",
                    "actual": 0,
                    "target": 15
                },
                {
                    "rank": 15,
                    "partner": "Alrawafid",
                    "newold": "Old",
                    "actual": 0,
                    "target": 15
                },
                {
                    "rank": 16,
                    "partner": "Dawaer Elemdad",
                    "newold": "Old",
                    "actual": 0,
                    "target": 16
                },
                {
                    "rank": 17,
                    "partner": "AZM",
                    "newold": "Old",
                    "actual": 0,
                    "target": 19
                },
                {
                    "rank": 18,
                    "partner": "Alrawazan",
                    "newold": "Old",
                    "actual": 0,
                    "target": 19
                },
                {
                    "rank": 19,
                    "partner": "Solution alinjaz",
                    "newold": "Old",
                    "actual": 2,
                    "target": 20
                },
                {
                    "rank": 20,
                    "partner": "Kifayah",
                    "newold": "Old",
                    "actual": 6,
                    "target": 20
                },
            ]
        },
        {
            "month": "Oct",
            "top_biggest": [
                {
                    "rank": 1,
                    "partner": "ON Time Logistics",
                    "newold": "New",
                    "actual": 696,
                    "target": 755
                },
                {
                    "rank": 2,
                    "partner": "SWEX",
                    "newold": "Old",
                    "actual": 1256,
                    "target": 678
                },
                {
                    "rank": 3,
                    "partner": "First Line Logistics",
                    "newold": "New",
                    "actual": 763,
                    "target": 631
                },
                {
                    "rank": 4,
                    "partner": "Gulf Support",
                    "newold": "Old",
                    "actual": 350,
                    "target": 408
                },
                {
                    "rank": 5,
                    "partner": "AL-ZAHRANI",
                    "newold": "Old",
                    "actual": 374,
                    "target": 391
                },
                {
                    "rank": 6,
                    "partner": "Nader logistics",
                    "newold": "Old",
                    "actual": 391,
                    "target": 380
                },
                {
                    "rank": 7,
                    "partner": "Company Minassah Sahm Commercial",
                    "newold": "Old",
                    "actual": 296,
                    "target": 365
                },
                {
                    "rank": 8,
                    "partner": "SDC Logistics",
                    "newold": "New",
                    "actual": 302,
                    "target": 350
                },
                {
                    "rank": 9,
                    "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services",
                    "newold": "Old",
                    "actual": 312,
                    "target": 347
                },
                {
                    "rank": 10,
                    "partner": "Funoon Alkawader",
                    "newold": "Old",
                    "actual": 244,
                    "target": 320
                },
                {
                    "rank": 11,
                    "partner": "Rider's King",
                    "newold": "Old",
                    "actual": 626,
                    "target": 315
                },
                {
                    "rank": 12,
                    "partner": "albwaba",
                    "newold": "New",
                    "actual": 376,
                    "target": 312
                },
                {
                    "rank": 13,
                    "partner": "ONE TRIP",
                    "newold": "New",
                    "actual": 354,
                    "target": 310
                },
                {
                    "rank": 14,
                    "partner": "services delivery",
                    "newold": "New",
                    "actual": 266,
                    "target": 305
                },
                {
                    "rank": 15,
                    "partner": "AL-BARAQ AL-KHATEF",
                    "newold": "Old",
                    "actual": 244,
                    "target": 300
                },
                {
                    "rank": 16,
                    "partner": "Anan Capital",
                    "newold": "Old",
                    "actual": 259,
                    "target": 292
                },
                {
                    "rank": 17,
                    "partner": "FAHAD AL-SHARQ",
                    "newold": "Old",
                    "actual": 221,
                    "target": 270
                },
                {
                    "rank": 18,
                    "partner": "Aibtukir",
                    "newold": "Old",
                    "actual": 331,
                    "target": 265
                },
                {
                    "rank": 19,
                    "partner": "Markhor",
                    "newold": "Old",
                    "actual": 371,
                    "target": 250
                },
                {
                    "rank": 20,
                    "partner": "MADD",
                    "newold": "Old",
                    "actual": 203,
                    "target": 245
                },
            ],
            "bottom_smallest": [
                {
                    "rank": 1,
                    "partner": "GHAZAL LOGISTICS",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 2,
                    "partner": "saudiExpress",
                    "actual": 23.7,
                    "target": 10
                },
                {
                    "rank": 3,
                    "partner": "KDC Logistics",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 4,
                    "partner": "ALK",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 5,
                    "partner": "Meyzat Al-Takamul",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 6,
                    "partner": "NAS",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 7,
                    "partner": "Swiftlane",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 8,
                    "partner": "Last Moment",
                    "actual": 0.6,
                    "target": 10
                },
                {
                    "rank": 9,
                    "partner": "Nukhba Al Madinah",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 10,
                    "partner": "Alkhutut Almudhia",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 11,
                    "partner": "Husool",
                    "actual": 9.1,
                    "target": 10
                },
                {
                    "rank": 12,
                    "partner": "Triple Step",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 13,
                    "partner": " AL-BARQ LOGISTICS",
                    "actual": 0.8,
                    "target": 10
                },
                {
                    "rank": 14,
                    "partner": "ASTOL AL-WASSAL",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 15,
                    "partner": "Abrar Abdulrahman",
                    "actual": 19.2,
                    "target": 10
                },
                {
                    "rank": 16,
                    "partner": "ASHRAF BEN HASSIN BEN ALI BOUGRARDAH",
                    "actual": 10.1,
                    "target": 10
                },
                {
                    "rank": 17,
                    "partner": "AL-ABOUR MUMAIZ",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 18,
                    "partner": "Fast Food",
                    "actual": 21.5,
                    "target": 11
                },
                {
                    "rank": 19,
                    "partner": "ASMA HAMOOD",
                    "actual": 0,
                    "target": 11
                },
                {
                    "rank": 20,
                    "partner": "4th Goal Est",
                    "actual": 0,
                    "target": 12
                },
            ]
        },
        {
            "month": "Nov",
            "top_biggest": [
                {
                    "rank": 1,
                    "partner": "ON Time Logistics",
                    "newold": "Old",
                    "actual": 761,
                    "target": 580
                },
                {
                    "rank": 2,
                    "partner": "SWEX",
                    "newold": "Old",
                    "actual": 812,
                    "target": 481
                },
                {
                    "rank": 3,
                    "partner": "First Line Logistics",
                    "newold": "Old",
                    "actual": 636,
                    "target": 457
                },
                {
                    "rank": 4,
                    "partner": "Gulf Support",
                    "newold": "Old",
                    "actual": 407,
                    "target": 370
                },
                {
                    "rank": 5,
                    "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services",
                    "newold": "Old",
                    "actual": 331,
                    "target": 350
                },
                {
                    "rank": 6,
                    "partner": "ONE TRIP",
                    "newold": "Old",
                    "actual": 333,
                    "target": 345
                },
                {
                    "rank": 7,
                    "partner": "SDC Logistics",
                    "newold": "New",
                    "actual": 342,
                    "target": 345
                },
                {
                    "rank": 8,
                    "partner": "AL-BARAQ AL-KHATEF",
                    "newold": "Old",
                    "actual": 286,
                    "target": 320
                },
                {
                    "rank": 9,
                    "partner": "Nader logistics",
                    "newold": "Old",
                    "actual": 359,
                    "target": 315
                },
                {
                    "rank": 10,
                    "partner": "services delivery",
                    "newold": "Old",
                    "actual": 294,
                    "target": 309
                },
                {
                    "rank": 11,
                    "partner": "FAHAD AL-SHARQ",
                    "newold": "Old",
                    "actual": 253,
                    "target": 300
                },
                {
                    "rank": 12,
                    "partner": "Funoon Alkawader",
                    "newold": "Old",
                    "actual": 269,
                    "target": 290
                },
                {
                    "rank": 13,
                    "partner": "PARTNER SUCCESS",
                    "newold": "Old",
                    "actual": 204,
                    "target": 270
                },
                {
                    "rank": 14,
                    "partner": "AL-ZAHRANI",
                    "newold": "Old",
                    "actual": 381,
                    "target": 260
                },
                {
                    "rank": 15,
                    "partner": "MADD",
                    "newold": "Old",
                    "actual": 246,
                    "target": 255
                },
                {
                    "rank": 16,
                    "partner": "Anan Capital",
                    "newold": "Old",
                    "actual": 269,
                    "target": 250
                },
                {
                    "rank": 17,
                    "partner": "Masar",
                    "newold": "Old",
                    "actual": 188,
                    "target": 250
                },
                {
                    "rank": 18,
                    "partner": "Plus Logistics",
                    "newold": "New",
                    "actual": 181,
                    "target": 249
                },
                {
                    "rank": 19,
                    "partner": "Next Mile",
                    "newold": "New",
                    "actual": 220,
                    "target": 236
                },
                {
                    "rank": 20,
                    "partner": "Aibtukir",
                    "newold": "Old",
                    "actual": 264,
                    "target": 235
                },
            ],
            "bottom_smallest": [
                {
                    "rank": 1,
                    "partner": "My Way Logistics",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 2,
                    "partner": "NAWAF",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 3,
                    "partner": "Darb Al-Thuraya",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 4,
                    "partner": "ALK",
                    "newold": "New",
                    "actual": 6,
                    "target": 10
                },
                {
                    "rank": 5,
                    "partner": "Noor Alraida",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 6,
                    "partner": "lwaft aldhahab",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 7,
                    "partner": "Marasi Roads",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 8,
                    "partner": "Golden takfoul logistics service",
                    "newold": "New",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 9,
                    "partner": "Mister Wasil",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 10,
                    "partner": "Dan Al Sharq",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 11,
                    "partner": "Taif Al-Badr",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 12,
                    "partner": "Ayan Logistics",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 13,
                    "partner": "Abrar Abdulrahman",
                    "newold": "Old",
                    "actual": 15,
                    "target": 10
                },
                {
                    "rank": 14,
                    "partner": "ASHRAF BEN HASSIN BEN ALI BOUGRARDAH",
                    "newold": "Old",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 15,
                    "partner": "GHADAY HASSAN NASSER AL ABBAS",
                    "newold": "Old",
                    "actual": 0,
                    "target": 11
                },
                {
                    "rank": 16,
                    "partner": "GHAZAL LOGISTICS",
                    "newold": "New",
                    "actual": 9,
                    "target": 12
                },
                {
                    "rank": 17,
                    "partner": "3 Star Logistics",
                    "newold": "Old",
                    "actual": 0,
                    "target": 12
                },
                {
                    "rank": 18,
                    "partner": "4th Goal Est",
                    "newold": "New",
                    "actual": 3,
                    "target": 12
                },
                {
                    "rank": 19,
                    "partner": "Husool",
                    "newold": "New",
                    "actual": 12,
                    "target": 12
                },
                {
                    "rank": 20,
                    "partner": "Mohammad Hilal",
                    "newold": "Old",
                    "actual": 0,
                    "target": 12
                },
            ]
        },
        {
            "month": "Dec",
            "top_biggest": [
                {
                    "rank": 1,
                    "partner": "ON Time Logistics",
                    "newold": "Old",
                    "actual": 539,
                    "target": 399
                },
                {
                    "rank": 2,
                    "partner": "ONE TRIP",
                    "newold": "Old",
                    "actual": 350,
                    "target": 319
                },
                {
                    "rank": 3,
                    "partner": "SDC Logistics",
                    "newold": "New",
                    "actual": 331,
                    "target": 300
                },
                {
                    "rank": 4,
                    "partner": "AL-BARAQ AL-KHATEF",
                    "newold": "Old",
                    "actual": 306,
                    "target": 290
                },
                {
                    "rank": 5,
                    "partner": "First Line Logistics",
                    "newold": "Old",
                    "actual": 443,
                    "target": 289
                },
                {
                    "rank": 6,
                    "partner": "PARTNER SUCCESS",
                    "newold": "Old",
                    "actual": 240,
                    "target": 260
                },
                {
                    "rank": 7,
                    "partner": "Funoon Alkawader",
                    "newold": "Old",
                    "actual": 239,
                    "target": 247
                },
                {
                    "rank": 8,
                    "partner": "services delivery",
                    "newold": "Old",
                    "actual": 291,
                    "target": 231
                },
                {
                    "rank": 9,
                    "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services",
                    "newold": "Old",
                    "actual": 344,
                    "target": 207
                },
                {
                    "rank": 10,
                    "partner": "PCC",
                    "newold": "Old",
                    "actual": 200,
                    "target": 205
                },
                {
                    "rank": 11,
                    "partner": "Mahran Logistics",
                    "newold": "Old",
                    "actual": 201,
                    "target": 200
                },
                {
                    "rank": 12,
                    "partner": "Company Minassah Sahm Commercial",
                    "newold": "Old",
                    "actual": 193,
                    "target": 190
                },
                {
                    "rank": 13,
                    "partner": "Anan Capital",
                    "newold": "Old",
                    "actual": 223,
                    "target": 187
                },
                {
                    "rank": 14,
                    "partner": "FAHAD AL-SHARQ",
                    "newold": "Old",
                    "actual": 267,
                    "target": 180
                },
                {
                    "rank": 15,
                    "partner": "AMC",
                    "newold": "Old",
                    "actual": 171,
                    "target": 175
                },
                {
                    "rank": 16,
                    "partner": "Makhsos logsitics",
                    "newold": "Old",
                    "actual": 191,
                    "target": 175
                },
                {
                    "rank": 17,
                    "partner": "AMIYAL",
                    "newold": "Old",
                    "actual": 160,
                    "target": 173
                },
                {
                    "rank": 18,
                    "partner": "Quick Way Logistics",
                    "newold": "Old",
                    "actual": 163,
                    "target": 170
                },
                {
                    "rank": 19,
                    "partner": "Next Mile",
                    "newold": "New",
                    "actual": 194,
                    "target": 165
                },
                {
                    "rank": 20,
                    "partner": "SAKA SRIAA LALCHUDMAT AL-LUGASTIA",
                    "newold": "Old",
                    "actual": 153,
                    "target": 156
                },
            ],
            "bottom_smallest": [
                {
                    "rank": 1,
                    "partner": "My Way Logistics",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 2,
                    "partner": "NAWAF",
                    "newold": "New",
                    "actual": 8,
                    "target": 10
                },
                {
                    "rank": 3,
                    "partner": "QAWAFIL AL-NAKHABA",
                    "newold": "New",
                    "actual": 22,
                    "target": 10
                },
                {
                    "rank": 4,
                    "partner": "R-C-L",
                    "newold": "New",
                    "actual": 22,
                    "target": 10
                },
                {
                    "rank": 5,
                    "partner": "Darb Al-Thuraya",
                    "newold": "New",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 6,
                    "partner": "Mashariq Al Makan",
                    "newold": "New",
                    "actual": 16,
                    "target": 10
                },
                {
                    "rank": 7,
                    "partner": "TRS",
                    "newold": "New",
                    "actual": 20,
                    "target": 10
                },
                {
                    "rank": 8,
                    "partner": "Mountain logistics",
                    "newold": "New",
                    "actual": 27,
                    "target": 10
                },
                {
                    "rank": 9,
                    "partner": "ghayat albinna",
                    "newold": "New",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 10,
                    "partner": "Bakri Al Zubaidi",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 11,
                    "partner": "Osulha for Logistics",
                    "newold": "Old",
                    "actual": 94,
                    "target": 10
                },
                {
                    "rank": 12,
                    "partner": "ALK",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 13,
                    "partner": "Marasi Roads",
                    "newold": "New",
                    "actual": 4,
                    "target": 10
                },
                {
                    "rank": 14,
                    "partner": "ELRAHAL MUMAIZEH",
                    "newold": "New",
                    "actual": 7,
                    "target": 10
                },
                {
                    "rank": 15,
                    "partner": "Aqbal Logistics",
                    "newold": "Old",
                    "actual": 16,
                    "target": 10
                },
                {
                    "rank": 16,
                    "partner": "Roshn",
                    "newold": "New",
                    "actual": 13,
                    "target": 10
                },
                {
                    "rank": 17,
                    "partner": "Al saqr aljarih",
                    "newold": "Old",
                    "actual": 22,
                    "target": 10
                },
                {
                    "rank": 18,
                    "partner": "LEO Delivery",
                    "newold": "Old",
                    "actual": 25,
                    "target": 10
                },
                {
                    "rank": 19,
                    "partner": "onestep",
                    "newold": "Old",
                    "actual": 19,
                    "target": 10
                },
                {
                    "rank": 20,
                    "partner": "ELIOUM AL-AFDAL",
                    "newold": "New",
                    "actual": 17,
                    "target": 10
                },
            ]
        },
        {
            "month": "Jan",
            "top_biggest": [
                {
                    "rank": 1,
                    "partner": "ON Time Logistics",
                    "newold": "Old",
                    "actual": 391,
                    "target": 342
                },
                {
                    "rank": 2,
                    "partner": "ONE TRIP",
                    "newold": "Old",
                    "actual": 340,
                    "target": 318
                },
                {
                    "rank": 3,
                    "partner": "First Line Logistics",
                    "newold": "Old",
                    "actual": 280,
                    "target": 288
                },
                {
                    "rank": 4,
                    "partner": "AL-BARAQ AL-KHATEF",
                    "newold": "Old",
                    "actual": 275,
                    "target": 280
                },
                {
                    "rank": 5,
                    "partner": "SDC Logistics",
                    "newold": "Old",
                    "actual": 306,
                    "target": 265
                },
                {
                    "rank": 6,
                    "partner": "PARTNER SUCCESS",
                    "newold": "Old",
                    "actual": 246,
                    "target": 255
                },
                {
                    "rank": 7,
                    "partner": "services delivery",
                    "newold": "Old",
                    "actual": 233,
                    "target": 228
                },
                {
                    "rank": 8,
                    "partner": "Makhsos logsitics",
                    "newold": "Old",
                    "actual": 171,
                    "target": 218
                },
                {
                    "rank": 9,
                    "partner": "Anan Capital",
                    "newold": "Old",
                    "actual": 172,
                    "target": 205
                },
                {
                    "rank": 10,
                    "partner": "AMC",
                    "newold": "Old",
                    "actual": 165,
                    "target": 193
                },
                {
                    "rank": 11,
                    "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services",
                    "newold": "Old",
                    "actual": 228,
                    "target": 192
                },
                {
                    "rank": 12,
                    "partner": "Funoon Alkawader",
                    "newold": "Old",
                    "actual": 226,
                    "target": 185
                },
                {
                    "rank": 13,
                    "partner": "Quick Way Logistics",
                    "newold": "Old",
                    "actual": 181,
                    "target": 177
                },
                {
                    "rank": 14,
                    "partner": "SAKA SRIAA LALCHUDMAT AL-LUGASTIA",
                    "newold": "Old",
                    "actual": 153,
                    "target": 175
                },
                {
                    "rank": 15,
                    "partner": "AMIYAL",
                    "newold": "Old",
                    "actual": 175,
                    "target": 169
                },
                {
                    "rank": 16,
                    "partner": "FAHAD AL-SHARQ",
                    "newold": "Old",
                    "actual": 145,
                    "target": 169
                },
                {
                    "rank": 17,
                    "partner": "PCC",
                    "newold": "Old",
                    "actual": 200,
                    "target": 168
                },
                {
                    "rank": 18,
                    "partner": "Company Minassah Sahm Commercial",
                    "newold": "Old",
                    "actual": 148,
                    "target": 167
                },
                {
                    "rank": 19,
                    "partner": "Markhor",
                    "newold": "Old",
                    "actual": 115,
                    "target": 160
                },
                {
                    "rank": 20,
                    "partner": "albwaba",
                    "newold": "Old",
                    "actual": 140,
                    "target": 158
                },
            ],
            "bottom_smallest": [
                {
                    "rank": 1,
                    "partner": "My Way Logistics",
                    "newold": "New",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 2,
                    "partner": "NAWAF",
                    "newold": "New",
                    "actual": 9,
                    "target": 10
                },
                {
                    "rank": 3,
                    "partner": "QAWAFIL AL-NAKHABA",
                    "newold": "Old",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 4,
                    "partner": "fal alraqmiya",
                    "newold": "New",
                    "actual": 25,
                    "target": 10
                },
                {
                    "rank": 5,
                    "partner": "ZikraSabiti",
                    "newold": "Old",
                    "actual": 0,
                    "target": 10
                },
                {
                    "rank": 6,
                    "partner": "STUL AL-MATIAZ",
                    "newold": "Old",
                    "actual": 16,
                    "target": 10
                },
                {
                    "rank": 7,
                    "partner": "GHAIMA SAHAB",
                    "newold": "Old",
                    "actual": 29,
                    "target": 10
                },
                {
                    "rank": 8,
                    "partner": "OPS CARE",
                    "newold": "New",
                    "actual": 18,
                    "target": 10
                },
                {
                    "rank": 9,
                    "partner": "Aqbal Logistics",
                    "newold": "Old",
                    "actual": 12,
                    "target": 10
                },
                {
                    "rank": 10,
                    "partner": "Al saqr aljarih",
                    "newold": "Old",
                    "actual": 13,
                    "target": 10
                },
                {
                    "rank": 11,
                    "partner": "LEO Delivery",
                    "newold": "Old",
                    "actual": 13,
                    "target": 10
                },
                {
                    "rank": 12,
                    "partner": "onestep",
                    "newold": "Old",
                    "actual": 12,
                    "target": 10
                },
                {
                    "rank": 13,
                    "partner": "Quma Teser",
                    "newold": "Old",
                    "actual": 14,
                    "target": 10
                },
                {
                    "rank": 14,
                    "partner": "Last Moment",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 15,
                    "partner": "Mister Wasil",
                    "newold": "New",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 16,
                    "partner": "Shabab Tayba",
                    "newold": "New",
                    "actual": 11,
                    "target": 10
                },
                {
                    "rank": 17,
                    "partner": "almasarat althnaiya",
                    "newold": "Old",
                    "actual": 14,
                    "target": 10
                },
                {
                    "rank": 18,
                    "partner": "GRUBB AL-HAJJAZ",
                    "newold": "Old",
                    "actual": 10,
                    "target": 10
                },
                {
                    "rank": 19,
                    "partner": "Alkhatam Co. for logistics services",
                    "newold": "Old",
                    "actual": 48,
                    "target": 10
                },
                {
                    "rank": 20,
                    "partner": "Speedone",
                    "newold": "Old",
                    "actual": 16,
                    "target": 10
                },
            ]
        },
        {
            "month": "Feb",
            "top_biggest": [
                { "rank": 1, "partner": "ON Time Logistics", "newold": "Old", "actual": 332, "target": 325 },
                { "rank": 2, "partner": "ONE TRIP", "newold": "Old", "actual": 311, "target": 315 },
                { "rank": 3, "partner": "PARTNER SUCCESS", "newold": "Old", "actual": 241, "target": 257 },
                { "rank": 4, "partner": "First Line Logistics", "newold": "Old", "actual": 272, "target": 215 },
                { "rank": 5, "partner": "SDC Logistics", "newold": "Old", "actual": 261, "target": 210 },
                { "rank": 6, "partner": "Anan Capital", "newold": "Old", "actual": 184, "target": 198 },
                { "rank": 7, "partner": "AL-BARAQ AL-KHATEF", "newold": "Old", "actual": 265, "target": 195 },
                { "rank": 8, "partner": "Quick Way Logistics", "newold": "Old", "actual": 155, "target": 186 },
                { "rank": 9, "partner": "Makhsos", "newold": "Old", "actual": 189, "target": 180 },
                { "rank": 10, "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services", "newold": "Old", "actual": 182, "target": 169 },
                { "rank": 11, "partner": "PCC", "newold": "Old", "actual": 189, "target": 168 },
                { "rank": 12, "partner": "AMC", "newold": "Old", "actual": 175, "target": 166 },
                { "rank": 13, "partner": "AMIYAL", "newold": "Old", "actual": 157, "target": 150 },
                { "rank": 14, "partner": "FAHAD AL-SHARQ", "newold": "Old", "actual": 151, "target": 150 },
                { "rank": 15, "partner": "SAKA SRIAA LALCHUDMAT AL-LUGASTIA", "newold": "Old", "actual": 149, "target": 149 },
                { "rank": 16, "partner": "AL-ANJAZ AL-MATARAA", "newold": "Old", "actual": 116, "target": 141 },
                { "rank": 17, "partner": "Holoul", "newold": "Old", "actual": 122, "target": 135 },
                { "rank": 18, "partner": "EXPSERCO", "newold": "Old", "actual": 129, "target": 132 },
                { "rank": 19, "partner": "Establishment ASHRAF BEN HASSIN BEN ALI BOUGRARDAH For logistics", "newold": "Old", "actual": 138, "target": 130 },
                { "rank": 20, "partner": "EXPRESS GATE", "newold": "Old", "actual": 146, "target": 127 }
            ],
            "bottom_smallest": [
                { "rank": 1, "partner": "Afkar Logistics", "newold": "New", "actual": 0, "target": 10 },
                { "rank": 2, "partner": "Tadarak Logistics", "newold": "Old", "actual": 0, "target": 10 },
                { "rank": 3, "partner": "QAWAFIL AL-NAKHABA", "newold": "Old", "actual": 9, "target": 10 },
                { "rank": 4, "partner": "ZikraSabiti", "newold": "New", "actual": 10, "target": 10 },
                { "rank": 5, "partner": "STUL AL-MATIAZ", "newold": "Old", "actual": 11, "target": 10 },
                { "rank": 6, "partner": "NAS", "newold": "Old", "actual": 11, "target": 10 },
                { "rank": 7, "partner": "AL-ALAMIN KOM", "newold": "New", "actual": 16, "target": 10 },
                { "rank": 8, "partner": "alshuhna almumayaza", "newold": "New", "actual": 17, "target": 10 },
                { "rank": 9, "partner": "MUSTER FLE", "newold": "Old", "actual": 19, "target": 10 },
                { "rank": 10, "partner": "Aqbal Logistics", "newold": "Old", "actual": 10, "target": 10 },
                { "rank": 11, "partner": "RADHI ABDULSAMEA", "newold": "New", "actual": 6, "target": 10 },
                { "rank": 12, "partner": "AL-TUQDAM AL-MASI", "newold": "Old", "actual": 8, "target": 10 },
                { "rank": 13, "partner": "almasarat althnaiya", "newold": "Old", "actual": 9, "target": 10 },
                { "rank": 14, "partner": "Selsala", "newold": "New", "actual": 9, "target": 10 },
                { "rank": 15, "partner": "ashara khutut", "newold": "New", "actual": 10, "target": 10 },
                { "rank": 16, "partner": "Al Nsoor (Eagle Logistics)", "newold": "Old", "actual": 0, "target": 10 },
                { "rank": 17, "partner": "LEO Delivery", "newold": "Old", "actual": 12, "target": 10 },
                { "rank": 18, "partner": "Swiftlane", "newold": "Old", "actual": 12, "target": 10 },
                { "rank": 19, "partner": "Alkhutut Almudhia", "newold": "Old", "actual": 14, "target": 10 },
                { "rank": 20, "partner": "Rakb Tayba", "newold": "Old", "actual": 15, "target": 10 }
            ],
            "top_ranked": [
                { "rank": 1, "partner": "First Line Logistics", "newold": "Old", "cities": 9, "actual": 272, "target": 215 },
                { "rank": 2, "partner": "NAJIZ", "newold": "Old", "cities": 5, "actual": 117, "target": 51 },
                { "rank": 3, "partner": "ONE TRIP", "newold": "Old", "cities": 5, "actual": 311, "target": 315 },
                { "rank": 4, "partner": "Next Mile", "newold": "Old", "cities": 5, "actual": 131, "target": 121 },
                { "rank": 5, "partner": "Anan Capital", "newold": "Old", "cities": 5, "actual": 184, "target": 198 },
                { "rank": 6, "partner": "Quick Way Logistics", "newold": "Old", "cities": 5, "actual": 155, "target": 186 },
                { "rank": 7, "partner": "Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services", "newold": "Old", "cities": 5, "actual": 182, "target": 169 },
                { "rank": 8, "partner": "ON Time Logistics", "newold": "Old", "cities": 5, "actual": 332, "target": 325 },
                { "rank": 9, "partner": "Aibtukir", "newold": "Old", "cities": 5, "actual": 113, "target": 72 },
                { "rank": 10, "partner": "services delivery", "newold": "Old", "cities": 4, "actual": 142, "target": 122 },
                { "rank": 11, "partner": "SAKA SRIAA LALCHUDMAT AL-LUGASTIA", "newold": "Old", "cities": 4, "actual": 149, "target": 149 },
                { "rank": 12, "partner": "TEM AL-TOUSSIL", "newold": "Old", "cities": 4, "actual": 111, "target": 109 },
                { "rank": 13, "partner": "Sama Golden logistics", "newold": "Old", "cities": 4, "actual": 60, "target": 70 },
                { "rank": 14, "partner": "AMIYAL", "newold": "Old", "cities": 3, "actual": 157, "target": 150 },
                { "rank": 15, "partner": "WABM Logistics", "newold": "Old", "cities": 3, "actual": 44, "target": 66 },
                { "rank": 16, "partner": "Tomorrow's Falcons Company", "newold": "Old", "cities": 3, "actual": 78, "target": 65 },
                { "rank": 17, "partner": "Saudi falcon for logistics", "newold": "Old", "cities": 3, "actual": 62, "target": 43 },
                { "rank": 18, "partner": "HERVEY AL-WAHHA", "newold": "Old", "cities": 3, "actual": 71, "target": 80 },
                { "rank": 19, "partner": "SHAFAQ AL-KHAYR", "newold": "Old", "cities": 3, "actual": 83, "target": 75 },
                { "rank": 20, "partner": "Ettijahat", "newold": "Old", "cities": 3, "actual": 64, "target": 54 }
            ]
        },
    ];

    function updateTopMoversTable(selectedMonth) {
        try {
            const monthData = topMoversData.find(m => m.month === selectedMonth);
            if (!monthData) {
                console.log('No data for month:', selectedMonth);
                return;
            }
            
            // Update biggest partners table (top riders)
            const biggestBody = document.getElementById('topIncreasesTableBody');
            if (biggestBody) {
                biggestBody.innerHTML = '';
                monthData.top_biggest.forEach((mover, idx) => {
                    const bg = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    const newOldColor = mover.newold === 'New' ? '#10b981' : '#6b7280';
                    const newOldBg = mover.newold === 'New' ? '#d1fae5' : '#f3f4f6';
                    
                    biggestBody.innerHTML += `
                        <tr style="background: ${bg};">
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 700;">${mover.rank}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; font-size: 10px;" title="${mover.partner}">${mover.partner.substring(0, 28)}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><span style="background: ${newOldBg}; color: ${newOldColor}; padding: 3px 8px; border-radius: 4px; font-weight: 600; font-size: 10px;">${mover.newold}</span></td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${mover.actual.toFixed(1)}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${mover.target}</td>
                        </tr>
                    `;
                });
            }
            
            // Update smallest partners table (bottom riders)
            const smallestBody = document.getElementById('topDecreasesTableBody');
            if (smallestBody) {
                smallestBody.innerHTML = '';
                monthData.bottom_smallest.forEach((mover, idx) => {
                    const bg = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    const newOldColor = mover.newold === 'New' ? '#10b981' : '#6b7280';
                    const newOldBg = mover.newold === 'New' ? '#d1fae5' : '#f3f4f6';
                    
                    smallestBody.innerHTML += `
                        <tr style="background: ${bg};">
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 700;">${mover.rank}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; font-size: 10px;" title="${mover.partner}">${mover.partner.substring(0, 28)}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><span style="background: ${newOldBg}; color: ${newOldColor}; padding: 3px 8px; border-radius: 4px; font-weight: 600; font-size: 10px;">${mover.newold}</span></td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${mover.actual.toFixed(1)}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${mover.target}</td>
                        </tr>
                    `;
                });
            }

            // Update ranked partners table (by city coverage) - Feb only
            const rankedBody = document.getElementById('topRankedTableBody');
            if (rankedBody) {
                if (monthData.top_ranked) {
                    rankedBody.innerHTML = '';
                    monthData.top_ranked.forEach((mover, idx) => {
                        const bg = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                        const newOldColor = mover.newold === 'New' ? '#10b981' : '#6b7280';
                        const newOldBg = mover.newold === 'New' ? '#d1fae5' : '#f3f4f6';
                        
                        rankedBody.innerHTML += `
                            <tr style="background: ${bg};">
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 700;">${mover.rank}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; font-size: 10px;" title="${mover.partner}">${mover.partner.substring(0, 28)}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${mover.cities}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><span style="background: ${newOldBg}; color: ${newOldColor}; padding: 3px 8px; border-radius: 4px; font-weight: 600; font-size: 10px;">${mover.newold}</span></td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${mover.actual}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${mover.target}</td>
                            </tr>
                        `;
                    });
                } else {
                    rankedBody.innerHTML = '<tr><td colspan="6" style="padding: 12px; text-align: center; color: #6b7280; font-style: italic;">No ranked data available for this month.</td></tr>';
                }
            }
        } catch(e) {
            console.error('Error updating Top Movers:', e);
        }
    }
    
    // Initialize Top Movers on page load and tab switch
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            updateTopMoversTable('Feb');
        }, 1500);
    });

    // Toggle function for expandable tables
    function toggleTable(button, tableId) {
        const table = document.getElementById(tableId);
        const isHidden = table.style.display === 'none';
        
        if (isHidden) {
            table.style.display = 'block';
            button.textContent = '▲ Click to hide detailed data ▲';
        } else {
            table.style.display = 'none';
            button.textContent = '▼ Click to view detailed data ▼';
        }
    }

    // FR Range Filter Button Handler
    document.addEventListener('DOMContentLoaded', function() {
        const impactTablesMount = document.getElementById('impactDetailedTablesMount');
        const detailedTablesSection = document.getElementById('detailedTablesSection');
        if (impactTablesMount && detailedTablesSection && detailedTablesSection.parentElement !== impactTablesMount) {
            impactTablesMount.appendChild(detailedTablesSection);
        }
        const targetRangeView = document.getElementById('targetRangeView');
        if (detailedTablesSection && targetRangeView) {
            const targetRangeActive = window.getComputedStyle(targetRangeView).display !== 'none'
                || document.querySelector('.analysis-type-toggle[data-type="target-range"].active');
            if (targetRangeActive) {
                detailedTablesSection.style.display = 'block';
            }
        }

        // Impact Section - Metric Toggle Handler
        document.querySelectorAll('.impact-metric-toggle').forEach(button => {
            button.addEventListener('click', function() {
                const metric = this.getAttribute('data-metric');
                const metricColor = metric === 'fr' ? '#3b82f6' : '#f97316';
                resetImpactPerfFilters();
                
                // Update active button styling
                document.querySelectorAll('.impact-metric-toggle').forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.background = 'white';
                    btn.style.color = '#6b7280';
                    btn.style.borderColor = '#e5e7eb';
                    btn.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                });
                this.classList.add('active');
                this.style.background = metricColor;
                this.style.color = 'white';
                this.style.borderColor = metricColor;
                this.style.boxShadow = metric === 'fr'
                    ? '0 4px 12px rgba(59, 130, 246, 0.3)'
                    : '0 4px 12px rgba(249, 115, 22, 0.3)';
                
                // Update title
                const titles = {
                    fr: 'Face Recognition (FR) Range Impact - Target Changes (Jan vs Feb)',
                    dc: 'Driver Card Range Impact - Target Changes (Jan vs Feb)'
                };
                document.getElementById('impactTitle').textContent = titles[metric] || titles.fr;
                
                // Reset filter to "all" when changing metric
                document.querySelectorAll('.impact-filter-btn').forEach(btn => {
                    btn.style.background = 'white';
                    btn.style.color = '#6b7280';
                    btn.style.borderColor = '#e5e7eb';
                });
                document.querySelector('[data-filter="all"]').style.background = metric === 'fr' ? '#3b82f6' : '#f97316';
                document.querySelector('[data-filter="all"]').style.color = 'white';
                document.querySelector('[data-filter="all"]').style.borderColor = metric === 'fr' ? '#3b82f6' : '#f97316';
                
                // Reinitialize chart with new metric
                window.initImpactChartOverall(metric);
                document.getElementById('impactChartSingle').style.display = 'none';
                document.getElementById('impactChartDual').style.display = 'none';
                document.getElementById('impactChartOverall').style.display = 'block';
                document.getElementById('impactChartWithTarget').style.display = 'none';
                if (window.updateImpactKpiCards) {
                    window.updateImpactKpiCards(metric, 'all');
                }
                
                // Show/hide detailed tables based on metric
                if (metric === 'fr') {
                    document.getElementById('frDetailedTablesWrapper').style.display = 'block';
                    document.getElementById('dcDetailedTablesWrapper').style.display = 'none';
                } else {
                    document.getElementById('frDetailedTablesWrapper').style.display = 'none';
                    document.getElementById('dcDetailedTablesWrapper').style.display = 'block';
                }
                
                // Resize chart to ensure proper rendering
                setTimeout(() => {
                    if (impactChartSingle) {
                        impactChartSingle.resize();
                    }
                }, 100);
            });
        });

        function resetImpactPerfFilters() {
            const perfButtons = document.querySelectorAll('.impact-perf-filter-btn');
            perfButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'white';
                btn.style.color = '#6b7280';
                btn.style.borderColor = '#e5e7eb';
            });
            window.currentImpactPerfFilter = 'all';
        }

        // Impact Section - Filter Handler
        document.querySelectorAll('.impact-filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                const filter = this.getAttribute('data-filter');
                console.log('Filter clicked:', filter);

                resetImpactPerfFilters();
                
                // Find active metric button
                let activeMetric = 'fr';
                const activeMetricBtn = document.querySelector('.impact-metric-toggle.active');
                if (activeMetricBtn) {
                    activeMetric = activeMetricBtn.getAttribute('data-metric');
                }
                console.log('Active metric determined:', activeMetric);
                
                // Update active button styling
                const metricColor = activeMetric === 'fr' ? '#3b82f6' : '#f97316';
                document.querySelectorAll('.impact-filter-btn').forEach(btn => {
                    btn.style.background = 'white';
                    btn.style.color = '#6b7280';
                    btn.style.borderColor = '#e5e7eb';
                });
                this.style.background = metricColor;
                this.style.color = 'white';
                this.style.borderColor = metricColor;
                
                // Update title based on metric and filter
                const titles = {
                    'fr-new': 'Face Recognition (FR) Range Impact - Target Changes (Jan vs Feb)',
                    'fr-old': 'Face Recognition (FR) Range Impact - Target Changes (Jan vs Feb)',
                    'fr-both': 'Face Recognition (FR) Range Impact - Target Changes (Jan vs Feb)',
                    'fr-all': 'Face Recognition (FR) All Partners Summary - Target Changes Across Ranges',
                    'fr-withtarget': 'Face Recognition (FR) Partners with Target Summary - Active Partners Across Ranges',
                    'dc-new': 'Driver Card Range Impact - Target Changes (Jan vs Feb)',
                    'dc-old': 'Driver Card Range Impact - Target Changes (Jan vs Feb)',
                    'dc-both': 'Driver Card Range Impact - Target Changes (Jan vs Feb)',
                    'dc-all': 'Driver Card All Partners Summary - Target Changes Across Ranges',
                    'dc-withtarget': 'Driver Card Partners with Target Summary - Active Partners Across Ranges'
                };
                document.getElementById('impactTitle').textContent = titles[`${activeMetric}-${filter}`] || titles[`${activeMetric}-new`];
                
                // Handle different filters
                if (filter === 'new' || filter === 'old') {
                    console.log('Showing single view for metric:', activeMetric, 'filter:', filter);
                    document.getElementById('impactChartSingle').style.display = 'block';
                    document.getElementById('impactChartDual').style.display = 'none';
                    document.getElementById('impactChartOverall').style.display = 'none';
                    document.getElementById('impactChartWithTarget').style.display = 'none';
                    window.initImpactChartSingle(activeMetric, filter);
                    if (window.updateImpactKpiCards) {
                        window.updateImpactKpiCards(activeMetric, filter);
                    }
                } else if (filter === 'both') {
                    console.log('Showing dual view for metric:', activeMetric);
                    document.getElementById('impactChartSingle').style.display = 'none';
                    document.getElementById('impactChartDual').style.display = 'flex';
                    document.getElementById('impactChartOverall').style.display = 'none';
                    document.getElementById('impactChartWithTarget').style.display = 'none';
                    window.initImpactChartDual(activeMetric);
                    if (window.updateImpactKpiCards) {
                        window.updateImpactKpiCards(activeMetric, filter);
                    }
                } else if (filter === 'all') {
                    console.log('Showing all partners view for metric:', activeMetric);
                    document.getElementById('impactChartSingle').style.display = 'none';
                    document.getElementById('impactChartDual').style.display = 'none';
                    document.getElementById('impactChartOverall').style.display = 'block';
                    document.getElementById('impactChartWithTarget').style.display = 'none';
                    window.initImpactChartOverall(activeMetric);
                    if (window.updateImpactKpiCards) {
                        window.updateImpactKpiCards(activeMetric, filter);
                    }
                } else if (filter === 'withtarget') {
                    console.log('Showing with target view for metric:', activeMetric);
                    document.getElementById('impactChartSingle').style.display = 'none';
                    document.getElementById('impactChartDual').style.display = 'none';
                    document.getElementById('impactChartOverall').style.display = 'none';
                    document.getElementById('impactChartWithTarget').style.display = 'block';
                    window.initImpactChartWithTarget(activeMetric);
                    if (window.updateImpactKpiCards) {
                        window.updateImpactKpiCards(activeMetric, filter);
                    }
                }
            });
        });

        // Impact Section - Performance Filter Handler
        document.querySelectorAll('.impact-perf-filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                const perf = this.getAttribute('data-perf');
                
                // Find active metric button
                let activeMetric = 'fr';
                const activeMetricBtn = document.querySelector('.impact-metric-toggle.active');
                if (activeMetricBtn) {
                    activeMetric = activeMetricBtn.getAttribute('data-metric');
                }
                
                // Update Performance button styles
                document.querySelectorAll('.impact-perf-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.background = 'white';
                    btn.style.color = '#6b7280';
                    btn.style.borderColor = '#e5e7eb';
                });
                this.classList.add('active');
                this.style.background = '#059669';
                this.style.color = 'white';
                this.style.borderColor = '#059669';
                window.currentImpactPerfFilter = perf;
                
                // Reset View filter buttons to inactive state (same as Compliance Distribution)
                document.querySelectorAll('.impact-filter-btn').forEach(btn => {
                    btn.style.background = 'white';
                    btn.style.color = '#6b7280';
                    btn.style.borderColor = '#e5e7eb';
                });
                
                // Update title based on performance
                const perfLabel = perf === 'all' ? 'All Partners' : (perf.charAt(0).toUpperCase() + perf.slice(1) + ' Partners');
                const metricLabel = activeMetric === 'fr' ? 'Face Recognition (FR)' : 'Driver Card';
                document.getElementById('impactTitle').textContent = `${metricLabel} Range Impact - ${perfLabel}`;
                
                // Update Impact KPI cards with performance data
                updateImpactPerfKpiCards(perf, activeMetric);
                
                // Update Impact chart with performance data
                updateImpactChartForPerfFilter(perf, activeMetric);
            });
        });
        
        // Function to update Impact KPI cards for performance filter
        function updateImpactPerfKpiCards(perf, metric) {
            const partnersValue = document.getElementById('impactPartnersValue');
            const partnersSub = document.getElementById('impactPartnersSub');
            const partnersSplit = document.getElementById('impactPartnersSplit');
            const targetsValue = document.getElementById('impactTargetsValue');
            const targetsSub = document.getElementById('impactTargetsSub');
            const targetsChange = document.getElementById('impactTargetsChange');
            
            if (metric === 'fr') {
                const perfData = {
                    all: { partners: 551, partnersSub: 'Partners with Target', split: 'New: 127 (23.0%) | Old: 424 (77.0%)', target: '19,365', targetSub: 'Total Feb Target', change: 'Avg FR Rate: 92.4%' },
                    good: { partners: 252, partnersSub: 'Good Partners', split: 'New: 58 (23.0%) | Old: 194 (77.0%)', target: '10,192', targetSub: 'Good Partners Target', change: 'Avg FR Rate: 96.5%' },
                    average: { partners: 262, partnersSub: 'Average Partners', split: 'New: 60 (22.9%) | Old: 202 (77.1%)', target: '8,414', targetSub: 'Average Partners Target', change: 'Avg FR Rate: 92.0%' },
                    bad: { partners: 20, partnersSub: 'Bad Partners', split: 'New: 5 (25.0%) | Old: 15 (75.0%)', target: '370', targetSub: 'Bad Partners Target', change: 'Avg FR Rate: 72.9%' }
                };
                const data = perfData[perf] || perfData.all;
                partnersValue.textContent = data.partners;
                partnersSub.textContent = data.partnersSub;
                partnersSplit.textContent = data.split;
                targetsValue.textContent = data.target;
                targetsSub.textContent = data.targetSub;
                targetsChange.textContent = data.change;
            } else {
                const perfData = {
                    all: { partners: 551, partnersSub: 'Partners with Target', split: 'New: 127 (23.0%) | Old: 424 (77.0%)', target: '19,365', targetSub: 'Total Feb Target', change: 'Avg DC Rate: 40.5%' },
                    good: { partners: 252, partnersSub: 'Good Partners', split: 'New: 58 (23.0%) | Old: 194 (77.0%)', target: '10,192', targetSub: 'Good Partners Target', change: 'Avg DC Rate: 42.8%' },
                    average: { partners: 262, partnersSub: 'Average Partners', split: 'New: 60 (22.9%) | Old: 202 (77.1%)', target: '8,414', targetSub: 'Average Partners Target', change: 'Avg DC Rate: 39.0%' },
                    bad: { partners: 20, partnersSub: 'Bad Partners', split: 'New: 5 (25.0%) | Old: 15 (75.0%)', target: '370', targetSub: 'Bad Partners Target', change: 'Avg DC Rate: 33.5%' }
                };
                const data = perfData[perf] || perfData.all;
                partnersValue.textContent = data.partners;
                partnersSub.textContent = data.partnersSub;
                partnersSplit.textContent = data.split;
                targetsValue.textContent = data.target;
                targetsSub.textContent = data.targetSub;
                targetsChange.textContent = data.change;
            }
        }
        
        // Function to update Impact chart for performance filter
        function updateImpactChartForPerfFilter(perf, metric) {
            // Performance data for FR targets by range
            const frPerfTargetData = {
                all: [369, 0, 19, 0, 11, 628, 18338],
                good: [0, 0, 0, 0, 0, 182, 10010],
                average: [0, 0, 0, 0, 0, 396, 8018],
                bad: [35, 0, 19, 0, 11, 50, 255]
            };
            
            // Performance data for DC targets by range
            const dcPerfTargetData = {
                all: [8347, 1567, 1318, 800, 978, 1402, 4953],
                good: [4600, 762, 537, 341, 449, 735, 2768],
                average: [3270, 805, 781, 420, 514, 587, 2037],
                bad: [178, 0, 0, 39, 15, 50, 88]
            };
            
            const data = metric === 'fr' ? frPerfTargetData[perf] : dcPerfTargetData[perf];
            const perfLabel = perf === 'all' ? 'All Partners' : (perf.charAt(0).toUpperCase() + perf.slice(1) + ' Partners');
            
            // Color scheme based on performance category
            const colorSchemes = {
                all: { line: '#3b82f6', fill: 'rgba(59, 130, 246, 0.15)', point: '#2563eb' },
                good: { line: '#10b981', fill: 'rgba(16, 185, 129, 0.15)', point: '#059669' },
                average: { line: '#f59e0b', fill: 'rgba(245, 158, 11, 0.15)', point: '#d97706' },
                bad: { line: '#ef4444', fill: 'rgba(239, 68, 68, 0.15)', point: '#dc2626' }
            };
            const colors = colorSchemes[perf] || colorSchemes.all;
            
            // Show single chart, hide others
            document.getElementById('impactChartSingle').style.display = 'block';
            document.getElementById('impactChartDual').style.display = 'none';
            document.getElementById('impactChartOverall').style.display = 'none';
            document.getElementById('impactChartWithTarget').style.display = 'none';
            
            // Destroy existing chart and create new one
            if (window.impactChartSingle) {
                try { window.impactChartSingle.destroy(); } catch(e) {}
            }
            
            const canvas = document.getElementById('impactChartSingleCanvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            // Create gradient fill
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, colors.fill.replace('0.15', '0.4'));
            gradient.addColorStop(0.5, colors.fill.replace('0.15', '0.2'));
            gradient.addColorStop(1, colors.fill.replace('0.15', '0.02'));
            
            window.impactChartSingle = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'],
                    datasets: [{
                        label: `${perfLabel} Target`,
                        data: data,
                        borderColor: colors.line,
                        backgroundColor: gradient,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: colors.point,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 9,
                        pointHoverBackgroundColor: colors.point,
                        pointHoverBorderColor: '#fff',
                        pointHoverBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.8,
                    layout: { padding: { top: 35, right: 20 } },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: { 
                            display: true, 
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 20,
                                font: { size: 12, weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            padding: 14,
                            titleFont: { size: 13, weight: 'bold' },
                            bodyFont: { size: 12 },
                            borderColor: colors.line,
                            borderWidth: 1,
                            displayColors: true,
                            usePointStyle: true,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((sum, v) => sum + v, 0);
                                    const pct = total ? ((context.parsed.y / total) * 100).toFixed(1) : '0.0';
                                    return `  ${context.dataset.label}: ${context.parsed.y.toLocaleString()} riders (${pct}%)`;
                                }
                            }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            offset: 6,
                            font: { size: 11, weight: 'bold' },
                            color: colors.point,
                            backgroundColor: 'rgba(255, 255, 255, 0.85)',
                            borderRadius: 4,
                            padding: { top: 3, bottom: 3, left: 6, right: 6 },
                            formatter: (value, context) => {
                                const total = context.dataset.data.reduce((sum, v) => sum + v, 0);
                                const pct = total ? ((value / total) * 100).toFixed(1) : '0.0';
                                return value.toLocaleString() + ' (' + pct + '%)';
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.06)',
                                drawBorder: false
                            },
                            ticks: { 
                                callback: (value) => value.toLocaleString(), 
                                font: { size: 11 },
                                padding: 8
                            },
                            title: { 
                                display: true, 
                                text: 'Target Riders', 
                                font: { size: 12, weight: 'bold' },
                                padding: { bottom: 10 }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: { size: 11 },
                                padding: 8
                            },
                            title: { 
                                display: true, 
                                text: metric === 'fr' ? 'FR Rate Range' : 'DC Rate Range', 
                                font: { size: 12, weight: 'bold' },
                                padding: { top: 10 }
                            }
                        }
                    }
                }
            });
        }

        // Mark initial metric as active
        document.querySelector('[data-metric="fr"]').classList.add('active');
        
        // Analysis Type Toggle Handler (Compliance vs Target Range)
        document.querySelectorAll('.analysis-type-toggle').forEach(button => {
            button.addEventListener('click', function() {
                const analysisType = this.getAttribute('data-type');
                
                // Update active button styling
                document.querySelectorAll('.analysis-type-toggle').forEach(btn => {
                    btn.style.background = 'white';
                    btn.style.color = '#6b7280';
                    btn.style.borderColor = '#e5e7eb';
                    btn.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                });
                const activeColor = analysisType === 'compliance' ? '#059669' : (analysisType === 'target-range' ? '#3b82f6' : '#8b5cf6');
                this.style.background = activeColor;
                this.style.color = 'white';
                this.style.borderColor = activeColor;
                this.style.boxShadow = analysisType === 'compliance'
                    ? '0 4px 12px rgba(5, 150, 105, 0.3)'
                    : (analysisType === 'target-range'
                        ? '0 4px 12px rgba(59, 130, 246, 0.3)'
                        : '0 4px 12px rgba(139, 92, 246, 0.3)');
                
                // Show/hide views
                if (analysisType === 'compliance') {
                    document.getElementById('complianceAnalysisView').style.display = 'block';
                    document.getElementById('targetRangeView').style.display = 'none';
                    document.getElementById('cityWiseView').style.display = 'none';
                    document.getElementById('detailedTablesSection').style.display = 'none';
                    // Re-trigger donut animation
                    const frCard = document.getElementById('frAvgCard');
                    const dcCard = document.getElementById('dcAvgCard');
                    // Check which metric is currently active
                    const activeMetricBtn = document.querySelector('.metric-toggle-btn.active');
                    const currentMetric = activeMetricBtn ? activeMetricBtn.getAttribute('data-metric') : 'fr';
                    
                    if (frCard) {
                        frCard.classList.remove('animate-in');
                        frCard.style.opacity = '0';
                        frCard.style.filter = 'none';
                        void frCard.offsetWidth; // Force reflow
                        frCard.classList.add('animate-in');
                    }
                    setTimeout(() => {
                        if (dcCard) {
                            dcCard.classList.remove('animate-in');
                            dcCard.style.opacity = '0';
                            dcCard.style.filter = 'none';
                            void dcCard.offsetWidth;
                            dcCard.classList.add('animate-in');
                        }
                        // Apply blur to inactive card after animation
                        setTimeout(() => {
                            if (currentMetric === 'fr') {
                                if (frCard) {
                                    frCard.style.opacity = '1';
                                    frCard.style.filter = 'none';
                                    frCard.style.transform = 'scale(1)';
                                }
                                if (dcCard) {
                                    dcCard.style.opacity = '0.5';
                                    dcCard.style.filter = 'blur(1px)';
                                    dcCard.style.transform = 'scale(0.95)';
                                }
                            } else {
                                if (dcCard) {
                                    dcCard.style.opacity = '1';
                                    dcCard.style.filter = 'none';
                                    dcCard.style.transform = 'scale(1)';
                                }
                                if (frCard) {
                                    frCard.style.opacity = '0.5';
                                    frCard.style.filter = 'blur(1px)';
                                    frCard.style.transform = 'scale(0.95)';
                                }
                            }
                        }, 700);
                    }, 200);
                } else if (analysisType === 'target-range') {
                    document.getElementById('complianceAnalysisView').style.display = 'none';
                    document.getElementById('targetRangeView').style.display = 'block';
                    document.getElementById('cityWiseView').style.display = 'none';
                    document.getElementById('detailedTablesSection').style.display = 'block';
                    // Trigger KPI card fly-in animation
                    const partnersCard = document.getElementById('impactPartnersCard');
                    const targetsCard = document.getElementById('impactTargetsCard');
                    if (partnersCard) {
                        partnersCard.classList.remove('fly-in');
                        partnersCard.style.opacity = '0';
                        void partnersCard.offsetWidth;
                        partnersCard.classList.add('fly-in');
                    }
                    setTimeout(() => {
                        if (targetsCard) {
                            targetsCard.classList.remove('fly-in');
                            targetsCard.style.opacity = '0';
                            void targetsCard.offsetWidth;
                            targetsCard.classList.add('fly-in');
                        }
                    }, 150); // Staggered animation
                    if (window.updateImpactKpiCards) {
                        window.updateImpactKpiCards('fr', 'all');
                    }
                } else {
                    document.getElementById('complianceAnalysisView').style.display = 'none';
                    document.getElementById('targetRangeView').style.display = 'none';
                    document.getElementById('cityWiseView').style.display = 'block';
                    document.getElementById('detailedTablesSection').style.display = 'none';
                    // Trigger KPI card fly-in animation
                    const avgCard = document.getElementById('cityWiseAvgCard');
                    const riskCard = document.getElementById('cityWiseRiskCard');
                    if (avgCard) {
                        avgCard.classList.remove('fly-in');
                        avgCard.style.opacity = '0';
                        void avgCard.offsetWidth;
                        avgCard.classList.add('fly-in');
                    }
                    setTimeout(() => {
                        if (riskCard) {
                            riskCard.classList.remove('fly-in');
                            riskCard.style.opacity = '0';
                            void riskCard.offsetWidth;
                            riskCard.classList.add('fly-in');
                        }
                    }, 150); // Staggered animation
                    if (window.initCityWiseCompliance) {
                        window.initCityWiseCompliance();
                    }
                }
            });
        });

        // City-wise Compliance Analysis (FR & Driver Card)
        const cityWiseRangeLabels = ['0-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-80%', '>80%'];
        const cityWiseData = {
            summary: [
                { city: 'Abha', partners: 15, fr: 91.9, dc: 70.9 },
                { city: 'Al Ahsa', partners: 28, fr: 98.4, dc: 54.0 },
                { city: 'Al Kharj', partners: 8, fr: 98.3, dc: 37.9 },
                { city: 'Buraydah', partners: 10, fr: 99.8, dc: 57.3 },
                { city: 'Dammam', partners: 64, fr: 96.9, dc: 37.0 },
                { city: 'Hafar Albatin', partners: 7, fr: 99.3, dc: 69.1 },
                { city: 'Hail', partners: 5, fr: 99.2, dc: 38.6 },
                { city: 'Jazan', partners: 3, fr: 100.0, dc: 42.8 },
                { city: 'Jeddah', partners: 83, fr: 92.3, dc: 43.6 },
                { city: 'Jubail', partners: 10, fr: 89.8, dc: 19.2 },
                { city: 'Makkah', partners: 41, fr: 90.9, dc: 54.1 },
                { city: 'Medina', partners: 37, fr: 96.2, dc: 42.8 },
                { city: 'Najran', partners: 5, fr: 100.0, dc: 28.8 },
                { city: 'Riyadh', partners: 200, fr: 88.1, dc: 33.3 },
                { city: 'Tabuk', partners: 11, fr: 99.6, dc: 22.9 },
                { city: 'Taif', partners: 14, fr: 89.0, dc: 42.7 },
                { city: 'Yanbu', partners: 10, fr: 97.4, dc: 41.3 }
            ],
            frPartnersRanges: {
                'Abha': [1, 0, 0, 0, 0, 0, 14],
                'Al Ahsa': [0, 0, 0, 0, 0, 0, 28],
                'Al Kharj': [0, 0, 0, 0, 0, 0, 8],
                'Buraydah': [0, 0, 0, 0, 0, 0, 10],
                'Dammam': [1, 0, 0, 0, 0, 0, 63],
                'Hafar Albatin': [0, 0, 0, 0, 0, 0, 7],
                'Hail': [0, 0, 0, 0, 0, 0, 5],
                'Jazan': [0, 0, 0, 0, 0, 0, 3],
                'Jeddah': [3, 0, 0, 0, 0, 4, 76],
                'Jubail': [1, 0, 0, 0, 0, 0, 9],
                'Makkah': [3, 0, 0, 0, 0, 0, 38],
                'Medina': [0, 0, 0, 0, 0, 1, 36],
                'Najran': [0, 0, 0, 0, 0, 0, 5],
                'Riyadh': [7, 0, 1, 0, 1, 18, 173],
                'Tabuk': [0, 0, 0, 0, 0, 0, 11],
                'Taif': [1, 0, 0, 0, 0, 0, 13],
                'Yanbu': [0, 0, 0, 0, 0, 0, 10]
            },
            frTargetRanges: {
                'Abha': [10, 0, 0, 0, 0, 0, 287],
                'Al Ahsa': [0, 0, 0, 0, 0, 0, 818],
                'Al Kharj': [0, 0, 0, 0, 0, 0, 347],
                'Buraydah': [0, 0, 0, 0, 0, 0, 253],
                'Dammam': [25, 0, 0, 0, 0, 0, 2102],
                'Hafar Albatin': [0, 0, 0, 0, 0, 0, 109],
                'Hail': [0, 0, 0, 0, 0, 0, 186],
                'Jazan': [0, 0, 0, 0, 0, 0, 74],
                'Jeddah': [60, 0, 0, 0, 0, 50, 3344],
                'Jubail': [12, 0, 0, 0, 0, 0, 218],
                'Makkah': [36, 0, 0, 0, 0, 0, 899],
                'Medina': [0, 0, 0, 0, 0, 12, 1119],
                'Najran': [0, 0, 0, 0, 0, 0, 78],
                'Riyadh': [216, 0, 19, 0, 11, 566, 7849],
                'Tabuk': [0, 0, 0, 0, 0, 0, 202],
                'Taif': [10, 0, 0, 0, 0, 0, 282],
                'Yanbu': [0, 0, 0, 0, 0, 0, 171]
            },
            dcPartnersRanges: {
                'Abha': [1, 1, 0, 1, 2, 2, 8],
                'Al Ahsa': [9, 1, 1, 2, 0, 5, 10],
                'Al Kharj': [2, 1, 1, 2, 1, 0, 1],
                'Buraydah': [1, 1, 2, 1, 1, 0, 4],
                'Dammam': [27, 8, 4, 4, 4, 7, 10],
                'Hafar Albatin': [2, 0, 0, 0, 0, 0, 5],
                'Hail': [2, 1, 0, 0, 0, 0, 2],
                'Jazan': [0, 2, 0, 0, 0, 0, 1],
                'Jeddah': [36, 3, 4, 4, 5, 5, 26],
                'Jubail': [6, 1, 2, 0, 0, 0, 1],
                'Makkah': [10, 3, 3, 4, 2, 4, 15],
                'Medina': [17, 1, 0, 2, 3, 4, 10],
                'Najran': [3, 0, 0, 0, 1, 0, 1],
                'Riyadh': [107, 14, 14, 3, 8, 16, 38],
                'Tabuk': [5, 3, 1, 1, 1, 0, 0],
                'Taif': [5, 1, 1, 1, 2, 0, 4],
                'Yanbu': [4, 2, 1, 0, 0, 0, 3]
            },
            dcTargetRanges: {
                'Abha': [10, 20, 0, 20, 40, 35, 172],
                'Al Ahsa': [222, 40, 25, 60, 0, 189, 282],
                'Al Kharj': [123, 25, 85, 64, 15, 0, 35],
                'Buraydah': [24, 25, 35, 15, 15, 0, 139],
                'Dammam': [850, 332, 128, 167, 154, 221, 275],
                'Hafar Albatin': [20, 0, 0, 0, 0, 0, 89],
                'Hail': [58, 20, 0, 0, 0, 0, 108],
                'Jazan': [0, 54, 0, 0, 0, 0, 20],
                'Jeddah': [1302, 88, 262, 125, 281, 209, 1187],
                'Jubail': [146, 15, 37, 0, 0, 0, 32],
                'Makkah': [208, 55, 80, 87, 32, 80, 393],
                'Medina': [459, 36, 0, 134, 57, 122, 323],
                'Najran': [53, 0, 0, 0, 10, 0, 15],
                'Riyadh': [4614, 748, 616, 82, 296, 546, 1759],
                'Tabuk': [85, 51, 25, 18, 23, 0, 0],
                'Taif': [88, 28, 12, 28, 55, 0, 81],
                'Yanbu': [85, 30, 13, 0, 0, 0, 43]
            }
        };

        const cityWiseTierMap = {
            'Riyadh': 't1',
            'Medina': 't1',
            'Makkah': 't1',
            'Jeddah': 't1',
            'Dammam': 't1',
            'Al Kharj': 't1',
            'Al Ahsa': 't1',
            'Abha': 't2',
            'Buraydah': 't2',
            'Hail': 't2',
            'Jazan': 't2',
            'Jubail': 't2',
            'Tabuk': 't2',
            'Taif': 't2',
            'Yanbu': 't2',
            'Hafar Albatin': 't2',
            'Najran': 't2'
        };

        let cityWiseOverviewChart = null;
        let cityWiseRangeChart = null;
        let cityWiseTargetRangeChart = null;
        let cityWiseT1OverviewChart = null;
        let cityWiseT2OverviewChart = null;
        let cityWiseState = { metric: 'fr', view: 'overview', city: 'Riyadh', tier: 'all' };

        function getCityWiseMetricColor(metric) {
            return metric === 'fr' ? '#3b82f6' : '#10b981';
        }

        function getCityRiskLevel(metric, value) {
            if (metric === 'fr') {
                if (value < 85) return { label: 'High Risk', color: '#ef4444', bg: '#fee2e2' };
                if (value < 92) return { label: 'Moderate Risk', color: '#f59e0b', bg: '#fef3c7' };
                return { label: 'Low Risk', color: '#16a34a', bg: '#dcfce7' };
            }
            if (value < 30) return { label: 'High Risk', color: '#ef4444', bg: '#fee2e2' };
            if (value < 40) return { label: 'Moderate Risk', color: '#f59e0b', bg: '#fef3c7' };
            return { label: 'Low Risk', color: '#16a34a', bg: '#dcfce7' };
        }

        function getPctHighlightColor(pct) {
            return pct < 10 ? '#dc2626' : '#16a34a';
        }

        function getCityTierLabel() {
            if (cityWiseState.tier === 't1') return 'T1 Cities';
            if (cityWiseState.tier === 't2') return 'T2 Cities';
            return 'All Cities';
        }

        function getFilteredCitySummary() {
            if (cityWiseState.tier === 'all') return [...cityWiseData.summary];
            return cityWiseData.summary.filter(c => cityWiseTierMap[c.city] === cityWiseState.tier);
        }

        function updateCityWiseSummaryCards() {
            const metricKey = cityWiseState.metric === 'fr' ? 'fr' : 'dc';
            const metricLabel = cityWiseState.metric === 'fr' ? 'FR' : 'DC';
            const filteredSummary = getFilteredCitySummary();
            const totalPartners = filteredSummary.reduce((sum, c) => sum + c.partners, 0);
            const overallAvgRate = totalPartners
                ? filteredSummary.reduce((sum, c) => sum + (c[metricKey] * c.partners), 0) / totalPartners
                : 0;
            const overallAvgRateDisplay = cityWiseState.metric === 'fr'
                ? Math.floor(overallAvgRate * 10) / 10
                : Math.round(overallAvgRate * 10) / 10;

            let highCount = 0;
            let moderateCount = 0;
            let lowCount = 0;
            filteredSummary.forEach(c => {
                const risk = getCityRiskLevel(cityWiseState.metric, c[metricKey]);
                if (risk.label === 'High Risk') highCount += 1;
                if (risk.label === 'Moderate Risk') moderateCount += 1;
                if (risk.label === 'Low Risk') lowCount += 1;
            });

            const avgValueEl = document.getElementById('cityWiseAvgCardValue');
            const avgSubEl = document.getElementById('cityWiseAvgCardSub');
            const riskValueEl = document.getElementById('cityWiseRiskCardValue');
            const riskSubEl = document.getElementById('cityWiseRiskCardSub');

            if (avgValueEl) avgValueEl.textContent = `${overallAvgRateDisplay.toFixed(1)}%`;
            if (avgSubEl) avgSubEl.textContent = `Overall Avg ${metricLabel} Rate (${getCityTierLabel()})`;
            if (riskValueEl) {
                riskValueEl.innerHTML = `<span style="color:#ef4444; font-weight:800;">High: ${highCount}</span> &nbsp;|&nbsp; <span style="color:#f59e0b; font-weight:800;">Moderate: ${moderateCount}</span> &nbsp;|&nbsp; <span style="color:#16a34a; font-weight:800;">Low: ${lowCount}</span>`;
            }
            if (riskSubEl) riskSubEl.textContent = `Total cities: ${filteredSummary.length}`;
        }

        function updateCityWiseTitle() {
            const metricLabel = cityWiseState.metric === 'fr' ? 'FR' : 'Driver Card';
            const viewLabel = cityWiseState.view === 'overview'
                ? 'Compliance Overview'
                : (cityWiseState.view === 'range' ? 'Range + Target Distribution' : 'T1 vs T2 Overview');
            const tierLabel = getCityTierLabel();
            document.getElementById('cityWiseTitle').textContent = `City-wise ${metricLabel} ${viewLabel} (${tierLabel})`;
            document.getElementById('cityWiseRangeTitle').textContent = `${metricLabel} partners with target by range - ${cityWiseState.city} (${tierLabel})`;
            document.getElementById('cityWiseTargetRangeTitle').textContent = `${metricLabel} target range by city - ${cityWiseState.city} (${tierLabel})`;
        }

        function updateCityWiseRiskList() {
            const metricKey = cityWiseState.metric === 'fr' ? 'fr' : 'dc';
            const tierLabel = getCityTierLabel();
            const rangeTitle = cityWiseState.metric === 'fr'
                ? `FR partners with target by range (${tierLabel})`
                : `Driver Card partners with target by range (${tierLabel})`;
            const targetTitle = cityWiseState.metric === 'fr'
                ? `FR target range by city (${tierLabel})`
                : `Driver Card target range by city (${tierLabel})`;
            const overallTitle = cityWiseState.metric === 'fr'
                ? `City Overall FR Compliance (${tierLabel})`
                : `City Overall Driver Card Compliance (${tierLabel})`;
            const overallHeader = cityWiseState.metric === 'fr' ? 'Avg FR Rate %' : 'Avg DC Rate %';
            const riskThreshold = cityWiseState.metric === 'fr' ? 70 : 25;

            const rangeTitleEl = document.getElementById('cityWiseRangeTableTitle');
            const targetTitleEl = document.getElementById('cityWiseTargetRangeTableTitle');
            const overallTitleEl = document.getElementById('cityWiseOverallTableTitle');
            const overallHeaderEl = document.getElementById('cityWiseOverallMetricHeader');
            if (rangeTitleEl) rangeTitleEl.textContent = rangeTitle;
            if (targetTitleEl) targetTitleEl.textContent = targetTitle;
            if (overallTitleEl) overallTitleEl.textContent = overallTitle;
            if (overallHeaderEl) overallHeaderEl.textContent = overallHeader;

            const rangeDataByCity = metricKey === 'fr' ? cityWiseData.frPartnersRanges : cityWiseData.dcPartnersRanges;
            const targetDataByCity = metricKey === 'fr' ? cityWiseData.frTargetRanges : cityWiseData.dcTargetRanges;
            const filteredSummary = getFilteredCitySummary();

            // Calculate totals for overall table
            const totalPartners = filteredSummary.reduce((sum, c) => sum + c.partners, 0);
            const overallAvgRate = totalPartners
                ? filteredSummary.reduce((sum, c) => sum + (c[metricKey] * c.partners), 0) / totalPartners
                : 0;
            const overallAvgRateDisplay = cityWiseState.metric === 'fr'
                ? Math.floor(overallAvgRate * 10) / 10
                : Math.round(overallAvgRate * 10) / 10;
            const overallRisk = getCityRiskLevel(cityWiseState.metric, overallAvgRate);

            const overallRows = [...filteredSummary].map((c) => {
                const risk = getCityRiskLevel(cityWiseState.metric, c[metricKey]);
                return `
                    <tr style="background: ${risk.bg};">
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: left; font-weight: 600;">${c.city}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600;">${c.partners.toLocaleString()}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${risk.color};">${c[metricKey].toFixed(1)}%</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${risk.color};">${risk.label}</td>
                    </tr>
                `;
            }).join('') + `
                <tr style="background: #f3f4f6; border-top: 3px solid #374151;">
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: left; font-weight: 700; font-size: 14px;">TOTAL</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px;">${totalPartners.toLocaleString()}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${overallRisk.color};">${overallAvgRateDisplay.toFixed(1)}%</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${overallRisk.color};">${overallRisk.label}</td>
                </tr>
            `;

            // Calculate column totals for range table
            const rangeTotals = [0, 0, 0, 0, 0, 0, 0];
            filteredSummary.forEach((c) => {
                const row = rangeDataByCity[c.city] || [0, 0, 0, 0, 0, 0, 0];
                for (let i = 0; i < 7; i++) {
                    rangeTotals[i] += row[i];
                }
            });
            const rangeGrandTotal = rangeTotals.reduce((s, v) => s + v, 0);
            const rangeTotalPct = rangeTotals.map(v => rangeGrandTotal ? (v / rangeGrandTotal) * 100 : 0);

            const rangeRows = [...filteredSummary].map((c) => {
                const row = rangeDataByCity[c.city] || [0, 0, 0, 0, 0, 0, 0];
                const total = row.reduce((s, v) => s + v, 0);
                const risk = getCityRiskLevel(cityWiseState.metric, c[metricKey]);
                const pct = row.map(v => total ? (v / total) * 100 : 0);
                return `
                    <tr style="background: ${risk.bg};">
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: left; font-weight: 600;">${c.city}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[0])};">${row[0].toLocaleString()} (${pct[0].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[1])};">${row[1].toLocaleString()} (${pct[1].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[2])};">${row[2].toLocaleString()} (${pct[2].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[3])};">${row[3].toLocaleString()} (${pct[3].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[4])};">${row[4].toLocaleString()} (${pct[4].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[5])};">${row[5].toLocaleString()} (${pct[5].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[6])};">${row[6].toLocaleString()} (${pct[6].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;">${total.toLocaleString()}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${risk.color};">${risk.label}</td>
                    </tr>
                `;
            }).join('') + `
                <tr style="background: #f3f4f6; border-top: 3px solid #374151;">
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: left; font-weight: 700; font-size: 14px;">TOTAL</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[0])};">${rangeTotals[0].toLocaleString()} (${rangeTotalPct[0].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[1])};">${rangeTotals[1].toLocaleString()} (${rangeTotalPct[1].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[2])};">${rangeTotals[2].toLocaleString()} (${rangeTotalPct[2].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[3])};">${rangeTotals[3].toLocaleString()} (${rangeTotalPct[3].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[4])};">${rangeTotals[4].toLocaleString()} (${rangeTotalPct[4].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[5])};">${rangeTotals[5].toLocaleString()} (${rangeTotalPct[5].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(rangeTotalPct[6])};">${rangeTotals[6].toLocaleString()} (${rangeTotalPct[6].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px;">${rangeGrandTotal.toLocaleString()}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;"></td>
                </tr>
            `;

            // Calculate column totals for target range table
            const targetTotals = [0, 0, 0, 0, 0, 0, 0];
            filteredSummary.forEach((c) => {
                const row = targetDataByCity[c.city] || [0, 0, 0, 0, 0, 0, 0];
                for (let i = 0; i < 7; i++) {
                    targetTotals[i] += row[i];
                }
            });
            const targetGrandTotal = targetTotals.reduce((s, v) => s + v, 0);
            const targetTotalPct = targetTotals.map(v => targetGrandTotal ? (v / targetGrandTotal) * 100 : 0);

            const targetRows = [...filteredSummary].map((c) => {
                const row = targetDataByCity[c.city] || [0, 0, 0, 0, 0, 0, 0];
                const total = row.reduce((s, v) => s + v, 0);
                const risk = getCityRiskLevel(cityWiseState.metric, c[metricKey]);
                const pct = row.map(v => total ? (v / total) * 100 : 0);
                return `
                    <tr style="background: ${risk.bg};">
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: left; font-weight: 600;">${c.city}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[0])};">${row[0].toLocaleString()} (${pct[0].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[1])};">${row[1].toLocaleString()} (${pct[1].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[2])};">${row[2].toLocaleString()} (${pct[2].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[3])};">${row[3].toLocaleString()} (${pct[3].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[4])};">${row[4].toLocaleString()} (${pct[4].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[5])};">${row[5].toLocaleString()} (${pct[5].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; color: ${getPctHighlightColor(pct[6])};">${row[6].toLocaleString()} (${pct[6].toFixed(1)}%)</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;">${total.toLocaleString()}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${risk.color};">${risk.label}</td>
                    </tr>
                `;
            }).join('') + `
                <tr style="background: #f3f4f6; border-top: 3px solid #374151;">
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: left; font-weight: 700; font-size: 14px;">TOTAL</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[0])};">${targetTotals[0].toLocaleString()} (${targetTotalPct[0].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[1])};">${targetTotals[1].toLocaleString()} (${targetTotalPct[1].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[2])};">${targetTotals[2].toLocaleString()} (${targetTotalPct[2].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[3])};">${targetTotals[3].toLocaleString()} (${targetTotalPct[3].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[4])};">${targetTotals[4].toLocaleString()} (${targetTotalPct[4].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[5])};">${targetTotals[5].toLocaleString()} (${targetTotalPct[5].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px; color: ${getPctHighlightColor(targetTotalPct[6])};">${targetTotals[6].toLocaleString()} (${targetTotalPct[6].toFixed(1)}%)</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 14px;">${targetGrandTotal.toLocaleString()}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;"></td>
                </tr>
            `;

            const overallBody = document.getElementById('cityWiseOverallTableBody');
            const rangeBody = document.getElementById('cityWiseRangeTableBody');
            const targetBody = document.getElementById('cityWiseTargetRangeTableBody');
            if (overallBody) overallBody.innerHTML = overallRows;
            if (rangeBody) rangeBody.innerHTML = rangeRows;
            if (targetBody) targetBody.innerHTML = targetRows;

            const overallTable = document.getElementById('cityWiseOverallTable');
            const rangeTables = document.getElementById('cityWiseRangeTables');
            if (cityWiseState.view === 'range') {
                if (overallTable) overallTable.style.display = 'none';
                if (rangeTables) rangeTables.style.display = 'block';
            } else {
                if (overallTable) overallTable.style.display = 'block';
                if (rangeTables) rangeTables.style.display = 'none';
            }
        }

        function updateCityWiseSelect() {
            const select = document.getElementById('cityWiseCitySelect');
            if (!select) return;
            const cities = getFilteredCitySummary().map(c => c.city);
            select.innerHTML = cities.map(c => `<option value="${c}">${c}</option>`).join('');
            if (!cities.includes(cityWiseState.city)) {
                cityWiseState.city = cities[0] || '';
            }
            if (cityWiseState.city) {
                select.value = cityWiseState.city;
                select.disabled = false;
                select.style.opacity = '1';
            } else {
                select.disabled = true;
                select.style.opacity = '0.6';
            }
        }

        function renderCityWiseOverview() {
            const metricKey = cityWiseState.metric === 'fr' ? 'fr' : 'dc';
            const sortedSummary = [...getFilteredCitySummary()].sort((a, b) => b[metricKey] - a[metricKey]);
            const cities = sortedSummary.map(c => c.city);
            const avgValues = sortedSummary.map(c => c[metricKey]);
            const partners = sortedSummary.map(c => c.partners);
            const metricColor = getCityWiseMetricColor(cityWiseState.metric);
            const barColors = avgValues.map(v => getCityRiskLevel(cityWiseState.metric, v).color || metricColor);

            if (!cities.length) {
                if (cityWiseOverviewChart) {
                    cityWiseOverviewChart.destroy();
                    cityWiseOverviewChart = null;
                }
                return;
            }

            if (cityWiseOverviewChart) {
                cityWiseOverviewChart.destroy();
            }

            const ctx = document.getElementById('cityWiseOverviewChart').getContext('2d');
            cityWiseOverviewChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cities,
                    datasets: [
                        {
                            label: `Avg ${cityWiseState.metric === 'fr' ? 'FR' : 'DC'} Rate %`,
                            data: avgValues,
                            backgroundColor: barColors,
                            borderColor: barColors,
                            borderWidth: 1.5,
                            yAxisID: 'y'
                        },
                        {
                            label: '# of partners with target',
                            data: partners,
                            type: 'line',
                            borderColor: '#6b7280',
                            backgroundColor: 'rgba(107,114,128,0.15)',
                            pointRadius: 3,
                            pointBackgroundColor: '#6b7280',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const avgRate = context.chart.data.datasets[0]?.data?.[context.dataIndex] ?? 0;
                                    const partners = context.chart.data.datasets[1]?.data?.[context.dataIndex] ?? 0;
                                    return [
                                        `Avg ${cityWiseState.metric === 'fr' ? 'FR' : 'DC'} Rate %: ${Number(avgRate).toFixed(1)}%`,
                                        `# of partners with target: ${Number(partners).toLocaleString()}`
                                    ];
                                }
                            }
                        },
                        datalabels: {
                            color: (context) => context.datasetIndex === 0 ? '#ffffff' : '#111827',
                            anchor: (context) => context.datasetIndex === 0 ? 'center' : 'end',
                            align: (context) => context.datasetIndex === 0 ? 'center' : 'top',
                            offset: (context) => context.datasetIndex === 0 ? 0 : 6,
                            backgroundColor: (context) => context.datasetIndex === 0 ? 'rgba(0,0,0,0.0)' : 'rgba(255,255,255,0.9)',
                            borderRadius: (context) => context.datasetIndex === 0 ? 0 : 4,
                            padding: (context) => context.datasetIndex === 0 ? 0 : 3,
                            font: (context) => ({ size: context.datasetIndex === 0 ? 10 : 10, weight: 'bold' }),
                            textStrokeColor: 'rgba(0,0,0,0.35)',
                            textStrokeWidth: (context) => context.datasetIndex === 0 ? 2 : 0,
                            formatter: (value, context) => {
                                if (context.datasetIndex === 0) {
                                    return value ? value.toFixed(1) + '%' : '';
                                }
                                return value ? value.toLocaleString() : '';
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: (value) => value + '%' },
                            title: { display: true, text: 'Avg Rate %' }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: '# of partners with target' }
                        },
                        x: {
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            });
        }

        function renderCityWiseTierOverview() {
            const metricKey = cityWiseState.metric === 'fr' ? 'fr' : 'dc';
            const metricColor = getCityWiseMetricColor(cityWiseState.metric);

            const renderTierChart = (tier, canvasId, titleId) => {
                const tierSummary = cityWiseData.summary.filter(c => cityWiseTierMap[c.city] === tier);
                const sortedSummary = [...tierSummary].sort((a, b) => b[metricKey] - a[metricKey]);
                const cities = sortedSummary.map(c => c.city);
                const avgValues = sortedSummary.map(c => c[metricKey]);
                const partners = sortedSummary.map(c => c.partners);
                const barColors = avgValues.map(v => getCityRiskLevel(cityWiseState.metric, v).color || metricColor);

                const titleEl = document.getElementById(titleId);
                if (titleEl) {
                    titleEl.textContent = `${tier.toUpperCase()} Cities`;
                }

                if (!cities.length) return null;

                const ctx = document.getElementById(canvasId).getContext('2d');
                return new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: cities,
                        datasets: [
                            {
                                label: `Avg ${cityWiseState.metric === 'fr' ? 'FR' : 'DC'} Rate %`,
                                data: avgValues,
                                backgroundColor: barColors,
                                borderColor: barColors,
                                borderWidth: 1.5,
                                yAxisID: 'y'
                            },
                            {
                                label: '# of partners with target',
                                data: partners,
                                type: 'line',
                                borderColor: '#6b7280',
                                backgroundColor: 'rgba(107,114,128,0.15)',
                                pointRadius: 3,
                                pointBackgroundColor: '#6b7280',
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2.5,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const avgRate = context.chart.data.datasets[0]?.data?.[context.dataIndex] ?? 0;
                                        const partnersVal = context.chart.data.datasets[1]?.data?.[context.dataIndex] ?? 0;
                                        return [
                                            `Avg ${cityWiseState.metric === 'fr' ? 'FR' : 'DC'} Rate %: ${Number(avgRate).toFixed(1)}%`,
                                            `# of partners with target: ${Number(partnersVal).toLocaleString()}`
                                        ];
                                    }
                                }
                            },
                            datalabels: {
                                color: (context) => context.datasetIndex === 0 ? '#ffffff' : '#111827',
                                anchor: (context) => context.datasetIndex === 0 ? 'center' : 'end',
                                align: (context) => context.datasetIndex === 0 ? 'center' : 'top',
                                offset: (context) => context.datasetIndex === 0 ? 0 : 6,
                                backgroundColor: (context) => context.datasetIndex === 0 ? 'rgba(0,0,0,0.0)' : 'rgba(255,255,255,0.9)',
                                borderRadius: (context) => context.datasetIndex === 0 ? 0 : 4,
                                padding: (context) => context.datasetIndex === 0 ? 0 : 3,
                                font: (context) => ({ size: 10, weight: 'bold' }),
                                textStrokeColor: 'rgba(0,0,0,0.35)',
                                textStrokeWidth: (context) => context.datasetIndex === 0 ? 2 : 0,
                                formatter: (value, context) => {
                                    if (context.datasetIndex === 0) {
                                        return value ? value.toFixed(1) + '%' : '';
                                    }
                                    return value ? value.toLocaleString() : '';
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { callback: (value) => value + '%' },
                                title: { display: true, text: 'Avg Rate %' }
                            },
                            y1: {
                                beginAtZero: true,
                                position: 'right',
                                grid: { drawOnChartArea: false },
                                title: { display: true, text: '# of partners with target' }
                            },
                            x: {
                                ticks: { maxRotation: 45, minRotation: 45 }
                            }
                        }
                    }
                });
            };

            if (cityWiseT1OverviewChart) {
                cityWiseT1OverviewChart.destroy();
            }
            if (cityWiseT2OverviewChart) {
                cityWiseT2OverviewChart.destroy();
            }

            cityWiseT1OverviewChart = renderTierChart('t1', 'cityWiseT1OverviewChart', 'cityWiseT1Title');
            cityWiseT2OverviewChart = renderTierChart('t2', 'cityWiseT2OverviewChart', 'cityWiseT2Title');
        }

        function renderCityWiseRanges() {
            if (!cityWiseState.city) {
                return;
            }
            const metricKey = cityWiseState.metric === 'fr' ? 'fr' : 'dc';
            const rangeData = metricKey === 'fr'
                ? cityWiseData.frPartnersRanges[cityWiseState.city]
                : cityWiseData.dcPartnersRanges[cityWiseState.city];
            const targetRangeData = metricKey === 'fr'
                ? cityWiseData.frTargetRanges[cityWiseState.city]
                : cityWiseData.dcTargetRanges[cityWiseState.city];
            const metricColor = getCityWiseMetricColor(cityWiseState.metric);

            if (cityWiseRangeChart) {
                cityWiseRangeChart.destroy();
            }
            if (cityWiseTargetRangeChart) {
                cityWiseTargetRangeChart.destroy();
            }

            const rangeTotal = rangeData.reduce((s, v) => s + v, 0);
            const targetTotal = targetRangeData.reduce((s, v) => s + v, 0);
            const rangeMax = Math.max(...rangeData, 0);
            const targetMax = Math.max(...targetRangeData, 0);
            const rangeSuggestedMax = rangeMax ? Math.ceil(rangeMax * 1.25) : 1;
            const targetSuggestedMax = targetMax ? Math.ceil(targetMax * 1.15) : 1;
            const ctxRange = document.getElementById('cityWiseRangeChart').getContext('2d');
            cityWiseRangeChart = new Chart(ctxRange, {
                type: 'bar',
                data: {
                    labels: cityWiseRangeLabels,
                    datasets: [{
                        label: `${cityWiseState.city} - Partners with Target`,
                        data: rangeData,
                        backgroundColor: metricColor,
                        borderColor: metricColor,
                        borderWidth: 1.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: (context) => (context.dataset.data[context.dataIndex] || 0) > 0,
                            anchor: 'end',
                            align: 'top',
                            offset: 6,
                            clamp: true,
                            clip: false,
                            color: (context) => {
                                const val = context.dataset.data[context.dataIndex] || 0;
                                const pct = rangeTotal ? (val / rangeTotal) * 100 : 0;
                                return getPctHighlightColor(pct);
                            },
                            backgroundColor: 'rgba(255,255,255,0.9)',
                            borderRadius: 4,
                            padding: 3,
                            font: { size: 10, weight: 'bold' },
                            formatter: (value) => {
                                if (!value) return '';
                                const pct = rangeTotal ? (value / rangeTotal) * 100 : 0;
                                return `${value.toLocaleString()} (${pct.toFixed(1)}%)`;
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, suggestedMax: rangeSuggestedMax, ticks: { callback: (v) => v.toLocaleString() } }
                    }
                }
            });

            const ctxTarget = document.getElementById('cityWiseTargetRangeChart').getContext('2d');
            cityWiseTargetRangeChart = new Chart(ctxTarget, {
                type: 'bar',
                data: {
                    labels: cityWiseRangeLabels,
                    datasets: [{
                        label: `${cityWiseState.city} - Target Range`,
                        data: targetRangeData,
                        backgroundColor: '#94a3b8',
                        borderColor: '#64748b',
                        borderWidth: 1.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: (context) => (context.dataset.data[context.dataIndex] || 0) > 0,
                            anchor: 'end',
                            align: 'top',
                            offset: 6,
                            clamp: true,
                            clip: false,
                            color: (context) => {
                                const val = context.dataset.data[context.dataIndex] || 0;
                                const pct = targetTotal ? (val / targetTotal) * 100 : 0;
                                return getPctHighlightColor(pct);
                            },
                            backgroundColor: 'rgba(255,255,255,0.9)',
                            borderRadius: 4,
                            padding: 3,
                            font: { size: 10, weight: 'bold' },
                            formatter: (value) => {
                                if (!value) return '';
                                const pct = targetTotal ? (value / targetTotal) * 100 : 0;
                                return `${value.toLocaleString()} (${pct.toFixed(1)}%)`;
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, suggestedMax: targetSuggestedMax, ticks: { callback: (v) => v.toLocaleString() } }
                    }
                }
            });
        }

        function updateCityWiseView() {
            updateCityWiseSelect();
            updateCityWiseTitle();
            updateCityWiseRiskList();
            updateCityWiseSummaryCards();
            const overviewSection = document.getElementById('cityWiseOverviewSection');
            const rangeSection = document.getElementById('cityWiseRangeSection');
            const tierOverviewSection = document.getElementById('cityWiseTierOverviewSection');
            const select = document.getElementById('cityWiseCitySelect');
            if (cityWiseState.view === 'overview') {
                overviewSection.style.display = 'block';
                rangeSection.style.display = 'none';
                tierOverviewSection.style.display = 'none';
                select.disabled = true;
                select.style.opacity = '0.6';
                renderCityWiseOverview();
            } else if (cityWiseState.view === 'range') {
                overviewSection.style.display = 'none';
                rangeSection.style.display = 'block';
                tierOverviewSection.style.display = 'none';
                select.disabled = false;
                select.style.opacity = '1';
                renderCityWiseRanges();
            } else {
                overviewSection.style.display = 'none';
                rangeSection.style.display = 'none';
                tierOverviewSection.style.display = 'block';
                select.disabled = true;
                select.style.opacity = '0.6';
                renderCityWiseTierOverview();
            }
        }

        window.initCityWiseCompliance = function() {
            updateCityWiseSelect();
            updateCityWiseView();
        };

        document.querySelectorAll('.citywise-metric-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const metric = this.getAttribute('data-metric');
                cityWiseState.metric = metric;
                document.querySelectorAll('.citywise-metric-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = metric === 'fr' ? '#3b82f6' : '#10b981';
                this.style.color = 'white';
                this.style.borderColor = metric === 'fr' ? '#3b82f6' : '#10b981';
                updateCityWiseView();
            });
        });

        document.querySelectorAll('.citywise-view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const view = this.getAttribute('data-view');
                cityWiseState.view = view;
                document.querySelectorAll('.citywise-view-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = '#8b5cf6';
                this.style.color = 'white';
                this.style.borderColor = '#8b5cf6';
                updateCityWiseView();
            });
        });

        document.querySelectorAll('.citywise-tier-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tier = this.getAttribute('data-tier');
                cityWiseState.tier = tier;
                if (cityWiseState.view === 't1t2') {
                    cityWiseState.view = 'overview';
                    document.querySelectorAll('.citywise-view-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.style.borderColor = '#e5e7eb';
                    });
                    const overviewBtn = document.querySelector('.citywise-view-btn[data-view="overview"]');
                    if (overviewBtn) {
                        overviewBtn.style.background = '#8b5cf6';
                        overviewBtn.style.color = 'white';
                        overviewBtn.style.borderColor = '#8b5cf6';
                    }
                }
                document.querySelectorAll('.citywise-tier-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = '#0ea5e9';
                this.style.color = 'white';
                this.style.borderColor = '#0ea5e9';
                updateCityWiseView();
            });
        });

        const cityWiseSelect = document.getElementById('cityWiseCitySelect');
        if (cityWiseSelect) {
            cityWiseSelect.addEventListener('change', function() {
                cityWiseState.city = this.value;
                updateCityWiseView();
            });
        }
        
        // Initialize default state - All Partners trend line view
        setTimeout(function() {
            // Set title for default view
            document.getElementById('impactTitle').textContent = 'Face Recognition (FR) All Partners Summary - Target Changes Across Ranges';
            
            // Style the All Partners button as active
            document.querySelectorAll('.impact-filter-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = '#6b7280';
                btn.style.borderColor = '#e5e7eb';
                btn.style.boxShadow = 'none';
            });
            const allBtn = document.querySelector('[data-filter="all"]');
            allBtn.style.background = '#3b82f6';
            allBtn.style.color = 'white';
            allBtn.style.borderColor = '#3b82f6';
            allBtn.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.2)';
            
            // Initialize and display the All Partners trend line chart
            window.initImpactChartOverall('fr');
            if (window.updateImpactKpiCards) {
                window.updateImpactKpiCards('fr', 'all');
            }
            document.getElementById('impactChartSingle').style.display = 'none';
            document.getElementById('impactChartDual').style.display = 'none';
            document.getElementById('impactChartOverall').style.display = 'block';
            document.getElementById('impactChartWithTarget').style.display = 'none';
            document.getElementById('detailedTablesSection').style.display = 'none';
            
            // Show FR detailed tables
            document.getElementById('frDetailedTablesWrapper').style.display = 'block';
            document.getElementById('dcDetailedTablesWrapper').style.display = 'none';
        }, 100);
    });

    // City Tier Analysis Section
    document.addEventListener('DOMContentLoaded', function() {
        const cityTierCityData = [
            { city: 'Abha', dec: { partners: 18, target: 339, avg: 18.8 }, jan: { partners: 15, target: 297, avg: 19.8 } },
            { city: 'Al Ahsa', dec: { partners: 32, target: 858, avg: 26.8 }, jan: { partners: 28, target: 818, avg: 29.2 } },
            { city: 'Al Kharj', dec: { partners: 7, target: 380, avg: 54.3 }, jan: { partners: 8, target: 347, avg: 43.4 } },
            { city: 'Buraydah', dec: { partners: 13, target: 296, avg: 22.8 }, jan: { partners: 10, target: 253, avg: 25.3 } },
            { city: 'Dammam', dec: { partners: 76, target: 2641, avg: 34.8 }, jan: { partners: 64, target: 2127, avg: 33.2 } },
            { city: 'Hafar Al Batin', dec: { partners: 8, target: 128, avg: 16.0 }, jan: { partners: 7, target: 109, avg: 15.6 } },
            { city: 'Hail', dec: { partners: 7, target: 199, avg: 28.4 }, jan: { partners: 5, target: 186, avg: 37.2 } },
            { city: 'Jazan', dec: { partners: 5, target: 95, avg: 19.0 }, jan: { partners: 3, target: 74, avg: 24.7 } },
            { city: 'Jeddah', dec: { partners: 95, target: 4094, avg: 43.1 }, jan: { partners: 83, target: 3454, avg: 41.6 } },
            { city: 'Jubail', dec: { partners: 11, target: 244, avg: 22.2 }, jan: { partners: 10, target: 230, avg: 23.0 } },
            { city: 'Makkah', dec: { partners: 47, target: 1074, avg: 22.9 }, jan: { partners: 41, target: 935, avg: 22.8 } },
            { city: 'Madinah', dec: { partners: 46, target: 1195, avg: 26.0 }, jan: { partners: 37, target: 1131, avg: 30.6 } },
            { city: 'Najran', dec: { partners: 5, target: 76, avg: 15.2 }, jan: { partners: 5, target: 78, avg: 15.6 } },
            { city: 'Riyadh', dec: { partners: 215, target: 10028, avg: 46.6 }, jan: { partners: 200, target: 8661, avg: 43.3 } },
            { city: 'Tabuk', dec: { partners: 13, target: 252, avg: 19.4 }, jan: { partners: 11, target: 202, avg: 18.4 } },
            { city: 'Taif', dec: { partners: 16, target: 345, avg: 21.6 }, jan: { partners: 14, target: 292, avg: 20.9 } },
            { city: 'Yanbu', dec: { partners: 11, target: 209, avg: 19.0 }, jan: { partners: 10, target: 171, avg: 17.1 } }
        ];

        const cityTierOverview = {
            t1: { dec: { partners: 518, target: 20270, avg: 39.1 }, jan: { partners: 461, target: 17473, avg: 37.9 } },
            t2: { dec: { partners: 107, target: 2183, avg: 20.4 }, jan: { partners: 90, target: 1892, avg: 21.0 } }
        };

        const cityTierMap = {
            'Riyadh': 't1',
            'Madinah': 't1',
            'Makkah': 't1',
            'Jeddah': 't1',
            'Dammam': 't1',
            'Al Kharj': 't1',
            'Al Ahsa': 't1',
            'Abha': 't2',
            'Buraydah': 't2',
            'Hail': 't2',
            'Jazan': 't2',
            'Jubail': 't2',
            'Tabuk': 't2',
            'Taif': 't2',
            'Yanbu': 't2',
            'Hafar Al Batin': 't2',
            'Najran': 't2'
        };

        const cityTierPerformance = {
            t1: {
                partners: { dec: { good: 207, average: 230, bad: 72 }, jan: { good: 199, average: 228, bad: 20 } },
                target: { dec: { good: 10903, average: 7613, bad: 1514 }, jan: { good: 8904, average: 7842, bad: 370 } }
            },
            t2: {
                partners: { dec: { good: 62, average: 44, bad: 1 }, jan: { good: 53, average: 34, bad: 0 } },
                target: { dec: { good: 1446, average: 717, bad: 20 }, jan: { good: 1288, average: 572, bad: 0 } }
            }
        };

        const cityTierScale = {
            t1: {
                partners: { dec: { big: 57, mid: 219, small: 233 }, jan: { big: 57, mid: 219, small: 171 } },
                target: { dec: { big: 4471, mid: 9490, small: 6069 }, jan: { big: 1650, mid: 7052, small: 8686 } }
            },
            t2: {
                partners: { dec: { big: 24, mid: 56, small: 27 }, jan: { big: 20, mid: 63, small: 4 } },
                target: { dec: { big: 467, mid: 1108, small: 608 }, jan: { big: 131, mid: 781, small: 854 } }
            }
        };

        const cityTierMetricLabels = {
            partners: '# of partners with target',
            target: 'Total target',
            avg: 'Avg scale'
        };

        const cityTierPerformanceData = [
            { city: 'Abha', performance: 'good', partners: 8, dec: 195, jan: 184, change: -11, changePct: -5.6 },
            { city: 'Abha', performance: 'average', partners: 6, dec: 144, jan: 103, change: -41, changePct: -28.5 },
            { city: 'Abha', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Al Ahsa', performance: 'good', partners: 12, dec: 304, jan: 326, change: 22, changePct: 7.2 },
            { city: 'Al Ahsa', performance: 'average', partners: 15, dec: 492, jan: 476, change: -16, changePct: -3.3 },
            { city: 'Al Ahsa', performance: 'bad', partners: 1, dec: 62, jan: 16, change: -46, changePct: -74.2 },
            { city: 'Al Kharj', performance: 'good', partners: 2, dec: 118, jan: 120, change: 2, changePct: 1.7 },
            { city: 'Al Kharj', performance: 'average', partners: 4, dec: 212, jan: 183, change: -29, changePct: -13.7 },
            { city: 'Al Kharj', performance: 'bad', partners: 2, dec: 50, jan: 44, change: -6, changePct: -12.0 },
            { city: 'Buraydah', performance: 'good', partners: 7, dec: 214, jan: 213, change: -1, changePct: -0.5 },
            { city: 'Buraydah', performance: 'average', partners: 3, dec: 70, jan: 40, change: -30, changePct: -42.9 },
            { city: 'Buraydah', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Dammam', performance: 'good', partners: 30, dec: 1153, jan: 1076, change: -77, changePct: -6.7 },
            { city: 'Dammam', performance: 'average', partners: 32, dec: 1372, jan: 1001, change: -371, changePct: -27.0 },
            { city: 'Dammam', performance: 'bad', partners: 1, dec: 116, jan: 25, change: -91, changePct: -78.4 },
            { city: 'Hafar Al Batin', performance: 'good', partners: 5, dec: 91, jan: 87, change: -4, changePct: -4.4 },
            { city: 'Hafar Al Batin', performance: 'average', partners: 2, dec: 37, jan: 22, change: -15, changePct: -40.5 },
            { city: 'Hafar Al Batin', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Hail', performance: 'good', partners: 5, dec: 169, jan: 186, change: 17, changePct: 10.1 },
            { city: 'Hail', performance: 'average', partners: 0, dec: 30, jan: 0, change: -30, changePct: -100.0 },
            { city: 'Hail', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Jazan', performance: 'good', partners: 2, dec: 71, jan: 62, change: -9, changePct: -12.7 },
            { city: 'Jazan', performance: 'average', partners: 1, dec: 24, jan: 12, change: -12, changePct: -50.0 },
            { city: 'Jazan', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Jeddah', performance: 'good', partners: 39, dec: 1829, jan: 1709, change: -120, changePct: -6.6 },
            { city: 'Jeddah', performance: 'average', partners: 39, dec: 2139, jan: 1640, change: -499, changePct: -23.3 },
            { city: 'Jeddah', performance: 'bad', partners: 2, dec: 69, jan: 45, change: -24, changePct: -34.8 },
            { city: 'Jubail', performance: 'good', partners: 5, dec: 148, jan: 136, change: -12, changePct: -8.1 },
            { city: 'Jubail', performance: 'average', partners: 4, dec: 81, jan: 82, change: 1, changePct: 1.2 },
            { city: 'Jubail', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Makkah', performance: 'good', partners: 19, dec: 496, jan: 463, change: -33, changePct: -6.7 },
            { city: 'Makkah', performance: 'average', partners: 18, dec: 589, jan: 426, change: -163, changePct: -27.7 },
            { city: 'Makkah', performance: 'bad', partners: 2, dec: 10, jan: 20, change: 10, changePct: 100.0 },
            { city: 'Madinah', performance: 'good', partners: 18, dec: 422, jan: 454, change: 32, changePct: 7.6 },
            { city: 'Madinah', performance: 'average', partners: 17, dec: 733, jan: 643, change: -90, changePct: -12.3 },
            { city: 'Madinah', performance: 'bad', partners: 2, dec: 57, jan: 34, change: -23, changePct: -40.4 },
            { city: 'Najran', performance: 'good', partners: 3, dec: 42, jan: 46, change: 4, changePct: 9.5 },
            { city: 'Najran', performance: 'average', partners: 2, dec: 34, jan: 32, change: -2, changePct: -5.9 },
            { city: 'Najran', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Riyadh', performance: 'good', partners: 79, dec: 5255, jan: 4756, change: -499, changePct: -9.5 },
            { city: 'Riyadh', performance: 'average', partners: 103, dec: 4279, jan: 3473, change: -806, changePct: -18.8 },
            { city: 'Riyadh', performance: 'bad', partners: 10, dec: 444, jan: 186, change: -258, changePct: -58.1 },
            { city: 'Tabuk', performance: 'good', partners: 6, dec: 101, jan: 105, change: 4, changePct: 4.0 },
            { city: 'Tabuk', performance: 'average', partners: 5, dec: 140, jan: 97, change: -43, changePct: -30.7 },
            { city: 'Tabuk', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Taif', performance: 'good', partners: 7, dec: 193, jan: 163, change: -30, changePct: -15.5 },
            { city: 'Taif', performance: 'average', partners: 6, dec: 152, jan: 119, change: -33, changePct: -21.7 },
            { city: 'Taif', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Yanbu', performance: 'good', partners: 5, dec: 113, jan: 106, change: -7, changePct: -6.2 },
            { city: 'Yanbu', performance: 'average', partners: 5, dec: 92, jan: 65, change: -27, changePct: -29.3 },
            { city: 'Yanbu', performance: 'bad', partners: 0, dec: 0, jan: 0, change: 0, changePct: null }
        ];

        // Partner Scale Data - City wise
        const cityTierScaleData = [
            { city: 'Abha', scale: 'small', partners: 0, dec: 20, jan: 0, change: -20, changePct: -100.0 },
            { city: 'Abha', scale: 'mid', partners: 11, dec: 244, jan: 215, change: -29, changePct: -11.9 },
            { city: 'Abha', scale: 'big', partners: 3, dec: 75, jan: 72, change: -3, changePct: -4.0 },
            { city: 'Al Ahsa', scale: 'small', partners: 12, dec: 319, jan: 238, change: -81, changePct: -25.4 },
            { city: 'Al Ahsa', scale: 'mid', partners: 13, dec: 389, jan: 418, change: 29, changePct: 7.5 },
            { city: 'Al Ahsa', scale: 'big', partners: 3, dec: 150, jan: 162, change: 12, changePct: 8.0 },
            { city: 'Al Kharj', scale: 'small', partners: 3, dec: 56, jan: 75, change: 19, changePct: 33.9 },
            { city: 'Al Kharj', scale: 'mid', partners: 3, dec: 116, jan: 84, change: -32, changePct: -27.6 },
            { city: 'Al Kharj', scale: 'big', partners: 2, dec: 208, jan: 188, change: -20, changePct: -9.6 },
            { city: 'Buraydah', scale: 'small', partners: 0, dec: 13, jan: 0, change: -13, changePct: -100.0 },
            { city: 'Buraydah', scale: 'mid', partners: 8, dec: 214, jan: 189, change: -25, changePct: -11.7 },
            { city: 'Buraydah', scale: 'big', partners: 2, dec: 57, jan: 64, change: 7, changePct: 12.3 },
            { city: 'Dammam', scale: 'small', partners: 20, dec: 582, jan: 442, change: -140, changePct: -24.1 },
            { city: 'Dammam', scale: 'mid', partners: 32, dec: 1318, jan: 1089, change: -229, changePct: -17.4 },
            { city: 'Dammam', scale: 'big', partners: 11, dec: 741, jan: 571, change: -170, changePct: -22.9 },
            { city: 'Hafar Al Batin', scale: 'small', partners: 1, dec: 12, jan: 10, change: -2, changePct: -16.7 },
            { city: 'Hafar Al Batin', scale: 'mid', partners: 4, dec: 69, jan: 56, change: -13, changePct: -18.8 },
            { city: 'Hafar Al Batin', scale: 'big', partners: 2, dec: 47, jan: 43, change: -4, changePct: -8.5 },
            { city: 'Hail', scale: 'small', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Hail', scale: 'mid', partners: 3, dec: 74, jan: 55, change: -19, changePct: -25.7 },
            { city: 'Hail', scale: 'big', partners: 2, dec: 125, jan: 131, change: 6, changePct: 4.8 },
            { city: 'Jazan', scale: 'small', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Jazan', scale: 'mid', partners: 2, dec: 57, jan: 32, change: -25, changePct: -43.9 },
            { city: 'Jazan', scale: 'big', partners: 1, dec: 38, jan: 42, change: 4, changePct: 10.5 },
            { city: 'Jeddah', scale: 'small', partners: 18, dec: 499, jan: 323, change: -176, changePct: -35.3 },
            { city: 'Jeddah', scale: 'mid', partners: 48, dec: 2127, jan: 1813, change: -314, changePct: -14.8 },
            { city: 'Jeddah', scale: 'big', partners: 14, dec: 1411, jan: 1258, change: -153, changePct: -10.8 },
            { city: 'Jubail', scale: 'small', partners: 1, dec: 10, jan: 10, change: 0, changePct: 0.0 },
            { city: 'Jubail', scale: 'mid', partners: 5, dec: 105, jan: 108, change: 3, changePct: 2.9 },
            { city: 'Jubail', scale: 'big', partners: 3, dec: 114, jan: 100, change: -14, changePct: -12.3 },
            { city: 'Makkah', scale: 'small', partners: 22, dec: 423, jan: 362, change: -61, changePct: -14.4 },
            { city: 'Makkah', scale: 'mid', partners: 13, dec: 462, jan: 377, change: -85, changePct: -18.4 },
            { city: 'Makkah', scale: 'big', partners: 4, dec: 210, jan: 170, change: -40, changePct: -19.0 },
            { city: 'Madinah', scale: 'small', partners: 18, dec: 389, jan: 315, change: -74, changePct: -19.0 },
            { city: 'Madinah', scale: 'mid', partners: 14, dec: 439, jan: 441, change: 2, changePct: 0.5 },
            { city: 'Madinah', scale: 'big', partners: 5, dec: 384, jan: 375, change: -9, changePct: -2.3 },
            { city: 'Najran', scale: 'small', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Najran', scale: 'mid', partners: 4, dec: 52, jan: 56, change: 4, changePct: 7.7 },
            { city: 'Najran', scale: 'big', partners: 1, dec: 24, jan: 22, change: -2, changePct: -8.3 },
            { city: 'Riyadh', scale: 'small', partners: 78, dec: 2138, jan: 1841, change: -297, changePct: -13.9 },
            { city: 'Riyadh', scale: 'mid', partners: 96, dec: 5459, jan: 4597, change: -862, changePct: -15.8 },
            { city: 'Riyadh', scale: 'big', partners: 18, dec: 2381, jan: 1977, change: -404, changePct: -17.0 },
            { city: 'Tabuk', scale: 'small', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Tabuk', scale: 'mid', partners: 9, dec: 196, jan: 159, change: -37, changePct: -18.9 },
            { city: 'Tabuk', scale: 'big', partners: 2, dec: 45, jan: 43, change: -2, changePct: -4.4 },
            { city: 'Taif', scale: 'small', partners: 2, dec: 30, jan: 27, change: -3, changePct: -10.0 },
            { city: 'Taif', scale: 'mid', partners: 9, dec: 195, jan: 177, change: -18, changePct: -9.2 },
            { city: 'Taif', scale: 'big', partners: 2, dec: 120, jan: 78, change: -42, changePct: -35.0 },
            { city: 'Yanbu', scale: 'small', partners: 0, dec: 0, jan: 0, change: 0, changePct: null },
            { city: 'Yanbu', scale: 'mid', partners: 8, dec: 141, jan: 116, change: -25, changePct: -17.7 },
            { city: 'Yanbu', scale: 'big', partners: 2, dec: 64, jan: 55, change: -9, changePct: -14.1 }
        ];

        let cityTierView = 'city';
        let cityTierMetric = 'partners';
        let cityTierTier = 't1';
        let cityTierBreakdown = 'overview';
        let cityTierBreakdownMetric = 'partners';
        const cityTierSelectedCity = { t1: 'all', t2: 'all' };
        let cityTierCityChart = null;
        let cityTierBreakdownChart = null;
        let cityTierBreakdownChartT1 = null;
        let cityTierBreakdownChartT2 = null;
        let cityTierPerformanceChart = null;
        let cityTierPerformanceChartT1 = null;
        let cityTierPerformanceChartT2 = null;
        let cityTierPerformanceFilter = 'total';
        let cityTierScaleChart = null;
        let cityTierScaleChartT1 = null;
        let cityTierScaleChartT2 = null;
        let cityTierScaleFilter = 'total';

        const cityTierFormatMoM = (dec, jan) => {
            if (!dec) return '0.0';
            return (((jan - dec) / dec) * 100).toFixed(1);
        };

        const cityTierMoMColor = (mom) => {
            const val = parseFloat(mom);
            if (val > 0) return '#16a34a';
            if (val < 0) return '#dc2626';
            return '#f59e0b';
        };

        function cityTierMomLabelPlugin(decData, janData, fontSize) {
            return {
                id: 'cityTierMomLabels',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    const showDec = chart.isDatasetVisible(0);
                    const showJan = chart.isDatasetVisible(1);
                    ctx.save();
                    ctx.font = `bold ${fontSize}px sans-serif`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    chart.data.datasets.forEach((dataset, datasetIndex) => {
                        if (!chart.isDatasetVisible(datasetIndex)) return;
                        const meta = chart.getDatasetMeta(datasetIndex);
                        meta.data.forEach((bar, index) => {
                            const val = dataset.data[index];
                            if (val === null || val === undefined) return;
                            const x = bar.x;
                            const y = bar.y - 4;
                            const valText = Number(val).toLocaleString();

                            if (datasetIndex === 1 && showDec && showJan) {
                                const mom = cityTierFormatMoM(decData[index], janData[index]);
                                const sign = parseFloat(mom) > 0 ? '+' : '';
                                const momText = ` (${sign}${mom}%)`;
                                const valWidth = ctx.measureText(valText).width;
                                ctx.fillStyle = '#111827';
                                ctx.fillText(valText, x - (ctx.measureText(momText).width / 2), y);
                                ctx.fillStyle = cityTierMoMColor(mom);
                                ctx.fillText(momText, x + (valWidth / 2), y);
                            } else {
                                ctx.fillStyle = '#111827';
                                ctx.fillText(valText, x, y);
                            }
                        });
                    });
                    ctx.restore();
                }
            };
        }

        function cityTierSetActive(buttons, activeBtn, activeColor) {
            buttons.forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = '#6b7280';
                btn.style.borderColor = '#e5e7eb';
            });
            activeBtn.style.background = activeColor;
            activeBtn.style.color = 'white';
            activeBtn.style.borderColor = activeColor;
        }

        // Summary Cards Update Function
        let cityTierPreviousView = 'city'; // Track previous view for animation
        
        function cityTierUpdateSummaryCards(forceAnimate = false) {
            const card1 = document.getElementById('cityTierSummaryCard1');
            const card2 = document.getElementById('cityTierSummaryCard2');
            const card3 = document.getElementById('cityTierSummaryCard3');
            const card4 = document.getElementById('cityTierSummaryCard4');
            const cards = [card1, card2, card3, card4];

            if (!card1 || !card2 || !card3 || !card4) return;

            // Check if view changed - only animate on view change
            const viewChanged = cityTierPreviousView !== cityTierView || forceAnimate;
            cityTierPreviousView = cityTierView;

            const metricKey = cityTierView === 'city' ? cityTierMetric : 
                              cityTierView === 'tier' ? cityTierBreakdownMetric : 'partners';
            const isAvg = metricKey === 'avg';

            // Helper to format value
            const formatVal = (v) => isAvg ? v.toFixed(1) : v.toLocaleString();
            const formatMoM = (dec, jan) => {
                if (dec === 0) return jan > 0 ? '+100.0' : '0.0';
                return ((jan - dec) / dec * 100).toFixed(1);
            };

            // Helper to update card
            const updateCard = (card, icon, label, value, sub, gradient1, gradient2) => {
                const topBar = card.querySelector('div[style*="position: absolute"]');
                const iconDiv = card.querySelector('div[style*="width: 48px"]');
                const labelDiv = card.querySelector('div[style*="text-transform: uppercase"]');
                
                if (topBar) topBar.style.background = `linear-gradient(90deg, ${gradient1}, ${gradient2})`;
                if (iconDiv) {
                    iconDiv.style.background = `linear-gradient(135deg, ${gradient1} 0%, ${gradient2} 100%)`;
                    iconDiv.textContent = icon;
                }
                if (labelDiv) labelDiv.textContent = label;
                card.querySelector('#summaryCard' + (cards.indexOf(card) + 1) + 'Value').textContent = value;
                card.querySelector('#summaryCard' + (cards.indexOf(card) + 1) + 'Sub').innerHTML = sub;
            };

            // If view changed, prepare cards for animation (hide them first)
            if (viewChanged) {
                cards.forEach(card => {
                    card.classList.remove('fly-in');
                    card.classList.add('preparing');
                });
            }

            // Update card content
            const doUpdate = () => {
                if (cityTierView === 'city') {
                    // City Level Summary
                    const sortedByFeb = [...cityTierCityData].sort((a, b) => b.jan[metricKey] - a.jan[metricKey]);
                    const highest = sortedByFeb[0];
                    const lowest = sortedByFeb[sortedByFeb.length - 1];
                    const totalFeb = cityTierCityData.reduce((sum, c) => sum + c.jan[metricKey], 0);
                    const totalDec = cityTierCityData.reduce((sum, c) => sum + c.dec[metricKey], 0);
                    
                    // For avg scale, calculate true overall average (total target / total partners)
                    const totalPartnersFeb = cityTierCityData.reduce((sum, c) => sum + c.jan.partners, 0);
                    const totalTargetFeb = cityTierCityData.reduce((sum, c) => sum + c.jan.target, 0);
                    const totalPartnersDec = cityTierCityData.reduce((sum, c) => sum + c.dec.partners, 0);
                    const totalTargetDec = cityTierCityData.reduce((sum, c) => sum + c.dec.target, 0);
                    const overallAvgScaleFeb = totalTargetFeb / totalPartnersFeb;
                    const overallAvgScaleDec = totalTargetDec / totalPartnersDec;
                    
                    // Calculate MoM for highest and lowest cities
                    const highestMoM = formatMoM(highest.dec[metricKey], highest.jan[metricKey]);
                    const lowestMoM = formatMoM(lowest.dec[metricKey], lowest.jan[metricKey]);
                    const totalMoM = isAvg ? formatMoM(overallAvgScaleDec, overallAvgScaleFeb) : formatMoM(totalDec, totalFeb);
                    
                    let biggestChange = { city: '', mom: 0 };
                    cityTierCityData.forEach(c => {
                        const mom = parseFloat(formatMoM(c.dec[metricKey], c.jan[metricKey]));
                        if (Math.abs(mom) > Math.abs(biggestChange.mom)) {
                            biggestChange = { city: c.city, mom: mom };
                        }
                    });

                    const formatMoMText = (mom) => {
                        const val = parseFloat(mom);
                        const color = val >= 0 ? '#10b981' : '#ef4444';
                        const sign = val >= 0 ? '+' : '';
                        return `<span style="color: ${color}; font-weight: 600;">(MoM ${sign}${mom}%)</span>`;
                    };

                    updateCard(card1, '🏆', 'Highest City', highest.city, 
                        formatVal(highest.jan[metricKey]) + (isAvg ? ' avg scale' : metricKey === 'target' ? ' riders' : ' partners') + ' (Feb) ' + formatMoMText(highestMoM),
                        '#0ea5e9', '#06b6d4');
                    updateCard(card2, '📉', 'Lowest City', lowest.city,
                        formatVal(lowest.jan[metricKey]) + (isAvg ? ' avg scale' : metricKey === 'target' ? ' riders' : ' partners') + ' (Feb) ' + formatMoMText(lowestMoM),
                        '#f59e0b', '#fbbf24');
                    updateCard(card3, '📊', isAvg ? 'Overall (Feb)' : 'Total (Feb)', isAvg ? overallAvgScaleFeb.toFixed(1) : totalFeb.toLocaleString(),
                        (isAvg ? 'overall avg scale' : metricKey === 'target' ? 'total riders' : 'partners with target') + ' ' + formatMoMText(totalMoM),
                        '#10b981', '#34d399');
                    updateCard(card4, '📈', 'Biggest MoM Change', biggestChange.city,
                        (biggestChange.mom >= 0 ? '+' : '') + biggestChange.mom.toFixed(1) + '% MoM',
                        '#8b5cf6', '#a78bfa');

                    // Dynamic tooltips for City view
                    const metricLabel = isAvg ? 'avg scale' : metricKey === 'target' ? 'total target' : '# of partners with target';
                    card1.setAttribute('data-tooltip', `Highest city by ${metricLabel}: ${highest.city} with ${formatVal(highest.jan[metricKey])} in Feb (MoM ${highestMoM}%).`);
                    card2.setAttribute('data-tooltip', `Lowest city by ${metricLabel}: ${lowest.city} with ${formatVal(lowest.jan[metricKey])} in Feb (MoM ${lowestMoM}%).`);
                    card3.setAttribute('data-tooltip', `${isAvg ? 'Overall avg scale' : 'Total ' + metricLabel} across all cities in Feb: ${isAvg ? overallAvgScaleFeb.toFixed(1) : totalFeb.toLocaleString()} (MoM ${totalMoM}%).`);
                    card4.setAttribute('data-tooltip', `City with largest MoM% change in ${metricLabel}: ${biggestChange.city} at ${biggestChange.mom >= 0 ? '+' : ''}${biggestChange.mom.toFixed(1)}%.`);

                } else if (cityTierView === 'tier') {
                    // City Tier Breakdown
                    const t1Data = cityTierOverview.t1;
                    const t2Data = cityTierOverview.t2;
                    const t1MoM = formatMoM(t1Data.dec[metricKey], t1Data.jan[metricKey]);
                    const t2MoM = formatMoM(t2Data.dec[metricKey], t2Data.jan[metricKey]);
                    
                    const formatMoMText = (mom) => {
                        const val = parseFloat(mom);
                        const color = val >= 0 ? '#10b981' : '#ef4444';
                        const sign = val >= 0 ? '+' : '';
                        return `<span style="color: ${color}; font-weight: 600;">(MoM ${sign}${mom}%)</span>`;
                    };
                    
                    updateCard(card1, '🏙️', 'Tier 1 (Feb)', formatVal(t1Data.jan[metricKey]),
                        'T1 ' + (isAvg ? 'avg scale' : metricKey === 'target' ? 'total target' : 'partners') + ' ' + formatMoMText(t1MoM),
                        '#0ea5e9', '#06b6d4');
                    updateCard(card2, '🏘️', 'Tier 2 (Feb)', formatVal(t2Data.jan[metricKey]),
                        'T2 ' + (isAvg ? 'avg scale' : metricKey === 'target' ? 'total target' : 'partners') + ' ' + formatMoMText(t2MoM),
                        '#64748b', '#94a3b8');
                    updateCard(card3, '📊', 'T1 MoM Change', (parseFloat(t1MoM) >= 0 ? '+' : '') + t1MoM + '%',
                        'T1 change vs Jan',
                        parseFloat(t1MoM) >= 0 ? '#10b981' : '#ef4444', parseFloat(t1MoM) >= 0 ? '#34d399' : '#f87171');
                    updateCard(card4, '📊', 'T2 MoM Change', (parseFloat(t2MoM) >= 0 ? '+' : '') + t2MoM + '%',
                        'T2 change vs Jan',
                        parseFloat(t2MoM) >= 0 ? '#10b981' : '#ef4444', parseFloat(t2MoM) >= 0 ? '#34d399' : '#f87171');

                    // Dynamic tooltips for Tier view
                    const tierMetricLabel = isAvg ? 'avg scale' : metricKey === 'target' ? 'total target' : '# of partners';
                    card1.setAttribute('data-tooltip', `T1 cities ${tierMetricLabel} in Feb: ${formatVal(t1Data.jan[metricKey])} (Jan: ${formatVal(t1Data.dec[metricKey])}, MoM ${t1MoM}%).`);
                    card2.setAttribute('data-tooltip', `T2 cities ${tierMetricLabel} in Feb: ${formatVal(t2Data.jan[metricKey])} (Jan: ${formatVal(t2Data.dec[metricKey])}, MoM ${t2MoM}%).`);
                    card3.setAttribute('data-tooltip', `T1 month-over-month change in ${tierMetricLabel}: ${parseFloat(t1MoM) >= 0 ? '+' : ''}${t1MoM}% from Jan to Feb.`);
                    card4.setAttribute('data-tooltip', `T2 month-over-month change in ${tierMetricLabel}: ${parseFloat(t2MoM) >= 0 ? '+' : ''}${t2MoM}% from Jan to Feb.`);

                } else if (cityTierView === 'performance') {
                    // Performance Distribution
                    const cityPerf = {};
                    cityTierPerformanceData.forEach(row => {
                        if (!cityPerf[row.city]) cityPerf[row.city] = { good: 0, average: 0, bad: 0, total: 0 };
                        cityPerf[row.city][row.performance] = row.partners;
                        cityPerf[row.city].total += row.partners;
                    });
                    
                    let bestCity = { name: '', goodPct: 0 };
                    let worstCity = { name: '', badPct: 0 };
                    let totalGood = 0, totalBad = 0, totalAll = 0;
                    const partnersWithTarget = 551; // Base for percentage calculation
                    
                    Object.entries(cityPerf).forEach(([city, data]) => {
                        const goodPct = data.total > 0 ? (data.good / data.total * 100) : 0;
                        const badPct = data.total > 0 ? (data.bad / data.total * 100) : 0;
                        totalGood += data.good;
                        totalBad += data.bad;
                        totalAll += data.total;
                        if (goodPct > bestCity.goodPct) bestCity = { name: city, goodPct };
                        if (badPct > worstCity.badPct && data.bad > 0) worstCity = { name: city, badPct };
                    });

                    // Calculate MoM for performance using cityTierPerformance data
                    const decGood = cityTierPerformance.t1.partners.dec.good + cityTierPerformance.t2.partners.dec.good;
                    const janGood = cityTierPerformance.t1.partners.jan.good + cityTierPerformance.t2.partners.jan.good;
                    const decBad = cityTierPerformance.t1.partners.dec.bad + cityTierPerformance.t2.partners.dec.bad;
                    const janBad = cityTierPerformance.t1.partners.jan.bad + cityTierPerformance.t2.partners.jan.bad;
                    const goodMoM = formatMoM(decGood, janGood);
                    const badMoM = formatMoM(decBad, janBad);
                    
                    const formatMoMText = (mom) => {
                        const val = parseFloat(mom);
                        const color = val >= 0 ? '#10b981' : '#ef4444';
                        const sign = val >= 0 ? '+' : '';
                        return `<span style="color: ${color}; font-weight: 600;">(MoM ${sign}${mom}%)</span>`;
                    };

                    updateCard(card1, '🏆', 'Best Performing', bestCity.name || 'N/A',
                        bestCity.goodPct.toFixed(1) + '% Good partners',
                        '#10b981', '#34d399');
                    updateCard(card2, '⚠️', 'Needs Attention', worstCity.name || 'N/A',
                        worstCity.badPct.toFixed(1) + '% Bad partners',
                        '#ef4444', '#f87171');
                    updateCard(card3, '✅', 'Overall Good %', (totalGood / partnersWithTarget * 100).toFixed(1) + '%',
                        totalGood + ' Good partners ' + formatMoMText(goodMoM),
                        '#22c55e', '#4ade80');
                    updateCard(card4, '❌', 'Overall Bad %', (totalBad / partnersWithTarget * 100).toFixed(1) + '%',
                        totalBad + ' Bad partners ' + formatMoMText(badMoM),
                        '#f59e0b', '#fbbf24');

                    // Dynamic tooltips for Performance view
                    card1.setAttribute('data-tooltip', `City with highest % of Good performance partners: ${bestCity.name || 'N/A'} at ${bestCity.goodPct.toFixed(1)}%.`);
                    card2.setAttribute('data-tooltip', `City with highest % of Bad performance partners: ${worstCity.name || 'N/A'} at ${worstCity.badPct.toFixed(1)}%. Needs immediate attention.`);
                    card3.setAttribute('data-tooltip', `Overall Good partners: ${totalGood} out of ${partnersWithTarget} (${(totalGood / partnersWithTarget * 100).toFixed(1)}%). MoM: ${goodMoM}%.`);
                    card4.setAttribute('data-tooltip', `Overall Bad partners: ${totalBad} out of ${partnersWithTarget} (${(totalBad / partnersWithTarget * 100).toFixed(1)}%). MoM: ${badMoM}%.`);

                } else if (cityTierView === 'scale') {
                    // Scale Distribution
                    const cityScale = {};
                    cityTierScaleData.forEach(row => {
                        if (!cityScale[row.city]) cityScale[row.city] = { big: 0, mid: 0, small: 0, total: 0 };
                        cityScale[row.city][row.scale] = row.partners;
                        cityScale[row.city].total += row.partners;
                    });
                    
                    let mostBig = { name: '', count: 0 };
                    let mostSmall = { name: '', count: 0 };
                    let totalBig = 0, totalSmall = 0, totalMid = 0;
                    const partnersWithTarget = 551; // Base for percentage calculation
                    
                    Object.entries(cityScale).forEach(([city, data]) => {
                        totalBig += data.big;
                        totalSmall += data.small;
                        totalMid += data.mid;
                        if (data.big > mostBig.count) mostBig = { name: city, count: data.big };
                        if (data.small > mostSmall.count) mostSmall = { name: city, count: data.small };
                    });

                    // Calculate MoM for scale using cityTierScale data
                    const decBig = cityTierScale.t1.partners.dec.big + cityTierScale.t2.partners.dec.big;
                    const janBig = cityTierScale.t1.partners.jan.big + cityTierScale.t2.partners.jan.big;
                    const decSmall = cityTierScale.t1.partners.dec.small + cityTierScale.t2.partners.dec.small;
                    const janSmall = cityTierScale.t1.partners.jan.small + cityTierScale.t2.partners.jan.small;
                    const bigMoM = formatMoM(decBig, janBig);
                    const smallMoM = formatMoM(decSmall, janSmall);
                    
                    const formatMoMText = (mom) => {
                        const val = parseFloat(mom);
                        const color = val >= 0 ? '#10b981' : '#ef4444';
                        const sign = val >= 0 ? '+' : '';
                        return `<span style="color: ${color}; font-weight: 600;">(MoM ${sign}${mom}%)</span>`;
                    };

                    updateCard(card1, '📈', 'Most Big Scale', mostBig.name || 'N/A',
                        mostBig.count + ' Big scale partners',
                        '#8b5cf6', '#a78bfa');
                    updateCard(card2, '📉', 'Most Small Scale', mostSmall.name || 'N/A',
                        mostSmall.count + ' Small scale partners',
                        '#f59e0b', '#fbbf24');
                    updateCard(card3, '🔵', 'Overall Big %', (totalBig / partnersWithTarget * 100).toFixed(1) + '%',
                        totalBig + ' Big partners ' + formatMoMText(bigMoM),
                        '#6366f1', '#818cf8');
                    updateCard(card4, '🟠', 'Overall Small %', (totalSmall / partnersWithTarget * 100).toFixed(1) + '%',
                        totalSmall + ' Small partners ' + formatMoMText(smallMoM),
                        '#fb923c', '#fdba74');

                    // Dynamic tooltips for Scale view
                    card1.setAttribute('data-tooltip', `City with the most Big scale partners: ${mostBig.name || 'N/A'} with ${mostBig.count} partners.`);
                    card2.setAttribute('data-tooltip', `City with the most Small scale partners: ${mostSmall.name || 'N/A'} with ${mostSmall.count} partners.`);
                    card3.setAttribute('data-tooltip', `Overall Big scale: ${totalBig} of ${partnersWithTarget} partners (${(totalBig / partnersWithTarget * 100).toFixed(1)}%). MoM: ${bigMoM}%.`);
                    card4.setAttribute('data-tooltip', `Overall Small scale: ${totalSmall} of ${partnersWithTarget} partners (${(totalSmall / partnersWithTarget * 100).toFixed(1)}%). MoM: ${smallMoM}%.`);
                }

                // Animate cards in with stagger only if view changed
                if (viewChanged) {
                    cards.forEach((card, index) => {
                        setTimeout(() => {
                            card.classList.remove('preparing');
                            card.classList.add('fly-in');
                        }, index * 120); // 120ms stagger between each card
                    });
                }
            };

            // If view changed, wait a brief moment before updating content
            if (viewChanged) {
                setTimeout(doUpdate, 50);
            } else {
                doUpdate();
            }
        }

        function cityTierRenderCitySummary() {
            const sortedRows = [...cityTierCityData].sort((a, b) => b.jan[cityTierMetric] - a.jan[cityTierMetric]);
            const labels = sortedRows.map(row => row.city);
            const decData = sortedRows.map(row => row.dec[cityTierMetric]);
            const janData = sortedRows.map(row => row.jan[cityTierMetric]);

            const title = document.getElementById('cityTierCityTitle');
            if (title) {
                title.textContent = `City Comparison • ${cityTierMetricLabels[cityTierMetric]} (Jan vs Feb)`;
            }

            const tableBody = document.getElementById('cityTierCityTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                sortedRows.forEach((row, idx) => {
                    const dec = row.dec[cityTierMetric];
                    const jan = row.jan[cityTierMetric];
                    const mom = cityTierFormatMoM(dec, jan);
                    const tr = document.createElement('tr');
                    tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${row.city}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;"><span style="color: ${cityTierMoMColor(mom)};">${mom}%</span></td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            const canvas = document.getElementById('cityTierCityChart');
            if (!canvas) return;
            if (cityTierCityChart) { try { cityTierCityChart.destroy(); } catch (e) {} }

            const momPlugin = cityTierMomLabelPlugin(decData, janData, 9);
            cityTierCityChart = new Chart(canvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        { label: 'Jan', data: decData, backgroundColor: '#93c5fd' },
                        { label: 'Feb', data: janData, backgroundColor: '#6ee7b7' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const valueText = `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    if (context.datasetIndex === 1) {
                                        const mom = cityTierFormatMoM(decData[context.dataIndex], janData[context.dataIndex]);
                                        const sign = parseFloat(mom) > 0 ? '+' : '';
                                        return `${valueText} (MoM ${sign}${mom}%)`;
                                    }
                                    return valueText;
                                }
                            }
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } },
                        x: { ticks: { font: { size: 10 } } }
                    }
                },
                plugins: [momPlugin]
            });
        }

        function cityTierRenderPerformanceDistribution() {
            // Get cities directly from cityTierMap
            const t1Cities = Object.keys(cityTierMap).filter(city => cityTierMap[city] === 't1');
            const t2Cities = Object.keys(cityTierMap).filter(city => cityTierMap[city] === 't2');
            const filter = cityTierPerformanceFilter;

            const singleWrap = document.getElementById('cityTierPerformanceSingle');
            const splitWrap = document.getElementById('cityTierPerformanceSplit');

            const filteredRows = cityTierPerformanceData.filter(row => {
                if (filter === 't1') return t1Cities.includes(row.city);
                if (filter === 't2') return t2Cities.includes(row.city);
                return true;
            });

            const cityTotals = {};
            filteredRows.forEach(row => {
                cityTotals[row.city] = (cityTotals[row.city] || 0) + row.partners;
            });

            let labels = [];
            let goodCounts = [];
            let avgCounts = [];
            let badCounts = [];

            if (filter === 't1t2') {
                if (singleWrap) singleWrap.style.display = 'none';
                if (splitWrap) splitWrap.style.display = 'block';
            } else {
                if (singleWrap) singleWrap.style.display = 'block';
                if (splitWrap) splitWrap.style.display = 'none';
                labels = Object.keys(cityTotals).sort((a, b) => (cityTotals[b] || 0) - (cityTotals[a] || 0));
            }
            const buildSeries = (labelsList, rows, totals) => ({
                good: labelsList.map(city => {
                    const row = rows.find(r => r.city === city && r.performance === 'good');
                    return row ? row.partners : 0;
                }),
                avg: labelsList.map(city => {
                    const row = rows.find(r => r.city === city && r.performance === 'average');
                    return row ? row.partners : 0;
                }),
                bad: labelsList.map(city => {
                    const row = rows.find(r => r.city === city && r.performance === 'bad');
                    return row ? row.partners : 0;
                }),
                totals: labelsList.map(city => totals[city] || 0)
            });

            if (filter === 't1t2') {
                const t1Rows = cityTierPerformanceData.filter(r => t1Cities.includes(r.city));
                const t2Rows = cityTierPerformanceData.filter(r => t2Cities.includes(r.city));

                const t1Totals = {};
                t1Rows.forEach(row => { t1Totals[row.city] = (t1Totals[row.city] || 0) + row.partners; });
                const t2Totals = {};
                t2Rows.forEach(row => { t2Totals[row.city] = (t2Totals[row.city] || 0) + row.partners; });

                const t1Labels = Object.keys(t1Totals).sort((a, b) => (t1Totals[b] || 0) - (t1Totals[a] || 0));
                const t2Labels = Object.keys(t2Totals).sort((a, b) => (t2Totals[b] || 0) - (t2Totals[a] || 0));

                const t1Series = buildSeries(t1Labels, t1Rows, t1Totals);
                const t2Series = buildSeries(t2Labels, t2Rows, t2Totals);

                const makeChart = (canvasId, series, labelsList, totalsMap, storeSetter) => {
                    const ctx = document.getElementById(canvasId).getContext('2d');
                    if (storeSetter.current) {
                        storeSetter.current.destroy();
                    }
                    const totalsArray = labelsList.map(city => totalsMap[city] || 0);
                    const maxTotal = Math.max(...totalsArray, 1);
                    storeSetter.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labelsList,
                            datasets: [
                                { label: 'Good', data: series.good, backgroundColor: '#16a34a', stack: 'stack1', order: 2 },
                                { label: 'Average', data: series.avg, backgroundColor: '#f59e0b', stack: 'stack1', order: 2 },
                                { label: 'Bad', data: series.bad, backgroundColor: '#ef4444', stack: 'stack1', order: 2 },
                                {
                                    label: 'Total Partners Trend',
                                    data: totalsArray,
                                    type: 'line',
                                    borderColor: '#1f2937',
                                    backgroundColor: '#1f2937',
                                    borderWidth: 2,
                                    pointRadius: 5,
                                    pointBackgroundColor: '#1f2937',
                                    fill: false,
                                    tension: 0.3,
                                    order: 1,
                                    datalabels: {
                                        display: true,
                                        color: '#1f2937',
                                        font: { size: 11, weight: 'bold' },
                                        anchor: 'end',
                                        align: 'top',
                                        offset: 4,
                                        formatter: (value) => value.toLocaleString()
                                    }
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            aspectRatio: 2.5,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        boxWidth: 12
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        title: function(tooltipItems) {
                                            return tooltipItems[0].label;
                                        },
                                        label: function(context) {
                                            if (context.dataset.label === 'Total Partners Trend') {
                                                return null;
                                            }
                                            const total = totalsMap[context.label] || 0;
                                            const pct = total ? (context.parsed.y / total) * 100 : 0;
                                            return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} (${pct.toFixed(0)}%)`;
                                        },
                                        afterBody: function(tooltipItems) {
                                            const city = tooltipItems[0].label;
                                            const total = totalsMap[city] || 0;
                                            return [`──────────`, `Total: ${total.toLocaleString()}`];
                                        }
                                    },
                                    filter: function(tooltipItem) {
                                        return tooltipItem.dataset.label !== 'Total Partners Trend';
                                    }
                                },
                                datalabels: {
                                    display: function(context) {
                                        if (context.dataset.type === 'line') return false;
                                        return context.dataset.data[context.dataIndex] > 0;
                                    },
                                    color: '#ffffff',
                                    font: { size: 9, weight: 'bold' },
                                    anchor: 'center',
                                    align: 'center',
                                    formatter: (value, context) => {
                                        if (context.dataset.type === 'line' || !value) return '';
                                        const total = totalsMap[context.chart.data.labels[context.dataIndex]] || 0;
                                        const pct = total ? (value / total) * 100 : 0;
                                        return `${value}\n(${pct.toFixed(0)}%)`;
                                    }
                                }
                            },
                            scales: {
                                x: { stacked: true, ticks: { maxRotation: 45, minRotation: 45 } },
                                y: {
                                    stacked: true,
                                    beginAtZero: true,
                                    max: Math.ceil(maxTotal * 1.15),
                                    ticks: { callback: v => v.toLocaleString() }
                                }
                            }
                        }
                    });
                };

                makeChart('cityTierPerformanceChartT1', t1Series, t1Labels, t1Totals, {
                    get current() { return cityTierPerformanceChartT1; },
                    set current(v) { cityTierPerformanceChartT1 = v; }
                });
                makeChart('cityTierPerformanceChartT2', t2Series, t2Labels, t2Totals, {
                    get current() { return cityTierPerformanceChartT2; },
                    set current(v) { cityTierPerformanceChartT2 = v; }
                });
            } else {
                labels = Object.keys(cityTotals).sort((a, b) => (cityTotals[b] || 0) - (cityTotals[a] || 0));
                const series = buildSeries(labels, filteredRows, cityTotals);
                goodCounts = series.good;
                avgCounts = series.avg;
                badCounts = series.bad;
            }

            if (filter !== 't1t2') {
                if (cityTierPerformanceChart) {
                    cityTierPerformanceChart.destroy();
                }

                const totalsArray = labels.map(city => cityTotals[city] || 0);
                const maxTotal = Math.max(...totalsArray, 1);

                const ctx = document.getElementById('cityTierPerformanceChart').getContext('2d');
                cityTierPerformanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Good', data: goodCounts, backgroundColor: '#16a34a', stack: 'stack1', order: 2 },
                            { label: 'Average', data: avgCounts, backgroundColor: '#f59e0b', stack: 'stack1', order: 2 },
                            { label: 'Bad', data: badCounts, backgroundColor: '#ef4444', stack: 'stack1', order: 2 },
                            {
                                label: 'Total Partners Trend',
                                data: totalsArray,
                                type: 'line',
                                borderColor: '#1f2937',
                                backgroundColor: '#1f2937',
                                borderWidth: 2,
                                pointRadius: 5,
                                pointBackgroundColor: '#1f2937',
                                fill: false,
                                tension: 0.3,
                                order: 1,
                                datalabels: {
                                    display: true,
                                    color: '#1f2937',
                                    font: { size: 11, weight: 'bold' },
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 4,
                                    formatter: (value) => value.toLocaleString()
                                }
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2.5,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    boxWidth: 12
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    title: function(tooltipItems) {
                                        return tooltipItems[0].label;
                                    },
                                    label: function(context) {
                                        if (context.dataset.label === 'Total Partners Trend') {
                                            return null;
                                        }
                                        const total = cityTotals[context.label] || 0;
                                        const pct = total ? (context.parsed.y / total) * 100 : 0;
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} (${pct.toFixed(0)}%)`;
                                    },
                                    afterBody: function(tooltipItems) {
                                        const city = tooltipItems[0].label;
                                        const total = cityTotals[city] || 0;
                                        return [`──────────`, `Total: ${total.toLocaleString()}`];
                                    }
                                },
                                filter: function(tooltipItem) {
                                    return tooltipItem.dataset.label !== 'Total Partners Trend';
                                }
                            },
                            datalabels: {
                                display: function(context) {
                                    if (context.dataset.type === 'line') return false;
                                    return context.dataset.data[context.dataIndex] > 0;
                                },
                                color: '#ffffff',
                                font: { size: 9, weight: 'bold' },
                                anchor: 'center',
                                align: 'center',
                                formatter: (value, context) => {
                                    if (context.dataset.type === 'line' || !value) return '';
                                    const label = context.chart.data.labels[context.dataIndex];
                                    const total = cityTotals[label] || 0;
                                    const pct = total ? (value / total) * 100 : 0;
                                    return `${value}\n(${pct.toFixed(0)}%)`;
                                }
                            }
                        },
                        scales: {
                            x: { stacked: true, ticks: { maxRotation: 45, minRotation: 45 } },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                max: Math.ceil(maxTotal * 1.15),
                                ticks: { callback: v => v.toLocaleString() }
                            }
                        }
                    }
                });
            }

            const tableBody = document.getElementById('cityTierPerformanceTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                
                // Calculate city share % for Good and Bad performance rows
                const goodRows = filteredRows
                    .filter(r => r.performance === 'good')
                    .map(r => ({
                        city: r.city,
                        pct: cityTotals[r.city] ? (r.partners / cityTotals[r.city]) * 100 : 0
                    }))
                    .sort((a, b) => b.pct - a.pct);
                
                const badRows = filteredRows
                    .filter(r => r.performance === 'bad' && r.partners > 0)
                    .map(r => ({
                        city: r.city,
                        pct: cityTotals[r.city] ? (r.partners / cityTotals[r.city]) * 100 : 0
                    }))
                    .sort((a, b) => b.pct - a.pct);
                
                // Get top 3 cities for each
                const top3Good = goodRows.slice(0, 3).map(r => r.city);
                const top3Bad = badRows.slice(0, 3).map(r => r.city);
                
                // Create lookup for Good % and Bad % per city
                const cityGoodPct = {};
                const cityBadPct = {};
                goodRows.forEach(r => { cityGoodPct[r.city] = r.pct; });
                badRows.forEach(r => { cityBadPct[r.city] = r.pct; });
                
                // Calculate risk per city
                const getCityRisk = (city) => {
                    const goodPct = cityGoodPct[city] || 0;
                    const badPct = cityBadPct[city] || 0;
                    if (goodPct < 30 || badPct >= 20) return { level: 'High Risk', color: '#dc2626', bg: '#fee2e2' };
                    if (goodPct >= 50) return { level: 'Low Risk', color: '#16a34a', bg: '#dcfce7' };
                    return { level: 'Moderate Risk', color: '#f59e0b', bg: '#fef3c7' };
                };
                
                filteredRows.forEach((row, idx) => {
                    const total = cityTotals[row.city] || 0;
                    const pct = total ? (row.partners / total) * 100 : 0;
                    const changeText = row.changePct === null ? '-' : `${row.changePct.toFixed(1)}%`;
                    const changeColor = row.changePct === null ? '#6b7280' : (row.changePct > 0 ? '#16a34a' : (row.changePct < 0 ? '#dc2626' : '#6b7280'));
                    
                    // Determine highlight colors for full row
                    let rowBg = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    let cellStyle = '';
                    
                    if (row.performance === 'good' && top3Good.includes(row.city)) {
                        rowBg = '#dcfce7'; // Light green background for full row
                        cellStyle = 'background: #dcfce7;';
                    } else if (row.performance === 'bad' && top3Bad.includes(row.city)) {
                        rowBg = '#fee2e2'; // Light red background for full row
                        cellStyle = 'background: #fee2e2;';
                    }
                    
                    // Get risk level for this city
                    const risk = getCityRisk(row.city);
                    
                    const tr = document.createElement('tr');
                    tr.style.background = rowBg;
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600; ${cellStyle}">${row.city}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-transform: capitalize; ${cellStyle}">${row.performance}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; ${cellStyle}">${row.partners.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; ${cellStyle}">${row.dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; ${cellStyle}">${row.jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; ${cellStyle}">${row.change.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${changeColor}; ${cellStyle}">${changeText}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; ${cellStyle}">${pct.toFixed(1)}%</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${risk.color}; background: ${risk.bg};">${risk.level}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            }
        }

        // Scale Distribution Rendering Function
        function cityTierRenderScaleDistribution() {
            // Get cities directly from cityTierMap
            const t1Cities = Object.keys(cityTierMap).filter(city => cityTierMap[city] === 't1');
            const t2Cities = Object.keys(cityTierMap).filter(city => cityTierMap[city] === 't2');
            const filter = cityTierScaleFilter;

            const singleWrap = document.getElementById('cityTierScaleSingle');
            const splitWrap = document.getElementById('cityTierScaleSplit');

            const filteredRows = cityTierScaleData.filter(row => {
                if (filter === 't1') return t1Cities.includes(row.city);
                if (filter === 't2') return t2Cities.includes(row.city);
                return true;
            });

            const cityTotals = {};
            filteredRows.forEach(row => {
                cityTotals[row.city] = (cityTotals[row.city] || 0) + row.partners;
            });

            let labels = [];
            let bigCounts = [];
            let midCounts = [];
            let smallCounts = [];

            if (filter === 't1t2') {
                if (singleWrap) singleWrap.style.display = 'none';
                if (splitWrap) splitWrap.style.display = 'block';
            } else {
                if (singleWrap) singleWrap.style.display = 'block';
                if (splitWrap) splitWrap.style.display = 'none';
                labels = Object.keys(cityTotals).sort((a, b) => (cityTotals[b] || 0) - (cityTotals[a] || 0));
            }
            const buildSeries = (labelsList, rows, totals) => ({
                big: labelsList.map(city => {
                    const row = rows.find(r => r.city === city && r.scale === 'big');
                    return row ? row.partners : 0;
                }),
                mid: labelsList.map(city => {
                    const row = rows.find(r => r.city === city && r.scale === 'mid');
                    return row ? row.partners : 0;
                }),
                small: labelsList.map(city => {
                    const row = rows.find(r => r.city === city && r.scale === 'small');
                    return row ? row.partners : 0;
                }),
                totals: labelsList.map(city => totals[city] || 0)
            });

            if (filter === 't1t2') {
                const t1Rows = cityTierScaleData.filter(r => t1Cities.includes(r.city));
                const t2Rows = cityTierScaleData.filter(r => t2Cities.includes(r.city));

                const t1Totals = {};
                t1Rows.forEach(row => { t1Totals[row.city] = (t1Totals[row.city] || 0) + row.partners; });
                const t2Totals = {};
                t2Rows.forEach(row => { t2Totals[row.city] = (t2Totals[row.city] || 0) + row.partners; });

                const t1Labels = Object.keys(t1Totals).sort((a, b) => (t1Totals[b] || 0) - (t1Totals[a] || 0));
                const t2Labels = Object.keys(t2Totals).sort((a, b) => (t2Totals[b] || 0) - (t2Totals[a] || 0));

                const t1Series = buildSeries(t1Labels, t1Rows, t1Totals);
                const t2Series = buildSeries(t2Labels, t2Rows, t2Totals);

                const makeScaleChart = (canvasId, series, labelsList, totalsMap, storeSetter) => {
                    const ctx = document.getElementById(canvasId).getContext('2d');
                    if (storeSetter.current) {
                        storeSetter.current.destroy();
                    }
                    const totalsArray = labelsList.map(city => totalsMap[city] || 0);
                    const maxTotal = Math.max(...totalsArray, 1);
                    storeSetter.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labelsList,
                            datasets: [
                                { label: 'Big', data: series.big, backgroundColor: '#7c3aed', stack: 'stack1', order: 2 },
                                { label: 'Mid', data: series.mid, backgroundColor: '#0ea5e9', stack: 'stack1', order: 2 },
                                { label: 'Small', data: series.small, backgroundColor: '#f59e0b', stack: 'stack1', order: 2 },
                                {
                                    label: 'Total Partners Trend',
                                    data: totalsArray,
                                    type: 'line',
                                    borderColor: '#1f2937',
                                    backgroundColor: '#1f2937',
                                    borderWidth: 2,
                                    pointRadius: 5,
                                    pointBackgroundColor: '#1f2937',
                                    fill: false,
                                    tension: 0.3,
                                    order: 1,
                                    datalabels: {
                                        display: true,
                                        color: '#1f2937',
                                        font: { size: 11, weight: 'bold' },
                                        anchor: 'end',
                                        align: 'top',
                                        offset: 4,
                                        formatter: (value) => value.toLocaleString()
                                    }
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            aspectRatio: 2.5,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        boxWidth: 12
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        title: function(tooltipItems) {
                                            return tooltipItems[0].label;
                                        },
                                        label: function(context) {
                                            if (context.dataset.label === 'Total Partners Trend') {
                                                return null;
                                            }
                                            const total = totalsMap[context.label] || 0;
                                            const pct = total ? (context.parsed.y / total) * 100 : 0;
                                            return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} (${pct.toFixed(0)}%)`;
                                        },
                                        afterBody: function(tooltipItems) {
                                            const city = tooltipItems[0].label;
                                            const total = totalsMap[city] || 0;
                                            return [`──────────`, `Total: ${total.toLocaleString()}`];
                                        }
                                    },
                                    filter: function(tooltipItem) {
                                        return tooltipItem.dataset.label !== 'Total Partners Trend';
                                    }
                                },
                                datalabels: {
                                    display: function(context) {
                                        if (context.dataset.type === 'line') return false;
                                        return context.dataset.data[context.dataIndex] > 0;
                                    },
                                    color: '#ffffff',
                                    font: { size: 9, weight: 'bold' },
                                    anchor: 'center',
                                    align: 'center',
                                    formatter: (value, context) => {
                                        if (context.dataset.type === 'line' || !value) return '';
                                        const total = totalsMap[context.chart.data.labels[context.dataIndex]] || 0;
                                        const pct = total ? (value / total) * 100 : 0;
                                        return `${value}\n(${pct.toFixed(0)}%)`;
                                    }
                                }
                            },
                            scales: {
                                x: { stacked: true, ticks: { maxRotation: 45, minRotation: 45 } },
                                y: {
                                    stacked: true,
                                    beginAtZero: true,
                                    max: Math.ceil(maxTotal * 1.15),
                                    ticks: { callback: v => v.toLocaleString() }
                                }
                            }
                        }
                    });
                };

                makeScaleChart('cityTierScaleChartT1', t1Series, t1Labels, t1Totals, {
                    get current() { return cityTierScaleChartT1; },
                    set current(v) { cityTierScaleChartT1 = v; }
                });
                makeScaleChart('cityTierScaleChartT2', t2Series, t2Labels, t2Totals, {
                    get current() { return cityTierScaleChartT2; },
                    set current(v) { cityTierScaleChartT2 = v; }
                });
            } else {
                labels = Object.keys(cityTotals).sort((a, b) => (cityTotals[b] || 0) - (cityTotals[a] || 0));
                const series = buildSeries(labels, filteredRows, cityTotals);
                bigCounts = series.big;
                midCounts = series.mid;
                smallCounts = series.small;
            }

            if (filter !== 't1t2') {
                if (cityTierScaleChart) {
                    cityTierScaleChart.destroy();
                }

                const totalsArray = labels.map(city => cityTotals[city] || 0);
                const maxTotal = Math.max(...totalsArray, 1);

                const ctx = document.getElementById('cityTierScaleChart').getContext('2d');
                cityTierScaleChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Big', data: bigCounts, backgroundColor: '#7c3aed', stack: 'stack1', order: 2 },
                            { label: 'Mid', data: midCounts, backgroundColor: '#0ea5e9', stack: 'stack1', order: 2 },
                            { label: 'Small', data: smallCounts, backgroundColor: '#f59e0b', stack: 'stack1', order: 2 },
                            {
                                label: 'Total Partners Trend',
                                data: totalsArray,
                                type: 'line',
                                borderColor: '#1f2937',
                                backgroundColor: '#1f2937',
                                borderWidth: 2,
                                pointRadius: 5,
                                pointBackgroundColor: '#1f2937',
                                fill: false,
                                tension: 0.3,
                                order: 1,
                                datalabels: {
                                    display: true,
                                    color: '#1f2937',
                                    font: { size: 11, weight: 'bold' },
                                    anchor: 'end',
                                    align: 'top',
                                    offset: 4,
                                    formatter: (value) => value.toLocaleString()
                                }
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2.5,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    boxWidth: 12
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    title: function(tooltipItems) {
                                        return tooltipItems[0].label;
                                    },
                                    label: function(context) {
                                        if (context.dataset.label === 'Total Partners Trend') {
                                            return null;
                                        }
                                        const total = cityTotals[context.label] || 0;
                                        const pct = total ? (context.parsed.y / total) * 100 : 0;
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} (${pct.toFixed(0)}%)`;
                                    },
                                    afterBody: function(tooltipItems) {
                                        const city = tooltipItems[0].label;
                                        const total = cityTotals[city] || 0;
                                        return [`──────────`, `Total: ${total.toLocaleString()}`];
                                    }
                                },
                                filter: function(tooltipItem) {
                                    return tooltipItem.dataset.label !== 'Total Partners Trend';
                                }
                            },
                            datalabels: {
                                display: function(context) {
                                    if (context.dataset.type === 'line') return false;
                                    return context.dataset.data[context.dataIndex] > 0;
                                },
                                color: '#ffffff',
                                font: { size: 9, weight: 'bold' },
                                anchor: 'center',
                                align: 'center',
                                formatter: (value, context) => {
                                    if (context.dataset.type === 'line' || !value) return '';
                                    const label = context.chart.data.labels[context.dataIndex];
                                    const total = cityTotals[label] || 0;
                                    const pct = total ? (value / total) * 100 : 0;
                                    return `${value}\n(${pct.toFixed(0)}%)`;
                                }
                            }
                        },
                        scales: {
                            x: { stacked: true, ticks: { maxRotation: 45, minRotation: 45 } },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                max: Math.ceil(maxTotal * 1.15),
                                ticks: { callback: v => v.toLocaleString() }
                            }
                        }
                    }
                });
            }

            // Render Scale Table
            const tableBody = document.getElementById('cityTierScaleTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                
                // Calculate city share % for Big and Small scale rows
                const bigRows = filteredRows
                    .filter(r => r.scale === 'big' && r.partners > 0)
                    .map(r => ({
                        city: r.city,
                        pct: cityTotals[r.city] ? (r.partners / cityTotals[r.city]) * 100 : 0
                    }))
                    .sort((a, b) => b.pct - a.pct);
                
                const smallRows = filteredRows
                    .filter(r => r.scale === 'small' && r.partners > 0)
                    .map(r => ({
                        city: r.city,
                        pct: cityTotals[r.city] ? (r.partners / cityTotals[r.city]) * 100 : 0
                    }))
                    .sort((a, b) => b.pct - a.pct);
                
                // Get top 3 cities for each
                const top3Big = bigRows.slice(0, 3).map(r => r.city);
                const top3Small = smallRows.slice(0, 3).map(r => r.city);
                
                filteredRows.forEach((row, idx) => {
                    const total = cityTotals[row.city] || 0;
                    const pct = total ? (row.partners / total) * 100 : 0;
                    const changeText = row.changePct === null ? '-' : `${row.changePct.toFixed(1)}%`;
                    const changeColor = row.changePct === null ? '#6b7280' : (row.changePct > 0 ? '#16a34a' : (row.changePct < 0 ? '#dc2626' : '#6b7280'));
                    
                    // Determine highlight colors for full row
                    let rowBg = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    let cellStyle = '';
                    
                    if (row.scale === 'big' && top3Big.includes(row.city)) {
                        rowBg = '#ede9fe'; // Light purple background for Big
                        cellStyle = 'background: #ede9fe;';
                    } else if (row.scale === 'small' && top3Small.includes(row.city)) {
                        rowBg = '#fef3c7'; // Light yellow/amber background for Small
                        cellStyle = 'background: #fef3c7;';
                    }
                    
                    const tr = document.createElement('tr');
                    tr.style.background = rowBg;
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600; ${cellStyle}">${row.city}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-transform: capitalize; ${cellStyle}">${row.scale}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; ${cellStyle}">${row.partners.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; ${cellStyle}">${row.dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; ${cellStyle}">${row.jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; ${cellStyle}">${row.change.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; color: ${changeColor}; ${cellStyle}">${changeText}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; ${cellStyle}">${pct.toFixed(1)}%</td>
                    `;
                    tableBody.appendChild(tr);
                });
            }
        }

        function cityTierGetCityData(cityName, metricKey) {
            const row = cityTierCityData.find(item => item.city === cityName);
            if (!row) return null;
            return {
                labels: [cityTierMetricLabels[metricKey]],
                decData: [row.dec[metricKey]],
                janData: [row.jan[metricKey]]
            };
        }

        function cityTierGetBreakdownData(tier, cityName) {
            if (cityTierBreakdown === 'city') {
                if (cityName && cityName !== 'all') {
                    return cityTierGetCityData(cityName, cityTierBreakdownMetric);
                }
                const filteredCities = cityTierCityData
                    .filter(row => cityTierMap[row.city] === tier)
                    .sort((a, b) => b.jan[cityTierBreakdownMetric] - a.jan[cityTierBreakdownMetric]);
                return {
                    labels: filteredCities.map(row => row.city),
                    decData: filteredCities.map(row => row.dec[cityTierBreakdownMetric]),
                    janData: filteredCities.map(row => row.jan[cityTierBreakdownMetric])
                };
            }

            if (cityName && cityName !== 'all') {
                return cityTierGetCityData(cityName, cityTierBreakdownMetric);
            }

            if (cityTierBreakdown === 'overview') {
                const metric = cityTierBreakdownMetric;
                const label = cityTierMetricLabels[metric];
                return {
                    labels: [label],
                    decData: [cityTierOverview[tier].dec[metric]],
                    janData: [cityTierOverview[tier].jan[metric]]
                };
            }

            if (cityTierBreakdown === 'performance') {
                const metric = cityTierBreakdownMetric;
                if (metric === 'avg') {
                    const pData = cityTierPerformance[tier].partners;
                    const tData = cityTierPerformance[tier].target;
                    return {
                        labels: ['Good', 'Average', 'Bad'],
                        decData: [pData.dec.good ? +(tData.dec.good / pData.dec.good).toFixed(1) : 0, pData.dec.average ? +(tData.dec.average / pData.dec.average).toFixed(1) : 0, pData.dec.bad ? +(tData.dec.bad / pData.dec.bad).toFixed(1) : 0],
                        janData: [pData.jan.good ? +(tData.jan.good / pData.jan.good).toFixed(1) : 0, pData.jan.average ? +(tData.jan.average / pData.jan.average).toFixed(1) : 0, pData.jan.bad ? +(tData.jan.bad / pData.jan.bad).toFixed(1) : 0]
                    };
                }
                const data = cityTierPerformance[tier][metric];
                return {
                    labels: ['Good', 'Average', 'Bad'],
                    decData: [data.dec.good, data.dec.average, data.dec.bad],
                    janData: [data.jan.good, data.jan.average, data.jan.bad]
                };
            }

            if (cityTierBreakdown === 'scale') {
                const metric = cityTierBreakdownMetric;
                if (metric === 'avg') {
                    const pData = cityTierScale[tier].partners;
                    const tData = cityTierScale[tier].target;
                    return {
                        labels: ['Big', 'Mid', 'Small'],
                        decData: [pData.dec.big ? +(tData.dec.big / pData.dec.big).toFixed(1) : 0, pData.dec.mid ? +(tData.dec.mid / pData.dec.mid).toFixed(1) : 0, pData.dec.small ? +(tData.dec.small / pData.dec.small).toFixed(1) : 0],
                        janData: [pData.jan.big ? +(tData.jan.big / pData.jan.big).toFixed(1) : 0, pData.jan.mid ? +(tData.jan.mid / pData.jan.mid).toFixed(1) : 0, pData.jan.small ? +(tData.jan.small / pData.jan.small).toFixed(1) : 0]
                    };
                }
                const data = cityTierScale[tier][metric];
                return {
                    labels: ['Big', 'Mid', 'Small'],
                    decData: [data.dec.big, data.dec.mid, data.dec.small],
                    janData: [data.jan.big, data.jan.mid, data.jan.small]
                };
            }

            return null;
        }

        function cityTierRenderBreakdownChart(canvasId, chartRef, data) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            if (chartRef.current) { try { chartRef.current.destroy(); } catch (e) {} }

            const momPlugin = cityTierMomLabelPlugin(data.decData, data.janData, 9);
            chartRef.current = new Chart(canvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [
                        { label: 'Jan', data: data.decData, backgroundColor: '#93c5fd' },
                        { label: 'Feb', data: data.janData, backgroundColor: '#6ee7b7' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const valueText = `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    if (context.datasetIndex === 1) {
                                        const mom = cityTierFormatMoM(data.decData[context.dataIndex], data.janData[context.dataIndex]);
                                        const sign = parseFloat(mom) > 0 ? '+' : '';
                                        return `${valueText} (MoM ${sign}${mom}%)`;
                                    }
                                    return valueText;
                                }
                            }
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } },
                        x: { ticks: { font: { size: 10 } } }
                    }
                },
                plugins: [momPlugin]
            });
        }

        function cityTierRenderBreakdown() {

            const singleSelect = document.getElementById('cityTierCitySelectSingle');
            const t1Select = document.getElementById('cityTierCitySelectT1');
            const t2Select = document.getElementById('cityTierCitySelectT2');

            if (cityTierTier === 'both') {
                if (singleSelect) singleSelect.style.display = 'none';
                if (t1Select) t1Select.style.display = 'inline-block';
                if (t2Select) t2Select.style.display = 'inline-block';
            } else {
                if (singleSelect) singleSelect.style.display = 'inline-block';
                if (t1Select) t1Select.style.display = 'none';
                if (t2Select) t2Select.style.display = 'none';
            }

            const activeCity = cityTierTier === 'both' ? 'all' : cityTierSelectedCity[cityTierTier];
            if (activeCity !== 'all' && (cityTierBreakdown === 'performance' || cityTierBreakdown === 'scale')) {
                cityTierBreakdown = 'overview';
                const btns = document.querySelectorAll('.city-tier-breakdown-btn');
                const overviewBtn = document.querySelector('.city-tier-breakdown-btn[data-breakdown="overview"]');
                if (overviewBtn) cityTierSetActive(btns, overviewBtn, '#0ea5e9');
            }

            const singleWrap = document.getElementById('cityTierBreakdownSingle');
            const dualWrap = document.getElementById('cityTierBreakdownDual');
            const singleTableWrap = document.getElementById('cityTierBreakdownSingleTable');
            const dualTableWrap = document.getElementById('cityTierBreakdownDualTable');

            if (cityTierTier === 'both') {
                const cityT1 = cityTierSelectedCity.t1;
                const cityT2 = cityTierSelectedCity.t2;
                const dataT1 = cityTierGetBreakdownData('t1', cityT1);
                const dataT2 = cityTierGetBreakdownData('t2', cityT2);
                if (!dataT1 || !dataT2) return;

                if (singleWrap) singleWrap.style.display = 'none';
                if (dualWrap) dualWrap.style.display = 'block';
                if (singleTableWrap) singleTableWrap.style.display = 'none';
                if (dualTableWrap) dualTableWrap.style.display = 'block';

                const breakdownLabel = cityTierBreakdown.charAt(0).toUpperCase() + cityTierBreakdown.slice(1);
                const metricLabel = cityTierMetricLabels[cityTierBreakdownMetric];
                const titleT1 = document.getElementById('cityTierBreakdownTitleT1');
                const titleT2 = document.getElementById('cityTierBreakdownTitleT2');
                const cityLabelT1 = cityT1 !== 'all' ? ` • ${cityT1}` : '';
                const cityLabelT2 = cityT2 !== 'all' ? ` • ${cityT2}` : '';
                if (titleT1) titleT1.textContent = `T1${cityLabelT1} • ${breakdownLabel} • ${metricLabel} (Jan vs Feb)`;
                if (titleT2) titleT2.textContent = `T2${cityLabelT2} • ${breakdownLabel} • ${metricLabel} (Jan vs Feb)`;

                cityTierRenderBreakdownChart('cityTierBreakdownChartT1', {
                    get current() { return cityTierBreakdownChartT1; },
                    set current(v) { cityTierBreakdownChartT1 = v; }
                }, dataT1);
                cityTierRenderBreakdownChart('cityTierBreakdownChartT2', {
                    get current() { return cityTierBreakdownChartT2; },
                    set current(v) { cityTierBreakdownChartT2 = v; }
                }, dataT2);

                const tableBodyT1 = document.getElementById('cityTierBreakdownTableBodyT1');
                const tableBodyT2 = document.getElementById('cityTierBreakdownTableBodyT2');
                if (tableBodyT1 && tableBodyT2) {
                    tableBodyT1.innerHTML = '';
                    dataT1.labels.forEach((label, idx) => {
                        const dec = dataT1.decData[idx];
                        const jan = dataT1.janData[idx];
                        const mom = cityTierFormatMoM(dec, jan);
                        const tr = document.createElement('tr');
                        tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                        tr.innerHTML = `
                            <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${label}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;"><span style="color: ${cityTierMoMColor(mom)};">${mom}%</span></td>
                        `;
                        tableBodyT1.appendChild(tr);
                    });

                    tableBodyT2.innerHTML = '';
                    dataT2.labels.forEach((label, idx) => {
                        const dec = dataT2.decData[idx];
                        const jan = dataT2.janData[idx];
                        const mom = cityTierFormatMoM(dec, jan);
                        const tr = document.createElement('tr');
                        tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                        tr.innerHTML = `
                            <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${label}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                            <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;"><span style="color: ${cityTierMoMColor(mom)};">${mom}%</span></td>
                        `;
                        tableBodyT2.appendChild(tr);
                    });
                }
                return;
            }

            const data = cityTierGetBreakdownData(cityTierTier, cityTierSelectedCity[cityTierTier]);
            if (!data) return;

            if (singleWrap) singleWrap.style.display = 'block';
            if (dualWrap) dualWrap.style.display = 'none';
            if (singleTableWrap) singleTableWrap.style.display = 'block';
            if (dualTableWrap) dualTableWrap.style.display = 'none';

            const title = document.getElementById('cityTierBreakdownTitle');
            if (title) {
                const tierLabel = cityTierTier.toUpperCase();
                const breakdownLabel = cityTierBreakdown.charAt(0).toUpperCase() + cityTierBreakdown.slice(1);
                const metricLabel = cityTierMetricLabels[cityTierBreakdownMetric];
                const cityLabel = cityTierSelectedCity[cityTierTier] !== 'all' ? ` • ${cityTierSelectedCity[cityTierTier]}` : '';
                title.textContent = `${tierLabel}${cityLabel} • ${breakdownLabel} • ${metricLabel} (Jan vs Feb)`;
            }

            const tableBody = document.getElementById('cityTierBreakdownTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                data.labels.forEach((label, idx) => {
                    const dec = data.decData[idx];
                    const jan = data.janData[idx];
                    const mom = cityTierFormatMoM(dec, jan);
                    const tr = document.createElement('tr');
                    tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${label}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;"><span style="color: ${cityTierMoMColor(mom)};">${mom}%</span></td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            cityTierRenderBreakdownChart('cityTierBreakdownChart', {
                get current() { return cityTierBreakdownChart; },
                set current(v) { cityTierBreakdownChart = v; }
            }, data);
        }

        document.querySelectorAll('.city-tier-view-toggle').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierView = this.getAttribute('data-view');
                cityTierSetActive(document.querySelectorAll('.city-tier-view-toggle'), this, '#0ea5e9');
                document.getElementById('cityTierCityView').style.display = cityTierView === 'city' ? 'block' : 'none';
                document.getElementById('cityTierBreakdownView').style.display = cityTierView === 'tier' ? 'block' : 'none';
                document.getElementById('cityTierPerformanceView').style.display = cityTierView === 'performance' ? 'block' : 'none';
                document.getElementById('cityTierScaleView').style.display = cityTierView === 'scale' ? 'block' : 'none';
                if (cityTierView === 'performance') {
                    cityTierRenderPerformanceDistribution();
                }
                if (cityTierView === 'scale') {
                    cityTierRenderScaleDistribution();
                }
                cityTierUpdateSummaryCards();
            });
        });

        document.querySelectorAll('.city-tier-performance-filter').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierPerformanceFilter = this.getAttribute('data-filter');
                cityTierSetActive(document.querySelectorAll('.city-tier-performance-filter'), this, '#22c55e');
                cityTierRenderPerformanceDistribution();
                cityTierUpdateSummaryCards();
            });
        });

        document.querySelectorAll('.city-tier-scale-filter').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierScaleFilter = this.getAttribute('data-filter');
                cityTierSetActive(document.querySelectorAll('.city-tier-scale-filter'), this, '#8b5cf6');
                cityTierRenderScaleDistribution();
                cityTierUpdateSummaryCards();
            });
        });

        document.querySelectorAll('.city-tier-metric-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierMetric = this.getAttribute('data-metric');
                cityTierSetActive(document.querySelectorAll('.city-tier-metric-btn'), this, '#0ea5e9');
                cityTierRenderCitySummary();
                cityTierUpdateSummaryCards();
            });
        });

        document.querySelectorAll('.city-tier-tier-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierTier = this.getAttribute('data-tier');
                cityTierSetActive(document.querySelectorAll('.city-tier-tier-btn'), this, '#0ea5e9');
                cityTierRefreshSingleSelectOptions();
                cityTierRenderBreakdown();
                cityTierUpdateSummaryCards();
            });
        });

        document.querySelectorAll('.city-tier-breakdown-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierBreakdown = this.getAttribute('data-breakdown');
                cityTierSetActive(document.querySelectorAll('.city-tier-breakdown-btn'), this, '#0ea5e9');
                cityTierRenderBreakdown();
                cityTierUpdateSummaryCards();
            });
        });

        document.querySelectorAll('.city-tier-breakdown-metric-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                cityTierBreakdownMetric = this.getAttribute('data-metric');
                cityTierSetActive(document.querySelectorAll('.city-tier-breakdown-metric-btn'), this, '#0ea5e9');
                cityTierRenderBreakdown();
                cityTierUpdateSummaryCards();
            });
        });

        function cityTierPopulateCitySelects() {
            const selectSingle = document.getElementById('cityTierCitySelectSingle');
            const selectT1 = document.getElementById('cityTierCitySelectT1');
            const selectT2 = document.getElementById('cityTierCitySelectT2');
            if (!selectSingle || !selectT1 || !selectT2) return;

            const t1Cities = cityTierCityData.filter(row => cityTierMap[row.city] === 't1').map(row => row.city);
            const t2Cities = cityTierCityData.filter(row => cityTierMap[row.city] === 't2').map(row => row.city);

            selectSingle.innerHTML = '<option value="all">All (Tier summary)</option>';
            selectT1.innerHTML = '<option value="all">T1 (Tier summary)</option>';
            selectT2.innerHTML = '<option value="all">T2 (Tier summary)</option>';

            const addOptions = (select, cities) => {
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    select.appendChild(option);
                });
            };

            addOptions(selectSingle, t1Cities.concat(t2Cities));
            addOptions(selectT1, t1Cities);
            addOptions(selectT2, t2Cities);
        }

        function cityTierRefreshSingleSelectOptions() {
            const selectSingle = document.getElementById('cityTierCitySelectSingle');
            if (!selectSingle) return;

            const t1Cities = cityTierCityData.filter(row => cityTierMap[row.city] === 't1').map(row => row.city);
            const t2Cities = cityTierCityData.filter(row => cityTierMap[row.city] === 't2').map(row => row.city);
            const allowed = cityTierTier === 't2' ? t2Cities : t1Cities;

            selectSingle.innerHTML = '<option value="all">All (Tier summary)</option>';
            allowed.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                selectSingle.appendChild(option);
            });

            if (cityTierSelectedCity[cityTierTier] && cityTierSelectedCity[cityTierTier] !== 'all') {
                if (!allowed.includes(cityTierSelectedCity[cityTierTier])) {
                    cityTierSelectedCity[cityTierTier] = 'all';
                }
            }
            selectSingle.value = cityTierSelectedCity[cityTierTier] || 'all';
        }

        const selectSingle = document.getElementById('cityTierCitySelectSingle');
        const selectT1 = document.getElementById('cityTierCitySelectT1');
        const selectT2 = document.getElementById('cityTierCitySelectT2');
        const clearCityBtn = document.getElementById('cityTierClearCityFilter');

        if (selectSingle) {
            selectSingle.addEventListener('change', function() {
                const value = this.value;
                const tier = cityTierTier === 't2' ? 't2' : 't1';
                cityTierSelectedCity[tier] = value;
                if (value !== 'all' && (cityTierBreakdown === 'performance' || cityTierBreakdown === 'scale')) {
                    cityTierBreakdown = 'overview';
                    const btns = document.querySelectorAll('.city-tier-breakdown-btn');
                    const overviewBtn = document.querySelector('.city-tier-breakdown-btn[data-breakdown="overview"]');
                    if (overviewBtn) cityTierSetActive(btns, overviewBtn, '#0ea5e9');
                }
                cityTierRenderBreakdown();
            });
        }

        if (selectT1) {
            selectT1.addEventListener('change', function() {
                cityTierSelectedCity.t1 = this.value;
                if (this.value !== 'all' && (cityTierBreakdown === 'performance' || cityTierBreakdown === 'scale')) {
                    cityTierBreakdown = 'overview';
                    const btns = document.querySelectorAll('.city-tier-breakdown-btn');
                    const overviewBtn = document.querySelector('.city-tier-breakdown-btn[data-breakdown="overview"]');
                    if (overviewBtn) cityTierSetActive(btns, overviewBtn, '#0ea5e9');
                }
                cityTierRenderBreakdown();
            });
        }

        if (selectT2) {
            selectT2.addEventListener('change', function() {
                cityTierSelectedCity.t2 = this.value;
                if (this.value !== 'all' && (cityTierBreakdown === 'performance' || cityTierBreakdown === 'scale')) {
                    cityTierBreakdown = 'overview';
                    const btns = document.querySelectorAll('.city-tier-breakdown-btn');
                    const overviewBtn = document.querySelector('.city-tier-breakdown-btn[data-breakdown="overview"]');
                    if (overviewBtn) cityTierSetActive(btns, overviewBtn, '#0ea5e9');
                }
                cityTierRenderBreakdown();
            });
        }

        if (clearCityBtn) {
            clearCityBtn.addEventListener('click', function() {
                cityTierSelectedCity.t1 = 'all';
                cityTierSelectedCity.t2 = 'all';
                if (selectSingle) selectSingle.value = 'all';
                if (selectT1) selectT1.value = 'all';
                if (selectT2) selectT2.value = 'all';
                cityTierRenderBreakdown();
            });
        }

        cityTierPopulateCitySelects();
        cityTierRefreshSingleSelectOptions();
        cityTierRenderCitySummary();
        cityTierRenderBreakdown();
        cityTierUpdateSummaryCards(true); // Force animation on initial load
    });

    // Target Movement Analysis Section
    document.addEventListener('DOMContentLoaded', function() {
        const targetMovementTotals = {
            labels: ['Jan', 'Feb'],
            partners: [625, 551],
            increase: [212, 153],
            decrease: [240, 284],
            noChange: [173, 114]
        };

        const targetMovementBreakdownData = {
            increased: { dec: [109, 79, 15], jan: [82, 47, 7] },
            decreased: { dec: [78, 123, 39], jan: [109, 163, 12] },
            nochange: { dec: [82, 72, 19], jan: [61, 52, 1] }
        };

        const targetMovementBreakdownLabels = ['Good', 'Average', 'Bad'];

        const ridersSlabData = {
            increased: {
                labels: ['>=1 - <20', '>=20 - <30', '>=30 - <50', '>=50 - <80', '>=80 - <100', '>=100 - <150', '>=150 - <200', '>=200 - <300', '>=300'],
                dec: [200, 8, 3, 1, 0, 0, 0, 0, 0],
                jan: [139, 12, 1, 1, 0, 0, 0, 0, 0]
            },
            decreased: {
                labels: ['<0 & >-20', '<=-20 & >-30', '<=-30 & >-50', '<=-50 & >-80', '<=-80 & >-100', '<=-100 & >-150', '<=-150 & >-200', '<=-200 & >-300', '<=-300'],
                dec: [221, 11, 6, 0, 1, 1, 0, 0, 0],
                jan: [255, 19, 6, 3, 1, 0, 0, 0, 0]
            },
            total: {
                labels: ['>0 - <20', '>=20 - <30', '>=30 - <50', '>=50 - <80', '>=80 - <100', '>=100 - <150', '>=150 - <200', '>=200 - <300', '>=300'],
                dec: [181, 156, 172, 63, 23, 19, 7, 4, 0],
                jan: [141, 160, 156, 49, 25, 13, 6, 1, 0]
            }
        };

        let targetMovementBreakdownView = 'increased';
        let ridersSlabView = 'total';

        let targetMovementSummaryChart = null;
        let targetMovementBreakdownChart = null;
        let ridersSlabChart = null;

        const formatMoM = (dec, jan) => {
            if (!dec) return '0.0';
            return (((jan - dec) / dec) * 100).toFixed(1);
        };

        const momColor = (mom) => {
            const val = parseFloat(mom);
            if (val > 0) return '#16a34a';
            if (val < 0) return '#dc2626';
            return '#f59e0b';
        };

        function createLineMomLabelPlugin(decData, janData, fontSize) {
            return {
                id: 'lineMomLabels',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    const showDec = chart.isDatasetVisible(0);
                    const showJan = chart.isDatasetVisible(1);
                    ctx.save();
                    ctx.font = `bold ${fontSize}px sans-serif`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    const metaDec = chart.getDatasetMeta(0);
                    const metaJan = chart.getDatasetMeta(1);
                    if (showDec && metaDec && metaDec.data) {
                        metaDec.data.forEach((point, idx) => {
                            const decVal = decData[idx];
                            if (decVal === null || decVal === undefined) return;
                            ctx.fillStyle = '#111827';
                            ctx.fillText(Number(decVal).toLocaleString(), point.x, point.y - 6);
                        });
                    }

                    if (showJan && metaJan && metaJan.data) {
                        metaJan.data.forEach((point, idx) => {
                            const janVal = janData[idx];
                            if (janVal === null || janVal === undefined) return;
                            const decVal = decData[idx];
                            const mom = formatMoM(decVal, janVal);
                            const sign = parseFloat(mom) > 0 ? '+' : '';
                            const valText = Number(janVal).toLocaleString();
                            const momText = ` (${sign}${mom}%)`;
                            const valWidth = ctx.measureText(valText).width;
                            const momWidth = ctx.measureText(momText).width;
                            const x = point.x;
                            const y = point.y - 6;
                            ctx.fillStyle = '#111827';
                            ctx.fillText(valText, x - (momWidth / 2), y);
                            ctx.fillStyle = momColor(mom);
                            ctx.fillText(momText, x + (valWidth / 2), y);
                        });
                    }
                    ctx.restore();
                }
            };
        }

        function createSummaryMomPlugin() {
            return {
                id: 'summaryMomLabels',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    ctx.save();
                    ctx.font = 'bold 10px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    chart.data.datasets.forEach((dataset, datasetIndex) => {
                        if (!chart.isDatasetVisible(datasetIndex)) return;
                        const meta = chart.getDatasetMeta(datasetIndex);
                        const pointDec = meta && meta.data ? meta.data[0] : null;
                        const pointJan = meta && meta.data ? meta.data[1] : null;
                        if (!pointDec || !pointJan) return;

                        const decVal = dataset.data[0];
                        const janVal = dataset.data[1];

                        // Dec label (value only)
                        ctx.fillStyle = '#111827';
                        ctx.fillText(Number(decVal).toLocaleString(), pointDec.x, pointDec.y - 8);

                        // Jan label (value + MoM%)
                        const mom = formatMoM(decVal, janVal);
                        const sign = parseFloat(mom) > 0 ? '+' : '';
                        const valText = Number(janVal).toLocaleString();
                        const momText = ` (${sign}${mom}%)`;
                        const valWidth = ctx.measureText(valText).width;
                        const momWidth = ctx.measureText(momText).width;
                        const x = pointJan.x;
                        const y = pointJan.y - 8;
                        ctx.fillStyle = '#111827';
                        ctx.fillText(valText, x - (momWidth / 2), y);
                        ctx.fillStyle = momColor(mom);
                        ctx.fillText(momText, x + (valWidth / 2), y);
                    });
                    ctx.restore();
                }
            };
        }

        function renderTargetMovementSummary() {
            const canvas = document.getElementById('targetMovementSummaryChart');
            if (!canvas) return;
            if (targetMovementSummaryChart) { try { targetMovementSummaryChart.destroy(); } catch (e) {} }

            const labels = ['Jan', 'Feb'];
            const partnersSeries = [targetMovementTotals.partners[0], targetMovementTotals.partners[1]];
            const increaseSeries = [targetMovementTotals.increase[0], targetMovementTotals.increase[1]];
            const decreaseSeries = [targetMovementTotals.decrease[0], targetMovementTotals.decrease[1]];
            const noChangeSeries = [targetMovementTotals.noChange[0], targetMovementTotals.noChange[1]];

            targetMovementSummaryChart = new Chart(canvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        { label: 'Total partners with target', data: partnersSeries, borderColor: '#2563eb', backgroundColor: 'rgba(37, 99, 235, 0.5)', borderWidth: 2 },
                        { label: 'Total Increase', data: increaseSeries, borderColor: '#16a34a', backgroundColor: 'rgba(22, 163, 74, 0.5)', borderWidth: 2 },
                        { label: 'Total Decrease', data: decreaseSeries, borderColor: '#dc2626', backgroundColor: 'rgba(220, 38, 38, 0.5)', borderWidth: 2 },
                        { label: 'No Change', data: noChangeSeries, borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.5)', borderWidth: 2 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const valueText = `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    if (context.dataIndex === 1) {
                                        const mom = formatMoM(context.dataset.data[0], context.dataset.data[1]);
                                        const sign = parseFloat(mom) > 0 ? '+' : '';
                                        return `${valueText} (MoM ${sign}${mom}%)`;
                                    }
                                    return valueText;
                                }
                            }
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } }
                    }
                },
                plugins: [createSummaryMomPlugin()]
            });

            const insight = document.querySelector('#targetMovementInsight p');
            if (insight) {
                const totalMom = formatMoM(targetMovementTotals.partners[0], targetMovementTotals.partners[1]);
                const incMom = formatMoM(targetMovementTotals.increase[0], targetMovementTotals.increase[1]);
                const decMom = formatMoM(targetMovementTotals.decrease[0], targetMovementTotals.decrease[1]);
                insight.innerHTML = `Partners with target <strong style="color: ${momColor(totalMom)};">${totalMom}%</strong> MoM | Increases <strong style="color: ${momColor(incMom)};">${incMom}%</strong> | Decreases <strong style="color: ${momColor(decMom)};">${decMom}%</strong> (lower is better)`;
            }
        }

        function renderTargetMovementBreakdown() {
            const data = targetMovementBreakdownData[targetMovementBreakdownView];
            const canvas = document.getElementById('targetMovementBreakdownChart');
            if (!canvas || !data) return;
            if (targetMovementBreakdownChart) { try { targetMovementBreakdownChart.destroy(); } catch (e) {} }

            const title = document.getElementById('targetMovementBreakdownTitle');
            if (title) {
                const label = targetMovementBreakdownView === 'increased' ? 'Total Increased' : (targetMovementBreakdownView === 'decreased' ? 'Total Decreased' : 'No Change');
                title.textContent = `${label} • Segment Breakdown (Jan vs Feb)`;
            }

            const momPlugin = createLineMomLabelPlugin(data.dec, data.jan, 9);
            targetMovementBreakdownChart = new Chart(canvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels: targetMovementBreakdownLabels,
                    datasets: [
                        { label: 'Jan', data: data.dec, borderColor: '#93c5fd', backgroundColor: 'rgba(147, 197, 253, 0.2)', tension: 0.5, pointRadius: 5, fill: true },
                        { label: 'Feb', data: data.jan, borderColor: '#6ee7b7', backgroundColor: 'rgba(110, 231, 183, 0.2)', tension: 0.5, pointRadius: 5, fill: true }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const valueText = `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    if (context.datasetIndex === 1) {
                                        const mom = formatMoM(data.dec[context.dataIndex], data.jan[context.dataIndex]);
                                        const sign = parseFloat(mom) > 0 ? '+' : '';
                                        return `${valueText} (MoM ${sign}${mom}%)`;
                                    }
                                    return valueText;
                                }
                            }
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } }
                    }
                },
                plugins: [momPlugin]
            });

            const tableBody = document.getElementById('targetMovementBreakdownTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                targetMovementBreakdownLabels.forEach((label, idx) => {
                    const dec = data.dec[idx];
                    const jan = data.jan[idx];
                    const mom = formatMoM(dec, jan);
                    const tr = document.createElement('tr');
                    tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${label}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;"><span style="color: ${momColor(mom)};">${mom}%</span></td>
                    `;
                    tableBody.appendChild(tr);
                });
            }
        }

        function renderRidersSlab() {
            const data = ridersSlabData[ridersSlabView];
            const canvas = document.getElementById('ridersSlabChart');
            if (!canvas || !data) return;
            if (ridersSlabChart) { try { ridersSlabChart.destroy(); } catch (e) {} }

            const title = document.getElementById('ridersSlabTitle');
            if (title) {
                const label = ridersSlabView === 'total' ? 'Total with Target' : (ridersSlabView === 'increased' ? 'Increased Target' : 'Decreased Target');
                title.textContent = `${label} • Riders Slab Distribution (Jan vs Feb)`;
            }

            const momPlugin = createLineMomLabelPlugin(data.dec, data.jan, 9);
            ridersSlabChart = new Chart(canvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        { label: 'Jan', data: data.dec, borderColor: '#93c5fd', backgroundColor: 'rgba(147, 197, 253, 0.2)', tension: 0.6, cubicInterpolationMode: 'monotone', pointRadius: 4, fill: true },
                        { label: 'Feb', data: data.jan, borderColor: '#6ee7b7', backgroundColor: 'rgba(110, 231, 183, 0.2)', tension: 0.6, cubicInterpolationMode: 'monotone', pointRadius: 4, fill: true }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const valueText = `${context.dataset.label}: ${context.parsed.y.toLocaleString()}`;
                                    if (context.datasetIndex === 1) {
                                        const mom = formatMoM(data.dec[context.dataIndex], data.jan[context.dataIndex]);
                                        const sign = parseFloat(mom) > 0 ? '+' : '';
                                        return `${valueText} (MoM ${sign}${mom}%)`;
                                    }
                                    return valueText;
                                }
                            }
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: (v) => v.toLocaleString() } },
                        x: { ticks: { font: { size: 10 } } }
                    }
                },
                plugins: [momPlugin]
            });

            const tableBody = document.getElementById('ridersSlabTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                data.labels.forEach((label, idx) => {
                    const dec = data.dec[idx];
                    const jan = data.jan[idx];
                    const mom = formatMoM(dec, jan);
                    const tr = document.createElement('tr');
                    tr.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    tr.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 600;">${label}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${dec.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">${jan.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700;"><span style="color: ${momColor(mom)};">${mom}%</span></td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

        }

        document.querySelectorAll('.target-move-view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const view = this.getAttribute('data-view');
                document.querySelectorAll('.target-move-view-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = '#7c3aed';
                this.style.color = 'white';
                this.style.borderColor = '#7c3aed';

                // Both sections stay visible side by side
                if (view === 'overall') {
                    renderTargetMovementSummary();
                } else {
                    renderTargetMovementBreakdown();
                }
            });
        });

        // Auto expand/collapse breakdown filter on hover
        const breakdownBtn = document.getElementById('breakdownViewBtn');
        const breakdownFilter = document.getElementById('breakdownFilterContainer');
        const breakdownArrow = document.getElementById('breakdownArrow');
        
        if (breakdownBtn && breakdownFilter && breakdownArrow) {
            breakdownBtn.addEventListener('mouseenter', function() {
                breakdownFilter.style.display = 'flex';
                breakdownArrow.style.transform = 'rotate(-90deg)';
            });
            
            // Keep filter visible when hovering over filter itself
            breakdownFilter.addEventListener('mouseenter', function() {
                breakdownFilter.style.display = 'flex';
                breakdownArrow.style.transform = 'rotate(-90deg)';
            });
            
            breakdownFilter.addEventListener('mouseleave', function() {
                breakdownFilter.style.display = 'none';
                breakdownArrow.style.transform = 'rotate(0deg)';
            });
            
            breakdownBtn.addEventListener('mouseleave', function(e) {
                // Check if mouse moved to the filter container
                setTimeout(() => {
                    if (!breakdownFilter.matches(':hover') && !breakdownBtn.matches(':hover')) {
                        breakdownFilter.style.display = 'none';
                        breakdownArrow.style.transform = 'rotate(0deg)';
                    }
                }, 100);
            });
        }

        document.querySelectorAll('.target-move-breakdown-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                targetMovementBreakdownView = this.getAttribute('data-breakdown');
                document.querySelectorAll('.target-move-breakdown-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = '#7c3aed';
                this.style.color = 'white';
                this.style.borderColor = '#7c3aed';
                renderTargetMovementBreakdown();
            });
        });

        document.querySelectorAll('.riders-slab-view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                ridersSlabView = this.getAttribute('data-view');
                document.querySelectorAll('.riders-slab-view-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = '#0f766e';
                this.style.color = 'white';
                this.style.borderColor = '#0f766e';
                renderRidersSlab();
            });
        });

        renderTargetMovementSummary();
        renderTargetMovementBreakdown();
        renderRidersSlab();
    });

    // Top/Bottom Partners Overview Section
    document.addEventListener('DOMContentLoaded', function() {
        const topDec = [
            { name: 'ON Time Logistics', cities: 5, status: 'Old', riders: 391, target: 342, performance: 'average', fr: '61.2%', dc: '36.4%' },
            { name: 'ONE TRIP', cities: 5, status: 'Old', riders: 340, target: 318, performance: 'good', fr: '85.5%', dc: '36.8%' },
            { name: 'PARTNER SUCCESS', cities: 2, status: 'Old', riders: 246, target: 255, performance: 'good', fr: '84.3%', dc: '100.0%' },
            { name: 'First Line Logistics', cities: 9, status: 'Old', riders: 280, target: 288, performance: 'average', fr: '88.0%', dc: '6.9%' },
            { name: 'SDC Logistics', cities: 2, status: 'Old', riders: 306, target: 265, performance: 'good', fr: '64.0%', dc: '1.9%' },
            { name: 'Anan Capital', cities: 5, status: 'Old', riders: 172, target: 205, performance: 'good', fr: '82.2%', dc: '45.5%' },
            { name: 'AL-BARAQ AL-KHATEF', cities: 1, status: 'Old', riders: 275, target: 280, performance: 'good', fr: '66.0%', dc: '4.3%' },
            { name: 'Quick Way Logistics', cities: 5, status: 'Old', riders: 181, target: 177, performance: 'average', fr: '86.0%', dc: '51.1%' },
            { name: 'Makhsos', cities: 1, status: 'Old', riders: 171, target: 218, performance: 'good', fr: '75.5%', dc: '87.4%' },
            { name: 'Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services', cities: 5, status: 'Old', riders: 228, target: 192, performance: 'good', fr: '89.7%', dc: '28.0%' },
            { name: 'PCC', cities: 2, status: 'Old', riders: 200, target: 168, performance: 'good', fr: '63.5%', dc: '3.5%' },
            { name: 'AMC', cities: 2, status: 'Old', riders: 165, target: 193, performance: 'good', fr: '89.5%', dc: '8.8%' },
            { name: 'AMIYAL', cities: 3, status: 'Old', riders: 175, target: 169, performance: 'good', fr: '85.8%', dc: '35.3%' },
            { name: 'FAHAD AL-SHARQ', cities: 1, status: 'Old', riders: 145, target: 169, performance: 'good', fr: '48.7%', dc: '9.9%' },
            { name: 'SAKA SRIAA LALCHUDMAT AL-LUGASTIA', cities: 4, status: 'Old', riders: 153, target: 175, performance: 'good', fr: '91.9%', dc: '51.9%' },
            { name: 'AL-ANJAZ AL-MATARAA', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Holoul', cities: 1, status: 'Old', riders: 106, target: 125, performance: 'good', fr: '86.7%', dc: '83.3%' },
            { name: 'EXPSERCO', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Establishment ASHRAF BEN HASSIN BEN ALI BOUGRARDAH For logistics', cities: 1, status: 'Old', riders: 160, target: 150, performance: 'good', fr: '83.2%', dc: '4.8%' },
            { name: 'EXPRESS GATE', cities: 2, status: 'Old', riders: 140, target: 158, performance: 'good', fr: '60.2%', dc: '15.1%' }
        ];

        const topJan = [
            { name: 'ON Time Logistics', cities: 5, status: 'Old', riders: 332, target: 325, performance: 'average', fr: '92.8%', dc: '55.4%' },
            { name: 'ONE TRIP', cities: 5, status: 'Old', riders: 311, target: 315, performance: 'good', fr: '97.8%', dc: '38.5%' },
            { name: 'PARTNER SUCCESS', cities: 2, status: 'Old', riders: 241, target: 257, performance: 'good', fr: '94.0%', dc: '100.0%' },
            { name: 'First Line Logistics', cities: 9, status: 'Old', riders: 272, target: 215, performance: 'average', fr: '97.6%', dc: '11.2%' },
            { name: 'SDC Logistics', cities: 2, status: 'Old', riders: 261, target: 210, performance: 'good', fr: '98.6%', dc: '7.8%' },
            { name: 'Anan Capital', cities: 5, status: 'Old', riders: 184, target: 198, performance: 'good', fr: '98.8%', dc: '55.2%' },
            { name: 'AL-BARAQ AL-KHATEF', cities: 1, status: 'Old', riders: 265, target: 195, performance: 'good', fr: '93.7%', dc: '19.3%' },
            { name: 'Quick Way Logistics', cities: 5, status: 'Old', riders: 155, target: 186, performance: 'average', fr: '99.6%', dc: '74.8%' },
            { name: 'Makhsos', cities: 1, status: 'Old', riders: 189, target: 180, performance: 'good', fr: '95.0%', dc: '86.6%' },
            { name: 'Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services', cities: 5, status: 'Old', riders: 182, target: 169, performance: 'good', fr: '99.5%', dc: '40.7%' },
            { name: 'PCC', cities: 2, status: 'Old', riders: 189, target: 168, performance: 'good', fr: '98.1%', dc: '5.5%' },
            { name: 'AMC', cities: 2, status: 'Old', riders: 175, target: 166, performance: 'average', fr: '98.1%', dc: '20.4%' },
            { name: 'AMIYAL', cities: 3, status: 'Old', riders: 157, target: 150, performance: 'good', fr: '96.7%', dc: '43.9%' },
            { name: 'FAHAD AL-SHARQ', cities: 1, status: 'Old', riders: 151, target: 150, performance: 'good', fr: '91.0%', dc: '12.2%' },
            { name: 'SAKA SRIAA LALCHUDMAT AL-LUGASTIA', cities: 4, status: 'Old', riders: 149, target: 149, performance: 'average', fr: '98.4%', dc: '64.9%' },
            { name: 'AL-ANJAZ AL-MATARAA', cities: 3, status: 'Old', riders: 116, target: 141, performance: 'good', fr: '97.9%', dc: '37.0%' },
            { name: 'Holoul', cities: 1, status: 'Old', riders: 122, target: 135, performance: 'good', fr: '100.0%', dc: '85.6%' },
            { name: 'EXPSERCO', cities: 1, status: 'Old', riders: 129, target: 132, performance: 'good', fr: '95.2%', dc: '100.0%' },
            { name: 'Establishment ASHRAF BEN HASSIN BEN ALI BOUGRARDAH For logistics', cities: 1, status: 'Old', riders: 138, target: 130, performance: 'average', fr: '92.1%', dc: '8.4%' },
            { name: 'EXPRESS GATE', cities: 2, status: 'Old', riders: 146, target: 127, performance: 'average', fr: '88.1%', dc: '21.7%' }
        ];

        // Breakdown data for Top 20 partners (city-level details)
        const top20BreakdownDec = {
            'ON Time Logistics': [
                { city: 'Buraydah', status: 'Old', riders: 12, target: 15, performance: 'good', fr: '57.1%', dc: '26.7%' },
                { city: 'Dammam', status: 'Old', riders: 58, target: 55, performance: 'average', fr: '86.9%', dc: '48.7%' },
                { city: 'Jeddah', status: 'Old', riders: 80, target: 47, performance: 'average', fr: '41.0%', dc: '51.4%' },
                { city: 'Riyadh', status: 'Old', riders: 200, target: 180, performance: 'average', fr: '40.8%', dc: '31.0%' }
            ],
            'ONE TRIP': [
                { city: 'Abha', status: 'Old', riders: 44, target: 20, performance: 'good', fr: '82.4%', dc: '57.1%' },
                { city: 'Buraydah', status: 'Old', riders: 40, target: 33, performance: 'good', fr: '88.0%', dc: '88.6%' },
                { city: 'Dammam', status: 'Old', riders: 40, target: 40, performance: 'average', fr: '81.0%', dc: '12.5%' },
                { city: 'Riyadh', status: 'Old', riders: 189, target: 200, performance: 'good', fr: '83.1%', dc: '21.7%' },
                { city: 'Tabuk', status: 'Old', riders: 27, target: 25, performance: 'good', fr: '93.3%', dc: '3.8%' }
            ],
            'PARTNER SUCCESS': [
                { city: 'Jeddah', status: 'Old', riders: 89, target: 90, performance: 'good', fr: '89.2%', dc: '100.0%' },
                { city: 'Riyadh', status: 'Old', riders: 157, target: 165, performance: 'good', fr: '79.4%', dc: '100.0%' }
            ],
            'First Line Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 21, target: 18, performance: 'average', fr: '91.3%', dc: '0.0%' },
                { city: 'Buraydah', status: 'Old', riders: 10, target: 13, performance: 'average', fr: '80.0%', dc: '0.0%' },
                { city: 'Dammam', status: 'Old', riders: 65, target: 60, performance: 'average', fr: '85.3%', dc: '4.5%' },
                { city: 'Jeddah', status: 'Old', riders: 75, target: 92, performance: 'average', fr: '85.0%', dc: '27.9%' },
                { city: 'Makkah', status: 'Old', riders: 37, target: 30, performance: 'average', fr: '91.9%', dc: '0.0%' },
                { city: 'Najran', status: 'Old', riders: 13, target: 15, performance: 'good', fr: '92.3%', dc: '6.3%' },
                { city: 'Riyadh', status: 'Old', riders: 35, target: 40, performance: 'good', fr: '75.6%', dc: '0.0%' },
                { city: 'Yanbu', status: 'Old', riders: 9, target: 10, performance: 'average', fr: '100.0%', dc: '15.4%' }
            ],
            'SDC Logistics': [
                { city: 'Dammam', status: 'Old', riders: 37, target: 30, performance: 'good', fr: '67.4%', dc: '0.0%' },
                { city: 'Riyadh', status: 'Old', riders: 269, target: 235, performance: 'good', fr: '60.5%', dc: '3.7%' }
            ],
            'Anan Capital': [
                { city: 'Al Ahsa', status: 'Old', riders: 29, target: 30, performance: 'good', fr: '83.9%', dc: '60.0%' },
                { city: 'Dammam', status: 'Old', riders: 33, target: 33, performance: 'average', fr: '79.4%', dc: '45.5%' },
                { city: 'Makkah', status: 'Old', riders: 28, target: 30, performance: 'average', fr: '93.5%', dc: '48.3%' },
                { city: 'Riyadh', status: 'Old', riders: 61, target: 90, performance: 'good', fr: '74.3%', dc: '25.9%' }
            ],
            'AL-BARAQ AL-KHATEF': [
                { city: 'Riyadh', status: 'Old', riders: 275, target: 280, performance: 'good', fr: '66.0%', dc: '4.3%' }
            ],
            'Quick Way Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 68, target: 49, performance: 'average', fr: '94.6%', dc: '65.3%' },
                { city: 'Buraydah', status: 'New', riders: 14, target: 17, performance: 'average', fr: '86.7%', dc: '35.3%' },
                { city: 'Dammam', status: 'Old', riders: 50, target: 44, performance: 'average', fr: '79.6%', dc: '24.3%' },
                { city: 'Jubail', status: 'Old', riders: 28, target: 27, performance: 'good', fr: '83.3%', dc: '56.7%' },
                { city: 'Riyadh', status: 'New', riders: 21, target: 40, performance: 'good', fr: '85.7%', dc: '73.7%' }
            ],
            'Makhsos': [
                { city: 'Riyadh', status: 'Old', riders: 171, target: 218, performance: 'good', fr: '75.5%', dc: '87.4%' }
            ],
            'Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services': [
                { city: 'Al Kharj', status: 'Old', riders: 100, target: 88, performance: 'good', fr: '79.2%', dc: '18.7%' },
                { city: 'Dammam', status: 'Old', riders: 63, target: 60, performance: 'good', fr: '83.6%', dc: '22.4%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 28, target: 12, performance: 'good', fr: '96.7%', dc: '91.7%' },
                { city: 'Tabuk', status: 'Old', riders: 23, target: 17, performance: 'good', fr: '95.7%', dc: '0.0%' },
                { city: 'Taif', status: 'Old', riders: 14, target: 15, performance: 'good', fr: '93.3%', dc: '7.1%' }
            ],
            'PCC': [
                { city: 'Jeddah', status: 'Old', riders: 88, target: 68, performance: 'good', fr: '80.2%', dc: '1.0%' },
                { city: 'Riyadh', status: 'Old', riders: 112, target: 100, performance: 'good', fr: '46.8%', dc: '6.1%' }
            ],
            'AMC': [
                { city: 'Jeddah', status: 'Old', riders: 123, target: 153, performance: 'good', fr: '94.2%', dc: '17.7%' },
                { city: 'Yanbu', status: 'Old', riders: 41, target: 40, performance: 'good', fr: '84.8%', dc: '0.0%' }
            ],
            'AMIYAL': [
                { city: 'Abha', status: 'Old', riders: 36, target: 25, performance: 'average', fr: '82.5%', dc: '80.0%' },
                { city: 'Jeddah', status: 'Old', riders: 124, target: 125, performance: 'good', fr: '86.0%', dc: '9.2%' },
                { city: 'Makkah', status: 'New', riders: 15, target: 19, performance: 'average', fr: '88.9%', dc: '16.7%' }
            ],
            'FAHAD AL-SHARQ': [
                { city: 'Riyadh', status: 'Old', riders: 145, target: 169, performance: 'good', fr: '48.7%', dc: '9.9%' }
            ],
            'SAKA SRIAA LALCHUDMAT AL-LUGASTIA': [
                { city: 'Abha', status: 'Old', riders: 32, target: 30, performance: 'good', fr: '97.1%', dc: '60.0%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 36, target: 35, performance: 'good', fr: '97.4%', dc: '73.0%' },
                { city: 'Jeddah', status: 'Old', riders: 64, target: 75, performance: 'good', fr: '77.1%', dc: '30.2%' },
                { city: 'Riyadh', status: 'New', riders: 21, target: 35, performance: 'good', fr: '95.8%', dc: '44.4%' }
            ],
            'Holoul': [
                { city: 'Riyadh', status: 'Old', riders: 106, target: 125, performance: 'good', fr: '86.7%', dc: '83.3%' }
            ],
            'Establishment ASHRAF BEN HASSIN BEN ALI BOUGRARDAH For logistics': [
                { city: 'Madinah', status: 'Old', riders: 160, target: 150, performance: 'good', fr: '83.2%', dc: '4.8%' }
            ],
            'EXPRESS GATE': [
                { city: 'Jeddah', status: 'Old', riders: 127, target: 139, performance: 'good', fr: '73.2%', dc: '7.5%' },
                { city: 'Riyadh', status: 'Old', riders: 13, target: 19, performance: 'average', fr: '47.1%', dc: '22.7%' }
            ]
        };

        const top20BreakdownJan = {
            'ON Time Logistics': [
                { city: 'Buraydah', status: 'Old', riders: 14, target: 15, performance: 'average', fr: '100.0%', dc: '46.7%' },
                { city: 'Dammam', status: 'Old', riders: 53, target: 50, performance: 'average', fr: '95.1%', dc: '53.7%' },
                { city: 'Jeddah', status: 'Old', riders: 45, target: 45, performance: 'average', fr: '95.2%', dc: '52.1%' },
                { city: 'Madinah', status: 'Old', riders: 62, target: 65, performance: 'average', fr: '98.8%', dc: '90.8%' },
                { city: 'Riyadh', status: 'Old', riders: 159, target: 150, performance: 'average', fr: '74.9%', dc: '34.0%' }
            ],
            'ONE TRIP': [
                { city: 'Abha', status: 'Old', riders: 20, target: 20, performance: 'good', fr: '96.3%', dc: '57.1%' },
                { city: 'Buraydah', status: 'Old', riders: 33, target: 40, performance: 'good', fr: '97.6%', dc: '88.2%' },
                { city: 'Dammam', status: 'Old', riders: 39, target: 35, performance: 'good', fr: '100.0%', dc: '17.5%' },
                { city: 'Riyadh', status: 'Old', riders: 193, target: 200, performance: 'good', fr: '95.2%', dc: '26.0%' },
                { city: 'Tabuk', status: 'Old', riders: 26, target: 20, performance: 'good', fr: '100.0%', dc: '3.8%' }
            ],
            'PARTNER SUCCESS': [
                { city: 'Jeddah', status: 'Old', riders: 84, target: 92, performance: 'good', fr: '94.5%', dc: '100.0%' },
                { city: 'Riyadh', status: 'Old', riders: 156, target: 165, performance: 'good', fr: '93.5%', dc: '100.0%' }
            ],
            'First Line Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 15, target: 0, performance: 'bad', fr: '95.5%', dc: '0.0%' },
                { city: 'Buraydah', status: 'Old', riders: 12, target: 0, performance: 'average', fr: '100.0%', dc: '0.0%' },
                { city: 'Dammam', status: 'Old', riders: 56, target: 40, performance: 'good', fr: '95.5%', dc: '3.2%' },
                { city: 'Jeddah', status: 'Old', riders: 88, target: 85, performance: 'average', fr: '97.2%', dc: '2.0%' },
                { city: 'Makkah', status: 'Old', riders: 29, target: 15, performance: 'good', fr: '100.0%', dc: '3.2%' },
                { city: 'Madinah', status: 'Old', riders: 10, target: 10, performance: 'good', fr: '90.0%', dc: '84.6%' },
                { city: 'Najran', status: 'Old', riders: 15, target: 15, performance: 'good', fr: '100.0%', dc: '0.0%' },
                { city: 'Riyadh', status: 'Old', riders: 38, target: 40, performance: 'good', fr: '100.0%', dc: '7.5%' },
                { city: 'Yanbu', status: 'Old', riders: 9, target: 10, performance: 'good', fr: '100.0%', dc: '0.0%' }
            ],
            'SDC Logistics': [
                { city: 'Dammam', status: 'Old', riders: 29, target: 25, performance: 'average', fr: '97.3%', dc: '9.4%' },
                { city: 'Riyadh', status: 'Old', riders: 232, target: 185, performance: 'good', fr: '100.0%', dc: '6.3%' }
            ],
            'Anan Capital': [
                { city: 'Al Ahsa', status: 'Old', riders: 28, target: 35, performance: 'average', fr: '100.0%', dc: '62.5%' },
                { city: 'Dammam', status: 'Old', riders: 30, target: 33, performance: 'average', fr: '97.1%', dc: '51.5%' },
                { city: 'Makkah', status: 'Old', riders: 28, target: 25, performance: 'average', fr: '100.0%', dc: '70.0%' },
                { city: 'Madinah', status: 'Old', riders: 21, target: 25, performance: 'good', fr: '100.0%', dc: '54.2%' },
                { city: 'Riyadh', status: 'Old', riders: 76, target: 80, performance: 'good', fr: '96.8%', dc: '37.9%' }
            ],
            'AL-BARAQ AL-KHATEF': [
                { city: 'Riyadh', status: 'Old', riders: 265, target: 195, performance: 'good', fr: '93.7%', dc: '19.3%' }
            ],
            'Quick Way Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 41, target: 50, performance: 'average', fr: '100.0%', dc: '81.6%' },
                { city: 'Buraydah', status: 'New', riders: 16, target: 15, performance: 'average', fr: '100.0%', dc: '52.9%' },
                { city: 'Dammam', status: 'Old', riders: 38, target: 39, performance: 'average', fr: '98.2%', dc: '63.0%' },
                { city: 'Jubail', status: 'Old', riders: 26, target: 32, performance: 'average', fr: '100.0%', dc: '89.3%' },
                { city: 'Riyadh', status: 'New', riders: 33, target: 50, performance: 'average', fr: '100.0%', dc: '87.2%' }
            ],
            'Makhsos': [
                { city: 'Riyadh', status: 'Old', riders: 189, target: 180, performance: 'good', fr: '95.0%', dc: '86.6%' }
            ],
            'Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services': [
                { city: 'Al Kharj', status: 'Old', riders: 85, target: 85, performance: 'good', fr: '98.9%', dc: '30.0%' },
                { city: 'Dammam', status: 'Old', riders: 55, target: 54, performance: 'average', fr: '98.4%', dc: '42.4%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 12, target: 13, performance: 'good', fr: '100.0%', dc: '100.0%' },
                { city: 'Tabuk', status: 'Old', riders: 16, target: 17, performance: 'good', fr: '100.0%', dc: '16.7%' },
                { city: 'Taif', status: 'Old', riders: 13, target: 0, performance: 'good', fr: '100.0%', dc: '14.3%' }
            ],
            'PCC': [
                { city: 'Jeddah', status: 'Old', riders: 94, target: 70, performance: 'good', fr: '98.0%', dc: '0.0%' },
                { city: 'Riyadh', status: 'Old', riders: 95, target: 98, performance: 'good', fr: '98.2%', dc: '11.0%' }
            ],
            'AMC': [
                { city: 'Jeddah', status: 'Old', riders: 137, target: 131, performance: 'average', fr: '96.3%', dc: '38.3%' },
                { city: 'Yanbu', status: 'Old', riders: 38, target: 35, performance: 'good', fr: '100.0%', dc: '2.5%' }
            ],
            'AMIYAL': [
                { city: 'Abha', status: 'Old', riders: 24, target: 20, performance: 'average', fr: '96.3%', dc: '95.5%' },
                { city: 'Jeddah', status: 'Old', riders: 116, target: 110, performance: 'good', fr: '93.9%', dc: '15.3%' },
                { city: 'Makkah', status: 'Old', riders: 17, target: 20, performance: 'good', fr: '100.0%', dc: '21.1%' }
            ],
            'FAHAD AL-SHARQ': [
                { city: 'Riyadh', status: 'Old', riders: 151, target: 150, performance: 'good', fr: '91.0%', dc: '12.2%' }
            ],
            'SAKA SRIAA LALCHUDMAT AL-LUGASTIA': [
                { city: 'Abha', status: 'Old', riders: 30, target: 32, performance: 'good', fr: '100.0%', dc: '80.6%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 35, target: 30, performance: 'good', fr: '100.0%', dc: '89.2%' },
                { city: 'Jeddah', status: 'Old', riders: 61, target: 60, performance: 'average', fr: '100.0%', dc: '34.7%' },
                { city: 'Riyadh', status: 'New', riders: 24, target: 27, performance: 'average', fr: '93.5%', dc: '55.2%' }
            ],
            'AL-ANJAZ AL-MATARAA': [
                { city: 'Jeddah', status: 'Old', riders: 91, target: 100, performance: 'good', fr: '99.1%', dc: '52.5%' },
                { city: 'Taif', status: 'Old', riders: 12, target: 28, performance: 'good', fr: '94.7%', dc: '20.0%' },
                { city: 'Yanbu', status: 'Old', riders: 12, target: 13, performance: 'good', fr: '100.0%', dc: '38.5%' }
            ],
            'Holoul': [
                { city: 'Riyadh', status: 'Old', riders: 122, target: 135, performance: 'good', fr: '100.0%', dc: '85.6%' }
            ],
            'EXPSERCO': [
                { city: 'Jeddah', status: 'Old', riders: 129, target: 132, performance: 'good', fr: '95.2%', dc: '100.0%' }
            ],
            'Establishment ASHRAF BEN HASSIN BEN ALI BOUGRARDAH For logistics': [
                { city: 'Madinah', status: 'Old', riders: 138, target: 130, performance: 'average', fr: '92.1%', dc: '8.4%' }
            ],
            'EXPRESS GATE': [
                { city: 'Jeddah', status: 'Old', riders: 126, target: 112, performance: 'average', fr: '85.7%', dc: '14.3%' },
                { city: 'Riyadh', status: 'Old', riders: 20, target: 15, performance: 'good', fr: '90.5%', dc: '29.2%' }
            ]
        };

        // Top 20 Ranked Partners (by highest city coverage) - Feb only
        const rankedFeb = [
            { name: 'First Line Logistics', cities: 9, status: 'Old', riders: 272, target: 215, performance: 'average', fr: '97.6%', dc: '11.2%' },
            { name: 'NAJIZ', cities: 5, status: 'Old', riders: 117, target: 51, performance: 'good', fr: '96.0%', dc: '22.5%' },
            { name: 'ONE TRIP', cities: 5, status: 'Old', riders: 311, target: 315, performance: 'good', fr: '97.8%', dc: '38.5%' },
            { name: 'Next Mile', cities: 5, status: 'Old', riders: 131, target: 121, performance: 'average', fr: '98.5%', dc: '14.8%' },
            { name: 'Anan Capital', cities: 5, status: 'Old', riders: 184, target: 198, performance: 'good', fr: '98.8%', dc: '55.2%' },
            { name: 'Quick Way Logistics', cities: 5, status: 'Old', riders: 155, target: 186, performance: 'average', fr: '99.6%', dc: '74.8%' },
            { name: 'Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services', cities: 5, status: 'Old', riders: 182, target: 169, performance: 'good', fr: '99.5%', dc: '40.7%' },
            { name: 'ON Time Logistics', cities: 5, status: 'Old', riders: 332, target: 325, performance: 'average', fr: '92.8%', dc: '55.4%' },
            { name: 'Aibtukir', cities: 5, status: 'Old', riders: 113, target: 72, performance: 'good', fr: '94.4%', dc: '21.7%' },
            { name: 'services delivery', cities: 4, status: 'Old', riders: 142, target: 122, performance: 'good', fr: '98.9%', dc: '23.3%' },
            { name: 'SAKA SRIAA LALCHUDMAT AL-LUGASTIA', cities: 4, status: 'Old', riders: 149, target: 149, performance: 'average', fr: '98.4%', dc: '64.9%' },
            { name: 'TEM AL-TOUSSIL', cities: 4, status: 'Old', riders: 111, target: 109, performance: 'average', fr: '89.8%', dc: '46.4%' },
            { name: 'Sama Golden logistics', cities: 4, status: 'Old', riders: 60, target: 70, performance: 'average', fr: '96.5%', dc: '36.4%' },
            { name: 'AMIYAL', cities: 3, status: 'Old', riders: 157, target: 150, performance: 'good', fr: '96.7%', dc: '43.9%' },
            { name: 'WABM Logistics', cities: 3, status: 'Old', riders: 44, target: 66, performance: 'average', fr: '66.7%', dc: '66.7%' },
            { name: 'Tomorrow\'s Falcons Company', cities: 3, status: 'Old', riders: 78, target: 65, performance: 'good', fr: '94.0%', dc: '0.0%' },
            { name: 'Saudi falcon for logistics', cities: 3, status: 'Old', riders: 62, target: 43, performance: 'average', fr: '97.9%', dc: '2.0%' },
            { name: 'HERVEY AL-WAHHA', cities: 3, status: 'Old', riders: 71, target: 80, performance: 'average', fr: '98.8%', dc: '11.2%' },
            { name: 'SHAFAQ AL-KHAYR', cities: 3, status: 'Old', riders: 83, target: 75, performance: 'average', fr: '100.0%', dc: '37.1%' },
            { name: 'Ettijahat', cities: 3, status: 'Old', riders: 64, target: 54, performance: 'good', fr: '96.1%', dc: '14.3%' }
        ];

        // Breakdown data for Top 20 Ranked partners (city-level details) - Feb only
        const rankedBreakdownFeb = {
            'First Line Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 15, target: 0, performance: 'bad', fr: '95.5%', dc: '0.0%' },
                { city: 'Buraydah', status: 'Old', riders: 12, target: 0, performance: 'average', fr: '100.0%', dc: '0.0%' },
                { city: 'Dammam', status: 'Old', riders: 56, target: 40, performance: 'good', fr: '95.5%', dc: '3.2%' },
                { city: 'Jeddah', status: 'Old', riders: 88, target: 85, performance: 'average', fr: '97.2%', dc: '2.0%' },
                { city: 'Makkah', status: 'Old', riders: 29, target: 15, performance: 'good', fr: '100.0%', dc: '3.2%' },
                { city: 'Madinah', status: 'Old', riders: 10, target: 10, performance: 'good', fr: '90.0%', dc: '84.6%' },
                { city: 'Najran', status: 'Old', riders: 15, target: 15, performance: 'good', fr: '100.0%', dc: '0.0%' },
                { city: 'Riyadh', status: 'Old', riders: 38, target: 40, performance: 'good', fr: '100.0%', dc: '7.5%' },
                { city: 'Yanbu', status: 'Old', riders: 9, target: 10, performance: 'good', fr: '100.0%', dc: '0.0%' }
            ],
            'NAJIZ': [
                { city: 'Abha', status: 'Old', riders: 10, target: 0, performance: 'average', fr: '94.1%', dc: '18.2%' },
                { city: 'Hafar Al Batin', status: 'New', riders: 10, target: 10, performance: 'average', fr: '95.2%', dc: '91.7%' },
                { city: 'Hail', status: 'Old', riders: 36, target: 41, performance: 'good', fr: '96.2%', dc: '2.7%' },
                { city: 'Makkah', status: 'Old', riders: 27, target: 0, performance: 'average', fr: '100.0%', dc: '0.0%' },
                { city: 'Taif', status: 'Old', riders: 35, target: 0, performance: 'average', fr: '94.7%', dc: '0.0%' }
            ],
            'ONE TRIP': [
                { city: 'Abha', status: 'Old', riders: 20, target: 20, performance: 'good', fr: '96.3%', dc: '57.1%' },
                { city: 'Buraydah', status: 'Old', riders: 33, target: 40, performance: 'good', fr: '97.6%', dc: '88.2%' },
                { city: 'Dammam', status: 'Old', riders: 39, target: 35, performance: 'good', fr: '100.0%', dc: '17.5%' },
                { city: 'Riyadh', status: 'Old', riders: 193, target: 200, performance: 'good', fr: '95.2%', dc: '26.0%' },
                { city: 'Tabuk', status: 'Old', riders: 26, target: 20, performance: 'good', fr: '100.0%', dc: '3.8%' }
            ],
            'Next Mile': [
                { city: 'Al Ahsa', status: 'Old', riders: 25, target: 28, performance: 'good', fr: '100.0%', dc: '4.2%' },
                { city: 'Dammam', status: 'New', riders: 29, target: 24, performance: 'good', fr: '100.0%', dc: '8.3%' },
                { city: 'Jeddah', status: 'Old', riders: 32, target: 20, performance: 'average', fr: '94.7%', dc: '0.0%' },
                { city: 'Madinah', status: 'Old', riders: 10, target: 0, performance: 'average', fr: '100.0%', dc: '10.0%' },
                { city: 'Riyadh', status: 'Old', riders: 36, target: 49, performance: 'average', fr: '97.6%', dc: '51.4%' }
            ],
            'Anan Capital': [
                { city: 'Al Ahsa', status: 'Old', riders: 28, target: 35, performance: 'average', fr: '100.0%', dc: '62.5%' },
                { city: 'Dammam', status: 'Old', riders: 30, target: 33, performance: 'average', fr: '97.1%', dc: '51.5%' },
                { city: 'Makkah', status: 'Old', riders: 28, target: 25, performance: 'average', fr: '100.0%', dc: '70.0%' },
                { city: 'Madinah', status: 'Old', riders: 21, target: 25, performance: 'good', fr: '100.0%', dc: '54.2%' },
                { city: 'Riyadh', status: 'Old', riders: 76, target: 80, performance: 'good', fr: '96.8%', dc: '37.9%' }
            ],
            'Quick Way Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 41, target: 50, performance: 'average', fr: '100.0%', dc: '81.6%' },
                { city: 'Buraydah', status: 'New', riders: 16, target: 15, performance: 'average', fr: '100.0%', dc: '52.9%' },
                { city: 'Dammam', status: 'Old', riders: 38, target: 39, performance: 'average', fr: '98.2%', dc: '63.0%' },
                { city: 'Jubail', status: 'Old', riders: 26, target: 32, performance: 'average', fr: '100.0%', dc: '89.3%' },
                { city: 'Riyadh', status: 'New', riders: 33, target: 50, performance: 'average', fr: '100.0%', dc: '87.2%' }
            ],
            'Abdul Aziz Muhammmad bin Hassan Asiri for Logistics Services': [
                { city: 'Al Kharj', status: 'Old', riders: 85, target: 85, performance: 'good', fr: '98.9%', dc: '30.0%' },
                { city: 'Dammam', status: 'Old', riders: 55, target: 54, performance: 'average', fr: '98.4%', dc: '42.4%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 12, target: 13, performance: 'good', fr: '100.0%', dc: '100.0%' },
                { city: 'Tabuk', status: 'Old', riders: 16, target: 17, performance: 'good', fr: '100.0%', dc: '16.7%' },
                { city: 'Taif', status: 'Old', riders: 13, target: 0, performance: 'good', fr: '100.0%', dc: '14.3%' }
            ],
            'ON Time Logistics': [
                { city: 'Buraydah', status: 'Old', riders: 14, target: 15, performance: 'average', fr: '100.0%', dc: '46.7%' },
                { city: 'Dammam', status: 'Old', riders: 53, target: 50, performance: 'average', fr: '95.1%', dc: '53.7%' },
                { city: 'Jeddah', status: 'Old', riders: 45, target: 45, performance: 'average', fr: '95.2%', dc: '52.1%' },
                { city: 'Madinah', status: 'Old', riders: 62, target: 65, performance: 'average', fr: '98.8%', dc: '90.8%' },
                { city: 'Riyadh', status: 'Old', riders: 159, target: 150, performance: 'average', fr: '74.9%', dc: '34.0%' }
            ],
            'Aibtukir': [
                { city: 'Dammam', status: 'Old', riders: 16, target: 0, performance: 'bad', fr: '100.0%', dc: '0.0%' },
                { city: 'Jeddah', status: 'Old', riders: 37, target: 25, performance: 'good', fr: '100.0%', dc: '3.2%' },
                { city: 'Makkah', status: 'Old', riders: 13, target: 10, performance: 'average', fr: '100.0%', dc: '0.0%' },
                { city: 'Madinah', status: 'New', riders: 10, target: 12, performance: 'good', fr: '78.6%', dc: '100.0%' },
                { city: 'Riyadh', status: 'Old', riders: 36, target: 25, performance: 'good', fr: '93.2%', dc: '5.3%' }
            ],
            'services delivery': [
                { city: 'Abha', status: 'Old', riders: 20, target: 20, performance: 'good', fr: '100.0%', dc: '72.7%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 9, target: 10, performance: 'good', fr: '100.0%', dc: '10.0%' },
                { city: 'Jubail', status: 'Old', riders: 50, target: 42, performance: 'good', fr: '98.4%', dc: '5.8%' },
                { city: 'Riyadh', status: 'Old', riders: 62, target: 50, performance: 'good', fr: '97.1%', dc: '4.6%' }
            ],
            'SAKA SRIAA LALCHUDMAT AL-LUGASTIA': [
                { city: 'Abha', status: 'Old', riders: 30, target: 32, performance: 'good', fr: '100.0%', dc: '80.6%' },
                { city: 'Hafar Al Batin', status: 'Old', riders: 35, target: 30, performance: 'good', fr: '100.0%', dc: '89.2%' },
                { city: 'Jeddah', status: 'Old', riders: 61, target: 60, performance: 'average', fr: '100.0%', dc: '34.7%' },
                { city: 'Riyadh', status: 'New', riders: 24, target: 27, performance: 'average', fr: '93.5%', dc: '55.2%' }
            ],
            'TEM AL-TOUSSIL': [
                { city: 'Buraydah', status: 'Old', riders: 26, target: 25, performance: 'good', fr: '100.0%', dc: '29.6%' },
                { city: 'Madinah', status: 'Old', riders: 44, target: 48, performance: 'average', fr: '94.0%', dc: '40.4%' },
                { city: 'Riyadh', status: 'New', riders: 25, target: 18, performance: 'good', fr: '65.4%', dc: '72.0%' },
                { city: 'Tabuk', status: 'Old', riders: 16, target: 18, performance: 'good', fr: '100.0%', dc: '43.8%' }
            ],
            'Sama Golden logistics': [
                { city: 'Jeddah', status: 'Old', riders: 23, target: 33, performance: 'average', fr: '95.7%', dc: '25.0%' },
                { city: 'Madinah', status: 'Old', riders: 9, target: 10, performance: 'good', fr: '100.0%', dc: '13.3%' },
                { city: 'Riyadh', status: 'Old', riders: 20, target: 27, performance: 'average', fr: '90.2%', dc: '96.2%' },
                { city: 'Yanbu', status: 'Old', riders: 8, target: 0, performance: 'average', fr: '100.0%', dc: '11.1%' }
            ],
            'AMIYAL': [
                { city: 'Abha', status: 'Old', riders: 24, target: 20, performance: 'average', fr: '96.3%', dc: '95.5%' },
                { city: 'Jeddah', status: 'Old', riders: 116, target: 110, performance: 'good', fr: '93.9%', dc: '15.3%' },
                { city: 'Makkah', status: 'Old', riders: 17, target: 20, performance: 'good', fr: '100.0%', dc: '21.1%' }
            ],
            'WABM Logistics': [
                { city: 'Al Ahsa', status: 'Old', riders: 16, target: 11, performance: 'good', fr: '100.0%', dc: '100.0%' },
                { city: 'Dammam', status: 'Old', riders: 29, target: 30, performance: 'average', fr: '100.0%', dc: '100.0%' },
                { city: 'Riyadh', status: 'New', riders: 0, target: 25, performance: '-', fr: '0.0%', dc: '0.0%' }
            ],
            'Tomorrow\'s Falcons Company': [
                { city: 'Buraydah', status: 'Old', riders: 26, target: 24, performance: 'good', fr: '100.0%', dc: '0.0%' },
                { city: 'Jubail', status: 'Old', riders: 34, target: 26, performance: 'good', fr: '100.0%', dc: '0.0%' },
                { city: 'Riyadh', status: 'New', riders: 17, target: 15, performance: 'average', fr: '82.1%', dc: '0.0%' }
            ],
            'Saudi falcon for logistics': [
                { city: 'Dammam', status: 'Old', riders: 17, target: 0, performance: 'average', fr: '95.7%', dc: '5.9%' },
                { city: 'Madinah', status: 'New', riders: 14, target: 13, performance: 'good', fr: '100.0%', dc: '0.0%' },
                { city: 'Riyadh', status: 'Old', riders: 31, target: 30, performance: 'average', fr: '98.0%', dc: '0.0%' }
            ],
            'HERVEY AL-WAHHA': [
                { city: 'Dammam', status: 'Old', riders: 31, target: 31, performance: 'average', fr: '100.0%', dc: '6.3%' },
                { city: 'Jubail', status: 'Old', riders: 21, target: 26, performance: 'good', fr: '100.0%', dc: '8.7%' },
                { city: 'Riyadh', status: 'New', riders: 20, target: 23, performance: 'average', fr: '96.3%', dc: '18.5%' }
            ],
            'SHAFAQ AL-KHAYR': [
                { city: 'Dammam', status: 'New', riders: 28, target: 28, performance: 'average', fr: '100.0%', dc: '41.9%' },
                { city: 'Jazan', status: 'Old', riders: 12, target: 0, performance: 'good', fr: '100.0%', dc: '50.0%' },
                { city: 'Madinah', status: 'Old', riders: 44, target: 47, performance: 'average', fr: '100.0%', dc: '19.3%' }
            ],
            'Ettijahat': [
                { city: 'Jeddah', status: 'Old', riders: 43, target: 42, performance: 'good', fr: '96.0%', dc: '2.1%' },
                { city: 'Makkah', status: 'Old', riders: 9, target: 0, performance: 'average', fr: '100.0%', dc: '10.0%' },
                { city: 'Taif', status: 'Old', riders: 12, target: 12, performance: 'good', fr: '92.3%', dc: '30.8%' }
            ]
        };

        const bottomDec = [
            { name: 'Afkar Logistics', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Tadarak Logistics', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'QAWAFIL AL-NAKHABA', cities: 1, status: 'Old', riders: 10, target: 10, performance: 'average', fr: '90.9%', dc: '10.0%' },
            { name: 'ZikraSabiti', cities: 1, status: 'New', riders: null, target: 10, performance: '-', fr: '-', dc: '100.0%' },
            { name: 'STUL AL-MATIAZ', cities: 1, status: 'Old', riders: 16, target: 10, performance: 'good', fr: '100.0%', dc: '0.0%' },
            { name: 'NAS', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'AL-ALAMIN KOM', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'alshuhna almumayaza', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'MUSTER FLE', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Aqbal Logistics', cities: 1, status: 'Old', riders: 12, target: 10, performance: 'average', fr: '71.4%', dc: '36.4%' },
            { name: 'RADHI ABDULSAMEA', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'AL-TUQDAM AL-MASI', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'almasarat althnaiya', cities: 1, status: 'Old', riders: 14, target: 10, performance: 'average', fr: '75.0%', dc: '0.0%' },
            { name: 'Selsala', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'ashara khutut', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Al Nsoor (Eagle Logistics)', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'LEO Delivery', cities: 1, status: 'Old', riders: 13, target: 10, performance: 'good', fr: '93.8%', dc: '7.1%' },
            { name: 'Swiftlane', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Alkhutut Almudhia', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' },
            { name: 'Rakb Tayba', cities: '-', status: '-', riders: '-', target: '-', performance: '-', fr: '-', dc: '-' }
        ];

        const bottomJan = [
            { name: 'Afkar Logistics', cities: 1, status: 'New', riders: null, target: 10, performance: '-', fr: '0.0%', dc: '0.0%' },
            { name: 'Tadarak Logistics', cities: 1, status: 'Old', riders: null, target: 10, performance: 'average', fr: '100.0%', dc: '100.0%' },
            { name: 'QAWAFIL AL-NAKHABA', cities: 1, status: 'Old', riders: 9, target: 10, performance: 'average', fr: '100.0%', dc: '30.0%' },
            { name: 'ZikraSabiti', cities: 1, status: 'New', riders: 10, target: 10, performance: 'good', fr: '100.0%', dc: '100.0%' },
            { name: 'STUL AL-MATIAZ', cities: 1, status: 'Old', riders: 11, target: 10, performance: 'good', fr: '100.0%', dc: '0.0%' },
            { name: 'NAS', cities: 2, status: 'Old', riders: 11, target: 10, performance: 'average', fr: '83.3%', dc: '6.3%' },
            { name: 'AL-ALAMIN KOM', cities: 1, status: 'New', riders: 16, target: 10, performance: 'average', fr: '78.3%', dc: '100.0%' },
            { name: 'alshuhna almumayaza', cities: 1, status: 'New', riders: 17, target: 10, performance: 'average', fr: '100.0%', dc: '42.1%' },
            { name: 'MUSTER FLE', cities: 1, status: 'Old', riders: 19, target: 10, performance: 'average', fr: '73.0%', dc: '96.8%' },
            { name: 'Aqbal Logistics', cities: 1, status: 'Old', riders: 10, target: 10, performance: 'average', fr: '100.0%', dc: '30.0%' },
            { name: 'RADHI ABDULSAMEA', cities: 1, status: 'New', riders: 6, target: 10, performance: 'bad', fr: '87.5%', dc: '40.9%' },
            { name: 'AL-TUQDAM AL-MASI', cities: 1, status: 'Old', riders: 8, target: 10, performance: 'average', fr: '100.0%', dc: '62.5%' },
            { name: 'almasarat althnaiya', cities: 1, status: 'Old', riders: 9, target: 10, performance: 'average', fr: '100.0%', dc: '30.8%' },
            { name: 'Selsala', cities: 1, status: 'New', riders: 9, target: 10, performance: 'good', fr: '100.0%', dc: '100.0%' },
            { name: 'ashara khutut', cities: 1, status: 'New', riders: 10, target: 10, performance: 'good', fr: '100.0%', dc: '45.5%' },
            { name: 'Al Nsoor (Eagle Logistics)', cities: 1, status: 'Old', riders: null, target: 10, performance: 'bad', fr: '0.0%', dc: '100.0%' },
            { name: 'LEO Delivery', cities: 1, status: 'Old', riders: 12, target: 10, performance: 'average', fr: '100.0%', dc: '58.8%' },
            { name: 'Swiftlane', cities: 1, status: 'Old', riders: 12, target: 10, performance: 'average', fr: '100.0%', dc: '7.7%' },
            { name: 'Alkhutut Almudhia', cities: 1, status: 'Old', riders: 14, target: 10, performance: 'average', fr: '100.0%', dc: '10.0%' },
            { name: 'Rakb Tayba', cities: 1, status: 'Old', riders: 15, target: 10, performance: 'average', fr: '100.0%', dc: '10.0%' }
        ];

        const normalizeName = (name) => name.trim().toLowerCase();
        const mapByName = (rows) => {
            const map = new Map();
            rows.forEach(row => map.set(normalizeName(row.name), row));
            return map;
        };

        const momColor = (mom) => {
            const val = parseFloat(mom);
            if (val > 0) return '#16a34a';
            if (val < 0) return '#dc2626';
            return '#f59e0b';
        };

        const formatDual = (decVal, janVal) => {
            const decText = decVal === null || decVal === undefined || decVal === '' ? '-' : decVal;
            const janText = janVal === null || janVal === undefined || janVal === '' ? '-' : janVal;
            return `
                <div style="font-size: 12px; color: #6b7280;">Dec: <strong style="color:#111827;">${decText}</strong></div>
                <div style="font-size: 12px; color: #6b7280;">Jan: <strong style="color:#111827;">${janText}</strong></div>
            `;
        };

        const formatNumber = (val) => (val === null || val === undefined || val === '' || val === '-') ? '-' : Number(val).toLocaleString();

        // Color coding for FR% and Driver Card%
        // FR%: Green >= 80%, Yellow 50-79%, Red < 50%
        // Driver Card%: Green >= 50%, Yellow 20-49%, Red < 20%
        const getFRColor = (val) => {
            if (val === '-' || val === null || val === undefined || val === '') return '#6b7280';
            const num = parseFloat(val);
            if (isNaN(num)) return '#6b7280';
            if (num >= 80) return '#16a34a';
            if (num >= 50) return '#f59e0b';
            return '#dc2626';
        };

        const getDCColor = (val) => {
            if (val === '-' || val === null || val === undefined || val === '') return '#6b7280';
            const num = parseFloat(val);
            if (isNaN(num)) return '#6b7280';
            if (num >= 50) return '#16a34a';
            if (num >= 20) return '#f59e0b';
            return '#dc2626';
        };

        const formatVal = (val) => (val === null || val === undefined || val === '' || val === '-') ? '-' : val;

        const getPerformanceBadge = (val) => {
            const perf = (val || '').toString().toLowerCase();
            if (perf === 'good') {
                return '<span style="display: inline-block; padding: 2px 8px; border-radius: 999px; background: #dcfce7; color: #166534; font-weight: 700; font-size: 11px;">good</span>';
            }
            if (perf === 'average') {
                return '<span style="display: inline-block; padding: 2px 8px; border-radius: 999px; background: #fef3c7; color: #92400e; font-weight: 700; font-size: 11px;">average</span>';
            }
            if (perf === 'bad') {
                return '<span style="display: inline-block; padding: 2px 8px; border-radius: 999px; background: #fee2e2; color: #991b1b; font-weight: 700; font-size: 11px;">bad</span>';
            }
            return '<span style="color: #6b7280;">-</span>';
        };

        const getNewOldBadge = (val) => {
            const status = (val || '').toString().toLowerCase();
            if (status === 'new') {
                return '<span style="display: inline-block; padding: 2px 8px; border-radius: 999px; background: #dcfce7; color: #166534; font-weight: 700; font-size: 11px;">new</span>';
            }
            if (status === 'old') {
                return '<span style="display: inline-block; padding: 2px 8px; border-radius: 999px; background: #e2e8f0; color: #334155; font-weight: 700; font-size: 11px;">old</span>';
            }
            return '<span style="color: #6b7280;">-</span>';
        };

        // Track expanded state for each partner
        const expandedPartners = new Set();

        function togglePartnerBreakdown(partnerName) {
            if (expandedPartners.has(partnerName)) {
                expandedPartners.delete(partnerName);
            } else {
                expandedPartners.clear();
                expandedPartners.add(partnerName);
            }
            renderPartnersOverview(currentPartnersView);
        }

        let currentPartnersView = 'top';

        function renderPartnersOverview(view) {
            currentPartnersView = view;
            const body = document.getElementById('partnersOverviewTableBody');
            const thead = document.getElementById('partnersOverviewTableHead');
            const table = document.getElementById('partnersOverviewTable');
            const noteDiv = document.getElementById('partnersOverviewNote');
            if (!body || !thead) return;

            // Update table header based on view
            if (view === 'ranked') {
                table.style.minWidth = '900px';
                thead.innerHTML = `
                    <tr style="background: #0ea5e9; color: white;">
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db; min-width: 40px;">#</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #d1d5db; min-width: 200px;">Partner</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;"># of cities</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">New/Old</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Delivery riders</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Total target</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Performance</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Avg FR %</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #d1d5db;">Avg Driver Card %</th>
                    </tr>
                `;
            } else {
                table.style.minWidth = '1200px';
                thead.innerHTML = `
                    <tr style="background: #0ea5e9; color: white;">
                        <th rowspan="2" style="padding: 10px; text-align: center; border: 1px solid #d1d5db; min-width: 40px; vertical-align: middle;">#</th>
                        <th rowspan="2" style="padding: 10px; text-align: left; border: 1px solid #d1d5db; min-width: 200px; vertical-align: middle;">Partner</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;"># of cities</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">New/Old</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Delivery riders</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Total target</th>
                        <th rowspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db; vertical-align: middle;">MoM %<br>(Target)</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Performance</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Avg FR %</th>
                        <th colspan="2" style="padding: 8px; text-align: center; border: 1px solid #d1d5db;">Avg Driver Card %</th>
                    </tr>
                    <tr style="background: #0284c7; color: white;">
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Jan</th>
                        <th style="padding: 6px 8px; text-align: center; border: 1px solid #d1d5db; font-size: 11px;">Feb</th>
                    </tr>
                `;
            }

            // Update note
            if (noteDiv) {
                if (view === 'ranked') {
                    noteDiv.querySelector('p').innerHTML = '<strong>\ud83d\udccb Note:</strong> Top 20 partners ranked by highest city coverage across the Kingdom (Feb only). Shows partners with the widest geographic reach. Performance, FR & Driver Card rates are averaged across all covered cities.';
                } else {
                    noteDiv.querySelector('p').innerHTML = '<strong>\ud83d\udccb Note:</strong> Table compares Jan vs Feb per partner. MoM% shown for Total Target only. Total target reflects riders across all covered cities. Performance is based on highest-target city. FR & Driver Card rates are averaged across cities.';
                }
            }

            // Handle ranked view (Feb-only, single columns)
            if (view === 'ranked') {
                body.innerHTML = '';
                rankedFeb.forEach((partner, idx) => {
                    const hasBreakdown = rankedBreakdownFeb[partner.name];
                    const isExpanded = expandedPartners.has(partner.name);
                    const focusActive = expandedPartners.size > 0;
                    const isFocused = expandedPartners.has(partner.name);

                    const row = document.createElement('tr');
                    row.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                    row.style.cursor = hasBreakdown ? 'pointer' : 'default';
                    row.setAttribute('data-partner', partner.name);
                    if (focusActive && !isFocused) row.classList.add('blurred-row');

                    let partnerNameHtml = '';
                    if (hasBreakdown) {
                        const arrow = isExpanded ? '\u25BC' : '\u25B6';
                        partnerNameHtml = `<span style="color: #0ea5e9; margin-right: 8px; font-size: 12px;">${arrow}</span><span style="font-weight: 600;">${partner.name}</span>`;
                    } else {
                        partnerNameHtml = `<span style="font-weight: 600; margin-left: 20px;">${partner.name}</span>`;
                    }

                    row.innerHTML = `
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 12px;">${idx + 1}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb;">${partnerNameHtml}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatVal(partner.cities)}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getNewOldBadge(partner.status)}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(partner.riders)}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(partner.target)}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center;">${getPerformanceBadge(partner.performance)}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600; font-size: 12px; color: ${getFRColor(partner.fr)};">${formatVal(partner.fr)}</td>
                        <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600; font-size: 12px; color: ${getDCColor(partner.dc)};">${formatVal(partner.dc)}</td>
                    `;

                    if (hasBreakdown) {
                        row.onclick = () => togglePartnerBreakdown(partner.name);
                    }
                    body.appendChild(row);

                    // Render breakdown rows if expanded
                    if (hasBreakdown && isExpanded) {
                        const breakdown = rankedBreakdownFeb[partner.name] || [];
                        breakdown.forEach((cityData, cityIdx) => {
                            const breakdownRow = document.createElement('tr');
                            breakdownRow.style.background = '#f0f9ff';
                            breakdownRow.style.borderLeft = '4px solid #0ea5e9';
                            breakdownRow.setAttribute('data-partner', partner.name);
                            if (focusActive && !isFocused) breakdownRow.classList.add('blurred-row');

                            breakdownRow.innerHTML = `
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; color: #6b7280;">${cityIdx + 1}</td>
                                <td style="padding: 6px 10px 6px 36px; border: 1px solid #e5e7eb; font-size: 12px; color: #0369a1;">
                                    <span style="color: #94a3b8;">\u21b3</span> ${cityData.city}
                                </td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; color: #6b7280;">1</td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getNewOldBadge(cityData.status)}</td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(cityData.riders)}</td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(cityData.target)}</td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getPerformanceBadge(cityData.performance)}</td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${getFRColor(cityData.fr)};">${formatVal(cityData.fr)}</td>
                                <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${getDCColor(cityData.dc)};">${formatVal(cityData.dc)}</td>
                            `;
                            body.appendChild(breakdownRow);
                        });
                    }
                });
                return;
            }

            // Handle top/bottom views (dual Jan/Feb columns)
            const decRows = view === 'top' ? topDec : bottomDec;
            const janRows = view === 'top' ? topJan : bottomJan;

            const decMap = mapByName(decRows);
            const janMap = mapByName(janRows);

            const names = Array.from(new Set([...decRows, ...janRows].map(r => normalizeName(r.name))));
            const nameLookup = new Map();
            [...decRows, ...janRows].forEach(r => nameLookup.set(normalizeName(r.name), r.name));

            body.innerHTML = '';

            const calcMoMPercent = (janVal, febVal) => {
                const hasJan = janVal !== null && janVal !== undefined && janVal !== '-';
                const hasFeb = febVal !== null && febVal !== undefined && febVal !== '-';

                if (!hasJan && !hasFeb) return null;
                if (!hasJan && hasFeb) return '100.0';
                if (hasJan && !hasFeb) return '-100.0';

                const janNum = Number(janVal);
                const febNum = Number(febVal);
                if (!Number.isFinite(janNum) || !Number.isFinite(febNum)) return null;

                if (janNum === 0) {
                    if (febNum === 0) return '0.0';
                    return '100.0';
                }

                return (((febNum - janNum) / janNum) * 100).toFixed(1);
            };

            names.forEach((key, idx) => {
                const dec = decMap.get(key);
                const jan = janMap.get(key);
                const partnerName = nameLookup.get(key) || '-';

                const focusActive = expandedPartners.size > 0;
                const isFocused = expandedPartners.has(partnerName);

                const decTarget = dec ? dec.target : null;
                const janTarget = jan ? jan.target : null;
                const mom = calcMoMPercent(decTarget, janTarget);
                const momText = mom === null ? '-' : `${mom}%`;

                // Check if this partner has breakdown data (only for Top 20)
                const hasBreakdown = view === 'top' && (top20BreakdownDec[partnerName] || top20BreakdownJan[partnerName]);
                const isExpanded = expandedPartners.has(partnerName);

                const row = document.createElement('tr');
                row.style.background = idx % 2 === 0 ? '#ffffff' : '#f9fafb';
                row.style.cursor = hasBreakdown ? 'pointer' : 'default';
                row.setAttribute('data-partner', partnerName);
                if (focusActive && !isFocused) {
                    row.classList.add('blurred-row');
                }
                
                // Partner name with expand/collapse arrow
                let partnerNameHtml = '';
                if (hasBreakdown) {
                    const arrow = isExpanded ? '▼' : '▶';
                    partnerNameHtml = `<span style="color: #0ea5e9; margin-right: 8px; font-size: 12px;">${arrow}</span><span style="font-weight: 600;">${partnerName}</span>`;
                } else {
                    partnerNameHtml = `<span style="font-weight: 600; margin-left: 20px;">${partnerName}</span>`;
                }

                // Get FR and DC values
                const decFR = dec ? dec.fr : '-';
                const janFR = jan ? jan.fr : '-';
                const decDC = dec ? dec.dc : '-';
                const janDC = jan ? jan.dc : '-';

                row.innerHTML = `
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 12px;">${idx + 1}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb;">${partnerNameHtml}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatVal(dec ? dec.cities : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatVal(jan ? jan.cities : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getNewOldBadge(dec ? dec.status : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getNewOldBadge(jan ? jan.status : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(dec ? dec.riders : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(jan ? jan.riders : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(dec ? dec.target : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(jan ? jan.target : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 700; font-size: 12px; color: ${mom === null ? '#6b7280' : momColor(mom)};">${momText}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center;">${getPerformanceBadge(dec ? dec.performance : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center;">${getPerformanceBadge(jan ? jan.performance : '-')}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600; font-size: 12px; color: ${getFRColor(decFR)};">${formatVal(decFR)}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600; font-size: 12px; color: ${getFRColor(janFR)};">${formatVal(janFR)}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600; font-size: 12px; color: ${getDCColor(decDC)};">${formatVal(decDC)}</td>
                    <td style="padding: 8px 10px; border: 1px solid #e5e7eb; text-align: center; font-weight: 600; font-size: 12px; color: ${getDCColor(janDC)};">${formatVal(janDC)}</td>
                `;
                
                if (hasBreakdown) {
                    row.onclick = () => togglePartnerBreakdown(partnerName);
                }
                
                body.appendChild(row);

                // Render breakdown rows if expanded (only for Top 20)
                if (hasBreakdown && isExpanded) {
                    const decBreakdown = top20BreakdownDec[partnerName] || [];
                    const janBreakdown = top20BreakdownJan[partnerName] || [];

                    // Create map for breakdown by city
                    const decCityMap = new Map();
                    decBreakdown.forEach(c => decCityMap.set(c.city, c));
                    const janCityMap = new Map();
                    janBreakdown.forEach(c => janCityMap.set(c.city, c));

                    // Get all unique cities
                    const allCities = Array.from(new Set([
                        ...decBreakdown.map(c => c.city),
                        ...janBreakdown.map(c => c.city)
                    ]));

                    allCities.forEach((city, cityIdx) => {
                        const decCity = decCityMap.get(city);
                        const janCity = janCityMap.get(city);

                        const decCityTarget = decCity ? decCity.target : null;
                        const janCityTarget = janCity ? janCity.target : null;
                        const cityMom = calcMoMPercent(decCityTarget, janCityTarget);
                        const cityMomText = cityMom === null ? '-' : `${cityMom}%`;

                        // Get FR and DC values for city
                        const decCityFR = decCity ? decCity.fr : '-';
                        const janCityFR = janCity ? janCity.fr : '-';
                        const decCityDC = decCity ? decCity.dc : '-';
                        const janCityDC = janCity ? janCity.dc : '-';

                        const breakdownRow = document.createElement('tr');
                        breakdownRow.style.background = '#f0f9ff';
                        breakdownRow.style.borderLeft = '4px solid #0ea5e9';
                        breakdownRow.setAttribute('data-partner', partnerName);
                        if (focusActive && !isFocused) {
                            breakdownRow.classList.add('blurred-row');
                        }
                        
                        breakdownRow.innerHTML = `
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; color: #6b7280;">${cityIdx + 1}</td>
                            <td style="padding: 6px 10px 6px 36px; border: 1px solid #e5e7eb; font-size: 12px; color: #0369a1;">
                                <span style="color: #94a3b8;">↳</span> ${city}
                            </td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; color: #6b7280;">1</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; color: #6b7280;">1</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getNewOldBadge(decCity ? decCity.status : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getNewOldBadge(janCity ? janCity.status : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(decCity ? decCity.riders : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(janCity ? janCity.riders : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(decCity ? decCity.target : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${formatNumber(janCity ? janCity.target : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${cityMom === null ? '#6b7280' : momColor(cityMom)};">${cityMomText}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getPerformanceBadge(decCity ? decCity.performance : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px;">${getPerformanceBadge(janCity ? janCity.performance : '-')}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${getFRColor(decCityFR)};">${formatVal(decCityFR)}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${getFRColor(janCityFR)};">${formatVal(janCityFR)}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${getDCColor(decCityDC)};">${formatVal(decCityDC)}</td>
                            <td style="padding: 6px 8px; border: 1px solid #e5e7eb; text-align: center; font-size: 12px; font-weight: 600; color: ${getDCColor(janCityDC)};">${formatVal(janCityDC)}</td>
                        `;
                        body.appendChild(breakdownRow);
                    });
                }
            });
        }

        function updatePartnersOverviewCards(view) {
            const dataRows = view === 'ranked' ? rankedFeb : (view === 'top' ? topJan : bottomJan);
            const TOTAL_TARGET = 19365; // Total capacity target Feb
            
            // Calculate stats from data
            let totalTarget = 0, goodCount = 0, avgCount = 0, frSum = 0, frCount = 0, dcSum = 0, dcCount = 0;
            
            dataRows.forEach(row => {
                if (row.target !== '-' && row.target !== null) {
                    totalTarget += row.target;
                }
                if (row.performance === 'good') goodCount++;
                if (row.performance === 'average') avgCount++;
                if (row.fr && row.fr !== '-') {
                    frSum += parseFloat(row.fr);
                    frCount++;
                }
                if (row.dc && row.dc !== '-') {
                    dcSum += parseFloat(row.dc);
                    dcCount++;
                }
            });
            
            const targetPct = TOTAL_TARGET > 0 ? ((totalTarget / TOTAL_TARGET) * 100).toFixed(1) : 0;
            const avgFR = frCount > 0 ? (frSum / frCount).toFixed(1) : '-';
            const avgDC = dcCount > 0 ? (dcSum / dcCount).toFixed(1) : '-';
            
            // Update cards
            const cardPartners = document.getElementById('poCardPartners');
            const cardTotalTarget = document.getElementById('poCardTotalTarget');
            const cardTargetPct = document.getElementById('poCardTargetPct');
            const cardGood = document.getElementById('poCardGood');
            const cardAvg = document.getElementById('poCardAvg');
            const cardAvgFR = document.getElementById('poCardAvgFR');
            const cardAvgDC = document.getElementById('poCardAvgDC');
            const cardTotalTargetContainer = document.getElementById('poCardTotalTargetContainer');
            
            if (cardPartners) cardPartners.textContent = dataRows.length;
            if (cardTotalTarget) cardTotalTarget.textContent = totalTarget.toLocaleString();
            if (cardTargetPct) {
                cardTargetPct.textContent = targetPct + '%';
            }
            // Update tooltip with calculation
            if (cardTotalTargetContainer) {
                const viewLabel = view === 'top' ? 'Top 20' : (view === 'bottom' ? 'Bottom 20' : 'Ranked 20');
                cardTotalTargetContainer.setAttribute('data-tooltip', `${viewLabel}: ${totalTarget.toLocaleString()} / ${TOTAL_TARGET.toLocaleString()} total = ${targetPct}% of total capacity target`);
            }
            if (cardGood) cardGood.textContent = goodCount;
            if (cardAvg) cardAvg.textContent = avgCount;
            if (cardAvgFR) cardAvgFR.textContent = avgFR + '%';
            if (cardAvgDC) cardAvgDC.textContent = avgDC + '%';
        }

        document.querySelectorAll('.partners-overview-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.partners-overview-btn').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                });
                this.style.background = '#0ea5e9';
                this.style.color = 'white';
                this.style.borderColor = '#0ea5e9';
                const view = this.getAttribute('data-view');
                renderPartnersOverview(view);
                updatePartnersOverviewCards(view);
            });
        });

        renderPartnersOverview('top');
        updatePartnersOverviewCards('top');
    });

    // February 2026 Success Metrics - KPI Cards
    document.addEventListener('DOMContentLoaded', function() {
        const successMetricsData = {
            capacity: {
                title: 'Capacity Target & Avg Scale',
                isCombined: true,
                capacityData: {
                    title: 'Capacity Target',
                    segments: [
                        { label: 'Good', target: 10800, achieved: 10192, gap: -608, achievement: 94 },
                        { label: 'Average', target: 7285, achieved: 8414, gap: 1129, achievement: 115 },
                        { label: 'Bad', target: 952, achieved: 370, gap: -582, achievement: 39 },
                        { label: 'Total', target: 19037, achieved: 18976, gap: -61, achievement: 100 }
                    ],
                    insights: [
                        'Average segment exceeded target by +1,129 riders.',
                        'Good segment is short by -608 riders.',
                        'Bad segment is significantly below target with a -582 rider gap.'
                    ]
                },
                avgscaleData: {
                    title: 'Avg Scale Target',
                    segments: [
                        { label: 'Good', target: 44.9, achieved: 40.4, gap: -4, achievement: 90 },
                        { label: 'Average', target: 29.7, achieved: 32.1, gap: 2, achievement: 108 },
                        { label: 'Bad', target: 16.4, achieved: 18.5, gap: 2, achievement: 113 },
                        { label: 'Total (Overall Avg Scale)', target: 36.0, achieved: 35.1, gap: -0.9, achievement: 98 }
                    ],
                    insights: [
                        'Overall avg scale is below target by -0.9.',
                        'Good segment is below target by -4.',
                        'Average and Bad segments exceeded targets.'
                    ]
                }
            },
            nextmonth: {
                title: 'March 2026 Target Planning',
                isNextMonth: true,
                forecastedTarget: 21675,
                segments: [
                    { label: 'Good Partners', shareTarget: 50, scaleTarget: 50.0, currentShare: 53.7, currentScale: 40.4, color: '#10b981' },
                    { label: 'Average Partners', shareTarget: 45, scaleTarget: 30.0, currentShare: 44.3, currentScale: 32.1, color: '#f59e0b' },
                    { label: 'Bad Partners', shareTarget: 5, scaleTarget: 18.0, currentShare: 2.0, currentScale: 18.5, color: '#ef4444' }
                ],
                overall: { scaleTarget: 40.0, currentScale: 35.1 },
                insights: [
                    '<strong>⚖️ Share Rebalance:</strong> Good partners set to 50% given the 13% forecast uplift and driver-card constraints; capacity shifts to strong Average partners to keep coverage balanced.',
                    '<strong>📊 Balanced Distribution:</strong> Average partners raised to 45% (from 44.3% current) to absorb incremental capacity while maintaining stability.',
                    '<strong>📈 Scale Enhancement:</strong> Overall avg scale target raised to 40.0 (from 35.1 current) to drive cost per order reduction through partner consolidation.',
                    '<strong>🔒 Risk Containment:</strong> Bad partners held at 5% (from 2.0% current) to provide a controlled buffer for compliance improvement and onboarding.',
                    '<strong>💰 CPO Optimization:</strong> Scale targets remain (Good: 50.0, Average: 30.0, Bad: 18.0) to maximize efficiency per delivery.'
                ]
            }
        };

        const formatValue = (val) => {
            if (val === null || val === undefined) return '-';
            return Number.isInteger(val) ? val.toLocaleString() : val.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });
        };

        const formatPct = (val) => {
            if (val === null || val === undefined || !Number.isFinite(val)) return '-';
            return val.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });
        };

        const getGapColor = (gap) => {
            if (gap > 0) return '#16a34a';
            if (gap < 0) return '#dc2626';
            return '#6b7280';
        };

        const getAchievementColor = (pct, gap) => {
            // Treat meeting/exceeding target as green even if we flip the ratio.
            if (Number.isFinite(gap) && gap >= 0) return '#16a34a';
            if (pct >= 95) return '#16a34a';
            if (pct >= 85) return '#f59e0b';
            return '#dc2626';
        };

        const computeAchievement = (target, achieved) => {
            const t = Number(target);
            const a = Number(achieved);
            if (!Number.isFinite(t) || t <= 0 || !Number.isFinite(a)) {
                return { pct: 0, formula: '-' };
            }

            const rawPct = (a / t) * 100;
            if (rawPct <= 100) {
                return { pct: rawPct, formula: `${formatValue(a)} / ${formatValue(t)}` };
            }

            // Flip for >100% cases to keep the metric visually intuitive.
            return { pct: (t / a) * 100, formula: `${formatValue(t)} / ${formatValue(a)}` };
        };

        const renderSuccessMetrics = (metricKey) => {
            const container = document.getElementById('successMetricsCards');
            const insights = document.getElementById('successMetricsInsights');
            if (!container || !insights) return;

            const data = successMetricsData[metricKey];
            container.innerHTML = '';

            // Special rendering for Next Month Target
            if (data.isNextMonth) {
                container.style.gridTemplateColumns = '1fr';
                
                // Header Section
                const headerCard = document.createElement('div');
                headerCard.style.cssText = 'background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%); border-radius: 16px; padding: 24px; color: white; margin-bottom: 10px;';
                headerCard.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                        <div>
                            <h3 style="margin: 0 0 8px 0; font-size: 22px; font-weight: 800;">🎯 ${data.title}</h3>
                            <p style="margin: 0; opacity: 0.9; font-size: 14px;">Strategic capacity allocation targets for next month</p>
                        </div>
                        <div style="display: flex; gap: 20px;">
                            <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 12px;">
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">Overall Scale Target</div>
                                <div style="font-size: 28px; font-weight: 800;">${data.overall.scaleTarget}</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 12px;">
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">Current Scale</div>
                                <div style="font-size: 28px; font-weight: 800;">${data.overall.currentScale}</div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(headerCard);
                
                // Forecasted Target Note
                if (data.forecastedTarget) {
                    const noteCard = document.createElement('div');
                    noteCard.style.cssText = 'background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 14px 18px; margin-bottom: 16px; display: flex; align-items: flex-start; gap: 12px;';
                    noteCard.innerHTML = `
                        <div style="font-size: 20px;">⚠️</div>
                        <div>
                            <div style="font-weight: 700; color: #92400e; font-size: 13px; margin-bottom: 4px;">Planning Assumption Notice</div>
                            <div style="font-size: 12px; color: #78350f; line-height: 1.5;">These targets are based on <strong>forecasted capacity target of ${data.forecastedTarget.toLocaleString()} riders</strong>. Target distribution percentages and scale metrics will be recalibrated if actual capacity requirements differ from forecast.</div>
                        </div>
                    `;
                    container.appendChild(noteCard);
                }

                // Segments Grid
                const segmentsGrid = document.createElement('div');
                segmentsGrid.style.cssText = 'display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 10px;';
                
                data.segments.forEach(seg => {
                    const shareGap = seg.shareTarget - seg.currentShare;
                    const scaleGap = seg.scaleTarget - seg.currentScale;
                    const shareGapColor = shareGap >= 0 ? '#16a34a' : '#dc2626';
                    const scaleGapColor = scaleGap >= 0 ? '#16a34a' : '#dc2626';
                    
                    const segCard = document.createElement('div');
                    segCard.style.cssText = 'background: white; border-radius: 16px; padding: 20px; border: 2px solid ' + seg.color + '20; box-shadow: 0 4px 12px rgba(0,0,0,0.05);';
                    segCard.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="width: 50px; height: 50px; border-radius: 12px; background: ${seg.color}15; display: flex; align-items: center; justify-content: center;">
                                <div style="width: 24px; height: 24px; border-radius: 50%; background: ${seg.color};"></div>
                            </div>
                            <div>
                                <div style="font-weight: 800; color: #1f4e78; font-size: 16px;">${seg.label}</div>
                                <div style="font-size: 11px; color: #6b7280;">Performance Segment</div>
                            </div>
                        </div>
                        
                        <div style="background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                            <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">📊 Capacity Share Target</div>
                            <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 8px;">
                                <span style="font-size: 32px; font-weight: 800; color: ${seg.color};">${seg.shareTarget}%</span>
                                <span style="font-size: 13px; color: #6b7280;">target</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; color: #6b7280;">Current: ${seg.currentShare}%</span>
                                <span style="font-size: 12px; font-weight: 700; color: ${shareGapColor};">(${shareGap >= 0 ? '+' : ''}${shareGap.toFixed(1)}%)</span>
                            </div>
                            <div style="background: #e5e7eb; height: 6px; border-radius: 3px; margin-top: 10px; overflow: hidden;">
                                <div style="background: ${seg.color}; height: 100%; width: ${Math.min(seg.currentShare / seg.shareTarget * 100, 100)}%; border-radius: 3px; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        
                        <div style="background: #f0fdf4; border-radius: 12px; padding: 16px;">
                            <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">📈 Avg Scale Target</div>
                            <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 8px;">
                                <span style="font-size: 32px; font-weight: 800; color: #059669;">${seg.scaleTarget}</span>
                                <span style="font-size: 13px; color: #6b7280;">riders/partner</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; color: #6b7280;">Current: ${seg.currentScale}</span>
                                <span style="font-size: 12px; font-weight: 700; color: ${scaleGapColor};">(${scaleGap >= 0 ? '+' : ''}${scaleGap.toFixed(1)})</span>
                            </div>
                        </div>
                    `;
                    segmentsGrid.appendChild(segCard);
                });
                
                container.appendChild(segmentsGrid);

                // Summary Distribution Bar
                const distBar = document.createElement('div');
                distBar.style.cssText = 'background: white; border-radius: 16px; padding: 20px; border: 1px solid #e5e7eb; box-shadow: 0 4px 12px rgba(0,0,0,0.05);';
                distBar.innerHTML = `
                    <div style="font-size: 13px; color: #6b7280; margin-bottom: 12px; font-weight: 600;">📊 Target Capacity Distribution (Mar 2026) - Balanced Strategy</div>
                    <div style="display: flex; height: 40px; border-radius: 8px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 50%; background: #10b981; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 13px;">Good 50%</div>
                        <div style="width: 45%; background: #f59e0b; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 13px;">Average 45%</div>
                        <div style="width: 5%; background: #ef4444; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 11px;">5%</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6b7280;">
                        <span>🎯 Quality: Maximize Good allocation</span>
                        <span>💰 CPO: Scale consolidation</span>
                        <span>🔒 Risk: Controlled Bad buffer</span>
                    </div>
                `;
                container.appendChild(distBar);

                // Reset grid for insights
                container.style.gridTemplateColumns = '1fr';
            } else if (data.isCombined) {
                // Combined Capacity Target & Avg Scale view
                container.style.gridTemplateColumns = '1fr';
                
                // Helper function to create segment cards
                const createSegmentCards = (segments) => {
                    const grid = document.createElement('div');
                    grid.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 18px; margin-bottom: 18px;';
                    
                    segments.forEach(seg => {
                        const card = document.createElement('div');
                        card.style.cssText = 'background: white; border: 1px solid #e5e7eb; border-radius: 16px; padding: 24px; box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06); display: flex; align-items: center; gap: 20px;';

                        const gap = (Number.isFinite(seg.target) && Number.isFinite(seg.achieved)) ? (seg.achieved - seg.target) : seg.gap;
                        const ach = computeAchievement(seg.target, seg.achieved);
                        const achPct = Math.max(0, Math.min(ach.pct, 100));
                        const achColor = getAchievementColor(ach.pct, gap);
                        
                        card.innerHTML = `
                            <div style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(${achColor} ${achPct}%, #e5e7eb 0); position: relative; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <div style="position: absolute; inset: 10px; background: white; border-radius: 50%; box-shadow: inset 0 0 0 1px #f3f4f6;"></div>
                                <div style="position: relative; font-weight: 800; color: #111827; font-size: 20px;">${formatPct(ach.pct)}%</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 800; color: #1f4e78; font-size: 20px; margin-bottom: 12px;">${seg.label}</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Target</div>
                                        <div style="font-weight: 800; color: #111827; font-size: 18px;">${formatValue(seg.target)}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Achieved</div>
                                        <div style="font-weight: 800; color: #111827; font-size: 18px;">${formatValue(seg.achieved)}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Gap</div>
                                        <div style="font-weight: 800; color: ${getGapColor(gap)}; font-size: 16px;">${gap > 0 ? '+' : ''}${formatValue(gap)}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Achievement</div>
                                        <div style="font-weight: 800; color: ${achColor}; font-size: 16px;">${formatPct(ach.pct)}%</div>
                                        <div style="margin-top: 2px; font-size: 11px; color: #94a3b8; font-weight: 700; letter-spacing: 0.2px;">${ach.formula}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                    return grid;
                };
                
                // Capacity Target Section
                const capacityHeader = document.createElement('h4');
                capacityHeader.style.cssText = 'color: #1f4e78; font-size: 18px; font-weight: 700; margin: 0 0 16px 0; padding-bottom: 8px; border-bottom: 2px solid #059669;';
                capacityHeader.innerHTML = '📊 Capacity Target';
                container.appendChild(capacityHeader);
                container.appendChild(createSegmentCards(data.capacityData.segments));
                
                // Capacity insights
                const capacityInsights = document.createElement('div');
                capacityInsights.className = 'highlight-box';
                capacityInsights.style.cssText = 'background: #f0fdf4; padding: 16px 20px; border-radius: 12px; border-left: 4px solid #059669; margin-bottom: 24px;';
                const capacityListItems = data.capacityData.insights.map(text => `<li style="margin-bottom: 8px; font-size: 13px; line-height: 1.5;">${text}</li>`).join('');
                capacityInsights.innerHTML = `
                    <h5 style="color: #065f46; margin: 0 0 10px 0; font-size: 14px;">💡 Key Observations</h5>
                    <ul style="margin: 0; padding-left: 20px;">${capacityListItems}</ul>
                `;
                container.appendChild(capacityInsights);
                
                // Avg Scale Target Section
                const avgscaleHeader = document.createElement('h4');
                avgscaleHeader.style.cssText = 'color: #1f4e78; font-size: 18px; font-weight: 700; margin: 0 0 16px 0; padding-bottom: 8px; border-bottom: 2px solid #0ea5e9;';
                avgscaleHeader.innerHTML = '📈 Avg Scale Target';
                container.appendChild(avgscaleHeader);
                container.appendChild(createSegmentCards(data.avgscaleData.segments));
                
                // Avg Scale insights
                const avgscaleInsights = document.createElement('div');
                avgscaleInsights.className = 'highlight-box';
                avgscaleInsights.style.cssText = 'background: #f0f9ff; padding: 16px 20px; border-radius: 12px; border-left: 4px solid #0ea5e9;';
                const avgscaleListItems = data.avgscaleData.insights.map(text => `<li style="margin-bottom: 8px; font-size: 13px; line-height: 1.5;">${text}</li>`).join('');
                avgscaleInsights.innerHTML = `
                    <h5 style="color: #0f4a6e; margin: 0 0 10px 0; font-size: 14px;">💡 Key Observations</h5>
                    <ul style="margin: 0; padding-left: 20px;">${avgscaleListItems}</ul>
                `;
                container.appendChild(avgscaleInsights);
                
                // Hide the main insights section since we have inline insights
                insights.style.display = 'none';
                return;
            } else {
                container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(320px, 1fr))';
                
                data.segments.forEach(seg => {
                    const card = document.createElement('div');
                    card.style.background = 'white';
                    card.style.border = '1px solid #e5e7eb';
                    card.style.borderRadius = '16px';
                    card.style.padding = '24px';
                    card.style.boxShadow = '0 6px 18px rgba(15, 23, 42, 0.06)';
                    card.style.display = 'flex';
                    card.style.alignItems = 'center';
                    card.style.gap = '20px';

                    const gap = (Number.isFinite(seg.target) && Number.isFinite(seg.achieved)) ? (seg.achieved - seg.target) : seg.gap;
                    const ach = computeAchievement(seg.target, seg.achieved);
                    const achPct = Math.max(0, Math.min(ach.pct, 100));
                    const achColor = getAchievementColor(ach.pct, gap);

                    card.innerHTML = `
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(${achColor} ${achPct}%, #e5e7eb 0); position: relative; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <div style="position: absolute; inset: 10px; background: white; border-radius: 50%; box-shadow: inset 0 0 0 1px #f3f4f6;"></div>
                            <div style="position: relative; font-weight: 800; color: #111827; font-size: 20px;">${formatPct(ach.pct)}%</div>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 800; color: #1f4e78; font-size: 20px; margin-bottom: 12px;">${seg.label}</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Target</div>
                                    <div style="font-weight: 800; color: #111827; font-size: 18px;">${formatValue(seg.target)}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Achieved</div>
                                    <div style="font-weight: 800; color: #111827; font-size: 18px;">${formatValue(seg.achieved)}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Gap</div>
                                    <div style="font-weight: 800; color: ${getGapColor(gap)}; font-size: 16px;">${gap > 0 ? '+' : ''}${formatValue(gap)}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #6b7280; letter-spacing: 0.3px;">Achievement</div>
                                    <div style="font-weight: 800; color: ${achColor}; font-size: 16px;">${formatPct(ach.pct)}%</div>
                                    <div style="margin-top: 2px; font-size: 11px; color: #94a3b8; font-weight: 700; letter-spacing: 0.2px;">${ach.formula}</div>
                                </div>
                            </div>
                        </div>
                    `;

                    container.appendChild(card);
                });
            }

            const listItems = data.insights.map(text => `<li style="margin-bottom: 10px; font-size: 14px; line-height: 1.5;">${text}</li>`).join('');
            insights.innerHTML = `
                <h4 style="color: #065f46; margin-bottom: 12px; font-size: 16px;">💡 ${data.isNextMonth ? 'Strategic Planning Insights' : 'Key Observations'}</h4>
                <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                    ${listItems}
                </ul>
            `;
        };

        document.querySelectorAll('.success-metrics-toggle').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.success-metrics-toggle').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#6b7280';
                    b.style.borderColor = '#e5e7eb';
                    b.classList.remove('active');
                });
                this.style.background = '#059669';
                this.style.color = 'white';
                this.style.borderColor = '#059669';
                this.classList.add('active');
                
                const metric = this.getAttribute('data-metric');
                const okrsSection = document.getElementById('okrsSummarySection');
                const cardsSection = document.getElementById('successMetricsCards');
                const insightsSection = document.getElementById('successMetricsInsights');
                
                // Remove previous animation classes
                [okrsSection, cardsSection, insightsSection].forEach(el => {
                    if (el) {
                        el.classList.remove('metrics-animate-in', 'metrics-fade-in');
                    }
                });
                
                if (metric === 'okrs') {
                    if (cardsSection) cardsSection.style.display = 'none';
                    if (insightsSection) insightsSection.style.display = 'none';
                    if (okrsSection) {
                        okrsSection.style.display = 'block';
                        okrsSection.style.opacity = '0';
                        setTimeout(() => {
                            okrsSection.classList.add('metrics-animate-in');
                            okrsSection.style.opacity = '1';
                        }, 50);
                    }
                } else {
                    if (okrsSection) okrsSection.style.display = 'none';
                    if (cardsSection) {
                        cardsSection.style.display = 'grid';
                        cardsSection.style.opacity = '0';
                        setTimeout(() => {
                            cardsSection.classList.add('metrics-animate-in');
                            cardsSection.style.opacity = '1';
                        }, 50);
                    }
                    if (insightsSection) {
                        insightsSection.style.opacity = '0';
                        insightsSection.style.display = 'block';
                        setTimeout(() => {
                            insightsSection.classList.add('metrics-fade-in');
                            insightsSection.style.opacity = '1';
                        }, 150);
                    }
                    renderSuccessMetrics(metric);
                }
            });
        });

        // OKR Card Toggle Function
        window.toggleOkrCard = function(btn) {
            const content = btn.nextElementSibling;
            const arrow = btn.querySelector('span:last-child');
            if (content.style.display === 'none' || !content.style.display) {
                content.style.display = 'block';
                content.style.opacity = '0';
                content.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    content.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                    content.style.opacity = '1';
                    content.style.transform = 'translateY(0)';
                }, 10);
                arrow.textContent = '▲';
            } else {
                content.style.transition = 'all 0.3s ease-out';
                content.style.opacity = '0';
                content.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    content.style.display = 'none';
                }, 300);
                arrow.textContent = '▼';
            }
        };

        renderSuccessMetrics('capacity');
    });


    </script>
</div></body>
</html>